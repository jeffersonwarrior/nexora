{
  "file_path": "/work/internal/agent/recovery/registry.go",
  "file_hash": "79f0c993eed2dbfe7d14aa3a6180a98cc195b022",
  "updated_at": "2025-12-26T17:34:20.486919",
  "symbols": {
    "struct_RecoveryRegistry_11": {
      "name": "RecoveryRegistry",
      "type": "struct",
      "start_line": 11,
      "end_line": 16,
      "content_hash": "635046f4821737d29ea66a97cc111c70721ed501",
      "content": "type RecoveryRegistry struct {\n\tstrategies  []RecoveryStrategy\n\tmaxAttempts int // Global limit (default: 3)\n}\n\n// NewRecoveryRegistry creates a new recovery registry with default strategies",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewRecoveryRegistry_17": {
      "name": "NewRecoveryRegistry",
      "type": "function",
      "start_line": 17,
      "end_line": 32,
      "content_hash": "a3e4958795a27d1b2881a1ea78021b3bcba61109",
      "content": "func NewRecoveryRegistry() *RecoveryRegistry {\n\tregistry := &RecoveryRegistry{\n\t\tmaxAttempts: 3,\n\t\tstrategies: []RecoveryStrategy{\n\t\t\t&FileOutdatedStrategy{},\n\t\t\t&EditFailedStrategy{},\n\t\t\t&LoopDetectedStrategy{},\n\t\t\t&TimeoutStrategy{},\n\t\t\t&ResourceLimitStrategy{},\n\t\t\t&PanicStrategy{},\n\t\t},\n\t}\n\treturn registry\n}\n\n// SetMaxAttempts sets the global maximum retry attempts",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_SetMaxAttempts_33": {
      "name": "SetMaxAttempts",
      "type": "method",
      "start_line": 33,
      "end_line": 40,
      "content_hash": "411f89ccd232daa853d182a5ff10e505a3d5ec41",
      "content": "func (rr *RecoveryRegistry) SetMaxAttempts(max int) {\n\tif max < 1 {\n\t\tmax = 3 // Minimum of 3 attempts\n\t}\n\trr.maxAttempts = max\n}\n\n// AddStrategy adds a new recovery strategy to the registry",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AddStrategy_41": {
      "name": "AddStrategy",
      "type": "method",
      "start_line": 41,
      "end_line": 45,
      "content_hash": "735a94b495ff5494575519c9d575ff1b9e0a3581",
      "content": "func (rr *RecoveryRegistry) AddStrategy(strategy RecoveryStrategy) {\n\trr.strategies = append(rr.strategies, strategy)\n}\n\n// RemoveStrategy removes a recovery strategy by name",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_RemoveStrategy_46": {
      "name": "RemoveStrategy",
      "type": "method",
      "start_line": 46,
      "end_line": 55,
      "content_hash": "c23448249cb0d144b268ee8cece338d0dd7620e7",
      "content": "func (rr *RecoveryRegistry) RemoveStrategy(name string) {\n\tfor i, strategy := range rr.strategies {\n\t\tif strategy.Name() == name {\n\t\t\trr.strategies = append(rr.strategies[:i], rr.strategies[i+1:]...)\n\t\t\tbreak\n\t\t}\n\t}\n}\n\n// FindStrategy finds the appropriate recovery strategy for a given error",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_FindStrategy_56": {
      "name": "FindStrategy",
      "type": "method",
      "start_line": 56,
      "end_line": 65,
      "content_hash": "1cf1ba51fdaeed264ac1f21c5acbe6064e3630c5",
      "content": "func (rr *RecoveryRegistry) FindStrategy(err error) RecoveryStrategy {\n\tfor _, strategy := range rr.strategies {\n\t\tif strategy.CanRecover(err) {\n\t\t\treturn strategy\n\t\t}\n\t}\n\treturn nil\n}\n\n// AttemptRecovery tries to recover from an error using an appropriate strategy",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AttemptRecovery_66": {
      "name": "AttemptRecovery",
      "type": "method",
      "start_line": 66,
      "end_line": 93,
      "content_hash": "265eb8ca781f1523fc63a1718c32ae9447231005",
      "content": "func (rr *RecoveryRegistry) AttemptRecovery(ctx context.Context, err error, execCtx *state.AgentExecutionContext) error {\n\tstrategy := rr.FindStrategy(err)\n\tif strategy == nil {\n\t\treturn fmt.Errorf(\"no recovery strategy found for error: %w\", err)\n\t}\n\n\t// Check both global and strategy-specific retry limits\n\tif execCtx.RetryCount >= rr.maxAttempts {\n\t\treturn fmt.Errorf(\"global retry limit (%d) exceeded: %w\", rr.maxAttempts, err)\n\t}\n\n\tif execCtx.RetryCount >= strategy.MaxRetries() {\n\t\treturn fmt.Errorf(\"strategy retry limit (%d) exceeded for %s: %w\",\n\t\t\tstrategy.MaxRetries(), strategy.Name(), err)\n\t}\n\n\t// Attempt recovery\n\trecoveryErr := strategy.Recover(ctx, err, execCtx)\n\tif recoveryErr != nil {\n\t\treturn fmt.Errorf(\"recovery failed using %s: %w\", strategy.Name(), recoveryErr)\n\t}\n\n\t// Increment retry count\n\texecCtx.RetryCount++\n\treturn nil\n}\n\n// GetAllStrategies returns all registered strategies (for testing/diagnostics)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetAllStrategies_94": {
      "name": "GetAllStrategies",
      "type": "method",
      "start_line": 94,
      "end_line": 98,
      "content_hash": "65894adb5cc79190591f90211e2962087e1785c8",
      "content": "func (rr *RecoveryRegistry) GetAllStrategies() []RecoveryStrategy {\n\treturn append([]RecoveryStrategy{}, rr.strategies...)\n}\n\n// GetStrategyNames returns the names of all registered strategies",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetStrategyNames_99": {
      "name": "GetStrategyNames",
      "type": "method",
      "start_line": 99,
      "end_line": 107,
      "content_hash": "5b3585a3b6e81cf34335f75d2746ea7f50975cf8",
      "content": "func (rr *RecoveryRegistry) GetStrategyNames() []string {\n\tnames := make([]string, len(rr.strategies))\n\tfor i, strategy := range rr.strategies {\n\t\tnames[i] = strategy.Name()\n\t}\n\treturn names\n}\n\n// CanRecover returns true if any strategy can handle the given error",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CanRecover_108": {
      "name": "CanRecover",
      "type": "method",
      "start_line": 108,
      "end_line": 112,
      "content_hash": "9502c14f44de3d803ebad036827e34ed07291b5d",
      "content": "func (rr *RecoveryRegistry) CanRecover(err error) bool {\n\treturn rr.FindStrategy(err) != nil\n}\n\n// GetMaxAttempts returns the global maximum retry attempts",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetMaxAttempts_113": {
      "name": "GetMaxAttempts",
      "type": "method",
      "start_line": 113,
      "end_line": 117,
      "content_hash": "8c90b6b80baa1d053c98a608f76c43dffe298805",
      "content": "func (rr *RecoveryRegistry) GetMaxAttempts() int {\n\treturn rr.maxAttempts\n}\n\n// Reset resets the registry to default state",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Reset_118": {
      "name": "Reset",
      "type": "method",
      "start_line": 118,
      "end_line": 130,
      "content_hash": "8f427d5057e663e8efaa0d283a685745fd559162",
      "content": "func (rr *RecoveryRegistry) Reset() {\n\trr.maxAttempts = 3\n\trr.strategies = []RecoveryStrategy{\n\t\t&FileOutdatedStrategy{},\n\t\t&EditFailedStrategy{},\n\t\t&LoopDetectedStrategy{},\n\t\t&TimeoutStrategy{},\n\t\t&ResourceLimitStrategy{},\n\t\t&PanicStrategy{},\n\t}\n}\n\n// Diagnostics provides information about the recovery system",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_RecoveryDiagnostics_131": {
      "name": "RecoveryDiagnostics",
      "type": "struct",
      "start_line": 131,
      "end_line": 138,
      "content_hash": "6a8e542abeaa6265b32e4ebc99d2cd0ce1ea5cac",
      "content": "type RecoveryDiagnostics struct {\n\tTotalStrategies    int      `json:\"total_strategies\"`\n\tStrategyNames      []string `json:\"strategy_names\"`\n\tGlobalMaxAttempts  int      `json:\"global_max_attempts\"`\n\tLastRecoveredError string   `json:\"last_recovered_error,omitempty\"`\n}\n\n// GetDiagnostics returns diagnostic information about the recovery registry",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetDiagnostics_139": {
      "name": "GetDiagnostics",
      "type": "method",
      "start_line": 139,
      "end_line": 147,
      "content_hash": "fba073e14641e6cfecdfc63553013d397cb6beea",
      "content": "func (rr *RecoveryRegistry) GetDiagnostics() RecoveryDiagnostics {\n\treturn RecoveryDiagnostics{\n\t\tTotalStrategies:   len(rr.strategies),\n\t\tStrategyNames:     rr.GetStrategyNames(),\n\t\tGlobalMaxAttempts: rr.maxAttempts,\n\t}\n}\n\n// CreateRecoveryStatistics tracks recovery attempts and outcomes",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_RecoveryStatistics_148": {
      "name": "RecoveryStatistics",
      "type": "struct",
      "start_line": 148,
      "end_line": 157,
      "content_hash": "fa5b0ab79b04cf6db8a82a453fea11bf6fdaf3de",
      "content": "type RecoveryStatistics struct {\n\tTotalAttempts   int            `json:\"total_attempts\"`\n\tSuccessCount    int            `json:\"success_count\"`\n\tFailureCount    int            `json:\"failure_count\"`\n\tStrategyCounts  map[string]int `json:\"strategy_counts\"`\n\tErrorTypeCounts map[string]int `json:\"error_type_counts\"`\n\tAverageRetries  float64        `json:\"average_retries\"`\n}\n\n// NewRecoveryStatistics creates empty statistics",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewRecoveryStatistics_158": {
      "name": "NewRecoveryStatistics",
      "type": "function",
      "start_line": 158,
      "end_line": 165,
      "content_hash": "0332d64b5732b35fe29891fb60178219f73b0c7d",
      "content": "func NewRecoveryStatistics() *RecoveryStatistics {\n\treturn &RecoveryStatistics{\n\t\tStrategyCounts:  make(map[string]int),\n\t\tErrorTypeCounts: make(map[string]int),\n\t}\n}\n\n// RecordAttempt records a recovery attempt",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_RecordAttempt_166": {
      "name": "RecordAttempt",
      "type": "method",
      "start_line": 166,
      "end_line": 179,
      "content_hash": "3c50fcbe0faf1a8040e1ef877f5b5b5578879940",
      "content": "func (rs *RecoveryStatistics) RecordAttempt(strategy string, errorType string, success bool, retryCount int) {\n\trs.TotalAttempts++\n\tif success {\n\t\trs.SuccessCount++\n\t} else {\n\t\trs.FailureCount++\n\t}\n\n\trs.StrategyCounts[strategy]++\n\trs.ErrorTypeCounts[errorType]++\n\n\t// Update average retries\n\trs.AverageRetries = float64(retryCount)\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}