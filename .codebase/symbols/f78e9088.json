{
  "file_path": "/work/context-engine/scripts/mcp_router/validation.py",
  "file_hash": "08c58db04c24e826bdf2f14b27d07cbf34d9941c",
  "updated_at": "2025-12-26T17:34:21.568749",
  "symbols": {
    "function_is_result_good_12": {
      "name": "is_result_good",
      "type": "function",
      "start_line": 12,
      "end_line": 43,
      "content_hash": "9174e87a064d8a614b60f7b02029014b617aa78c",
      "content": "def is_result_good(tool: str, resp: Dict[str, Any]) -> bool:\n    \"\"\"Check if result is good enough to stop the plan.\"\"\"\n    try:\n        r = resp.get(\"result\") or {}\n        sc = r.get(\"structuredContent\") or {}\n        rs = sc.get(\"result\") or {}\n        \n        if tool in {\"context_answer\", \"context_answer_compat\"}:\n            ans = rs.get(\"answer\") if isinstance(rs, dict) else None\n            if isinstance(ans, str):\n                s = ans.strip()\n                if s and not any(p in s.lower() for p in [\n                    \"insufficient context\", \"not enough context\", \"no relevant\", \"don't know\", \"cannot answer\"\n                ]):\n                    return True\n            cites = rs.get(\"citations\") if isinstance(rs, dict) else None\n            if isinstance(cites, list) and len(cites) > 0:\n                return True\n            return False\n        \n        if tool.startswith(\"search_\") or tool == \"repo_search\":\n            total = rs.get(\"total\") if isinstance(rs, dict) else None\n            if isinstance(total, int) and total > 0:\n                return True\n            results = rs.get(\"results\") if isinstance(rs, dict) else None\n            if isinstance(results, list) and len(results) > 0:\n                return True\n            return False\n        \n        return not is_failure_response(resp)\n    except Exception:\n        return not is_failure_response(resp)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_extract_metric_from_resp_46": {
      "name": "extract_metric_from_resp",
      "type": "function",
      "start_line": 46,
      "end_line": 75,
      "content_hash": "6ea243b6ea8190fcbf402c997b9a9683571174b5",
      "content": "def extract_metric_from_resp(tool: str, resp: Dict[str, Any]) -> tuple[str, float] | None:\n    \"\"\"Extract metric for divergence detection.\"\"\"\n    try:\n        r = resp.get(\"result\") or {}\n        sc = r.get(\"structuredContent\") or {}\n        rs = sc.get(\"result\") or {}\n        \n        if tool in {\"repo_search\", \"code_search\", \"context_search\", \"search_tests_for\", \"search_config_for\", \"search_callers_for\", \"search_importers_for\"}:\n            tot = rs.get(\"total\")\n            if isinstance(tot, (int, float)):\n                return (\"total_results\", float(tot))\n            results = rs.get(\"results\")\n            if isinstance(results, list):\n                return (\"total_results\", float(len(results)))\n            return None\n        \n        if tool in {\"context_answer\", \"context_answer_compat\"}:\n            cites = rs.get(\"citations\")\n            if isinstance(cites, list):\n                return (\"citations\", float(len(cites)))\n            return (\"citations\", 0.0)\n        \n        if tool == \"qdrant_status\":\n            cnt = rs.get(\"count\")\n            if isinstance(cnt, (int, float)):\n                return (\"points\", float(cnt))\n            return None\n    except Exception:\n        return None\n    return None",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_material_drop_78": {
      "name": "material_drop",
      "type": "function",
      "start_line": 78,
      "end_line": 87,
      "content_hash": "14dc10c1bf7c69cb3b543532856d0717eb8a2770",
      "content": "def material_drop(prev: float | None, curr: float, drop_frac: float, min_base: int) -> bool:\n    \"\"\"Check if there's a material drop in metrics.\"\"\"\n    try:\n        if prev is None:\n            return False\n        if prev < float(min_base):\n            return False\n        return curr < (float(prev) * float(drop_frac))\n    except Exception:\n        return False",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}