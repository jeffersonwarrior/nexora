{
  "file_path": "/work/context-engine/scripts/mcp_impl/workspace.py",
  "file_hash": "a2bd1c2296881f689e9f762a07b471210447fbf1",
  "updated_at": "2025-12-26T17:34:23.831490",
  "symbols": {
    "function__state_file_path_66": {
      "name": "_state_file_path",
      "type": "function",
      "start_line": 66,
      "end_line": 73,
      "content_hash": "fc749d72274c5a75202e9fd659e08791a005ffb5",
      "content": "def _state_file_path(ws_path: str = \"/work\") -> str:\n    \"\"\"Get path to workspace state file, delegating to workspace_state module.\"\"\"\n    try:\n        from scripts.workspace_state import _state_file_path as _ws_state_file_path\n        return str(_ws_state_file_path(workspace_path=ws_path, repo_name=None))\n    except Exception as exc:\n        logger.warning(f\"State file path construction failed, using fallback: {exc}\")\n        return os.path.join(ws_path, \".codebase\", \"state.json\")",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function__read_ws_state_76": {
      "name": "_read_ws_state",
      "type": "function",
      "start_line": 76,
      "end_line": 87,
      "content_hash": "5e66090d5d9658c0161261f11fe5ff6168a3d556",
      "content": "def _read_ws_state(ws_path: str = \"/work\") -> Optional[Dict[str, Any]]:\n    \"\"\"Read and parse workspace state JSON file.\"\"\"\n    try:\n        p = _state_file_path(ws_path)\n        if not os.path.exists(p):\n            return None\n        with open(p, \"r\", encoding=\"utf-8\") as f:\n            obj = json.load(f)\n            return obj if isinstance(obj, dict) else None\n    except Exception as e:\n        logger.debug(f\"Failed to read workspace state: {e}\")\n        return None",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function__default_collection_90": {
      "name": "_default_collection",
      "type": "function",
      "start_line": 90,
      "end_line": 100,
      "content_hash": "8b92647bd2d2952fc14612fb6cda69cd596d4a31",
      "content": "def _default_collection() -> str:\n    \"\"\"Resolve default collection name from env or workspace state.\"\"\"\n    env_coll = (os.environ.get(\"DEFAULT_COLLECTION\") or os.environ.get(\"COLLECTION_NAME\") or \"\").strip()\n    if env_coll:\n        return env_coll\n    st = _read_ws_state(\"/work\")\n    if st:\n        coll = st.get(\"qdrant_collection\")\n        if isinstance(coll, str) and coll.strip():\n            return coll.strip()\n    return DEFAULT_COLLECTION",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function__work_script_103": {
      "name": "_work_script",
      "type": "function",
      "start_line": 103,
      "end_line": 119,
      "content_hash": "506bf8a7e10947c66efee0baad7bddb8b8b61d8c",
      "content": "def _work_script(name: str) -> str:\n    \"\"\"Return path to script respecting bind mounts first, then /app, then local fallback.\"\"\"\n    try:\n        work_path = os.path.join(\"/work\", \"scripts\", name)\n        if os.path.exists(work_path):\n            return work_path\n    except Exception:\n        pass\n\n    try:\n        app_path = os.path.join(\"/app\", \"scripts\", name)\n        if os.path.exists(app_path):\n            return app_path\n    except Exception:\n        pass\n\n    return os.path.join(os.getcwd(), \"scripts\", name)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}