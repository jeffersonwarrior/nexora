{
  "file_path": "/work/external-deps/claude-mem/scripts/export-memories.ts",
  "file_hash": "aa38d3c60419e9262efb00402c59e8ae17e313b1",
  "updated_at": "2025-12-26T17:34:23.298652",
  "symbols": {
    "function_exportMemories_87": {
      "name": "exportMemories",
      "type": "function",
      "start_line": 87,
      "end_line": 177,
      "content_hash": "75a835cd67fd00219bbc46e25654595391d1a622",
      "content": "async function exportMemories(query: string, outputFile: string, project?: string) {\n  try {\n    // Read port from settings\n    const settings = SettingsDefaultsManager.loadFromFile(join(homedir(), '.claude-mem', 'settings.json'));\n    const port = parseInt(settings.CLAUDE_MEM_WORKER_PORT, 10);\n    const baseUrl = `http://localhost:${port}`;\n\n    console.log(`\ud83d\udd0d Searching for: \"${query}\"${project ? ` (project: ${project})` : ' (all projects)'}`);\n\n    // Build query params - use format=json for raw data\n    const params = new URLSearchParams({\n      query,\n      format: 'json',\n      limit: '999999'\n    });\n    if (project) params.set('project', project);\n\n    // Unified search - gets all result types using hybrid search\n    console.log('\ud83d\udce1 Fetching all memories via hybrid search...');\n    const searchResponse = await fetch(`${baseUrl}/api/search?${params.toString()}`);\n    if (!searchResponse.ok) {\n      throw new Error(`Failed to search: ${searchResponse.status} ${searchResponse.statusText}`);\n    }\n    const searchData = await searchResponse.json();\n\n    const observations: ObservationRecord[] = searchData.observations || [];\n    const summaries: SessionSummaryRecord[] = searchData.sessions || [];\n    const prompts: UserPromptRecord[] = searchData.prompts || [];\n\n    console.log(`\u2705 Found ${observations.length} observations`);\n    console.log(`\u2705 Found ${summaries.length} session summaries`);\n    console.log(`\u2705 Found ${prompts.length} user prompts`);\n\n    // Get unique SDK session IDs from observations and summaries\n    const sdkSessionIds = new Set<string>();\n    observations.forEach((o) => {\n      if (o.sdk_session_id) sdkSessionIds.add(o.sdk_session_id);\n    });\n    summaries.forEach((s) => {\n      if (s.sdk_session_id) sdkSessionIds.add(s.sdk_session_id);\n    });\n\n    // Get SDK sessions metadata via API\n    console.log('\ud83d\udce1 Fetching SDK sessions metadata...');\n    let sessions: SdkSessionRecord[] = [];\n    if (sdkSessionIds.size > 0) {\n      const sessionsResponse = await fetch(`${baseUrl}/api/sdk-sessions/batch`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ sdkSessionIds: Array.from(sdkSessionIds) })\n      });\n      if (sessionsResponse.ok) {\n        sessions = await sessionsResponse.json();\n      } else {\n        console.warn(`\u26a0\ufe0f Failed to fetch SDK sessions: ${sessionsResponse.status}`);\n      }\n    }\n    console.log(`\u2705 Found ${sessions.length} SDK sessions`);\n\n    // Create export data\n    const exportData: ExportData = {\n      exportedAt: new Date().toISOString(),\n      exportedAtEpoch: Date.now(),\n      query,\n      project,\n      totalObservations: observations.length,\n      totalSessions: sessions.length,\n      totalSummaries: summaries.length,\n      totalPrompts: prompts.length,\n      observations,\n      sessions,\n      summaries,\n      prompts\n    };\n\n    // Write to file\n    writeFileSync(outputFile, JSON.stringify(exportData, null, 2));\n\n    console.log(`\\n\ud83d\udce6 Export complete!`);\n    console.log(`\ud83d\udcc4 Output: ${outputFile}`);\n    console.log(`\ud83d\udcca Stats:`);\n    console.log(`   \u2022 ${exportData.totalObservations} observations`);\n    console.log(`   \u2022 ${exportData.totalSessions} sessions`);\n    console.log(`   \u2022 ${exportData.totalSummaries} summaries`);\n    console.log(`   \u2022 ${exportData.totalPrompts} prompts`);\n\n  } catch (error) {\n    console.error('\u274c Export failed:', error);\n    process.exit(1);\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}