{
  "file_path": "/work/internal/task/agent.go",
  "file_hash": "5f38ac378eb6a3ec03d2d586b2f36f501ca7970d",
  "updated_at": "2025-12-26T17:34:24.002585",
  "symbols": {
    "struct_AgentTaskMiddleware_10": {
      "name": "AgentTaskMiddleware",
      "type": "struct",
      "start_line": 10,
      "end_line": 15,
      "content_hash": "12ac0196a208ecb243c02d0a1a1978a048ad5bde",
      "content": "type AgentTaskMiddleware struct {\n\ttaskService    Service\n\tagentSessionID string\n}\n\n// NewAgentTaskMiddleware creates task middleware for a specific agent session",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewAgentTaskMiddleware_16": {
      "name": "NewAgentTaskMiddleware",
      "type": "function",
      "start_line": 16,
      "end_line": 23,
      "content_hash": "ea6aa2c0d4c4412ab49a71e5faf9c9fac027e236",
      "content": "func NewAgentTaskMiddleware(taskService Service, sessionID string) *AgentTaskMiddleware {\n\treturn &AgentTaskMiddleware{\n\t\ttaskService:    taskService,\n\t\tagentSessionID: sessionID,\n\t}\n}\n\n// StartFocusedTask begins a new focused task for the agent",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_StartFocusedTask_24": {
      "name": "StartFocusedTask",
      "type": "method",
      "start_line": 24,
      "end_line": 39,
      "content_hash": "485f0752e6bb97799987acae5d798a0f2eaf5ccb",
      "content": "func (atm *AgentTaskMiddleware) StartFocusedTask(ctx context.Context, title, description string, milestones []string) (*Task, error) {\n\tif len(milestones) == 0 {\n\t\t// Default milestone if none provided\n\t\tmilestones = []string{\"Complete the requested task\"}\n\t}\n\n\ttask := atm.taskService.CreateTask(ctx, atm.agentSessionID, title, description, \"Working on the current user request\", milestones)\n\n\t// Log task start\n\tfmt.Printf(\"\ud83c\udfaf Task Started: %s\\n\", title)\n\tfmt.Printf(\"\ud83d\udccd Context: %s\\n\", description)\n\n\treturn task, nil\n}\n\n// UpdateTaskContext dynamically updates the current working context",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_UpdateTaskContext_40": {
      "name": "UpdateTaskContext",
      "type": "method",
      "start_line": 40,
      "end_line": 44,
      "content_hash": "cbd671647695e8fa0f2e82fb640be7434f88aba6",
      "content": "func (atm *AgentTaskMiddleware) UpdateTaskContext(ctx context.Context, newContext string) {\n\tatm.taskService.UpdateTaskContext(ctx, atm.agentSessionID, newContext)\n}\n\n// CheckAndCorrectDrift analyzes responses and applies corrections if needed",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CheckAndCorrectDrift_45": {
      "name": "CheckAndCorrectDrift",
      "type": "method",
      "start_line": 45,
      "end_line": 58,
      "content_hash": "72fb37be0b9dc06b88fde8aac485bf29186fe917",
      "content": "func (atm *AgentTaskMiddleware) CheckAndCorrectDrift(ctx context.Context, response string) (string, bool) {\n\tanalysis := atm.taskService.AnalyzeDrift(ctx, atm.agentSessionID, response)\n\n\tif analysis.Drifted {\n\t\t// Return correction prompt\n\t\tcorrection := atm.taskService.GetCorrectionPrompt(ctx, atm.agentSessionID)\n\t\treturn fmt.Sprintf(\"[TASK CORRECTION NEEDED]\\n%s\\n\\nContinue with your focused task.\\n\\n[ORIGINAL RESPONSE FOLLOWS]\\n%s\",\n\t\t\tcorrection, response), true\n\t}\n\n\treturn response, false\n}\n\n// MarkProgress updates milestone based on agent work",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_MarkProgress_59": {
      "name": "MarkProgress",
      "type": "method",
      "start_line": 59,
      "end_line": 75,
      "content_hash": "388b109782a806a2b7b827893f96cea50876ae49",
      "content": "func (atm *AgentTaskMiddleware) MarkProgress(ctx context.Context, milestoneDescription string) {\n\ttask, exists := atm.taskService.GetActiveTask(ctx, atm.agentSessionID)\n\tif !exists {\n\t\treturn\n\t}\n\n\t// Find matching milestone\n\tfor _, milestone := range task.Milestones {\n\t\tif strings.Contains(strings.ToLower(milestone.Description), strings.ToLower(milestoneDescription)) {\n\t\t\tatm.taskService.MarkMilestoneProgress(ctx, atm.agentSessionID, milestone.ID, milestoneDescription)\n\t\t\tfmt.Printf(\"\u2705 Milestone Completed: %s\\n\", milestone.Title)\n\t\t\tbreak\n\t\t}\n\t}\n}\n\n// GetTaskSummary returns current task progress",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetTaskSummary_76": {
      "name": "GetTaskSummary",
      "type": "method",
      "start_line": 76,
      "end_line": 80,
      "content_hash": "2ea0509ef3af9febaeb72af11508499df153481f",
      "content": "func (atm *AgentTaskMiddleware) GetTaskSummary(ctx context.Context) TaskSummary {\n\treturn atm.taskService.GetTaskSummary(ctx, atm.agentSessionID)\n}\n\n// CompleteCurrentTask finishes the current task",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CompleteCurrentTask_81": {
      "name": "CompleteCurrentTask",
      "type": "method",
      "start_line": 81,
      "end_line": 89,
      "content_hash": "193ed07f00d825719a1b279e22cab2ca5f80955b",
      "content": "func (atm *AgentTaskMiddleware) CompleteCurrentTask(ctx context.Context) {\n\tsummary := atm.taskService.GetTaskSummary(ctx, atm.agentSessionID)\n\tif summary.Title != \"\" {\n\t\tatm.taskService.CompleteTask(ctx, atm.agentSessionID)\n\t\tfmt.Printf(\"\ud83c\udf89 Task Completed: %s (Progress: %.0f%%)\\n\", summary.Title, summary.Progress*100)\n\t}\n}\n\n// AutoTaskCreator automatically creates tasks from user prompts",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AutoTaskCreator_90": {
      "name": "AutoTaskCreator",
      "type": "method",
      "start_line": 90,
      "end_line": 99,
      "content_hash": "712975a6fbe8ceaebca19f3dae3be93e0611648f",
      "content": "func (atm *AgentTaskMiddleware) AutoTaskCreator(ctx context.Context, userPrompt string) (*Task, error) {\n\t// Extract task info from prompt\n\ttitle := extractTaskTitle(userPrompt)\n\tdescription := userPrompt\n\tmilestones := generateMilestones(userPrompt)\n\n\treturn atm.StartFocusedTask(ctx, title, description, milestones)\n}\n\n// extractTaskTitle creates a concise title from user prompt",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_extractTaskTitle_100": {
      "name": "extractTaskTitle",
      "type": "function",
      "start_line": 100,
      "end_line": 115,
      "content_hash": "b5045340d898b6d5d0ab9ca8f33cafcff919995a",
      "content": "func extractTaskTitle(prompt string) string {\n\tprompt = strings.TrimSpace(prompt)\n\n\t// If prompt is short, use it directly\n\tif len(prompt) < 50 {\n\t\treturn prompt\n\t}\n\n\t// Take first sentence or first ~40 chars\n\tif idx := strings.Index(prompt, \".\"); idx > 0 && idx < 40 {\n\t\treturn strings.TrimSpace(prompt[:idx])\n\t}\n\treturn prompt[:40] + \"...\"\n}\n\n// generateMilestones creates relevant milestones from the prompt",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_generateMilestones_116": {
      "name": "generateMilestones",
      "type": "function",
      "start_line": 116,
      "end_line": 160,
      "content_hash": "d8ca0206010e600eb3a33551d0a1b560a8e380a0",
      "content": "func generateMilestones(prompt string) []string {\n\tvar milestones []string\n\n\tpromptLower := strings.ToLower(prompt)\n\n\t// Common patterns and their milestones\n\tpatterns := []struct {\n\t\thints     []string\n\t\tmilestone string\n\t}{\n\t\t{[]string{\"add feature\", \"implement feature\"}, \"Add the new feature\"},\n\t\t{[]string{\"fix bug\", \"address issue\", \"resolve problem\"}, \"Fix the identified bug\"},\n\t\t{[]string{\"refactor\", \"improve\", \"optimize\"}, \"Refactor the existing code\"},\n\t\t{[]string{\"test\", \"write test\"}, \"Write comprehensive tests\"},\n\t\t{[]string{\"document\", \"add docs\", \"update documentation\"}, \"Update documentation\"},\n\t\t{[]string{\"remove\", \"delete\", \"clean up\"}, \"Remove unnecessary code\"},\n\t\t{[]string{\"update\", \"modify\", \"change\"}, \"Update the existing implementation\"},\n\t}\n\n\thighestMatchScore := 0\n\tvar bestMilestone string\n\n\tfor _, pattern := range patterns {\n\t\tscore := 0\n\t\tfor _, hint := range pattern.hints {\n\t\t\tif strings.Contains(promptLower, hint) {\n\t\t\t\tscore++\n\t\t\t}\n\t\t}\n\t\tif score > highestMatchScore {\n\t\t\thighestMatchScore = score\n\t\t\tbestMilestone = pattern.milestone\n\t\t}\n\t}\n\n\tif bestMilestone != \"\" {\n\t\tmilestones = append(milestones, bestMilestone)\n\t}\n\n\t// Always add a completion milestone\n\tmilestones = append(milestones, \"Verify the implementation works correctly\")\n\tmilestones = append(milestones, \"Format and commit the changes\")\n\n\treturn milestones\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}