{
  "file_path": "/work/internal/agent/tools/search_test.go",
  "file_hash": "a6e02537e7171128be8789837721c577f7d30801",
  "updated_at": "2025-12-26T17:34:22.045649",
  "symbols": {
    "function_TestSearchDuckDuckGo_12": {
      "name": "TestSearchDuckDuckGo",
      "type": "function",
      "start_line": 12,
      "end_line": 39,
      "content_hash": "deb7849cee081b32608ff8afbd2f6fde2f7b84f8",
      "content": "func TestSearchDuckDuckGo(t *testing.T) {\n\t// Create mock server\n\tserver := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\t\t// Return mock HTML response\n\t\thtml := `\n<!DOCTYPE html>\n<html>\n<body>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/page1\">Test Result 1</a>\n\t\t<a class=\"result__snippet\">This is the first test result snippet</a>\n\t</div>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/page2\">Test Result 2</a>\n\t\t<a class=\"result__snippet\">This is the second test result snippet</a>\n\t</div>\n</body>\n</html>\n`\n\t\tw.WriteHeader(http.StatusOK)\n\t\tw.Write([]byte(html))\n\t}))\n\tdefer server.Close()\n\n\t// Note: This test is limited because searchDuckDuckGo uses hardcoded URL\n\t// We can't easily test it without refactoring, but we include it for coverage\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestParseSearchResults_40": {
      "name": "TestParseSearchResults",
      "type": "function",
      "start_line": 40,
      "end_line": 77,
      "content_hash": "8d758dddca7c0c7d53cb4f856129359d0d15c18f",
      "content": "func TestParseSearchResults(t *testing.T) {\n\thtml := `\n<!DOCTYPE html>\n<html>\n<body>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/page1\">Test Result 1</a>\n\t\t<a class=\"result__snippet\">First snippet</a>\n\t</div>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/page2\">Test Result 2</a>\n\t\t<a class=\"result__snippet\">Second snippet</a>\n\t</div>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/y.js\">Ad Link</a>\n\t\t<a class=\"result__snippet\">This should be filtered</a>\n\t</div>\n</body>\n</html>\n`\n\n\tresults, err := parseSearchResults(html, 10)\n\trequire.NoError(t, err)\n\n\t// Should get 2 results (y.js filtered out)\n\tassert.Len(t, results, 2)\n\n\tassert.Equal(t, \"Test Result 1\", results[0].Title)\n\tassert.Equal(t, \"https://example.com/page1\", results[0].Link)\n\tassert.Equal(t, \"First snippet\", results[0].Snippet)\n\tassert.Equal(t, 1, results[0].Position)\n\n\tassert.Equal(t, \"Test Result 2\", results[1].Title)\n\tassert.Equal(t, \"https://example.com/page2\", results[1].Link)\n\tassert.Equal(t, \"Second snippet\", results[1].Snippet)\n\tassert.Equal(t, 2, results[1].Position)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestParseSearchResults_MaxResults_78": {
      "name": "TestParseSearchResults_MaxResults",
      "type": "function",
      "start_line": 78,
      "end_line": 103,
      "content_hash": "9dd1f2af4ed22e0551a23f7fa0a4b5f7e4c0e094",
      "content": "func TestParseSearchResults_MaxResults(t *testing.T) {\n\thtml := `\n<!DOCTYPE html>\n<html>\n<body>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/1\">Result 1</a>\n\t\t<a class=\"result__snippet\">Snippet 1</a>\n\t</div>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/2\">Result 2</a>\n\t\t<a class=\"result__snippet\">Snippet 2</a>\n\t</div>\n\t<div class=\"result\">\n\t\t<a class=\"result__a\" href=\"https://example.com/3\">Result 3</a>\n\t\t<a class=\"result__snippet\">Snippet 3</a>\n\t</div>\n</body>\n</html>\n`\n\n\tresults, err := parseSearchResults(html, 2)\n\trequire.NoError(t, err)\n\tassert.Len(t, results, 2)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestParseSearchResults_NoResults_104": {
      "name": "TestParseSearchResults_NoResults",
      "type": "function",
      "start_line": 104,
      "end_line": 111,
      "content_hash": "307279936cb1523dd773bcae3438988eeee8bd11",
      "content": "func TestParseSearchResults_NoResults(t *testing.T) {\n\thtml := `<!DOCTYPE html><html><body></body></html>`\n\n\tresults, err := parseSearchResults(html, 10)\n\trequire.NoError(t, err)\n\tassert.Len(t, results, 0)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestParseSearchResults_InvalidHTML_112": {
      "name": "TestParseSearchResults_InvalidHTML",
      "type": "function",
      "start_line": 112,
      "end_line": 119,
      "content_hash": "03da730a14720bed7c65e9e9e22ba02d234be757",
      "content": "func TestParseSearchResults_InvalidHTML(t *testing.T) {\n\thtml := `<invalid html`\n\n\t_, err := parseSearchResults(html, 10)\n\t// Should still parse, just return no results\n\tassert.NoError(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestHasClass_120": {
      "name": "TestHasClass",
      "type": "function",
      "start_line": 120,
      "end_line": 124,
      "content_hash": "b898feb3fb3428d40a3e42278c2169fdd83efeb4",
      "content": "func TestHasClass(t *testing.T) {\n\t// This is tested indirectly through parseSearchResults\n\t// but we can add direct tests if needed\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestGetTextContent_125": {
      "name": "TestGetTextContent",
      "type": "function",
      "start_line": 125,
      "end_line": 129,
      "content_hash": "a5bb0380d526c3d02ba7865d9bd49b0f74a45111",
      "content": "func TestGetTextContent(t *testing.T) {\n\t// This is tested indirectly through parseSearchResults\n\t// Direct testing would require html.Node construction\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCleanDuckDuckGoURL_130": {
      "name": "TestCleanDuckDuckGoURL",
      "type": "function",
      "start_line": 130,
      "end_line": 165,
      "content_hash": "6668b9c19bba7517886d7febbc46f0f657ec16d5",
      "content": "func TestCleanDuckDuckGoURL(t *testing.T) {\n\ttests := []struct {\n\t\tname     string\n\t\tinput    string\n\t\texpected string\n\t}{\n\t\t{\n\t\t\tname:     \"direct url\",\n\t\t\tinput:    \"https://example.com/page\",\n\t\t\texpected: \"https://example.com/page\",\n\t\t},\n\t\t{\n\t\t\tname:     \"duckduckgo redirect\",\n\t\t\tinput:    \"//duckduckgo.com/l/?uddg=https%3A%2F%2Fexample.com%2Fpage&rut=abc\",\n\t\t\texpected: \"https://example.com/page\",\n\t\t},\n\t\t{\n\t\t\tname:     \"duckduckgo redirect no extra params\",\n\t\t\tinput:    \"//duckduckgo.com/l/?uddg=https%3A%2F%2Fexample.com\",\n\t\t\texpected: \"https://example.com\",\n\t\t},\n\t\t{\n\t\t\tname:     \"malformed redirect\",\n\t\t\tinput:    \"//duckduckgo.com/l/?other=param\",\n\t\t\texpected: \"//duckduckgo.com/l/?other=param\",\n\t\t},\n\t}\n\n\tfor _, tt := range tests {\n\t\tt.Run(tt.name, func(t *testing.T) {\n\t\t\tresult := cleanDuckDuckGoURL(tt.input)\n\t\t\tassert.Equal(t, tt.expected, result)\n\t\t})\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestFormatSearchResults_166": {
      "name": "TestFormatSearchResults",
      "type": "function",
      "start_line": 166,
      "end_line": 225,
      "content_hash": "59da9a4c07881e339ec4c162dc12fb700f00c2c7",
      "content": "func TestFormatSearchResults(t *testing.T) {\n\ttests := []struct {\n\t\tname     string\n\t\tresults  []SearchResult\n\t\texpected string\n\t}{\n\t\t{\n\t\t\tname:     \"no results\",\n\t\t\tresults:  []SearchResult{},\n\t\t\texpected: \"No results were found\",\n\t\t},\n\t\t{\n\t\t\tname: \"single result\",\n\t\t\tresults: []SearchResult{\n\t\t\t\t{\n\t\t\t\t\tTitle:    \"Test Page\",\n\t\t\t\t\tLink:     \"https://example.com\",\n\t\t\t\t\tSnippet:  \"Test snippet\",\n\t\t\t\t\tPosition: 1,\n\t\t\t\t},\n\t\t\t},\n\t\t\texpected: \"Found 1 search results\",\n\t\t},\n\t\t{\n\t\t\tname: \"multiple results\",\n\t\t\tresults: []SearchResult{\n\t\t\t\t{\n\t\t\t\t\tTitle:    \"Page 1\",\n\t\t\t\t\tLink:     \"https://example.com/1\",\n\t\t\t\t\tSnippet:  \"Snippet 1\",\n\t\t\t\t\tPosition: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tTitle:    \"Page 2\",\n\t\t\t\t\tLink:     \"https://example.com/2\",\n\t\t\t\t\tSnippet:  \"Snippet 2\",\n\t\t\t\t\tPosition: 2,\n\t\t\t\t},\n\t\t\t},\n\t\t\texpected: \"Found 2 search results\",\n\t\t},\n\t}\n\n\tfor _, tt := range tests {\n\t\tt.Run(tt.name, func(t *testing.T) {\n\t\t\tresult := formatSearchResults(tt.results)\n\t\t\tassert.Contains(t, result, tt.expected)\n\n\t\t\t// For non-empty results, verify structure\n\t\t\tif len(tt.results) > 0 {\n\t\t\t\tfor _, r := range tt.results {\n\t\t\t\t\tassert.Contains(t, result, r.Title)\n\t\t\t\t\tassert.Contains(t, result, r.Link)\n\t\t\t\t\tassert.Contains(t, result, r.Snippet)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestSearchResult_Struct_226": {
      "name": "TestSearchResult_Struct",
      "type": "function",
      "start_line": 226,
      "end_line": 239,
      "content_hash": "3de627956fd6fab294f3035380b51c1888c7fea5",
      "content": "func TestSearchResult_Struct(t *testing.T) {\n\tresult := SearchResult{\n\t\tTitle:    \"Test\",\n\t\tLink:     \"https://example.com\",\n\t\tSnippet:  \"snippet\",\n\t\tPosition: 1,\n\t}\n\n\tassert.Equal(t, \"Test\", result.Title)\n\tassert.Equal(t, \"https://example.com\", result.Link)\n\tassert.Equal(t, \"snippet\", result.Snippet)\n\tassert.Equal(t, 1, result.Position)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestSearchDuckDuckGo_Context_240": {
      "name": "TestSearchDuckDuckGo_Context",
      "type": "function",
      "start_line": 240,
      "end_line": 243,
      "content_hash": "2719baabc4e4204164fc87518a6cdb1983615a95",
      "content": "func TestSearchDuckDuckGo_Context(t *testing.T) {\n\tt.Skip(\"Skip live DuckDuckGo test - requires network access\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestSearchDuckDuckGo_MaxResults_244": {
      "name": "TestSearchDuckDuckGo_MaxResults",
      "type": "function",
      "start_line": 244,
      "end_line": 246,
      "content_hash": "c37b61488b98d73230a44a761eb8cfb46a6e501c",
      "content": "func TestSearchDuckDuckGo_MaxResults(t *testing.T) {\n\tt.Skip(\"Skip live DuckDuckGo test - requires network access\")\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}