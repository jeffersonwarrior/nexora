{
  "file_path": "/work/internal/config/env_test.go",
  "file_hash": "56ce60650f69d2fbd7267e73e24a4df3cb1dce56",
  "updated_at": "2025-12-26T17:34:22.832558",
  "symbols": {
    "function_TestApplyEnvironmentVariables_8": {
      "name": "TestApplyEnvironmentVariables",
      "type": "function",
      "start_line": 8,
      "end_line": 134,
      "content_hash": "6cdf14ed8eb897faa1e1ddc9343d571766573b8c",
      "content": "func TestApplyEnvironmentVariables(t *testing.T) {\n\ttests := []struct {\n\t\tname     string\n\t\tenvVars  map[string]string\n\t\tinput    ProviderConfig\n\t\texpected ProviderConfig\n\t}{\n\t\t{\n\t\t\tname: \"apply authorization header\",\n\t\t\tenvVars: map[string]string{\n\t\t\t\t\"NEXORA_PROVIDER_HEADER_AUTHORIZATION\": \"Bearer test-token\",\n\t\t\t},\n\t\t\tinput: ProviderConfig{\n\t\t\t\tBaseURL: \"https://api.example.com\",\n\t\t\t},\n\t\t\texpected: ProviderConfig{\n\t\t\t\tBaseURL: \"https://api.example.com\",\n\t\t\t\tExtraHeaders: map[string]string{\n\t\t\t\t\t\"authorization\": \"Bearer test-token\",\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname: \"apply custom header and base URL\",\n\t\t\tenvVars: map[string]string{\n\t\t\t\t\"NEXORA_PROVIDER_HEADER_X_CUSTOM\": \"custom-value\",\n\t\t\t\t\"NEXORA_PROVIDER_BASE_URL\":        \"https://custom.api.com\",\n\t\t\t},\n\t\t\tinput: ProviderConfig{\n\t\t\t\tBaseURL: \"https://original.api.com\",\n\t\t\t},\n\t\t\texpected: ProviderConfig{\n\t\t\t\tBaseURL: \"https://custom.api.com\",\n\t\t\t\tExtraHeaders: map[string]string{\n\t\t\t\t\t\"x-custom\": \"custom-value\",\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname: \"merge with existing headers\",\n\t\t\tenvVars: map[string]string{\n\t\t\t\t\"NEXORA_PROVIDER_HEADER_AUTHORIZATION\": \"Bearer new-token\",\n\t\t\t},\n\t\t\tinput: ProviderConfig{\n\t\t\t\tBaseURL: \"https://api.example.com\",\n\t\t\t\tExtraHeaders: map[string]string{\n\t\t\t\t\t\"x-existing\": \"existing-value\",\n\t\t\t\t},\n\t\t\t},\n\t\t\texpected: ProviderConfig{\n\t\t\t\tBaseURL: \"https://api.example.com\",\n\t\t\t\tExtraHeaders: map[string]string{\n\t\t\t\t\t\"x-existing\":    \"existing-value\",\n\t\t\t\t\t\"authorization\": \"Bearer new-token\",\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname: \"no environment variables\",\n\t\t\tinput: ProviderConfig{\n\t\t\t\tBaseURL: \"https://api.example.com\",\n\t\t\t},\n\t\t\texpected: ProviderConfig{\n\t\t\t\tBaseURL: \"https://api.example.com\",\n\t\t\t},\n\t\t},\n\t}\n\n\tfor _, tt := range tests {\n\t\tt.Run(tt.name, func(t *testing.T) {\n\t\t\t// Store original environment variables for this test\n\t\t\toriginalVars := make(map[string]string)\n\t\t\tfor k := range tt.envVars {\n\t\t\t\toriginalVars[k] = os.Getenv(k)\n\t\t\t}\n\n\t\t\t// Clean up environment variables for this test\n\t\t\tt.Cleanup(func() {\n\t\t\t\tfor k, v := range originalVars {\n\t\t\t\t\tif v != \"\" {\n\t\t\t\t\t\tos.Setenv(k, v)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tos.Unsetenv(k)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t\t// Clear all test environment variables first\n\t\t\tfor k := range tt.envVars {\n\t\t\t\tos.Unsetenv(k)\n\t\t\t}\n\n\t\t\t// Set test environment variables\n\t\t\tfor k, v := range tt.envVars {\n\t\t\t\tos.Setenv(k, v)\n\t\t\t}\n\n\t\t\t// Apply environment variables deep copy of input\n\t\t\tconfig := tt.input\n\t\t\tif config.ExtraHeaders != nil {\n\t\t\t\t// Make a copy of headers to avoid test pollution\n\t\t\t\tconfig.ExtraHeaders = make(map[string]string)\n\t\t\t\tfor k, v := range tt.input.ExtraHeaders {\n\t\t\t\t\tconfig.ExtraHeaders[k] = v\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tapplyEnvironmentVariables(&config)\n\n\t\t\t// Compare results\n\t\t\tif config.BaseURL != tt.expected.BaseURL {\n\t\t\t\tt.Errorf(\"BaseURL = %v, want %v\", config.BaseURL, tt.expected.BaseURL)\n\t\t\t}\n\n\t\t\tif len(config.ExtraHeaders) != len(tt.expected.ExtraHeaders) {\n\t\t\t\tt.Errorf(\"ExtraHeaders length = %d, want %d\", len(config.ExtraHeaders), len(tt.expected.ExtraHeaders))\n\t\t\t}\n\n\t\t\tfor k, v := range tt.expected.ExtraHeaders {\n\t\t\t\tif config.ExtraHeaders[k] != v {\n\t\t\t\t\tt.Errorf(\"ExtraHeaders[%s] = %v, want %v\", k, config.ExtraHeaders[k], v)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestApplyEnvironmentVariablesWithMCP_135": {
      "name": "TestApplyEnvironmentVariablesWithMCP",
      "type": "function",
      "start_line": 135,
      "end_line": 157,
      "content_hash": "b341697a8dcf299b8ede6a19607854d01f5ff73c",
      "content": "func TestApplyEnvironmentVariablesWithMCP(t *testing.T) {\n\t// Test MCP-specific environment variables\n\torigHeader := os.Getenv(\"NEXORA_MCP_HEADER_AUTHORIZATION\")\n\tt.Cleanup(func() {\n\t\tif origHeader != \"\" {\n\t\t\tos.Setenv(\"NEXORA_MCP_HEADER_AUTHORIZATION\", origHeader)\n\t\t} else {\n\t\t\tos.Unsetenv(\"NEXORA_MCP_HEADER_AUTHORIZATION\")\n\t\t}\n\t})\n\n\tos.Setenv(\"NEXORA_MCP_HEADER_AUTHORIZATION\", \"Bearer mcp-token\")\n\n\tconfig := &ProviderConfig{\n\t\tBaseURL: \"https://mcp.example.com\",\n\t}\n\n\tapplyEnvironmentVariables(config)\n\n\tif config.ExtraHeaders[\"authorization\"] != \"Bearer mcp-token\" {\n\t\tt.Errorf(\"Expected MCP authorization header, got: %v\", config.ExtraHeaders)\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}