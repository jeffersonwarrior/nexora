{
  "file_path": "/work/external-deps/claude-mem/src/ui/viewer/App.tsx",
  "file_hash": "f4df53a42b174aab19f2b0c86e52300b5ca2db3e",
  "updated_at": "2025-12-26T17:34:20.927943",
  "symbols": {
    "function_App_13": {
      "name": "App",
      "type": "function",
      "start_line": 13,
      "end_line": 121,
      "content_hash": "f29796533bdce5602477674df5ffa80cb49025af",
      "content": "export function App() {\n  const [currentFilter, setCurrentFilter] = useState('');\n  const [contextPreviewOpen, setContextPreviewOpen] = useState(false);\n  const [paginatedObservations, setPaginatedObservations] = useState<Observation[]>([]);\n  const [paginatedSummaries, setPaginatedSummaries] = useState<Summary[]>([]);\n  const [paginatedPrompts, setPaginatedPrompts] = useState<UserPrompt[]>([]);\n\n  const { observations, summaries, prompts, projects, isProcessing, queueDepth, isConnected } = useSSE();\n  const { settings, saveSettings, isSaving, saveStatus } = useSettings();\n  const { stats, refreshStats } = useStats();\n  const { preference, resolvedTheme, setThemePreference } = useTheme();\n  const pagination = usePagination(currentFilter);\n\n  // When filtering by project: ONLY use paginated data (API-filtered)\n  // When showing all projects: merge SSE live data with paginated data\n  const allObservations = useMemo(() => {\n    if (currentFilter) {\n      // Project filter active: API handles filtering, ignore SSE items\n      return paginatedObservations;\n    }\n    // No filter: merge SSE + paginated, deduplicate by ID\n    return mergeAndDeduplicateByProject(observations, paginatedObservations);\n  }, [observations, paginatedObservations, currentFilter]);\n\n  const allSummaries = useMemo(() => {\n    if (currentFilter) {\n      return paginatedSummaries;\n    }\n    return mergeAndDeduplicateByProject(summaries, paginatedSummaries);\n  }, [summaries, paginatedSummaries, currentFilter]);\n\n  const allPrompts = useMemo(() => {\n    if (currentFilter) {\n      return paginatedPrompts;\n    }\n    return mergeAndDeduplicateByProject(prompts, paginatedPrompts);\n  }, [prompts, paginatedPrompts, currentFilter]);\n\n  // Toggle context preview modal\n  const toggleContextPreview = useCallback(() => {\n    setContextPreviewOpen(prev => !prev);\n  }, []);\n\n  // Handle loading more data\n  const handleLoadMore = useCallback(async () => {\n    try {\n      const [newObservations, newSummaries, newPrompts] = await Promise.all([\n        pagination.observations.loadMore(),\n        pagination.summaries.loadMore(),\n        pagination.prompts.loadMore()\n      ]);\n\n      if (newObservations.length > 0) {\n        setPaginatedObservations(prev => [...prev, ...newObservations]);\n      }\n      if (newSummaries.length > 0) {\n        setPaginatedSummaries(prev => [...prev, ...newSummaries]);\n      }\n      if (newPrompts.length > 0) {\n        setPaginatedPrompts(prev => [...prev, ...newPrompts]);\n      }\n    } catch (error) {\n      console.error('Failed to load more data:', error);\n    }\n  }, [currentFilter, pagination.observations, pagination.summaries, pagination.prompts]);\n\n  // Reset paginated data and load first page when filter changes\n  useEffect(() => {\n    setPaginatedObservations([]);\n    setPaginatedSummaries([]);\n    setPaginatedPrompts([]);\n    handleLoadMore();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentFilter]);\n\n  return (\n    <>\n      <Header\n        isConnected={isConnected}\n        projects={projects}\n        currentFilter={currentFilter}\n        onFilterChange={setCurrentFilter}\n        isProcessing={isProcessing}\n        queueDepth={queueDepth}\n        themePreference={preference}\n        onThemeChange={setThemePreference}\n        onContextPreviewToggle={toggleContextPreview}\n      />\n\n      <Feed\n        observations={allObservations}\n        summaries={allSummaries}\n        prompts={allPrompts}\n        onLoadMore={handleLoadMore}\n        isLoading={pagination.observations.isLoading || pagination.summaries.isLoading || pagination.prompts.isLoading}\n        hasMore={pagination.observations.hasMore || pagination.summaries.hasMore || pagination.prompts.hasMore}\n      />\n\n      <ContextSettingsModal\n        isOpen={contextPreviewOpen}\n        onClose={toggleContextPreview}\n        settings={settings}\n        onSave={saveSettings}\n        isSaving={isSaving}\n        saveStatus={saveStatus}\n      />\n    </>\n  );\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}