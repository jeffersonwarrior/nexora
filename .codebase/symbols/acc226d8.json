{
  "file_path": "/work/external-deps/claude-swarm/src/utils/git-verification.ts",
  "file_hash": "035d31392ca2218bef5586e56fdd1d07d82048a0",
  "updated_at": "2025-12-26T17:34:22.954930",
  "symbols": {
    "function_captureGitState_18": {
      "name": "captureGitState",
      "type": "function",
      "start_line": 18,
      "end_line": 30,
      "content_hash": "94e4985949576224d09f68e29aed97f2ef6ff281",
      "content": "export function captureGitState(projectDir: string): string {\n  try {\n    const hash = execSync(\"git rev-parse HEAD\", {\n      cwd: projectDir,\n      encoding: \"utf-8\",\n    }).trim();\n    return hash;\n  } catch (error) {\n    throw new Error(\n      `Failed to capture git state: ${error instanceof Error ? error.message : String(error)}`\n    );\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_calculateGitVerification_35": {
      "name": "calculateGitVerification",
      "type": "function",
      "start_line": 35,
      "end_line": 117,
      "content_hash": "059e4a88fc4bf79b6549a64e558b76cd242c5308",
      "content": "export function calculateGitVerification(\n  projectDir: string,\n  beforeHash: string,\n  afterHash?: string\n): GitVerification {\n  try {\n    // If afterHash not provided, compare beforeHash to current working tree\n    const compareTarget = afterHash || \"HEAD\";\n\n    // Get diff statistics\n    const diffStat = execSync(\n      `git diff ${beforeHash}${afterHash ? `.${afterHash}` : \"\"} --numstat`,\n      {\n        cwd: projectDir,\n        encoding: \"utf-8\",\n      }\n    );\n\n    // Get list of changed files\n    const filesChanged = execSync(\n      `git diff ${beforeHash}${afterHash ? `.${afterHash}` : \"\"} --name-only`,\n      {\n        cwd: projectDir,\n        encoding: \"utf-8\",\n      }\n    )\n      .trim()\n      .split(\"\\n\")\n      .filter((f) => f.length > 0);\n\n    // Parse numstat output to calculate total lines added/deleted\n    let linesAdded = 0;\n    let linesDeleted = 0;\n\n    const lines = diffStat.trim().split(\"\\n\");\n    for (const line of lines) {\n      if (!line) continue;\n      const parts = line.split(\"\\t\");\n      if (parts.length < 3) continue;\n\n      const added = parts[0] === \"-\" ? 0 : parseInt(parts[0], 10);\n      const deleted = parts[1] === \"-\" ? 0 : parseInt(parts[1], 10);\n\n      linesAdded += added;\n      linesDeleted += deleted;\n    }\n\n    // Get full diff for checksum\n    const fullDiff = execSync(\n      `git diff ${beforeHash}${afterHash ? `.${afterHash}` : \"\"}`,\n      {\n        cwd: projectDir,\n        encoding: \"utf-8\",\n      }\n    );\n\n    // Calculate SHA-256 checksum of diff\n    const diffChecksum = crypto\n      .createHash(\"sha256\")\n      .update(fullDiff)\n      .digest(\"hex\");\n\n    // Get current HEAD hash if afterHash not provided\n    const finalAfterHash =\n      afterHash || execSync(\"git rev-parse HEAD\", {\n        cwd: projectDir,\n        encoding: \"utf-8\",\n      }).trim();\n\n    return {\n      beforeHash,\n      afterHash: finalAfterHash,\n      filesChanged,\n      linesAdded,\n      linesDeleted,\n      diffChecksum,\n    };\n  } catch (error) {\n    throw new Error(\n      `Failed to calculate git verification: ${error instanceof Error ? error.message : String(error)}`\n    );\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_verifyExpectedPackages_123": {
      "name": "verifyExpectedPackages",
      "type": "function",
      "start_line": 123,
      "end_line": 152,
      "content_hash": "1d6aa992c68fccf3e10512b828764502b18a4b14",
      "content": "export function verifyExpectedPackages(\n  verification: GitVerification,\n  expectedPackages: string[]\n): { matched: boolean; details: string } {\n  if (!expectedPackages || expectedPackages.length === 0) {\n    return {\n      matched: true,\n      details: \"No package constraints specified\",\n    };\n  }\n\n  // Check if any changed file is in expected packages\n  const matchedFiles = verification.filesChanged.filter((file) =>\n    expectedPackages.some((pkg) => file.startsWith(pkg))\n  );\n\n  const matched = matchedFiles.length > 0;\n\n  if (matched) {\n    return {\n      matched: true,\n      details: `${matchedFiles.length}/${verification.filesChanged.length} files match expected packages: ${expectedPackages.join(\", \")}`,\n    };\n  } else {\n    return {\n      matched: false,\n      details: `No files in expected packages. Expected: ${expectedPackages.join(\", \")}. Changed: ${verification.filesChanged.slice(0, 5).join(\", \")}${verification.filesChanged.length > 5 ? \"...\" : \"\"}`,\n    };\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_formatGitVerification_157": {
      "name": "formatGitVerification",
      "type": "function",
      "start_line": 157,
      "end_line": 183,
      "content_hash": "501a75816212d199603c24251b3d9009bec10114",
      "content": "export function formatGitVerification(\n  verification: GitVerification\n): string {\n  const lines = [\n    `\ud83d\udcdd Git Verification:`,\n    `   Before: ${verification.beforeHash.slice(0, 8)}`,\n    `   After:  ${verification.afterHash.slice(0, 8)}`,\n    `   Files:  ${verification.filesChanged.length} changed`,\n    `   Lines:  +${verification.linesAdded} -${verification.linesDeleted}`,\n    `   Checksum: ${verification.diffChecksum.slice(0, 16)}...`,\n  ];\n\n  if (verification.filesChanged.length > 0) {\n    lines.push(`   Changed files:`);\n    const displayFiles = verification.filesChanged.slice(0, 5);\n    for (const file of displayFiles) {\n      lines.push(`     - ${file}`);\n    }\n    if (verification.filesChanged.length > 5) {\n      lines.push(\n        `     ... and ${verification.filesChanged.length - 5} more`\n      );\n    }\n  }\n\n  return lines.join(\"\\n\");\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}