{
  "file_path": "/work/internal/agent/tools/bash_tool_test.go",
  "file_hash": "e9d3d3d3f9319a5f27624acf279c0e849e49b06d",
  "updated_at": "2025-12-26T17:34:23.656283",
  "symbols": {
    "function_TestNewBashTool_14": {
      "name": "TestNewBashTool",
      "type": "function",
      "start_line": 14,
      "end_line": 27,
      "content_hash": "8aef9de832ff084ba2b976e748bf05f6884a4ab6",
      "content": "func TestNewBashTool(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{\n\t\tGeneratedWith: true,\n\t\tTrailerStyle:  config.TrailerStyleAssistedBy,\n\t}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\tassert.NotNil(t, tool)\n\tassert.Equal(t, BashToolName, tool.Info().Name)\n\tassert.Contains(t, tool.Info().Description, \"bash\") // Basic check that description is generated\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_MissingCommand_28": {
      "name": "TestBashTool_MissingCommand",
      "type": "function",
      "start_line": 28,
      "end_line": 49,
      "content_hash": "8caec209923742534a2e3915f05e0e8a72e7ffc9",
      "content": "func TestBashTool_MissingCommand(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\tctx := context.Background()\n\tparams := BashParams{Command: \"\"} // Empty command\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-1\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.True(t, resp.IsError)\n\tassert.Contains(t, resp.Content, \"missing command\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_SimpleCommand_50": {
      "name": "TestBashTool_SimpleCommand",
      "type": "function",
      "start_line": 50,
      "end_line": 76,
      "content_hash": "0cee8890ad25ff296d990fc19907f35819dc27f3",
      "content": "func TestBashTool_SimpleCommand(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\t// Create context with session ID\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session-123\")\n\n\tparams := BashParams{\n\t\tCommand:    \"echo test\",\n\t\tWorkingDir: \"/tmp\",\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-2\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\tassert.Contains(t, resp.Content, \"test\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_WorkingDirectory_77": {
      "name": "TestBashTool_WorkingDirectory",
      "type": "function",
      "start_line": 77,
      "end_line": 104,
      "content_hash": "2c34196101b64a1e9488028208ef3446619b03a7",
      "content": "func TestBashTool_WorkingDirectory(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/\", attribution, \"test-model\")\n\n\t// Create context with session ID\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session-123\")\n\n\tparams := BashParams{\n\t\tCommand:    \"pwd\",\n\t\tWorkingDir: \"/tmp\",\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-3\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\t// The output should contain /tmp (pwd shows current directory)\n\tassert.Contains(t, resp.Content, \"/tmp\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_BackgroundCommand_105": {
      "name": "TestBashTool_BackgroundCommand",
      "type": "function",
      "start_line": 105,
      "end_line": 132,
      "content_hash": "a8de9a9ea2b747095e13548460ba0fde276fd99d",
      "content": "func TestBashTool_BackgroundCommand(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\t// Create context with session ID\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session-123\")\n\n\tparams := BashParams{\n\t\tCommand:         \"echo background job\",\n\t\tRunInBackground: true,\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-4\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\t// Background commands should complete quickly for simple echo command\n\tassert.Contains(t, resp.Content, \"background job\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_InvalidWorkingDir_133": {
      "name": "TestBashTool_InvalidWorkingDir",
      "type": "function",
      "start_line": 133,
      "end_line": 160,
      "content_hash": "0953ee58c6be08d5675179856635c1bd9eb532de",
      "content": "func TestBashTool_InvalidWorkingDir(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\t// Create context with session ID\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session-123\")\n\n\tparams := BashParams{\n\t\tCommand:    \"echo test\",\n\t\tWorkingDir: \"/nonexistent/path\",\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-5\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\t_, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\t// The bash tool may or may not error on invalid working directory,\n\t// depending on how it handles the error\n\t// assert.True(t, resp.IsError)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_WithSessionContext_161": {
      "name": "TestBashTool_WithSessionContext",
      "type": "function",
      "start_line": 161,
      "end_line": 187,
      "content_hash": "7e99f202dcf3a918d9e4629ffcdfc2faecb38a6e",
      "content": "func TestBashTool_WithSessionContext(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\t// Create context with session ID\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session-123\")\n\n\tparams := BashParams{\n\t\tCommand:    \"echo with session\",\n\t\tWorkingDir: \"/tmp\",\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-6\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\tassert.Contains(t, resp.Content, \"with session\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestBashTool_CommandWithOutput_188": {
      "name": "TestBashTool_CommandWithOutput",
      "type": "function",
      "start_line": 188,
      "end_line": 214,
      "content_hash": "a2b4f2a6c598d28f8a2be53bc6beb6c97de28176",
      "content": "func TestBashTool_CommandWithOutput(t *testing.T) {\n\tmockPermissions := &mockPermissionService{}\n\tattribution := &config.Attribution{}\n\n\ttool := NewBashTool(mockPermissions, \"/tmp\", attribution, \"test-model\")\n\n\t// Create context with session ID\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session-123\")\n\n\tparams := BashParams{\n\t\tCommand: \"echo 'multi\\nline\\noutput'\",\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test-7\",\n\t\tName:  BashToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\tassert.Contains(t, resp.Content, \"multi\")\n\tassert.Contains(t, resp.Content, \"line\")\n\tassert.Contains(t, resp.Content, \"output\")\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}