{
  "file_path": "/work/internal/agent/tools/hooks.go",
  "file_hash": "ec0416346fe800237cce747e72d99801d3d11614",
  "updated_at": "2025-12-26T17:34:20.217424",
  "symbols": {
    "interface_ToolHook_12": {
      "name": "ToolHook",
      "type": "interface",
      "start_line": 12,
      "end_line": 25,
      "content_hash": "ef77b22a8a2f4db8e2cc16653e8a1fad21330c2d",
      "content": "type ToolHook interface {\n\t// BeforeCall executes before a tool is called\n\t// Return error to block execution\n\tBeforeCall(ctx context.Context, toolName string, params interface{}) error\n\n\t// AfterCall executes after a tool completes\n\t// Can inspect/modify response\n\tAfterCall(ctx context.Context, toolName string, response fantasy.ToolResponse) fantasy.ToolResponse\n\n\t// OnError executes when a tool returns an error\n\tOnError(ctx context.Context, toolName string, err error) error\n}\n\n// HookChain manages multiple hooks",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_HookChain_26": {
      "name": "HookChain",
      "type": "struct",
      "start_line": 26,
      "end_line": 30,
      "content_hash": "334966d9c9f277b62eecb6a81a268ca0b9a0c303",
      "content": "type HookChain struct {\n\thooks []ToolHook\n}\n\n// NewHookChain creates a new hook chain",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewHookChain_31": {
      "name": "NewHookChain",
      "type": "function",
      "start_line": 31,
      "end_line": 35,
      "content_hash": "d569301f6c447a165708c85ab01ed62fb949762d",
      "content": "func NewHookChain(hooks ...ToolHook) *HookChain {\n\treturn &HookChain{hooks: hooks}\n}\n\n// BeforeCall executes all BeforeCall hooks",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_BeforeCall_36": {
      "name": "BeforeCall",
      "type": "method",
      "start_line": 36,
      "end_line": 50,
      "content_hash": "5eff43855077d5efa266c4a0a6247507001f3b9a",
      "content": "func (h *HookChain) BeforeCall(ctx context.Context, toolName string, params interface{}) error {\n\tfor _, hook := range h.hooks {\n\t\tif err := hook.BeforeCall(ctx, toolName, params); err != nil {\n\t\t\tslog.Warn(\"Tool hook blocked execution\",\n\t\t\t\t\"tool\", toolName,\n\t\t\t\t\"hook\", nameOfHook(hook),\n\t\t\t\t\"error\", err,\n\t\t\t)\n\t\t\treturn err\n\t\t}\n\t}\n\treturn nil\n}\n\n// AfterCall executes all AfterCall hooks",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AfterCall_51": {
      "name": "AfterCall",
      "type": "method",
      "start_line": 51,
      "end_line": 58,
      "content_hash": "255f3e560c1afac0edfd9bee2399477f6b7b675e",
      "content": "func (h *HookChain) AfterCall(ctx context.Context, toolName string, response fantasy.ToolResponse) fantasy.ToolResponse {\n\tfor _, hook := range h.hooks {\n\t\tresponse = hook.AfterCall(ctx, toolName, response)\n\t}\n\treturn response\n}\n\n// OnError executes all OnError hooks",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_OnError_59": {
      "name": "OnError",
      "type": "method",
      "start_line": 59,
      "end_line": 70,
      "content_hash": "9d422869fa1305889d406d99114b54346a5f270d",
      "content": "func (h *HookChain) OnError(ctx context.Context, toolName string, err error) error {\n\tfor _, hook := range h.hooks {\n\t\tif err := hook.OnError(ctx, toolName, err); err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\treturn err\n}\n\n// ===================== Built-in Hooks =====================\n\n// SecurityHook validates tool calls against security policies",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_SecurityHook_71": {
      "name": "SecurityHook",
      "type": "struct",
      "start_line": 71,
      "end_line": 78,
      "content_hash": "fd806ed5ecb534e787f8bb0d9ebe18d916593c84",
      "content": "type SecurityHook struct {\n\t// allowedTools: map of tool -> allowed\n\tallowedTools map[string]bool\n\t// deniedPaths: paths that cannot be accessed\n\tdeniedPaths []string\n}\n\n// NewSecurityHook creates a security hook",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewSecurityHook_79": {
      "name": "NewSecurityHook",
      "type": "function",
      "start_line": 79,
      "end_line": 89,
      "content_hash": "69e2b4a956e67f1413a23794d1aab2c80dc0f73a",
      "content": "func NewSecurityHook(allowedTools []string, deniedPaths []string) *SecurityHook {\n\tallowed := make(map[string]bool)\n\tfor _, t := range allowedTools {\n\t\tallowed[t] = true\n\t}\n\treturn &SecurityHook{\n\t\tallowedTools: allowed,\n\t\tdeniedPaths:  deniedPaths,\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_BeforeCall_90": {
      "name": "BeforeCall",
      "type": "method",
      "start_line": 90,
      "end_line": 97,
      "content_hash": "db36841bae81169c0797511d86fd339016c45fe7",
      "content": "func (h *SecurityHook) BeforeCall(ctx context.Context, toolName string, params interface{}) error {\n\t// Check if tool is allowed\n\tif len(h.allowedTools) > 0 && !h.allowedTools[toolName] {\n\t\treturn ErrToolNotAllowed(toolName)\n\t}\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AfterCall_98": {
      "name": "AfterCall",
      "type": "method",
      "start_line": 98,
      "end_line": 101,
      "content_hash": "f26bccd83f3172a668c8a00f536f9108acf52f2c",
      "content": "func (h *SecurityHook) AfterCall(ctx context.Context, toolName string, response fantasy.ToolResponse) fantasy.ToolResponse {\n\treturn response\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_OnError_102": {
      "name": "OnError",
      "type": "method",
      "start_line": 102,
      "end_line": 106,
      "content_hash": "080d210b052895b91f5111fb63f34a2ca6cf873f",
      "content": "func (h *SecurityHook) OnError(ctx context.Context, toolName string, err error) error {\n\treturn err\n}\n\n// MetricsHook tracks tool performance metrics",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_MetricsHook_107": {
      "name": "MetricsHook",
      "type": "struct",
      "start_line": 107,
      "end_line": 111,
      "content_hash": "38306e70158538c9625cf5a46d36317a75c55557",
      "content": "type MetricsHook struct {\n\tmetrics map[string]*ToolMetrics\n}\n\n// ToolMetrics holds performance metrics for a tool",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_ToolMetrics_112": {
      "name": "ToolMetrics",
      "type": "struct",
      "start_line": 112,
      "end_line": 119,
      "content_hash": "7e5a1ec7353462563576172842b4240eebb6f187",
      "content": "type ToolMetrics struct {\n\tCallCount    int64\n\tErrorCount   int64\n\tSuccessCount int64\n\tTotalTimeMS  float64\n}\n\n// NewMetricsHook creates a metrics hook",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewMetricsHook_120": {
      "name": "NewMetricsHook",
      "type": "function",
      "start_line": 120,
      "end_line": 125,
      "content_hash": "61169baa15f28135ad73dab8e728b5d0dc2a6a66",
      "content": "func NewMetricsHook() *MetricsHook {\n\treturn &MetricsHook{\n\t\tmetrics: make(map[string]*ToolMetrics),\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_BeforeCall_126": {
      "name": "BeforeCall",
      "type": "method",
      "start_line": 126,
      "end_line": 133,
      "content_hash": "b3fbb8880b7c38eb8a9ef8d8cbef2fc55471ff20",
      "content": "func (h *MetricsHook) BeforeCall(ctx context.Context, toolName string, params interface{}) error {\n\tif _, exists := h.metrics[toolName]; !exists {\n\t\th.metrics[toolName] = &ToolMetrics{}\n\t}\n\th.metrics[toolName].CallCount++\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AfterCall_134": {
      "name": "AfterCall",
      "type": "method",
      "start_line": 134,
      "end_line": 140,
      "content_hash": "0881852ae37e4aaceac7ced1a88baac72fca2fea",
      "content": "func (h *MetricsHook) AfterCall(ctx context.Context, toolName string, response fantasy.ToolResponse) fantasy.ToolResponse {\n\tif !response.IsError {\n\t\th.metrics[toolName].SuccessCount++\n\t}\n\treturn response\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_OnError_141": {
      "name": "OnError",
      "type": "method",
      "start_line": 141,
      "end_line": 146,
      "content_hash": "d57219dab9aa08b7103abfb2accf175b99ab6899",
      "content": "func (h *MetricsHook) OnError(ctx context.Context, toolName string, err error) error {\n\th.metrics[toolName].ErrorCount++\n\treturn err\n}\n\n// GetMetrics returns metrics for a specific tool",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetMetrics_147": {
      "name": "GetMetrics",
      "type": "method",
      "start_line": 147,
      "end_line": 151,
      "content_hash": "f24395ed9b6fcbc00345b4bdfae1af5dba3186b2",
      "content": "func (h *MetricsHook) GetMetrics(toolName string) *ToolMetrics {\n\treturn h.metrics[toolName]\n}\n\n// AllMetrics returns all metrics",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AllMetrics_152": {
      "name": "AllMetrics",
      "type": "method",
      "start_line": 152,
      "end_line": 157,
      "content_hash": "af56a619815afc6fc2197834d7c8cbb565aaec83",
      "content": "func (h *MetricsHook) AllMetrics() map[string]*ToolMetrics {\n\treturn h.metrics\n}\n\n// ===================== Helpers =====================\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_nameOfHook_158": {
      "name": "nameOfHook",
      "type": "function",
      "start_line": 158,
      "end_line": 169,
      "content_hash": "e43db4d7f02b482fb9caacea2d42e414f46bad11",
      "content": "func nameOfHook(h ToolHook) string {\n\tswitch h.(type) {\n\tcase *SecurityHook:\n\t\treturn \"SecurityHook\"\n\tcase *MetricsHook:\n\t\treturn \"MetricsHook\"\n\tdefault:\n\t\treturn \"UnknownHook\"\n\t}\n}\n\n// HookError types",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_HookError_170": {
      "name": "HookError",
      "type": "struct",
      "start_line": 170,
      "end_line": 173,
      "content_hash": "2268d87da4158bbf5dca93ec77058b22a0e70e98",
      "content": "type HookError struct {\n\tmsg string\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Error_174": {
      "name": "Error",
      "type": "method",
      "start_line": 174,
      "end_line": 177,
      "content_hash": "796ec0ec8d75241ec01b13388d6a0b21ac6bd5c2",
      "content": "func (e *HookError) Error() string {\n\treturn e.msg\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_ErrToolNotAllowed_178": {
      "name": "ErrToolNotAllowed",
      "type": "function",
      "start_line": 178,
      "end_line": 180,
      "content_hash": "66327f18652e88acfb0f09aef33aad5b1465269b",
      "content": "func ErrToolNotAllowed(toolName string) error {\n\treturn &HookError{msg: \"tool not allowed: \" + toolName}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}