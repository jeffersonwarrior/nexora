{
  "file_path": "/work/external-deps/claude-mem/scripts/discord-release-notify.js",
  "file_hash": "40e36eb2a39c5293d44d1d1881d6806d255dd737",
  "updated_at": "2025-12-26T17:34:20.747969",
  "symbols": {
    "function_loadEnv_21": {
      "name": "loadEnv",
      "type": "function",
      "start_line": 21,
      "end_line": 37,
      "content_hash": "06b87c51548d3c1bfbc7cd5c9d97c569ba28ff53",
      "content": "function loadEnv() {\n  const envPath = resolve(projectRoot, '.env');\n  if (!existsSync(envPath)) {\n    console.error('\u274c .env file not found');\n    process.exit(1);\n  }\n\n  const envContent = readFileSync(envPath, 'utf-8');\n  const webhookMatch = envContent.match(/DISCORD_UPDATES_WEBHOOK=(.+)/);\n\n  if (!webhookMatch) {\n    console.error('\u274c DISCORD_UPDATES_WEBHOOK not found in .env');\n    process.exit(1);\n  }\n\n  return webhookMatch[1].trim();\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getReleaseNotes_39": {
      "name": "getReleaseNotes",
      "type": "function",
      "start_line": 39,
      "end_line": 49,
      "content_hash": "f79805c38f558be196d3e490245cb10e876dec36",
      "content": "function getReleaseNotes(version) {\n  try {\n    const notes = execSync(`gh release view ${version} --json body --jq '.body'`, {\n      encoding: 'utf-8',\n      cwd: projectRoot,\n    }).trim();\n    return notes;\n  } catch {\n    return null;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_cleanNotes_51": {
      "name": "cleanNotes",
      "type": "function",
      "start_line": 51,
      "end_line": 57,
      "content_hash": "44138a46a7773790898427b0525bd1466c3e0b92",
      "content": "function cleanNotes(notes) {\n  // Remove Claude Code footer and clean up\n  return notes\n    .replace(/\ud83e\udd16 Generated with \\[Claude Code\\].*$/s, '')\n    .replace(/---\\n*$/s, '')\n    .trim();\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_truncate_59": {
      "name": "truncate",
      "type": "function",
      "start_line": 59,
      "end_line": 62,
      "content_hash": "5c49ed0e828ee98b4d953f12dda48be1cef7fec0",
      "content": "function truncate(text, maxLength) {\n  if (text.length <= maxLength) return text;\n  return text.slice(0, maxLength - 3) + '...';\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_postToDiscord_64": {
      "name": "postToDiscord",
      "type": "function",
      "start_line": 64,
      "end_line": 107,
      "content_hash": "5cf9c4744ee5311bb2b9d4172589b2e900b75e9c",
      "content": "async function postToDiscord(webhookUrl, version, notes) {\n  const cleanedNotes = notes ? cleanNotes(notes) : 'No release notes available.';\n  const repoUrl = 'https://github.com/thedotmack/claude-mem';\n\n  const payload = {\n    embeds: [\n      {\n        title: `\ud83d\ude80 claude-mem ${version} released`,\n        url: `${repoUrl}/releases/tag/${version}`,\n        description: truncate(cleanedNotes, 2000),\n        color: 0x7c3aed, // Purple\n        fields: [\n          {\n            name: '\ud83d\udce6 Install',\n            value: 'Update via Claude Code plugin marketplace',\n            inline: true,\n          },\n          {\n            name: '\ud83d\udcda Docs',\n            value: '[docs.claude-mem.ai](https://docs.claude-mem.ai)',\n            inline: true,\n          },\n        ],\n        footer: {\n          text: 'claude-mem \u2022 Persistent memory for Claude Code',\n        },\n        timestamp: new Date().toISOString(),\n      },\n    ],\n  };\n\n  const response = await fetch(webhookUrl, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(payload),\n  });\n\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Discord API error: ${response.status} - ${errorText}`);\n  }\n\n  return true;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_main_109": {
      "name": "main",
      "type": "function",
      "start_line": 109,
      "end_line": 135,
      "content_hash": "3852374306ecb875bb9912cae20d6f3fc84b147b",
      "content": "async function main() {\n  const version = process.argv[2];\n  const customNotes = process.argv[3];\n\n  if (!version) {\n    console.error('Usage: node scripts/discord-release-notify.js <version> [notes]');\n    console.error('Example: node scripts/discord-release-notify.js v7.4.2');\n    process.exit(1);\n  }\n\n  console.log(`\ud83d\udce3 Posting release notification for ${version}...`);\n\n  const webhookUrl = loadEnv();\n  const notes = customNotes || getReleaseNotes(version);\n\n  if (!notes && !customNotes) {\n    console.warn('\u26a0\ufe0f  Could not fetch release notes from GitHub, proceeding without them');\n  }\n\n  try {\n    await postToDiscord(webhookUrl, version, notes);\n    console.log('\u2705 Discord notification sent successfully!');\n  } catch (error) {\n    console.error('\u274c Failed to send Discord notification:', error.message);\n    process.exit(1);\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}