{
  "file_path": "/work/internal/tui/components/chat/header/header.go",
  "file_hash": "f0cf520ff64b01ec6fa44c7f573df2e9a54d1055",
  "updated_at": "2025-12-26T17:34:20.353870",
  "symbols": {
    "interface_Header_21": {
      "name": "Header",
      "type": "interface",
      "start_line": 21,
      "end_line": 28,
      "content_hash": "b8ff59889796d1f0f2ee83b960b29b9324754966",
      "content": "type Header interface {\n\tutil.Model\n\tSetSession(session session.Session) tea.Cmd\n\tSetWidth(width int) tea.Cmd\n\tSetDetailsOpen(open bool)\n\tShowingDetails() bool\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_header_29": {
      "name": "header",
      "type": "struct",
      "start_line": 29,
      "end_line": 35,
      "content_hash": "fdc1ee891019baa6ad31efab514f048fa0c8edbb",
      "content": "type header struct {\n\twidth       int\n\tsession     session.Session\n\tlspClients  *csync.Map[string, *lsp.Client]\n\tdetailsOpen bool\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_New_36": {
      "name": "New",
      "type": "function",
      "start_line": 36,
      "end_line": 42,
      "content_hash": "7cda42abd268da26ab77f677d15bdb44c7830e6d",
      "content": "func New(lspClients *csync.Map[string, *lsp.Client]) Header {\n\treturn &header{\n\t\tlspClients: lspClients,\n\t\twidth:      0,\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Init_43": {
      "name": "Init",
      "type": "method",
      "start_line": 43,
      "end_line": 46,
      "content_hash": "b76b5f5ae9c928f60db3a24a0da145d1d6725870",
      "content": "func (h *header) Init() tea.Cmd {\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Update_47": {
      "name": "Update",
      "type": "method",
      "start_line": 47,
      "end_line": 58,
      "content_hash": "6e7622518daad63cd184f8865c72f2ce3c2bc93a",
      "content": "func (h *header) Update(msg tea.Msg) (util.Model, tea.Cmd) {\n\tswitch msg := msg.(type) {\n\tcase pubsub.Event[session.Session]:\n\t\tif msg.Type == pubsub.UpdatedEvent {\n\t\t\tif h.session.ID == msg.Payload.ID {\n\t\t\t\th.session = msg.Payload\n\t\t\t}\n\t\t}\n\t}\n\treturn h, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_View_59": {
      "name": "View",
      "type": "method",
      "start_line": 59,
      "end_line": 101,
      "content_hash": "2cf55e706fe4b1f433bf574f4d11b6a154d0633c",
      "content": "func (h *header) View() string {\n\tif h.session.ID == \"\" {\n\t\treturn \"\"\n\t}\n\n\tconst (\n\t\tgap          = \" \"\n\t\tdiag         = \"\u2571\"\n\t\tminDiags     = 3\n\t\tleftPadding  = 1\n\t\trightPadding = 1\n\t)\n\n\tt := styles.CurrentTheme()\n\n\tvar b strings.Builder\n\n\tb.WriteString(t.S().Base.Foreground(t.Secondary).Render(\"Nexora\"))\n\tb.WriteString(gap)\n\tb.WriteString(styles.ApplyBoldForegroundGrad(\"NEXORA\", t.Secondary, t.Primary))\n\tb.WriteString(gap)\n\n\tavailDetailWidth := h.width - leftPadding - rightPadding - lipgloss.Width(b.String()) - minDiags\n\tdetails := h.details(availDetailWidth)\n\n\tremainingWidth := h.width -\n\t\tlipgloss.Width(b.String()) -\n\t\tlipgloss.Width(details) -\n\t\tleftPadding -\n\t\trightPadding\n\n\tif remainingWidth > 0 {\n\t\tb.WriteString(t.S().Base.Foreground(t.Primary).Render(\n\t\t\tstrings.Repeat(diag, max(minDiags, remainingWidth)),\n\t\t))\n\t\tb.WriteString(gap)\n\t}\n\n\tb.WriteString(details)\n\n\treturn t.S().Base.Padding(0, rightPadding, 0, leftPadding).Render(b.String())\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_details_102": {
      "name": "details",
      "type": "method",
      "start_line": 102,
      "end_line": 163,
      "content_hash": "bc3fa36f88bbe8c7b0d1ea6ae31b34a95d6be788",
      "content": "func (h *header) details(availWidth int) string {\n\ts := styles.CurrentTheme().S()\n\n\tvar parts []string\n\n\terrorCount := 0\n\tfor l := range h.lspClients.Seq() {\n\t\tfor _, diagnostics := range l.GetDiagnostics() {\n\t\t\tfor _, diagnostic := range diagnostics {\n\t\t\t\tif diagnostic.Severity == protocol.SeverityError {\n\t\t\t\t\terrorCount++\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif errorCount > 0 {\n\t\tparts = append(parts, s.Error.Render(fmt.Sprintf(\"%s%d\", styles.ErrorIcon, errorCount)))\n\t}\n\n\t// Always add session title (truncate if too long) - FORCE DISPLAY\n\ttitle := h.session.Title\n\tif title == \"\" {\n\t\ttitle = fmt.Sprintf(\"Session %s\", h.session.ID[:8])\n\t}\n\tif lipgloss.Width(title) > 25 {\n\t\ttitle = title[:22] + \"...\"\n\t}\n\tparts = append(parts, s.Subtitle.Bold(true).Render(title))\n\n\tagentCfg := config.Get().Agents[config.AgentCoder]\n\tmodel := config.Get().GetModelByType(agentCfg.Model)\n\n\t// Calculate percentage, handling zero context window\n\tpercentage := 0.0\n\tif model != nil && model.ContextWindow > 0 {\n\t\tpercentage = (float64(h.session.CompletionTokens+h.session.PromptTokens) / float64(model.ContextWindow)) * 100\n\t}\n\n\tformattedPercentage := s.Muted.Render(fmt.Sprintf(\"%d%%\", int(percentage)))\n\tparts = append(parts, formattedPercentage)\n\n\tconst keystroke = \"ctrl+d\"\n\tif h.detailsOpen {\n\t\tparts = append(parts, s.Muted.Render(keystroke)+s.Subtle.Render(\" close\"))\n\t} else {\n\t\tparts = append(parts, s.Muted.Render(keystroke)+s.Subtle.Render(\" open \"))\n\t}\n\n\tdot := s.Subtle.Render(\" \u2022 \")\n\tmetadata := strings.Join(parts, dot)\n\tmetadata = dot + metadata\n\n\t// Truncate cwd if necessary, and insert it at the beginning.\n\tconst dirTrimLimit = 4\n\tcwd := fsext.DirTrim(fsext.PrettyPath(config.Get().WorkingDir()), dirTrimLimit)\n\tcwd = ansi.Truncate(cwd, max(0, availWidth-lipgloss.Width(metadata)), \"\u2026\")\n\tcwd = s.Muted.Render(cwd)\n\n\treturn cwd + metadata\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_SetDetailsOpen_164": {
      "name": "SetDetailsOpen",
      "type": "method",
      "start_line": 164,
      "end_line": 168,
      "content_hash": "79e0e7a1c4a2dd4b2cb59f6987c57ba540e8659d",
      "content": "func (h *header) SetDetailsOpen(open bool) {\n\th.detailsOpen = open\n}\n\n// SetSession implements Header.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_SetSession_169": {
      "name": "SetSession",
      "type": "method",
      "start_line": 169,
      "end_line": 174,
      "content_hash": "86a78354a6264af730a4ad2fd5cd41d292062c58",
      "content": "func (h *header) SetSession(session session.Session) tea.Cmd {\n\th.session = session\n\treturn nil\n}\n\n// SetWidth implements Header.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_SetWidth_175": {
      "name": "SetWidth",
      "type": "method",
      "start_line": 175,
      "end_line": 180,
      "content_hash": "df3e7c62d655ebbc5cb97331741d37e950ca423b",
      "content": "func (h *header) SetWidth(width int) tea.Cmd {\n\th.width = width\n\treturn nil\n}\n\n// ShowingDetails implements Header.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ShowingDetails_181": {
      "name": "ShowingDetails",
      "type": "method",
      "start_line": 181,
      "end_line": 183,
      "content_hash": "f3e96b30dbc7b756e000706ad16a29754af298d9",
      "content": "func (h *header) ShowingDetails() bool {\n\treturn h.detailsOpen\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}