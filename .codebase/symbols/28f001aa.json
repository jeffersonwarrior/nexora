{
  "file_path": "/work/.local/tools/modelscan/main.go",
  "file_hash": "2855cdd3996e34d0def6278f528b0c3fbf52d7b0",
  "updated_at": "2025-12-26T17:34:21.740911",
  "symbols": {
    "function_main_24": {
      "name": "main",
      "type": "function",
      "start_line": 24,
      "end_line": 86,
      "content_hash": "160bf0c47345a2f2ef882e7f4567c6b0359546ae",
      "content": "func main() {\n\tflag.Parse()\n\n\tctx := context.Background()\n\n\t// Load configuration from environment and NEXORA setup\n\tcfg, err := config.LoadConfig()\n\tif err != nil {\n\t\tlog.Fatalf(\"Failed to load configuration: %v\", err)\n\t}\n\n\t// Initialize database if SQLite output is requested OR if we need markdown from SQLite\n\tif *outputFormat == \"all\" || *outputFormat == \"sqlite\" || *outputFormat == \"markdown\" {\n\t\tdbPath := filepath.Join(*outputPath, \"providers.db\")\n\t\tif err := storage.InitDB(dbPath); err != nil {\n\t\t\tlog.Printf(\"Warning: Failed to initialize database: %v\", err)\n\t\t}\n\t}\n\n\tif *providerName == \"all\" {\n\t\t// Validate all configured providers\n\t\tfor _, name := range cfg.ListProviders() {\n\t\t\tif err := validateProvider(ctx, name, cfg); err != nil {\n\t\t\t\tlog.Printf(\"Error validating provider %s: %v\", name, err)\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// Validate specific provider\n\t\tif !cfg.HasProvider(*providerName) {\n\t\t\tlog.Fatalf(\"Provider %s is not configured or missing API key\", *providerName)\n\t\t}\n\n\t\tif err := validateProvider(ctx, *providerName, cfg); err != nil {\n\t\t\tlog.Fatalf(\"Error validating provider %s: %v\", *providerName, err)\n\t\t}\n\t}\n\n\t// Export results in requested formats\n\tif *outputFormat == \"all\" || *outputFormat == \"sqlite\" {\n\t\tdbPath := filepath.Join(*outputPath, \"providers.db\")\n\t\tif err := storage.ExportToSQLite(dbPath); err != nil {\n\t\t\tlog.Printf(\"Error exporting to SQLite: %v\", err)\n\t\t} else {\n\t\t\tfmt.Printf(\"\u2713 Saved SQLite database to %s\\n\", dbPath)\n\t\t}\n\t}\n\n\tif *outputFormat == \"all\" || *outputFormat == \"markdown\" {\n\t\tmdPath := filepath.Join(*outputPath, \"PROVIDERS.md\")\n\t\t// Ensure parent directory exists, not create the file as a directory\n\t\tif err := os.MkdirAll(*outputPath, 0o755); err != nil {\n\t\t\tlog.Printf(\"Error creating output directory: %v\", err)\n\t\t}\n\t\tif err := storage.ExportToMarkdown(mdPath); err != nil {\n\t\t\tlog.Printf(\"Error exporting to Markdown: %v\", err)\n\t\t} else {\n\t\t\tfmt.Printf(\"\u2713 Saved Markdown report to %s\\n\", mdPath)\n\t\t}\n\t}\n\n\tfmt.Println(\"\\nValidation complete!\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_validateProvider_87": {
      "name": "validateProvider",
      "type": "function",
      "start_line": 87,
      "end_line": 130,
      "content_hash": "8a32fed228818e2c4569b9dfd375f8ddc5218a2b",
      "content": "func validateProvider(ctx context.Context, name string, cfg *config.Config) error {\n\tfmt.Printf(\"\\n=== Validating %s Provider ===\\n\", name)\n\n\t// Get provider factory\n\tfactory, exists := providers.GetProviderFactory(name)\n\tif !exists {\n\t\treturn fmt.Errorf(\"unknown provider: %s\", name)\n\t}\n\n\t// Get API key from config\n\tapiKey, err := cfg.GetAPIKey(name)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// Create provider instance with API key\n\tprovider := factory(apiKey)\n\n\t// Validate endpoints\n\tif err := provider.ValidateEndpoints(ctx, *verbose); err != nil {\n\t\treturn fmt.Errorf(\"endpoint validation failed: %w\", err)\n\t}\n\n\t// List available models\n\tmodels, err := provider.ListModels(ctx, *verbose)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"model listing failed: %w\", err)\n\t}\n\n\tfmt.Printf(\"Found %d models for %s\\n\", len(models), name)\n\n\t// Store results\n\tif err := storage.StoreProviderInfo(name, models, provider.GetCapabilities()); err != nil {\n\t\treturn fmt.Errorf(\"failed to store provider info: %w\", err)\n\t}\n\n\t// Also store endpoint results\n\tendpoints := provider.GetEndpoints()\n\tif err := storage.StoreEndpointResults(name, endpoints); err != nil {\n\t\treturn fmt.Errorf(\"failed to store endpoint info: %w\", err)\n\t}\n\n\treturn nil\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}