{
  "file_path": "/work/context-engine/docker-compose.yml",
  "file_hash": "3f251754f0364389532005e4d90c71128d420602",
  "updated_at": "2025-12-26T17:34:23.994335",
  "symbols": {
    "key_version_6": {
      "name": "version",
      "type": "key",
      "start_line": 6,
      "end_line": 6,
      "content_hash": "c75981bd986ae410678a2c5e60ae013967e6ba08",
      "content": "version: '3.8'",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services_8": {
      "name": "services",
      "type": "key",
      "start_line": 8,
      "end_line": 592,
      "content_hash": "ccdeda1e9cc39a6e198e314541693cda3dfe774e",
      "content": "services:\n  # Qdrant vector database - same as base compose\n  qdrant:\n    image: qdrant/qdrant:latest\n    container_name: qdrant-db-dev-remote\n    ports:\n      - \"6333:6333\"\n      - \"6334:6334\"\n    volumes:\n      - qdrant_storage_dev_remote:/qdrant/storage\n    networks:\n      - dev-remote-network\n\n  # MCP search service - same as base compose\n  mcp:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp\n    container_name: mcp-search-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_PORT=${FASTMCP_PORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      # Use /tmp for HF caches to avoid root-owned docker volume permissions\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - TOOL_STORE_DESCRIPTION=${TOOL_STORE_DESCRIPTION}\n      - TOOL_FIND_DESCRIPTION=${TOOL_FIND_DESCRIPTION}\n      - FASTMCP_HEALTH_PORT=18000\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"18000:18000\"\n      - \"8000:8000\"\n    volumes:\n      - workspace_pvc:/work:ro\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # MCP indexer service - same as base compose\n  mcp_indexer:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer\n    container_name: mcp-indexer-dev-remote\n    user: \"1000:1000\"\n    # In K8s, scripts would be accessed directly at /app/scripts/ or via proper initContainer\n    # For Docker Compose dev-remote simulation, create symlink so /work/scripts/ works\n    # Use /tmp/huggingface for cache to avoid permission issues (universally writable)\n    # Set CORRECT environment variables for HuggingFace and FastEmbed\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/mcp_indexer_server.py\"]\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - LOG_LEVEL=${LOG_LEVEL:-INFO}\n      - FASTMCP_HEALTH_PORT=18001\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_INDEXER_PORT=${FASTMCP_INDEXER_PORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - REFRAG_DECODER=${REFRAG_DECODER:-1}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-llamacpp}\n      - GLM_API_KEY=${GLM_API_KEY}\n      - GLM_API_BASE=${GLM_API_BASE:-https://api.z.ai/api/paas/v4/}\n      - GLM_MODEL=${GLM_MODEL:-glm-4.6}\n      - LLAMACPP_URL=${LLAMACPP_URL:-http://llamacpp:8080}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env (no defaults here to respect .env)\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"${FASTMCP_INDEXER_PORT:-8001}:8001\"\n      - \"18001:18001\"\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # Learning reranker worker - processes training events in background\n  learning_worker:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer\n    container_name: learning-worker-dev-remote\n    user: \"1000:1000\"\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/learning_reranker_worker.py --daemon\"]\n    depends_on:\n      - qdrant\n      - mcp_indexer\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_LEARNING_BATCH_SIZE=${RERANK_LEARNING_BATCH_SIZE:-32}\n      - RERANK_LEARNING_POLL_INTERVAL=${RERANK_LEARNING_POLL_INTERVAL:-30}\n      - RERANK_LEARNING_RATE=${RERANK_LEARNING_RATE:-0.001}\n      - RERANK_LLM_TEACHER=${RERANK_LLM_TEACHER:-0}\n      - RERANK_LLM_SAMPLE_RATE=${RERANK_LLM_SAMPLE_RATE:-1.0}\n      - GLM_API_KEY=${GLM_API_KEY:-}\n      - GLM_API_BASE=${GLM_API_BASE:-}\n      - GLM_MODEL=${GLM_MODEL:-}\n      - GLM_MODEL_FAST=${GLM_MODEL_FAST:-}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-glm}\n      - LLAMACPP_URL=${LLAMACPP_URL:-}\n      - RERANK_VICREG_WEIGHT=${RERANK_VICREG_WEIGHT:-0.1}\n    volumes:\n      - workspace_pvc:/work:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n    restart: unless-stopped\n\n  # MCP HTTP search service - same as base compose\n  mcp_http:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp\n    container_name: mcp-search-http-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_PORT=8000\n      - FASTMCP_TRANSPORT=${FASTMCP_HTTP_TRANSPORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      # Use /tmp for HF caches to avoid root-owned docker volume permissions\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - TOOL_STORE_DESCRIPTION=${TOOL_STORE_DESCRIPTION}\n      - TOOL_FIND_DESCRIPTION=${TOOL_FIND_DESCRIPTION}\n      - FASTMCP_HEALTH_PORT=18000\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"${FASTMCP_HTTP_HEALTH_PORT:-18002}:18000\"\n      - \"${FASTMCP_HTTP_PORT:-8002}:8000\"\n    volumes:\n      - workspace_pvc:/work:ro\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # MCP HTTP indexer service - same as base compose\n  mcp_indexer_http:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer\n    container_name: mcp-indexer-http-dev-remote\n    user: \"1000:1000\"\n    # In K8s, scripts would be accessed directly at /app/scripts/ or via proper initContainer\n    # For Docker Compose dev-remote simulation, create symlink so /work/scripts/ works\n    # Use /tmp/huggingface for cache to avoid permission issues (universally writable)\n    # Set CORRECT environment variables for HuggingFace and FastEmbed\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/mcp_indexer_server.py\"]\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - LOG_LEVEL=${LOG_LEVEL:-INFO}\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_INDEXER_PORT=8001\n      - FASTMCP_TRANSPORT=${FASTMCP_HTTP_TRANSPORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - REFRAG_DECODER=${REFRAG_DECODER:-1}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-llamacpp}\n      - GLM_API_KEY=${GLM_API_KEY}\n      - GLM_API_BASE=${GLM_API_BASE:-https://api.z.ai/api/paas/v4/}\n      - GLM_MODEL=${GLM_MODEL:-glm-4.6}\n      - LLAMACPP_URL=${LLAMACPP_URL:-http://llamacpp:8080}\n      - FASTMCP_HEALTH_PORT=18001\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"${FASTMCP_INDEXER_HTTP_PORT:-8003}:8001\"\n      - \"${FASTMCP_INDEXER_HTTP_HEALTH_PORT:-18003}:18001\"\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # Llama.cpp decoder service - same as base compose\n  llamacpp:\n    image: ghcr.io/ggerganov/llama.cpp:server\n    container_name: llama-decoder-dev-remote\n    environment:\n      - LLAMA_ARG_MODEL=/models/model.gguf\n      - LLAMA_ARG_CTX_SIZE=8192\n      - LLAMA_ARG_HOST=0.0.0.0\n      - LLAMA_ARG_PORT=8080\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - ./models:/models:ro\n    command: [\"--model\", \"/models/model.gguf\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\", \"--no-warmup\"]\n    networks:\n      - dev-remote-network\n\n  # Indexer service - modified for PVC volumes\n  indexer:\n    build:\n      context: .\n      dockerfile: Dockerfile.indexer\n    container_name: indexer-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - GIT_HISTORY_PRUNE=${GIT_HISTORY_PRUNE:-1}\n      - GIT_HISTORY_DELETE_MANIFEST=${GIT_HISTORY_DELETE_MANIFEST:-0}\n      - GIT_HISTORY_MANIFEST_MAX_FILES=${GIT_HISTORY_MANIFEST_MAX_FILES:-0}\n      # Use /tmp for HF caches to avoid permission issues during model download\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - HOST_INDEX_PATH=/work\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n    entrypoint: [\"sh\", \"-c\", \"mkdir -p /tmp/logs /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && /app/scripts/wait-for-qdrant.sh && cd /app && python /app/scripts/ingest_code.py --root /work\"]\n    restart: \"no\"  # Run once on startup, do not restart after completion\n    cpus: 2.0\n    networks:\n      - dev-remote-network\n\n  # Watcher service - modified for PVC volumes\n  watcher:\n    build:\n      context: .\n      dockerfile: Dockerfile.indexer\n    container_name: watcher-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - GIT_HISTORY_PRUNE=${GIT_HISTORY_PRUNE:-1}\n      - GIT_HISTORY_DELETE_MANIFEST=${GIT_HISTORY_DELETE_MANIFEST:-0}\n      - GIT_HISTORY_MANIFEST_MAX_FILES=${GIT_HISTORY_MANIFEST_MAX_FILES:-0}\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - WATCH_ROOT=${WATCH_ROOT:-/work}\n      - HOST_INDEX_PATH=/work\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      - WATCH_DEBOUNCE_SECS=${WATCH_DEBOUNCE_SECS:-1.5}\n      - REMOTE_UPLOAD_ENABLED=${REMOTE_UPLOAD_ENABLED:-0}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/watch_index.py\"]\n    cpus: 2\n    networks:\n      - dev-remote-network\n\n  # Init payload service - modified for PVC volumes with complete bootstrap\n  init_payload:\n    build:\n      context: .\n      dockerfile: Dockerfile.indexer\n    container_name: init-payload-dev-remote\n    user: \"0:0\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - HF_HOME=/work/.cache/huggingface\n      - TRANSFORMERS_CACHE=/work/.cache/huggingface\n      - HUGGINGFACE_HUB_CACHE=/work/.cache/huggingface\n      - WORKDIR=/work\n      - TOKENIZER_URL=${TOKENIZER_URL:-https://huggingface.co/BAAI/bge-base-en-v1.5/resolve/main/tokenizer.json}\n      - TOKENIZER_PATH=${TOKENIZER_PATH:-/work/models/tokenizer.json}\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n    command: [\n      \"sh\",\n      \"-c\",\n      \"mkdir -p /tmp/logs /work/.codebase && (chgrp -R 1000 /work/.codebase 2>/dev/null || true) && (chmod -R g+rwX /work/.codebase 2>/dev/null || true) && (find /work/.codebase -type d -exec chmod g+s {} + 2>/dev/null || true) && echo 'Starting initialization sequence...' && /app/scripts/wait-for-qdrant.sh && PYTHONPATH=/app python /app/scripts/create_indexes.py && echo 'Collections and metadata created' && python /app/scripts/warm_all_collections.py && echo 'Search caches warmed for all collections' && python /app/scripts/health_check.py && echo 'Initialization completed successfully!'\"\n    ]\n    restart: \"no\"  # Run once on startup\n    networks:\n      - dev-remote-network\n\n  # NEW: Upload Service for Remote Upload System\n  upload_service:\n    build:\n      context: .\n      dockerfile: Dockerfile.upload-service\n    container_name: upload-service-dev-remote\n    user: \"0:0\" # Windows bind-mount to /work requires root to create workspace dirs\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      # Upload service configuration\n      - UPLOAD_SERVICE_HOST=0.0.0.0\n      - UPLOAD_SERVICE_PORT=8002\n      - QDRANT_URL=${QDRANT_URL}\n      - WORKDIR=/work\n      - MAX_BUNDLE_SIZE_MB=100\n      - UPLOAD_TIMEOUT_SECS=300\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - CTXCE_ADMIN_COLLECTION_DELETE_ENABLED=${CTXCE_ADMIN_COLLECTION_DELETE_ENABLED:-0}\n      - CTXCE_COLLECTION_REGISTRY_UNDELETE_ON_DISCOVERY=${CTXCE_COLLECTION_REGISTRY_UNDELETE_ON_DISCOVERY:-0}\n      \n      # Indexing configuration\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - HF_HOME=/work/.cache/huggingface\n      - TRANSFORMERS_CACHE=/work/.cache/huggingface\n      - HUGGINGFACE_HUB_CACHE=/work/.cache/huggingface\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - USE_TREE_SITTER=${USE_TREE_SITTER}\n      - INDEX_SEMANTIC_CHUNKS=${INDEX_SEMANTIC_CHUNKS}\n      - INDEX_MICRO_CHUNKS=${INDEX_MICRO_CHUNKS}\n      \n      # Remote upload mode configuration\n      - REMOTE_UPLOAD_ENABLED=1\n      - REMOTE_UPLOAD_MODE=development\n      - REMOTE_UPLOAD_DEBUG=1\n      - REMOTE_UPLOAD_TIMEOUT=300\n      - REMOTE_UPLOAD_MAX_RETRIES=5\n      - MAX_BUNDLE_SIZE_MB=256\n      \n      # Qdrant configuration\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE}\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n    ports:\n      - \"8004:8002\"  # Map to different host port to avoid conflicts\n      - \"18004:18000\"  # Health check port\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - upload_temp:/tmp/uploads\n    command: [\n      \"sh\",\n      \"-c\",\n      \"mkdir -p /work/.codebase && (chgrp -R 1000 /work/.codebase 2>/dev/null || true) && (chmod -R g+rwX /work/.codebase 2>/dev/null || true) && (find /work/.codebase -type d -exec chmod g+s {} + 2>/dev/null || true) && exec python scripts/upload_service.py\"\n    ]\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8002/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    restart: unless-stopped\n    networks:\n      - dev-remote-network\n\n  \n# PVCs to simulate CephFS RWX behavior (production-like)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.qdrant_10": {
      "name": "services.qdrant",
      "type": "key",
      "start_line": 10,
      "end_line": 21,
      "content_hash": "54e08c83154f4c3cdabcead9468f30db07b8abbd",
      "content": "  qdrant:\n    image: qdrant/qdrant:latest\n    container_name: qdrant-db-dev-remote\n    ports:\n      - \"6333:6333\"\n      - \"6334:6334\"\n    volumes:\n      - qdrant_storage_dev_remote:/qdrant/storage\n    networks:\n      - dev-remote-network\n\n  # MCP search service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.qdrant.image_11": {
      "name": "services.qdrant.image",
      "type": "key",
      "start_line": 11,
      "end_line": 11,
      "content_hash": "e3548351c22deb286c483b3cce5c2d7b616d9418",
      "content": "    image: qdrant/qdrant:latest",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.qdrant.container_name_12": {
      "name": "services.qdrant.container_name",
      "type": "key",
      "start_line": 12,
      "end_line": 12,
      "content_hash": "54c87e87fd6c1eeb22ad1ad7c714ffd5198b6728",
      "content": "    container_name: qdrant-db-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.qdrant.ports_13": {
      "name": "services.qdrant.ports",
      "type": "key",
      "start_line": 13,
      "end_line": 15,
      "content_hash": "7084a91e5611ffa1a2802770a8f74998d43f7604",
      "content": "    ports:\n      - \"6333:6333\"\n      - \"6334:6334\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.qdrant.volumes_16": {
      "name": "services.qdrant.volumes",
      "type": "key",
      "start_line": 16,
      "end_line": 17,
      "content_hash": "38d63fb5d8c7eb13f0f1beb3f03a7b62fe3ba5c6",
      "content": "    volumes:\n      - qdrant_storage_dev_remote:/qdrant/storage",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.qdrant.networks_18": {
      "name": "services.qdrant.networks",
      "type": "key",
      "start_line": 18,
      "end_line": 21,
      "content_hash": "ef7633601e4be1c96f4dc5d042f3e5d9faed55e2",
      "content": "    networks:\n      - dev-remote-network\n\n  # MCP search service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_22": {
      "name": "services.mcp",
      "type": "key",
      "start_line": 22,
      "end_line": 77,
      "content_hash": "c7cc3475aa1265336c3d07b80a549a498064b903",
      "content": "  mcp:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp\n    container_name: mcp-search-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_PORT=${FASTMCP_PORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      # Use /tmp for HF caches to avoid root-owned docker volume permissions\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - TOOL_STORE_DESCRIPTION=${TOOL_STORE_DESCRIPTION}\n      - TOOL_FIND_DESCRIPTION=${TOOL_FIND_DESCRIPTION}\n      - FASTMCP_HEALTH_PORT=18000\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"18000:18000\"\n      - \"8000:8000\"\n    volumes:\n      - workspace_pvc:/work:ro\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # MCP indexer service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.build_23": {
      "name": "services.mcp.build",
      "type": "key",
      "start_line": 23,
      "end_line": 25,
      "content_hash": "f4015ef42c7d4c8909de3cd6149b2476b974681d",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.mcp",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.build.context_24": {
      "name": "services.mcp.build.context",
      "type": "key",
      "start_line": 24,
      "end_line": 24,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.build.dockerfile_25": {
      "name": "services.mcp.build.dockerfile",
      "type": "key",
      "start_line": 25,
      "end_line": 25,
      "content_hash": "d9c9833ce19ca288ec68f35f4e13e9714acba94e",
      "content": "      dockerfile: Dockerfile.mcp",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.container_name_26": {
      "name": "services.mcp.container_name",
      "type": "key",
      "start_line": 26,
      "end_line": 26,
      "content_hash": "d19e9597e8b72ba26a75e40f3fedb3452222e049",
      "content": "    container_name: mcp-search-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.user_27": {
      "name": "services.mcp.user",
      "type": "key",
      "start_line": 27,
      "end_line": 27,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.depends_on_28": {
      "name": "services.mcp.depends_on",
      "type": "key",
      "start_line": 28,
      "end_line": 29,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.env_file_30": {
      "name": "services.mcp.env_file",
      "type": "key",
      "start_line": 30,
      "end_line": 31,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.environment_32": {
      "name": "services.mcp.environment",
      "type": "key",
      "start_line": 32,
      "end_line": 66,
      "content_hash": "7a9cdd826981bfd200f03642fa0b093ea8bbff7d",
      "content": "    environment:\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_PORT=${FASTMCP_PORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      # Use /tmp for HF caches to avoid root-owned docker volume permissions\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - TOOL_STORE_DESCRIPTION=${TOOL_STORE_DESCRIPTION}\n      - TOOL_FIND_DESCRIPTION=${TOOL_FIND_DESCRIPTION}\n      - FASTMCP_HEALTH_PORT=18000\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.ports_67": {
      "name": "services.mcp.ports",
      "type": "key",
      "start_line": 67,
      "end_line": 69,
      "content_hash": "ca0b1cd3f1df0993feab3adbe71bfd1a961b28da",
      "content": "    ports:\n      - \"18000:18000\"\n      - \"8000:8000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.volumes_70": {
      "name": "services.mcp.volumes",
      "type": "key",
      "start_line": 70,
      "end_line": 73,
      "content_hash": "56e5729b79a68b5d752166ffe44d5db95f7702dd",
      "content": "    volumes:\n      - workspace_pvc:/work:ro\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp.networks_74": {
      "name": "services.mcp.networks",
      "type": "key",
      "start_line": 74,
      "end_line": 77,
      "content_hash": "1715b62215ade82a73a66f828f7b5144c2c57496",
      "content": "    networks:\n      - dev-remote-network\n\n  # MCP indexer service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_78": {
      "name": "services.mcp_indexer",
      "type": "key",
      "start_line": 78,
      "end_line": 157,
      "content_hash": "e8a0c92ec2c20cf2f6b717be758e447b72950247",
      "content": "  mcp_indexer:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer\n    container_name: mcp-indexer-dev-remote\n    user: \"1000:1000\"\n    # In K8s, scripts would be accessed directly at /app/scripts/ or via proper initContainer\n    # For Docker Compose dev-remote simulation, create symlink so /work/scripts/ works\n    # Use /tmp/huggingface for cache to avoid permission issues (universally writable)\n    # Set CORRECT environment variables for HuggingFace and FastEmbed\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/mcp_indexer_server.py\"]\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - LOG_LEVEL=${LOG_LEVEL:-INFO}\n      - FASTMCP_HEALTH_PORT=18001\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_INDEXER_PORT=${FASTMCP_INDEXER_PORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - REFRAG_DECODER=${REFRAG_DECODER:-1}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-llamacpp}\n      - GLM_API_KEY=${GLM_API_KEY}\n      - GLM_API_BASE=${GLM_API_BASE:-https://api.z.ai/api/paas/v4/}\n      - GLM_MODEL=${GLM_MODEL:-glm-4.6}\n      - LLAMACPP_URL=${LLAMACPP_URL:-http://llamacpp:8080}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env (no defaults here to respect .env)\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"${FASTMCP_INDEXER_PORT:-8001}:8001\"\n      - \"18001:18001\"\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # Learning reranker worker - processes training events in background",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.build_79": {
      "name": "services.mcp_indexer.build",
      "type": "key",
      "start_line": 79,
      "end_line": 81,
      "content_hash": "e9fa437527dc0dcf68255ae6d6daa8730837a3ff",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.build.context_80": {
      "name": "services.mcp_indexer.build.context",
      "type": "key",
      "start_line": 80,
      "end_line": 80,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.build.dockerfile_81": {
      "name": "services.mcp_indexer.build.dockerfile",
      "type": "key",
      "start_line": 81,
      "end_line": 81,
      "content_hash": "a39248293ab9144c4323411115cf4a3d7b0b3d0e",
      "content": "      dockerfile: Dockerfile.mcp-indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.container_name_82": {
      "name": "services.mcp_indexer.container_name",
      "type": "key",
      "start_line": 82,
      "end_line": 82,
      "content_hash": "cacdd40934c3029722d87afa1307e7b4bb02b5c6",
      "content": "    container_name: mcp-indexer-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.user_83": {
      "name": "services.mcp_indexer.user",
      "type": "key",
      "start_line": 83,
      "end_line": 83,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.command_88": {
      "name": "services.mcp_indexer.command",
      "type": "key",
      "start_line": 88,
      "end_line": 88,
      "content_hash": "814284ce1a0635b27622d23c9e4ad22329f709c0",
      "content": "    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/mcp_indexer_server.py\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.depends_on_89": {
      "name": "services.mcp_indexer.depends_on",
      "type": "key",
      "start_line": 89,
      "end_line": 90,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.env_file_91": {
      "name": "services.mcp_indexer.env_file",
      "type": "key",
      "start_line": 91,
      "end_line": 92,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.environment_93": {
      "name": "services.mcp_indexer.environment",
      "type": "key",
      "start_line": 93,
      "end_line": 145,
      "content_hash": "05601fb69afb6ba122228b481345d110d0c631f2",
      "content": "    environment:\n      - LOG_LEVEL=${LOG_LEVEL:-INFO}\n      - FASTMCP_HEALTH_PORT=18001\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_INDEXER_PORT=${FASTMCP_INDEXER_PORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - REFRAG_DECODER=${REFRAG_DECODER:-1}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-llamacpp}\n      - GLM_API_KEY=${GLM_API_KEY}\n      - GLM_API_BASE=${GLM_API_BASE:-https://api.z.ai/api/paas/v4/}\n      - GLM_MODEL=${GLM_MODEL:-glm-4.6}\n      - LLAMACPP_URL=${LLAMACPP_URL:-http://llamacpp:8080}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env (no defaults here to respect .env)\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.ports_146": {
      "name": "services.mcp_indexer.ports",
      "type": "key",
      "start_line": 146,
      "end_line": 148,
      "content_hash": "433ba8bff9cf9163ae16bd70e2400542f7e17793",
      "content": "    ports:\n      - \"${FASTMCP_INDEXER_PORT:-8001}:8001\"\n      - \"18001:18001\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.volumes_149": {
      "name": "services.mcp_indexer.volumes",
      "type": "key",
      "start_line": 149,
      "end_line": 153,
      "content_hash": "8dd225320853945e8c4d80c15802d9c9de22f312",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer.networks_154": {
      "name": "services.mcp_indexer.networks",
      "type": "key",
      "start_line": 154,
      "end_line": 157,
      "content_hash": "ff0626026d3b39fae12d3f2585a81a722c18ae00",
      "content": "    networks:\n      - dev-remote-network\n\n  # Learning reranker worker - processes training events in background",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker_158": {
      "name": "services.learning_worker",
      "type": "key",
      "start_line": 158,
      "end_line": 201,
      "content_hash": "4512f926c8d87379862260ac711db104e07516ce",
      "content": "  learning_worker:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer\n    container_name: learning-worker-dev-remote\n    user: \"1000:1000\"\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/learning_reranker_worker.py --daemon\"]\n    depends_on:\n      - qdrant\n      - mcp_indexer\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_LEARNING_BATCH_SIZE=${RERANK_LEARNING_BATCH_SIZE:-32}\n      - RERANK_LEARNING_POLL_INTERVAL=${RERANK_LEARNING_POLL_INTERVAL:-30}\n      - RERANK_LEARNING_RATE=${RERANK_LEARNING_RATE:-0.001}\n      - RERANK_LLM_TEACHER=${RERANK_LLM_TEACHER:-0}\n      - RERANK_LLM_SAMPLE_RATE=${RERANK_LLM_SAMPLE_RATE:-1.0}\n      - GLM_API_KEY=${GLM_API_KEY:-}\n      - GLM_API_BASE=${GLM_API_BASE:-}\n      - GLM_MODEL=${GLM_MODEL:-}\n      - GLM_MODEL_FAST=${GLM_MODEL_FAST:-}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-glm}\n      - LLAMACPP_URL=${LLAMACPP_URL:-}\n      - RERANK_VICREG_WEIGHT=${RERANK_VICREG_WEIGHT:-0.1}\n    volumes:\n      - workspace_pvc:/work:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n    restart: unless-stopped\n\n  # MCP HTTP search service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.build_159": {
      "name": "services.learning_worker.build",
      "type": "key",
      "start_line": 159,
      "end_line": 161,
      "content_hash": "e9fa437527dc0dcf68255ae6d6daa8730837a3ff",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.build.context_160": {
      "name": "services.learning_worker.build.context",
      "type": "key",
      "start_line": 160,
      "end_line": 160,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.build.dockerfile_161": {
      "name": "services.learning_worker.build.dockerfile",
      "type": "key",
      "start_line": 161,
      "end_line": 161,
      "content_hash": "a39248293ab9144c4323411115cf4a3d7b0b3d0e",
      "content": "      dockerfile: Dockerfile.mcp-indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.container_name_162": {
      "name": "services.learning_worker.container_name",
      "type": "key",
      "start_line": 162,
      "end_line": 162,
      "content_hash": "b6808ae0e41487e1f60f0a1127dffd50c485180f",
      "content": "    container_name: learning-worker-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.user_163": {
      "name": "services.learning_worker.user",
      "type": "key",
      "start_line": 163,
      "end_line": 163,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.command_164": {
      "name": "services.learning_worker.command",
      "type": "key",
      "start_line": 164,
      "end_line": 164,
      "content_hash": "d2689fa1c7b7084143ba669613b5421a54c014f9",
      "content": "    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/learning_reranker_worker.py --daemon\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.depends_on_165": {
      "name": "services.learning_worker.depends_on",
      "type": "key",
      "start_line": 165,
      "end_line": 167,
      "content_hash": "16dc1e58ec2de1da697a0619bac9990c6604cefd",
      "content": "    depends_on:\n      - qdrant\n      - mcp_indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.env_file_168": {
      "name": "services.learning_worker.env_file",
      "type": "key",
      "start_line": 168,
      "end_line": 169,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.environment_170": {
      "name": "services.learning_worker.environment",
      "type": "key",
      "start_line": 170,
      "end_line": 192,
      "content_hash": "412a8666d73e23930218808c9ef1c2136c4a2ed2",
      "content": "    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_LEARNING_BATCH_SIZE=${RERANK_LEARNING_BATCH_SIZE:-32}\n      - RERANK_LEARNING_POLL_INTERVAL=${RERANK_LEARNING_POLL_INTERVAL:-30}\n      - RERANK_LEARNING_RATE=${RERANK_LEARNING_RATE:-0.001}\n      - RERANK_LLM_TEACHER=${RERANK_LLM_TEACHER:-0}\n      - RERANK_LLM_SAMPLE_RATE=${RERANK_LLM_SAMPLE_RATE:-1.0}\n      - GLM_API_KEY=${GLM_API_KEY:-}\n      - GLM_API_BASE=${GLM_API_BASE:-}\n      - GLM_MODEL=${GLM_MODEL:-}\n      - GLM_MODEL_FAST=${GLM_MODEL_FAST:-}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-glm}\n      - LLAMACPP_URL=${LLAMACPP_URL:-}\n      - RERANK_VICREG_WEIGHT=${RERANK_VICREG_WEIGHT:-0.1}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.volumes_193": {
      "name": "services.learning_worker.volumes",
      "type": "key",
      "start_line": 193,
      "end_line": 196,
      "content_hash": "f695e7e9a84982dc20f7525f7855e4f9831e1b92",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.networks_197": {
      "name": "services.learning_worker.networks",
      "type": "key",
      "start_line": 197,
      "end_line": 198,
      "content_hash": "8baa425cb253d1a1045da7e46df870dbbe9f46d4",
      "content": "    networks:\n      - dev-remote-network",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.learning_worker.restart_199": {
      "name": "services.learning_worker.restart",
      "type": "key",
      "start_line": 199,
      "end_line": 199,
      "content_hash": "74557caa0a21d8e8ad7cfa64ad6b18fb402da2d0",
      "content": "    restart: unless-stopped",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http_202": {
      "name": "services.mcp_http",
      "type": "key",
      "start_line": 202,
      "end_line": 258,
      "content_hash": "fb5790b6de5a8197b47abab76b98a6d6e8b0772e",
      "content": "  mcp_http:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp\n    container_name: mcp-search-http-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_PORT=8000\n      - FASTMCP_TRANSPORT=${FASTMCP_HTTP_TRANSPORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      # Use /tmp for HF caches to avoid root-owned docker volume permissions\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - TOOL_STORE_DESCRIPTION=${TOOL_STORE_DESCRIPTION}\n      - TOOL_FIND_DESCRIPTION=${TOOL_FIND_DESCRIPTION}\n      - FASTMCP_HEALTH_PORT=18000\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"${FASTMCP_HTTP_HEALTH_PORT:-18002}:18000\"\n      - \"${FASTMCP_HTTP_PORT:-8002}:8000\"\n    volumes:\n      - workspace_pvc:/work:ro\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # MCP HTTP indexer service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.build_203": {
      "name": "services.mcp_http.build",
      "type": "key",
      "start_line": 203,
      "end_line": 205,
      "content_hash": "f4015ef42c7d4c8909de3cd6149b2476b974681d",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.mcp",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.build.context_204": {
      "name": "services.mcp_http.build.context",
      "type": "key",
      "start_line": 204,
      "end_line": 204,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.build.dockerfile_205": {
      "name": "services.mcp_http.build.dockerfile",
      "type": "key",
      "start_line": 205,
      "end_line": 205,
      "content_hash": "d9c9833ce19ca288ec68f35f4e13e9714acba94e",
      "content": "      dockerfile: Dockerfile.mcp",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.container_name_206": {
      "name": "services.mcp_http.container_name",
      "type": "key",
      "start_line": 206,
      "end_line": 206,
      "content_hash": "fcb527c09eea266f2233cb8c02c27d689de28d18",
      "content": "    container_name: mcp-search-http-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.user_207": {
      "name": "services.mcp_http.user",
      "type": "key",
      "start_line": 207,
      "end_line": 207,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.depends_on_208": {
      "name": "services.mcp_http.depends_on",
      "type": "key",
      "start_line": 208,
      "end_line": 209,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.env_file_210": {
      "name": "services.mcp_http.env_file",
      "type": "key",
      "start_line": 210,
      "end_line": 211,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.environment_212": {
      "name": "services.mcp_http.environment",
      "type": "key",
      "start_line": 212,
      "end_line": 247,
      "content_hash": "3cad551f05e858d88b9321c061b207a9a42b8dfd",
      "content": "    environment:\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_PORT=8000\n      - FASTMCP_TRANSPORT=${FASTMCP_HTTP_TRANSPORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      # Use /tmp for HF caches to avoid root-owned docker volume permissions\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - TOOL_STORE_DESCRIPTION=${TOOL_STORE_DESCRIPTION}\n      - TOOL_FIND_DESCRIPTION=${TOOL_FIND_DESCRIPTION}\n      - FASTMCP_HEALTH_PORT=18000\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.ports_248": {
      "name": "services.mcp_http.ports",
      "type": "key",
      "start_line": 248,
      "end_line": 250,
      "content_hash": "f82b8a118a9cf59dbc011b88a54e269837e1aa43",
      "content": "    ports:\n      - \"${FASTMCP_HTTP_HEALTH_PORT:-18002}:18000\"\n      - \"${FASTMCP_HTTP_PORT:-8002}:8000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.volumes_251": {
      "name": "services.mcp_http.volumes",
      "type": "key",
      "start_line": 251,
      "end_line": 254,
      "content_hash": "56e5729b79a68b5d752166ffe44d5db95f7702dd",
      "content": "    volumes:\n      - workspace_pvc:/work:ro\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_http.networks_255": {
      "name": "services.mcp_http.networks",
      "type": "key",
      "start_line": 255,
      "end_line": 258,
      "content_hash": "63ddae3abbb82029d9cfad5ed16ead53c82c4165",
      "content": "    networks:\n      - dev-remote-network\n\n  # MCP HTTP indexer service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http_259": {
      "name": "services.mcp_indexer_http",
      "type": "key",
      "start_line": 259,
      "end_line": 339,
      "content_hash": "9a67b1abff108a109c78d010bded5f69f8e24876",
      "content": "  mcp_indexer_http:\n    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer\n    container_name: mcp-indexer-http-dev-remote\n    user: \"1000:1000\"\n    # In K8s, scripts would be accessed directly at /app/scripts/ or via proper initContainer\n    # For Docker Compose dev-remote simulation, create symlink so /work/scripts/ works\n    # Use /tmp/huggingface for cache to avoid permission issues (universally writable)\n    # Set CORRECT environment variables for HuggingFace and FastEmbed\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/mcp_indexer_server.py\"]\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - LOG_LEVEL=${LOG_LEVEL:-INFO}\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_INDEXER_PORT=8001\n      - FASTMCP_TRANSPORT=${FASTMCP_HTTP_TRANSPORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - REFRAG_DECODER=${REFRAG_DECODER:-1}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-llamacpp}\n      - GLM_API_KEY=${GLM_API_KEY}\n      - GLM_API_BASE=${GLM_API_BASE:-https://api.z.ai/api/paas/v4/}\n      - GLM_MODEL=${GLM_MODEL:-glm-4.6}\n      - LLAMACPP_URL=${LLAMACPP_URL:-http://llamacpp:8080}\n      - FASTMCP_HEALTH_PORT=18001\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}\n    ports:\n      - \"${FASTMCP_INDEXER_HTTP_PORT:-8003}:8001\"\n      - \"${FASTMCP_INDEXER_HTTP_HEALTH_PORT:-18003}:18001\"\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw\n    networks:\n      - dev-remote-network\n\n  # Llama.cpp decoder service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.build_260": {
      "name": "services.mcp_indexer_http.build",
      "type": "key",
      "start_line": 260,
      "end_line": 262,
      "content_hash": "e9fa437527dc0dcf68255ae6d6daa8730837a3ff",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.mcp-indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.build.context_261": {
      "name": "services.mcp_indexer_http.build.context",
      "type": "key",
      "start_line": 261,
      "end_line": 261,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.build.dockerfile_262": {
      "name": "services.mcp_indexer_http.build.dockerfile",
      "type": "key",
      "start_line": 262,
      "end_line": 262,
      "content_hash": "a39248293ab9144c4323411115cf4a3d7b0b3d0e",
      "content": "      dockerfile: Dockerfile.mcp-indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.container_name_263": {
      "name": "services.mcp_indexer_http.container_name",
      "type": "key",
      "start_line": 263,
      "end_line": 263,
      "content_hash": "2964d42cd86800bb9d07b694e3af6811c4e0140e",
      "content": "    container_name: mcp-indexer-http-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.user_264": {
      "name": "services.mcp_indexer_http.user",
      "type": "key",
      "start_line": 264,
      "end_line": 264,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.command_269": {
      "name": "services.mcp_indexer_http.command",
      "type": "key",
      "start_line": 269,
      "end_line": 269,
      "content_hash": "814284ce1a0635b27622d23c9e4ad22329f709c0",
      "content": "    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/mcp_indexer_server.py\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.depends_on_270": {
      "name": "services.mcp_indexer_http.depends_on",
      "type": "key",
      "start_line": 270,
      "end_line": 271,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.env_file_272": {
      "name": "services.mcp_indexer_http.env_file",
      "type": "key",
      "start_line": 272,
      "end_line": 273,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.environment_274": {
      "name": "services.mcp_indexer_http.environment",
      "type": "key",
      "start_line": 274,
      "end_line": 327,
      "content_hash": "ef3b49716d611a8f429bf3b1c83b82a14f35c31c",
      "content": "    environment:\n      - LOG_LEVEL=${LOG_LEVEL:-INFO}\n      - FASTMCP_HOST=${FASTMCP_HOST}\n      - FASTMCP_INDEXER_PORT=8001\n      - FASTMCP_TRANSPORT=${FASTMCP_HTTP_TRANSPORT}\n      - QDRANT_URL=${QDRANT_URL}\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - REFRAG_DECODER=${REFRAG_DECODER:-1}\n      - REFRAG_RUNTIME=${REFRAG_RUNTIME:-llamacpp}\n      - GLM_API_KEY=${GLM_API_KEY}\n      - GLM_API_BASE=${GLM_API_BASE:-https://api.z.ai/api/paas/v4/}\n      - GLM_MODEL=${GLM_MODEL:-glm-4.6}\n      - LLAMACPP_URL=${LLAMACPP_URL:-http://llamacpp:8080}\n      - FASTMCP_HEALTH_PORT=18001\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - PATH_EMIT_MODE=auto\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n      # Learning reranker configuration\n      - RERANK_LEARNING=${RERANK_LEARNING:-1}\n      - RERANKER_WEIGHTS_DIR=/tmp/rerank_weights\n      - RERANK_EVENTS_DIR=/tmp/rerank_events\n      - RERANK_EVENTS_ENABLED=${RERANK_EVENTS_ENABLED:-1}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.ports_328": {
      "name": "services.mcp_indexer_http.ports",
      "type": "key",
      "start_line": 328,
      "end_line": 330,
      "content_hash": "945fd9e04df0b59fe71cff363afde342a4fc52b7",
      "content": "    ports:\n      - \"${FASTMCP_INDEXER_HTTP_PORT:-8003}:8001\"\n      - \"${FASTMCP_INDEXER_HTTP_HEALTH_PORT:-18003}:18001\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.volumes_331": {
      "name": "services.mcp_indexer_http.volumes",
      "type": "key",
      "start_line": 331,
      "end_line": 335,
      "content_hash": "8dd225320853945e8c4d80c15802d9c9de22f312",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - rerank_data:/tmp/rerank_weights:rw\n      - rerank_events:/tmp/rerank_events:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.mcp_indexer_http.networks_336": {
      "name": "services.mcp_indexer_http.networks",
      "type": "key",
      "start_line": 336,
      "end_line": 339,
      "content_hash": "327753f59b45660212a5f76004b5663a0460edf3",
      "content": "    networks:\n      - dev-remote-network\n\n  # Llama.cpp decoder service - same as base compose",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp_340": {
      "name": "services.llamacpp",
      "type": "key",
      "start_line": 340,
      "end_line": 356,
      "content_hash": "38b865f0af1fcc8226ec1ab000c06ba99132dd03",
      "content": "  llamacpp:\n    image: ghcr.io/ggerganov/llama.cpp:server\n    container_name: llama-decoder-dev-remote\n    environment:\n      - LLAMA_ARG_MODEL=/models/model.gguf\n      - LLAMA_ARG_CTX_SIZE=8192\n      - LLAMA_ARG_HOST=0.0.0.0\n      - LLAMA_ARG_PORT=8080\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - ./models:/models:ro\n    command: [\"--model\", \"/models/model.gguf\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\", \"--no-warmup\"]\n    networks:\n      - dev-remote-network\n\n  # Indexer service - modified for PVC volumes",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.image_341": {
      "name": "services.llamacpp.image",
      "type": "key",
      "start_line": 341,
      "end_line": 341,
      "content_hash": "98c71bfb2ff9e90e7db14e0ae76a5cb030d954cb",
      "content": "    image: ghcr.io/ggerganov/llama.cpp:server",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.container_name_342": {
      "name": "services.llamacpp.container_name",
      "type": "key",
      "start_line": 342,
      "end_line": 342,
      "content_hash": "df069b4112874b9a6f008221395ce56bd4c2c66c",
      "content": "    container_name: llama-decoder-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.environment_343": {
      "name": "services.llamacpp.environment",
      "type": "key",
      "start_line": 343,
      "end_line": 347,
      "content_hash": "79a9b5ebef38420fe72b3a58fbbaec8dd6d0dda4",
      "content": "    environment:\n      - LLAMA_ARG_MODEL=/models/model.gguf\n      - LLAMA_ARG_CTX_SIZE=8192\n      - LLAMA_ARG_HOST=0.0.0.0\n      - LLAMA_ARG_PORT=8080",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.ports_348": {
      "name": "services.llamacpp.ports",
      "type": "key",
      "start_line": 348,
      "end_line": 349,
      "content_hash": "33a0b4c6b23d07e8cb2eb88b705485b3b4f386d2",
      "content": "    ports:\n      - \"8080:8080\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.volumes_350": {
      "name": "services.llamacpp.volumes",
      "type": "key",
      "start_line": 350,
      "end_line": 351,
      "content_hash": "1545b006f4423d3cf5c6dbb5d2e2b388dff229d6",
      "content": "    volumes:\n      - ./models:/models:ro",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.command_352": {
      "name": "services.llamacpp.command",
      "type": "key",
      "start_line": 352,
      "end_line": 352,
      "content_hash": "ba1584173053504599680a7600065d8c4508ef73",
      "content": "    command: [\"--model\", \"/models/model.gguf\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\", \"--no-warmup\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.llamacpp.networks_353": {
      "name": "services.llamacpp.networks",
      "type": "key",
      "start_line": 353,
      "end_line": 356,
      "content_hash": "e9fa9a5936eab398a00f6f36816aa1bf5b43087b",
      "content": "    networks:\n      - dev-remote-network\n\n  # Indexer service - modified for PVC volumes",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer_357": {
      "name": "services.indexer",
      "type": "key",
      "start_line": 357,
      "end_line": 410,
      "content_hash": "b7fc446056d7a42ea3443cee061b1e764d040903",
      "content": "  indexer:\n    build:\n      context: .\n      dockerfile: Dockerfile.indexer\n    container_name: indexer-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - GIT_HISTORY_PRUNE=${GIT_HISTORY_PRUNE:-1}\n      - GIT_HISTORY_DELETE_MANIFEST=${GIT_HISTORY_DELETE_MANIFEST:-0}\n      - GIT_HISTORY_MANIFEST_MAX_FILES=${GIT_HISTORY_MANIFEST_MAX_FILES:-0}\n      # Use /tmp for HF caches to avoid permission issues during model download\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - HOST_INDEX_PATH=/work\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n    entrypoint: [\"sh\", \"-c\", \"mkdir -p /tmp/logs /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && /app/scripts/wait-for-qdrant.sh && cd /app && python /app/scripts/ingest_code.py --root /work\"]\n    restart: \"no\"  # Run once on startup, do not restart after completion\n    cpus: 2.0\n    networks:\n      - dev-remote-network\n\n  # Watcher service - modified for PVC volumes",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.build_358": {
      "name": "services.indexer.build",
      "type": "key",
      "start_line": 358,
      "end_line": 360,
      "content_hash": "5f17dc77ad3fa01d41f4633c680af811d5f0719c",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.build.context_359": {
      "name": "services.indexer.build.context",
      "type": "key",
      "start_line": 359,
      "end_line": 359,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.build.dockerfile_360": {
      "name": "services.indexer.build.dockerfile",
      "type": "key",
      "start_line": 360,
      "end_line": 360,
      "content_hash": "fca1ab723f36dadaf106da76545461c692a4a079",
      "content": "      dockerfile: Dockerfile.indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.container_name_361": {
      "name": "services.indexer.container_name",
      "type": "key",
      "start_line": 361,
      "end_line": 361,
      "content_hash": "e09986634ea1e0faca507659792902506507eeb7",
      "content": "    container_name: indexer-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.user_362": {
      "name": "services.indexer.user",
      "type": "key",
      "start_line": 362,
      "end_line": 362,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.depends_on_363": {
      "name": "services.indexer.depends_on",
      "type": "key",
      "start_line": 363,
      "end_line": 364,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.env_file_365": {
      "name": "services.indexer.env_file",
      "type": "key",
      "start_line": 365,
      "end_line": 366,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.environment_367": {
      "name": "services.indexer.environment",
      "type": "key",
      "start_line": 367,
      "end_line": 400,
      "content_hash": "0d100b9733c2b5e99abc0b15d32a12f82904cf7d",
      "content": "    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - GIT_HISTORY_PRUNE=${GIT_HISTORY_PRUNE:-1}\n      - GIT_HISTORY_DELETE_MANIFEST=${GIT_HISTORY_DELETE_MANIFEST:-0}\n      - GIT_HISTORY_MANIFEST_MAX_FILES=${GIT_HISTORY_MANIFEST_MAX_FILES:-0}\n      # Use /tmp for HF caches to avoid permission issues during model download\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - HUGGINGFACE_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - HF_HUB_DISABLE_XET=1\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - HOST_INDEX_PATH=/work\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.volumes_401": {
      "name": "services.indexer.volumes",
      "type": "key",
      "start_line": 401,
      "end_line": 403,
      "content_hash": "fbe3c030b8d8cbe13271efd87429664731a4e062",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.entrypoint_404": {
      "name": "services.indexer.entrypoint",
      "type": "key",
      "start_line": 404,
      "end_line": 404,
      "content_hash": "6355e40c9544ab55e7d8b777b855c57419e5d3f3",
      "content": "    entrypoint: [\"sh\", \"-c\", \"mkdir -p /tmp/logs /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && /app/scripts/wait-for-qdrant.sh && cd /app && python /app/scripts/ingest_code.py --root /work\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.restart_405": {
      "name": "services.indexer.restart",
      "type": "key",
      "start_line": 405,
      "end_line": 405,
      "content_hash": "3f46e646a528c704024ec4eece7e9e5c1660bdb5",
      "content": "    restart: \"no\"  # Run once on startup, do not restart after completion",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.cpus_406": {
      "name": "services.indexer.cpus",
      "type": "key",
      "start_line": 406,
      "end_line": 406,
      "content_hash": "141ecb85833614feffa5ea6b288f4d042ecd5cf5",
      "content": "    cpus: 2.0",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.indexer.networks_407": {
      "name": "services.indexer.networks",
      "type": "key",
      "start_line": 407,
      "end_line": 410,
      "content_hash": "26494a69dcf31a830b5f8b78f1e56acbdb9feda6",
      "content": "    networks:\n      - dev-remote-network\n\n  # Watcher service - modified for PVC volumes",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher_411": {
      "name": "services.watcher",
      "type": "key",
      "start_line": 411,
      "end_line": 464,
      "content_hash": "6d2aed6af29246053fd8a90101ae76fdd9b080b4",
      "content": "  watcher:\n    build:\n      context: .\n      dockerfile: Dockerfile.indexer\n    container_name: watcher-dev-remote\n    user: \"1000:1000\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - GIT_HISTORY_PRUNE=${GIT_HISTORY_PRUNE:-1}\n      - GIT_HISTORY_DELETE_MANIFEST=${GIT_HISTORY_DELETE_MANIFEST:-0}\n      - GIT_HISTORY_MANIFEST_MAX_FILES=${GIT_HISTORY_MANIFEST_MAX_FILES:-0}\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - WATCH_ROOT=${WATCH_ROOT:-/work}\n      - HOST_INDEX_PATH=/work\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      - WATCH_DEBOUNCE_SECS=${WATCH_DEBOUNCE_SECS:-1.5}\n      - REMOTE_UPLOAD_ENABLED=${REMOTE_UPLOAD_ENABLED:-0}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/watch_index.py\"]\n    cpus: 2\n    networks:\n      - dev-remote-network\n\n  # Init payload service - modified for PVC volumes with complete bootstrap",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.build_412": {
      "name": "services.watcher.build",
      "type": "key",
      "start_line": 412,
      "end_line": 414,
      "content_hash": "5f17dc77ad3fa01d41f4633c680af811d5f0719c",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.build.context_413": {
      "name": "services.watcher.build.context",
      "type": "key",
      "start_line": 413,
      "end_line": 413,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.build.dockerfile_414": {
      "name": "services.watcher.build.dockerfile",
      "type": "key",
      "start_line": 414,
      "end_line": 414,
      "content_hash": "fca1ab723f36dadaf106da76545461c692a4a079",
      "content": "      dockerfile: Dockerfile.indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.container_name_415": {
      "name": "services.watcher.container_name",
      "type": "key",
      "start_line": 415,
      "end_line": 415,
      "content_hash": "fc9726a12c278d14b1a6a3639f60bca5d8073511",
      "content": "    container_name: watcher-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.user_416": {
      "name": "services.watcher.user",
      "type": "key",
      "start_line": 416,
      "end_line": 416,
      "content_hash": "1e84eb803640eb0f0c2f67285fba23f292460258",
      "content": "    user: \"1000:1000\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.depends_on_417": {
      "name": "services.watcher.depends_on",
      "type": "key",
      "start_line": 417,
      "end_line": 418,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.env_file_419": {
      "name": "services.watcher.env_file",
      "type": "key",
      "start_line": 419,
      "end_line": 420,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.environment_421": {
      "name": "services.watcher.environment",
      "type": "key",
      "start_line": 421,
      "end_line": 455,
      "content_hash": "ca7ce8e719f15de799bef8d21909be444a460d3e",
      "content": "    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - GIT_HISTORY_PRUNE=${GIT_HISTORY_PRUNE:-1}\n      - GIT_HISTORY_DELETE_MANIFEST=${GIT_HISTORY_DELETE_MANIFEST:-0}\n      - GIT_HISTORY_MANIFEST_MAX_FILES=${GIT_HISTORY_MANIFEST_MAX_FILES:-0}\n      - HF_HOME=/tmp/huggingface\n      - HF_HUB_CACHE=/tmp/huggingface/hub\n      - TRANSFORMERS_CACHE=/tmp/huggingface/transformers\n      - FASTEMBED_CACHE_PATH=/tmp/huggingface/fastembed\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - WATCH_ROOT=${WATCH_ROOT:-/work}\n      - HOST_INDEX_PATH=/work\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT:-60}\n      # Chunking config - values come from .env\n      - INDEX_SEMANTIC_CHUNKS\n      - INDEX_MICRO_CHUNKS\n      - MICRO_CHUNK_TOKENS\n      - MICRO_CHUNK_STRIDE\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH:-512}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES:-5}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE:-200}\n      - WATCH_DEBOUNCE_SECS=${WATCH_DEBOUNCE_SECS:-1.5}\n      - REMOTE_UPLOAD_ENABLED=${REMOTE_UPLOAD_ENABLED:-0}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.volumes_456": {
      "name": "services.watcher.volumes",
      "type": "key",
      "start_line": 456,
      "end_line": 458,
      "content_hash": "fbe3c030b8d8cbe13271efd87429664731a4e062",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.command_459": {
      "name": "services.watcher.command",
      "type": "key",
      "start_line": 459,
      "end_line": 459,
      "content_hash": "58b31a025ce59071d34ff79b60d6b74057d83aba",
      "content": "    command: [\"sh\", \"-c\", \"mkdir -p /tmp/huggingface/hub /tmp/huggingface/transformers /tmp/huggingface/fastembed && exec python /app/scripts/watch_index.py\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.cpus_460": {
      "name": "services.watcher.cpus",
      "type": "key",
      "start_line": 460,
      "end_line": 460,
      "content_hash": "fb460f849b098a74077f6731762bc4630a8707c6",
      "content": "    cpus: 2",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.watcher.networks_461": {
      "name": "services.watcher.networks",
      "type": "key",
      "start_line": 461,
      "end_line": 464,
      "content_hash": "94e543b92dfbbe438f0aab85ab9b052038bd4a5d",
      "content": "    networks:\n      - dev-remote-network\n\n  # Init payload service - modified for PVC volumes with complete bootstrap",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload_465": {
      "name": "services.init_payload",
      "type": "key",
      "start_line": 465,
      "end_line": 504,
      "content_hash": "35bf59705fb101682a015b974d6b52f49929c293",
      "content": "  init_payload:\n    build:\n      context: .\n      dockerfile: Dockerfile.indexer\n    container_name: init-payload-dev-remote\n    user: \"0:0\"\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - HF_HOME=/work/.cache/huggingface\n      - TRANSFORMERS_CACHE=/work/.cache/huggingface\n      - HUGGINGFACE_HUB_CACHE=/work/.cache/huggingface\n      - WORKDIR=/work\n      - TOKENIZER_URL=${TOKENIZER_URL:-https://huggingface.co/BAAI/bge-base-en-v1.5/resolve/main/tokenizer.json}\n      - TOKENIZER_PATH=${TOKENIZER_PATH:-/work/models/tokenizer.json}\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n    command: [\n      \"sh\",\n      \"-c\",\n      \"mkdir -p /tmp/logs /work/.codebase && (chgrp -R 1000 /work/.codebase 2>/dev/null || true) && (chmod -R g+rwX /work/.codebase 2>/dev/null || true) && (find /work/.codebase -type d -exec chmod g+s {} + 2>/dev/null || true) && echo 'Starting initialization sequence...' && /app/scripts/wait-for-qdrant.sh && PYTHONPATH=/app python /app/scripts/create_indexes.py && echo 'Collections and metadata created' && python /app/scripts/warm_all_collections.py && echo 'Search caches warmed for all collections' && python /app/scripts/health_check.py && echo 'Initialization completed successfully!'\"\n    ]\n    restart: \"no\"  # Run once on startup\n    networks:\n      - dev-remote-network\n\n  # NEW: Upload Service for Remote Upload System",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.build_466": {
      "name": "services.init_payload.build",
      "type": "key",
      "start_line": 466,
      "end_line": 468,
      "content_hash": "5f17dc77ad3fa01d41f4633c680af811d5f0719c",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.build.context_467": {
      "name": "services.init_payload.build.context",
      "type": "key",
      "start_line": 467,
      "end_line": 467,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.build.dockerfile_468": {
      "name": "services.init_payload.build.dockerfile",
      "type": "key",
      "start_line": 468,
      "end_line": 468,
      "content_hash": "fca1ab723f36dadaf106da76545461c692a4a079",
      "content": "      dockerfile: Dockerfile.indexer",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.container_name_469": {
      "name": "services.init_payload.container_name",
      "type": "key",
      "start_line": 469,
      "end_line": 469,
      "content_hash": "02c540e768f68af316489fb397027617520418b1",
      "content": "    container_name: init-payload-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.user_470": {
      "name": "services.init_payload.user",
      "type": "key",
      "start_line": 470,
      "end_line": 470,
      "content_hash": "cb1aa9113d6fbe9ae27179a2ef6b4411448baa38",
      "content": "    user: \"0:0\"",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.depends_on_471": {
      "name": "services.init_payload.depends_on",
      "type": "key",
      "start_line": 471,
      "end_line": 472,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.env_file_473": {
      "name": "services.init_payload.env_file",
      "type": "key",
      "start_line": 473,
      "end_line": 474,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.environment_475": {
      "name": "services.init_payload.environment",
      "type": "key",
      "start_line": 475,
      "end_line": 491,
      "content_hash": "120efe6d4a09773216eb9e3a984617562c01dbcb",
      "content": "    environment:\n      - QDRANT_URL=${QDRANT_URL}\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - HF_HOME=/work/.cache/huggingface\n      - TRANSFORMERS_CACHE=/work/.cache/huggingface\n      - HUGGINGFACE_HUB_CACHE=/work/.cache/huggingface\n      - WORKDIR=/work\n      - TOKENIZER_URL=${TOKENIZER_URL:-https://huggingface.co/BAAI/bge-base-en-v1.5/resolve/main/tokenizer.json}\n      - TOKENIZER_PATH=${TOKENIZER_PATH:-/work/models/tokenizer.json}\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.volumes_492": {
      "name": "services.init_payload.volumes",
      "type": "key",
      "start_line": 492,
      "end_line": 494,
      "content_hash": "fbe3c030b8d8cbe13271efd87429664731a4e062",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.command_495": {
      "name": "services.init_payload.command",
      "type": "key",
      "start_line": 495,
      "end_line": 499,
      "content_hash": "c68c34b4108c7659f4545e2ca897e5da4e138c03",
      "content": "    command: [\n      \"sh\",\n      \"-c\",\n      \"mkdir -p /tmp/logs /work/.codebase && (chgrp -R 1000 /work/.codebase 2>/dev/null || true) && (chmod -R g+rwX /work/.codebase 2>/dev/null || true) && (find /work/.codebase -type d -exec chmod g+s {} + 2>/dev/null || true) && echo 'Starting initialization sequence...' && /app/scripts/wait-for-qdrant.sh && PYTHONPATH=/app python /app/scripts/create_indexes.py && echo 'Collections and metadata created' && python /app/scripts/warm_all_collections.py && echo 'Search caches warmed for all collections' && python /app/scripts/health_check.py && echo 'Initialization completed successfully!'\"\n    ]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.restart_500": {
      "name": "services.init_payload.restart",
      "type": "key",
      "start_line": 500,
      "end_line": 500,
      "content_hash": "2f9e6e4e3c7f4b04e3b1acfd1aab444259d55aa9",
      "content": "    restart: \"no\"  # Run once on startup",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.init_payload.networks_501": {
      "name": "services.init_payload.networks",
      "type": "key",
      "start_line": 501,
      "end_line": 504,
      "content_hash": "33cfb59df17cea2f054f680c312310107c9e57f2",
      "content": "    networks:\n      - dev-remote-network\n\n  # NEW: Upload Service for Remote Upload System",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service_505": {
      "name": "services.upload_service",
      "type": "key",
      "start_line": 505,
      "end_line": 592,
      "content_hash": "50ec9b916d60acd0e0717ab18d5107bb6b47df2f",
      "content": "  upload_service:\n    build:\n      context: .\n      dockerfile: Dockerfile.upload-service\n    container_name: upload-service-dev-remote\n    user: \"0:0\" # Windows bind-mount to /work requires root to create workspace dirs\n    depends_on:\n      - qdrant\n    env_file:\n      - .env\n    environment:\n      # Upload service configuration\n      - UPLOAD_SERVICE_HOST=0.0.0.0\n      - UPLOAD_SERVICE_PORT=8002\n      - QDRANT_URL=${QDRANT_URL}\n      - WORKDIR=/work\n      - MAX_BUNDLE_SIZE_MB=100\n      - UPLOAD_TIMEOUT_SECS=300\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - CTXCE_ADMIN_COLLECTION_DELETE_ENABLED=${CTXCE_ADMIN_COLLECTION_DELETE_ENABLED:-0}\n      - CTXCE_COLLECTION_REGISTRY_UNDELETE_ON_DISCOVERY=${CTXCE_COLLECTION_REGISTRY_UNDELETE_ON_DISCOVERY:-0}\n      \n      # Indexing configuration\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - HF_HOME=/work/.cache/huggingface\n      - TRANSFORMERS_CACHE=/work/.cache/huggingface\n      - HUGGINGFACE_HUB_CACHE=/work/.cache/huggingface\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - USE_TREE_SITTER=${USE_TREE_SITTER}\n      - INDEX_SEMANTIC_CHUNKS=${INDEX_SEMANTIC_CHUNKS}\n      - INDEX_MICRO_CHUNKS=${INDEX_MICRO_CHUNKS}\n      \n      # Remote upload mode configuration\n      - REMOTE_UPLOAD_ENABLED=1\n      - REMOTE_UPLOAD_MODE=development\n      - REMOTE_UPLOAD_DEBUG=1\n      - REMOTE_UPLOAD_TIMEOUT=300\n      - REMOTE_UPLOAD_MAX_RETRIES=5\n      - MAX_BUNDLE_SIZE_MB=256\n      \n      # Qdrant configuration\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE}\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME\n    ports:\n      - \"8004:8002\"  # Map to different host port to avoid conflicts\n      - \"18004:18000\"  # Health check port\n    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - upload_temp:/tmp/uploads\n    command: [\n      \"sh\",\n      \"-c\",\n      \"mkdir -p /work/.codebase && (chgrp -R 1000 /work/.codebase 2>/dev/null || true) && (chmod -R g+rwX /work/.codebase 2>/dev/null || true) && (find /work/.codebase -type d -exec chmod g+s {} + 2>/dev/null || true) && exec python scripts/upload_service.py\"\n    ]\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8002/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    restart: unless-stopped\n    networks:\n      - dev-remote-network\n\n  \n# PVCs to simulate CephFS RWX behavior (production-like)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.build_506": {
      "name": "services.upload_service.build",
      "type": "key",
      "start_line": 506,
      "end_line": 508,
      "content_hash": "fee696124b28e6bab4119a98c88807bae2edec38",
      "content": "    build:\n      context: .\n      dockerfile: Dockerfile.upload-service",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.build.context_507": {
      "name": "services.upload_service.build.context",
      "type": "key",
      "start_line": 507,
      "end_line": 507,
      "content_hash": "3659828311974a51a3b0608f8b6b8935e8116957",
      "content": "      context: .",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.build.dockerfile_508": {
      "name": "services.upload_service.build.dockerfile",
      "type": "key",
      "start_line": 508,
      "end_line": 508,
      "content_hash": "00d6f4c127b9ffaea6757ddaf3cc642ef415573b",
      "content": "      dockerfile: Dockerfile.upload-service",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.container_name_509": {
      "name": "services.upload_service.container_name",
      "type": "key",
      "start_line": 509,
      "end_line": 509,
      "content_hash": "34a4af4edeb85c7530835812afadd92cc09bc96a",
      "content": "    container_name: upload-service-dev-remote",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.user_510": {
      "name": "services.upload_service.user",
      "type": "key",
      "start_line": 510,
      "end_line": 510,
      "content_hash": "ca11fec7d5b2786a7204d3dcd7580b7a0cf7c29e",
      "content": "    user: \"0:0\" # Windows bind-mount to /work requires root to create workspace dirs",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.depends_on_511": {
      "name": "services.upload_service.depends_on",
      "type": "key",
      "start_line": 511,
      "end_line": 512,
      "content_hash": "9c01229f5474f21fdf7fbdcf97371fa5954c75db",
      "content": "    depends_on:\n      - qdrant",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.env_file_513": {
      "name": "services.upload_service.env_file",
      "type": "key",
      "start_line": 513,
      "end_line": 514,
      "content_hash": "b41d395466de321da37bafc9e759bd64d3245410",
      "content": "    env_file:\n      - .env",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.environment_515": {
      "name": "services.upload_service.environment",
      "type": "key",
      "start_line": 515,
      "end_line": 568,
      "content_hash": "baec44351d33f93e45091bc375b3aa7eacd0ca36",
      "content": "    environment:\n      # Upload service configuration\n      - UPLOAD_SERVICE_HOST=0.0.0.0\n      - UPLOAD_SERVICE_PORT=8002\n      - QDRANT_URL=${QDRANT_URL}\n      - WORKDIR=/work\n      - MAX_BUNDLE_SIZE_MB=100\n      - UPLOAD_TIMEOUT_SECS=300\n      # Optional auth configuration (fully opt-in via .env)\n      - CTXCE_AUTH_ENABLED=${CTXCE_AUTH_ENABLED:-0}\n      - CTXCE_MCP_ACL_ENFORCE=${CTXCE_MCP_ACL_ENFORCE:-0}\n      - CTXCE_ACL_ALLOW_ALL=${CTXCE_ACL_ALLOW_ALL:-0}\n      - CTXCE_AUTH_SHARED_TOKEN=${CTXCE_AUTH_SHARED_TOKEN}\n      - CTXCE_AUTH_ADMIN_TOKEN=${CTXCE_AUTH_ADMIN_TOKEN}\n      - CTXCE_AUTH_DB_URL=${CTXCE_AUTH_DB_URL}\n      - CTXCE_AUTH_SESSION_TTL_SECONDS=${CTXCE_AUTH_SESSION_TTL_SECONDS:-0}\n      - CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN=${CTXCE_AUTH_ALLOW_OPEN_TOKEN_LOGIN:-0}\n      - CTXCE_ADMIN_COLLECTION_DELETE_ENABLED=${CTXCE_ADMIN_COLLECTION_DELETE_ENABLED:-0}\n      - CTXCE_COLLECTION_REGISTRY_UNDELETE_ON_DISCOVERY=${CTXCE_COLLECTION_REGISTRY_UNDELETE_ON_DISCOVERY:-0}\n      \n      # Indexing configuration\n      - COLLECTION_NAME=${COLLECTION_NAME}\n      - HF_HOME=/work/.cache/huggingface\n      - TRANSFORMERS_CACHE=/work/.cache/huggingface\n      - HUGGINGFACE_HUB_CACHE=/work/.cache/huggingface\n      - EMBEDDING_MODEL=${EMBEDDING_MODEL}\n      - EMBEDDING_PROVIDER=${EMBEDDING_PROVIDER}\n      - QWEN3_EMBEDDING_ENABLED=${QWEN3_EMBEDDING_ENABLED:-0}\n      - QWEN3_QUERY_INSTRUCTION=${QWEN3_QUERY_INSTRUCTION:-1}\n      - QWEN3_INSTRUCTION_TEXT=${QWEN3_INSTRUCTION_TEXT}\n      - USE_TREE_SITTER=${USE_TREE_SITTER}\n      - INDEX_SEMANTIC_CHUNKS=${INDEX_SEMANTIC_CHUNKS}\n      - INDEX_MICRO_CHUNKS=${INDEX_MICRO_CHUNKS}\n      \n      # Remote upload mode configuration\n      - REMOTE_UPLOAD_ENABLED=1\n      - REMOTE_UPLOAD_MODE=development\n      - REMOTE_UPLOAD_DEBUG=1\n      - REMOTE_UPLOAD_TIMEOUT=300\n      - REMOTE_UPLOAD_MAX_RETRIES=5\n      - MAX_BUNDLE_SIZE_MB=256\n      \n      # Qdrant configuration\n      - QDRANT_TIMEOUT=${QDRANT_TIMEOUT}\n      - MAX_MICRO_CHUNKS_PER_FILE=${MAX_MICRO_CHUNKS_PER_FILE}\n      - INDEX_UPSERT_BATCH=${INDEX_UPSERT_BATCH}\n      - INDEX_UPSERT_RETRIES=${INDEX_UPSERT_RETRIES}\n      # Lexical vector config - values from .env (code defaults to legacy-safe)\n      - LEX_VECTOR_DIM\n      - LEX_MULTI_HASH\n      - LEX_BIGRAMS\n      - LEX_BIGRAM_WEIGHT\n      - LEX_SPARSE_MODE\n      - LEX_SPARSE_NAME",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.ports_569": {
      "name": "services.upload_service.ports",
      "type": "key",
      "start_line": 569,
      "end_line": 571,
      "content_hash": "c13874f3c0197d54c6b7d56582c148be17009bc8",
      "content": "    ports:\n      - \"8004:8002\"  # Map to different host port to avoid conflicts\n      - \"18004:18000\"  # Health check port",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.volumes_572": {
      "name": "services.upload_service.volumes",
      "type": "key",
      "start_line": 572,
      "end_line": 575,
      "content_hash": "a3ca1cbb0d70035020d600334b967d003255a7b2",
      "content": "    volumes:\n      - workspace_pvc:/work:rw\n      - codebase_pvc:/work/.codebase:rw\n      - upload_temp:/tmp/uploads",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.command_576": {
      "name": "services.upload_service.command",
      "type": "key",
      "start_line": 576,
      "end_line": 580,
      "content_hash": "37d941815a95d0081a39e9b936e71a8069c9141f",
      "content": "    command: [\n      \"sh\",\n      \"-c\",\n      \"mkdir -p /work/.codebase && (chgrp -R 1000 /work/.codebase 2>/dev/null || true) && (chmod -R g+rwX /work/.codebase 2>/dev/null || true) && (find /work/.codebase -type d -exec chmod g+s {} + 2>/dev/null || true) && exec python scripts/upload_service.py\"\n    ]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.healthcheck_581": {
      "name": "services.upload_service.healthcheck",
      "type": "key",
      "start_line": 581,
      "end_line": 586,
      "content_hash": "4b8af6b078c5f2dfde990c5f4224513fda0c25a6",
      "content": "    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8002/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.healthcheck.test_582": {
      "name": "services.upload_service.healthcheck.test",
      "type": "key",
      "start_line": 582,
      "end_line": 582,
      "content_hash": "302b4437714094b8b944af6fb87cc4fe847d0233",
      "content": "      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8002/health\"]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.healthcheck.interval_583": {
      "name": "services.upload_service.healthcheck.interval",
      "type": "key",
      "start_line": 583,
      "end_line": 583,
      "content_hash": "0c30cb23938fbb260547c1093a7901b9a23d677c",
      "content": "      interval: 30s",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.healthcheck.timeout_584": {
      "name": "services.upload_service.healthcheck.timeout",
      "type": "key",
      "start_line": 584,
      "end_line": 584,
      "content_hash": "acdf07325310ca35b5a7d8a9f9e17a372bd66ad3",
      "content": "      timeout: 10s",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.healthcheck.retries_585": {
      "name": "services.upload_service.healthcheck.retries",
      "type": "key",
      "start_line": 585,
      "end_line": 585,
      "content_hash": "90508af0177a7483604e60303e00ae598b7d9bdb",
      "content": "      retries: 3",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.healthcheck.start_period_586": {
      "name": "services.upload_service.healthcheck.start_period",
      "type": "key",
      "start_line": 586,
      "end_line": 586,
      "content_hash": "cf09d7ef0b4492bf44573d6cc85a2a3ec65e61e8",
      "content": "      start_period: 40s",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.restart_587": {
      "name": "services.upload_service.restart",
      "type": "key",
      "start_line": 587,
      "end_line": 587,
      "content_hash": "74557caa0a21d8e8ad7cfa64ad6b18fb402da2d0",
      "content": "    restart: unless-stopped",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_services.upload_service.networks_588": {
      "name": "services.upload_service.networks",
      "type": "key",
      "start_line": 588,
      "end_line": 592,
      "content_hash": "660559e5901f60eb5241e51a6a811cd4ff8fd189",
      "content": "    networks:\n      - dev-remote-network\n\n  \n# PVCs to simulate CephFS RWX behavior (production-like)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes_593": {
      "name": "volumes",
      "type": "key",
      "start_line": 593,
      "end_line": 634,
      "content_hash": "d4521826cb62a5d94b6b9c2171997a6d186d55e1",
      "content": "volumes:\n  # Main workspace volume - simulates CephFS RWX for repository storage\n  workspace_pvc:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: ${HOST_INDEX_PATH:-./dev-workspace}\n  \n  # Codebase metadata volume - simulates CephFS RWX for indexing metadata\n  codebase_pvc:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: ./.codebase\n  \n  # Temporary upload storage\n  upload_temp:\n    driver: local\n  \n  # HuggingFace cache for model downloads\n  huggingface_cache:\n    driver: local\n  \n  # Indexer cache for model downloads\n  indexer_cache:\n    driver: local\n  \n  # Qdrant storage - separate from base compose to avoid conflicts\n  qdrant_storage_dev_remote:\n    driver: local\n\n  # Learning reranker weights storage (shared between indexer and worker)\n  rerank_data:\n    driver: local\n\n  # Learning reranker events storage (shared between indexer and worker)\n  rerank_events:\n    driver: local\n\n# Custom network for service discovery",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.workspace_pvc_595": {
      "name": "volumes.workspace_pvc",
      "type": "key",
      "start_line": 595,
      "end_line": 602,
      "content_hash": "447634e7891e22f0671530ca3fa6b23388b895f9",
      "content": "  workspace_pvc:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: ${HOST_INDEX_PATH:-./dev-workspace}\n  \n  # Codebase metadata volume - simulates CephFS RWX for indexing metadata",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.workspace_pvc.driver_596": {
      "name": "volumes.workspace_pvc.driver",
      "type": "key",
      "start_line": 596,
      "end_line": 596,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.workspace_pvc.driver_opts_597": {
      "name": "volumes.workspace_pvc.driver_opts",
      "type": "key",
      "start_line": 597,
      "end_line": 602,
      "content_hash": "4b78e21a075f8edda3b6f2c32ddd29c283b4ac38",
      "content": "    driver_opts:\n      type: none\n      o: bind\n      device: ${HOST_INDEX_PATH:-./dev-workspace}\n  \n  # Codebase metadata volume - simulates CephFS RWX for indexing metadata",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.workspace_pvc.driver_opts.type_598": {
      "name": "volumes.workspace_pvc.driver_opts.type",
      "type": "key",
      "start_line": 598,
      "end_line": 598,
      "content_hash": "470330278f1066d80ba5cd0c6afc6ca63ab5ae80",
      "content": "      type: none",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.workspace_pvc.driver_opts.o_599": {
      "name": "volumes.workspace_pvc.driver_opts.o",
      "type": "key",
      "start_line": 599,
      "end_line": 599,
      "content_hash": "baea801e462739576e1bb372504064d37fde0340",
      "content": "      o: bind",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.workspace_pvc.driver_opts.device_600": {
      "name": "volumes.workspace_pvc.driver_opts.device",
      "type": "key",
      "start_line": 600,
      "end_line": 600,
      "content_hash": "a077499e49a06d540cd53a118785fc7c79e70516",
      "content": "      device: ${HOST_INDEX_PATH:-./dev-workspace}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.codebase_pvc_603": {
      "name": "volumes.codebase_pvc",
      "type": "key",
      "start_line": 603,
      "end_line": 610,
      "content_hash": "18798035ed0579114433f9d9e8f8b61c83119fa1",
      "content": "  codebase_pvc:\n    driver: local\n    driver_opts:\n      type: none\n      o: bind\n      device: ./.codebase\n  \n  # Temporary upload storage",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.codebase_pvc.driver_604": {
      "name": "volumes.codebase_pvc.driver",
      "type": "key",
      "start_line": 604,
      "end_line": 604,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.codebase_pvc.driver_opts_605": {
      "name": "volumes.codebase_pvc.driver_opts",
      "type": "key",
      "start_line": 605,
      "end_line": 610,
      "content_hash": "2d10a133d7c9d580caff27b0d2d568820cd09d04",
      "content": "    driver_opts:\n      type: none\n      o: bind\n      device: ./.codebase\n  \n  # Temporary upload storage",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.codebase_pvc.driver_opts.type_606": {
      "name": "volumes.codebase_pvc.driver_opts.type",
      "type": "key",
      "start_line": 606,
      "end_line": 606,
      "content_hash": "470330278f1066d80ba5cd0c6afc6ca63ab5ae80",
      "content": "      type: none",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.codebase_pvc.driver_opts.o_607": {
      "name": "volumes.codebase_pvc.driver_opts.o",
      "type": "key",
      "start_line": 607,
      "end_line": 607,
      "content_hash": "baea801e462739576e1bb372504064d37fde0340",
      "content": "      o: bind",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.codebase_pvc.driver_opts.device_608": {
      "name": "volumes.codebase_pvc.driver_opts.device",
      "type": "key",
      "start_line": 608,
      "end_line": 608,
      "content_hash": "56e71d7a53d486f3b162d6306784d63e7d5ddf24",
      "content": "      device: ./.codebase",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.upload_temp_611": {
      "name": "volumes.upload_temp",
      "type": "key",
      "start_line": 611,
      "end_line": 614,
      "content_hash": "01915d8e5f20a6df63a516b9af53b21a046ee20f",
      "content": "  upload_temp:\n    driver: local\n  \n  # HuggingFace cache for model downloads",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.upload_temp.driver_612": {
      "name": "volumes.upload_temp.driver",
      "type": "key",
      "start_line": 612,
      "end_line": 612,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.huggingface_cache_615": {
      "name": "volumes.huggingface_cache",
      "type": "key",
      "start_line": 615,
      "end_line": 618,
      "content_hash": "8ab134629573c80b5415c77dad007e1f0ea0135b",
      "content": "  huggingface_cache:\n    driver: local\n  \n  # Indexer cache for model downloads",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.huggingface_cache.driver_616": {
      "name": "volumes.huggingface_cache.driver",
      "type": "key",
      "start_line": 616,
      "end_line": 616,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.indexer_cache_619": {
      "name": "volumes.indexer_cache",
      "type": "key",
      "start_line": 619,
      "end_line": 622,
      "content_hash": "d2e7cbe3399c9b98d3bd98d7bb4e39ea6c9a081a",
      "content": "  indexer_cache:\n    driver: local\n  \n  # Qdrant storage - separate from base compose to avoid conflicts",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.indexer_cache.driver_620": {
      "name": "volumes.indexer_cache.driver",
      "type": "key",
      "start_line": 620,
      "end_line": 620,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.qdrant_storage_dev_remote_623": {
      "name": "volumes.qdrant_storage_dev_remote",
      "type": "key",
      "start_line": 623,
      "end_line": 626,
      "content_hash": "f6b5f0ccd41e9568f35fff1bc704c780530e561f",
      "content": "  qdrant_storage_dev_remote:\n    driver: local\n\n  # Learning reranker weights storage (shared between indexer and worker)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.qdrant_storage_dev_remote.driver_624": {
      "name": "volumes.qdrant_storage_dev_remote.driver",
      "type": "key",
      "start_line": 624,
      "end_line": 624,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.rerank_data_627": {
      "name": "volumes.rerank_data",
      "type": "key",
      "start_line": 627,
      "end_line": 630,
      "content_hash": "0946c8ab5afe74847b5c34259e1f914bdc137092",
      "content": "  rerank_data:\n    driver: local\n\n  # Learning reranker events storage (shared between indexer and worker)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.rerank_data.driver_628": {
      "name": "volumes.rerank_data.driver",
      "type": "key",
      "start_line": 628,
      "end_line": 628,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.rerank_events_631": {
      "name": "volumes.rerank_events",
      "type": "key",
      "start_line": 631,
      "end_line": 634,
      "content_hash": "d630a3b0c2c06a10cf51b18bfecef741b76f2250",
      "content": "  rerank_events:\n    driver: local\n\n# Custom network for service discovery",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_volumes.rerank_events.driver_632": {
      "name": "volumes.rerank_events.driver",
      "type": "key",
      "start_line": 632,
      "end_line": 632,
      "content_hash": "2ccd9b5efb381fd54b252c1d1777bbc03bec08ce",
      "content": "    driver: local",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_networks_635": {
      "name": "networks",
      "type": "key",
      "start_line": 635,
      "end_line": 640,
      "content_hash": "e2d4535d0e80b4bbc994fb70df2133183d3ffe98",
      "content": "networks:\n  dev-remote-network:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.0.0/16",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_networks.dev-remote-network_636": {
      "name": "networks.dev-remote-network",
      "type": "key",
      "start_line": 636,
      "end_line": 640,
      "content_hash": "1c87b47230b450f2e5061f7246adb72cefe6f337",
      "content": "  dev-remote-network:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.0.0/16",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_networks.dev-remote-network.driver_637": {
      "name": "networks.dev-remote-network.driver",
      "type": "key",
      "start_line": 637,
      "end_line": 637,
      "content_hash": "07b69369864f369a7e9cef9d10a9a432b089f371",
      "content": "    driver: bridge",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_networks.dev-remote-network.ipam_638": {
      "name": "networks.dev-remote-network.ipam",
      "type": "key",
      "start_line": 638,
      "end_line": 640,
      "content_hash": "52a34d5a7fa4f7dfcfcf85b887e0d4623c3291ff",
      "content": "    ipam:\n      config:\n        - subnet: 172.20.0.0/16",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_networks.dev-remote-network.ipam.config_639": {
      "name": "networks.dev-remote-network.ipam.config",
      "type": "key",
      "start_line": 639,
      "end_line": 640,
      "content_hash": "d941bc84a1f758fc6241b533256380aeed61edc4",
      "content": "      config:\n        - subnet: 172.20.0.0/16",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "key_networks.dev-remote-network.ipam.config.subnet_640": {
      "name": "networks.dev-remote-network.ipam.config.subnet",
      "type": "key",
      "start_line": 640,
      "end_line": 640,
      "content_hash": "57c6e0a76c4e79c64c1c3e1f796e97d66969ed2b",
      "content": "        - subnet: 172.20.0.0/16",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}