{
  "file_path": "/work/external-deps/claude-mem/scripts/publish.js",
  "file_hash": "13a4ebb992f58d3d7e1af43608df1c03355e97ed",
  "updated_at": "2025-12-26T17:34:25.069771",
  "symbols": {
    "function_question_20": {
      "name": "question",
      "type": "function",
      "start_line": 20,
      "end_line": 20,
      "content_hash": "81f329557e428705ed6d48e841a26ab6ab2a1e52",
      "content": "const question = (query) => new Promise((resolve) => rl.question(query, resolve));",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_publish_22": {
      "name": "publish",
      "type": "function",
      "start_line": 22,
      "end_line": 146,
      "content_hash": "260c8413faff1ecb3f301ba2dc760d560877588a",
      "content": "async function publish() {\n  try {\n    console.log('\ud83d\udce6 Claude-mem Marketplace Release Tool\\n');\n\n    // Check git status\n    console.log('\ud83d\udd0d Checking git status...');\n    const { stdout: gitStatus } = await execAsync('git status --porcelain');\n    if (gitStatus.trim()) {\n      console.log('\u26a0\ufe0f  Uncommitted changes detected:');\n      console.log(gitStatus);\n      const proceed = await question('\\nContinue anyway? (y/N) ');\n      if (proceed.toLowerCase() !== 'y') {\n        console.log('Aborted.');\n        rl.close();\n        process.exit(0);\n      }\n    } else {\n      console.log('\u2713 Working directory clean');\n    }\n\n    // Get current version\n    const packageJson = JSON.parse(fs.readFileSync('package.json', 'utf-8'));\n    const currentVersion = packageJson.version;\n    console.log(`\\n\ud83d\udccc Current version: ${currentVersion}`);\n\n    // Ask for version bump type\n    console.log('\\nVersion bump type:');\n    console.log('  1. patch (x.x.X) - Bug fixes');\n    console.log('  2. minor (x.X.0) - New features');\n    console.log('  3. major (X.0.0) - Breaking changes');\n    console.log('  4. custom - Enter version manually');\n\n    const bumpType = await question('\\nSelect bump type (1-4): ');\n    let newVersion;\n\n    switch (bumpType.trim()) {\n      case '1':\n        newVersion = bumpVersion(currentVersion, 'patch');\n        break;\n      case '2':\n        newVersion = bumpVersion(currentVersion, 'minor');\n        break;\n      case '3':\n        newVersion = bumpVersion(currentVersion, 'major');\n        break;\n      case '4':\n        newVersion = await question('Enter version: ');\n        if (!isValidVersion(newVersion)) {\n          throw new Error('Invalid version format. Use semver (e.g., 1.2.3)');\n        }\n        break;\n      default:\n        throw new Error('Invalid selection');\n    }\n\n    console.log(`\\n\ud83c\udfaf New version: ${newVersion}`);\n    const confirm = await question('\\nProceed with publish? (y/N) ');\n    if (confirm.toLowerCase() !== 'y') {\n      console.log('Aborted.');\n      rl.close();\n      process.exit(0);\n    }\n\n    // Update package.json and marketplace.json versions\n    console.log('\\n\ud83d\udcdd Updating package.json and marketplace.json...');\n    packageJson.version = newVersion;\n    fs.writeFileSync('package.json', JSON.stringify(packageJson, null, 2) + '\\n');\n\n    const marketplaceJson = JSON.parse(fs.readFileSync('.claude-plugin/marketplace.json', 'utf-8'));\n    marketplaceJson.plugins[0].version = newVersion;\n    fs.writeFileSync('.claude-plugin/marketplace.json', JSON.stringify(marketplaceJson, null, 2) + '\\n');\n    console.log('\u2713 Versions updated in both files');\n\n    // Run build\n    console.log('\\n\ud83d\udd28 Building hooks...');\n    await execAsync('npm run build');\n    console.log('\u2713 Build complete');\n\n    // Run tests if they exist\n    if (packageJson.scripts?.test) {\n      console.log('\\n\ud83e\uddea Running tests...');\n      try {\n        await execAsync('npm test');\n        console.log('\u2713 Tests passed');\n      } catch (error) {\n        console.error('\u274c Tests failed:', error.message);\n        const continueAnyway = await question('\\nPublish anyway? (y/N) ');\n        if (continueAnyway.toLowerCase() !== 'y') {\n          console.log('Aborted.');\n          rl.close();\n          process.exit(1);\n        }\n      }\n    }\n\n    // Git commit and tag\n    console.log('\\n\ud83d\udccc Creating git commit and tag...');\n    await execAsync('git add package.json .claude-plugin/marketplace.json plugin/');\n    await execAsync(`git commit -m \"chore: Release v${newVersion}\n\nMarketplace release for Claude Code plugin\nhttps://github.com/thedotmack/claude-mem\"`);\n    await execAsync(`git tag v${newVersion}`);\n    console.log(`\u2713 Created commit and tag v${newVersion}`);\n\n    // Push to git\n    console.log('\\n\u2b06\ufe0f  Pushing to git...');\n    await execAsync('git push');\n    await execAsync('git push --tags');\n    console.log('\u2713 Pushed to git');\n\n    console.log(`\\n\u2705 Successfully released v${newVersion}! \ud83c\udf89`);\n    console.log(`\\n\ud83c\udff7\ufe0f  Tag: https://github.com/thedotmack/claude-mem/releases/tag/v${newVersion}`);\n    console.log(`\ud83d\udce6 Marketplace will sync from this tag automatically`);\n\n  } catch (error) {\n    console.error('\\n\u274c Release failed:', error.message);\n    if (error.stderr) {\n      console.error('\\nError details:', error.stderr);\n    }\n    process.exit(1);\n  } finally {\n    rl.close();\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_bumpVersion_148": {
      "name": "bumpVersion",
      "type": "function",
      "start_line": 148,
      "end_line": 165,
      "content_hash": "484748fd9e61c29d2d73473d1db122f08b6c90f4",
      "content": "function bumpVersion(version, type) {\n  const parts = version.split('.').map(Number);\n  switch (type) {\n    case 'patch':\n      parts[2]++;\n      break;\n    case 'minor':\n      parts[1]++;\n      parts[2] = 0;\n      break;\n    case 'major':\n      parts[0]++;\n      parts[1] = 0;\n      parts[2] = 0;\n      break;\n  }\n  return parts.join('.');\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_isValidVersion_167": {
      "name": "isValidVersion",
      "type": "function",
      "start_line": 167,
      "end_line": 169,
      "content_hash": "ae2f14393419aa10729698bfad0e6f7ef5d3fa9b",
      "content": "function isValidVersion(version) {\n  return /^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.-]+)?$/.test(version);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}