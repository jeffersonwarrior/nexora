{
  "file_path": "/work/external-deps/claude-mem/src/sdk/prompts.ts",
  "file_hash": "806431b48d7adfa78dd698fbd90c70ff1e388cf8",
  "updated_at": "2025-12-26T17:34:21.997078",
  "symbols": {
    "function_buildInitPrompt_30": {
      "name": "buildInitPrompt",
      "type": "function",
      "start_line": 30,
      "end_line": 87,
      "content_hash": "e7b8ade81fca189c81b16d6f7c8deea34ef1bbb3",
      "content": "export function buildInitPrompt(project: string, sessionId: string, userPrompt: string, mode: ModeConfig): string {\n  return `${mode.prompts.system_identity}\n\n<observed_from_primary_session>\n  <user_request>${userPrompt}</user_request>\n  <requested_at>${new Date().toISOString().split('T')[0]}</requested_at>\n</observed_from_primary_session>\n\n${mode.prompts.observer_role}\n\n${mode.prompts.spatial_awareness}\n\n${mode.prompts.recording_focus}\n\n${mode.prompts.skip_guidance}\n\n${mode.prompts.output_format_header}\n\n\\`\\`\\`xml\n<observation>\n  <type>[ ${mode.observation_types.map(t => t.id).join(' | ')} ]</type>\n  <!--\n    ${mode.prompts.type_guidance}\n  -->\n  <title>${mode.prompts.xml_title_placeholder}</title>\n  <subtitle>${mode.prompts.xml_subtitle_placeholder}</subtitle>\n  <facts>\n    <fact>${mode.prompts.xml_fact_placeholder}</fact>\n    <fact>${mode.prompts.xml_fact_placeholder}</fact>\n    <fact>${mode.prompts.xml_fact_placeholder}</fact>\n  </facts>\n  <!--\n    ${mode.prompts.field_guidance}\n  -->\n  <narrative>${mode.prompts.xml_narrative_placeholder}</narrative>\n  <concepts>\n    <concept>${mode.prompts.xml_concept_placeholder}</concept>\n    <concept>${mode.prompts.xml_concept_placeholder}</concept>\n  </concepts>\n  <!--\n    ${mode.prompts.concept_guidance}\n  -->\n  <files_read>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n  </files_read>\n  <files_modified>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n  </files_modified>\n</observation>\n\\`\\`\\`\n${mode.prompts.format_examples}\n\n${mode.prompts.footer}\n\n${mode.prompts.header_memory_start}`;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_buildObservationPrompt_92": {
      "name": "buildObservationPrompt",
      "type": "function",
      "start_line": 92,
      "end_line": 115,
      "content_hash": "c3ba513af7acf5b42296cb6e52a9bc2a9621b530",
      "content": "export function buildObservationPrompt(obs: Observation): string {\n  // Safely parse tool_input and tool_output - they're already JSON strings\n  let toolInput: any;\n  let toolOutput: any;\n\n  try {\n    toolInput = typeof obs.tool_input === 'string' ? JSON.parse(obs.tool_input) : obs.tool_input;\n  } catch {\n    toolInput = obs.tool_input;  // If parse fails, use raw value\n  }\n\n  try {\n    toolOutput = typeof obs.tool_output === 'string' ? JSON.parse(obs.tool_output) : obs.tool_output;\n  } catch {\n    toolOutput = obs.tool_output;  // If parse fails, use raw value\n  }\n\n  return `<observed_from_primary_session>\n  <what_happened>${obs.tool_name}</what_happened>\n  <occurred_at>${new Date(obs.created_at_epoch).toISOString()}</occurred_at>${obs.cwd ? `\\n  <working_directory>${obs.cwd}</working_directory>` : ''}\n  <parameters>${JSON.stringify(toolInput, null, 2)}</parameters>\n  <outcome>${JSON.stringify(toolOutput, null, 2)}</outcome>\n</observed_from_primary_session>`;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_buildSummaryPrompt_120": {
      "name": "buildSummaryPrompt",
      "type": "function",
      "start_line": 120,
      "end_line": 146,
      "content_hash": "21cd1d62849bdcad71e931d282f07822be149a59",
      "content": "export function buildSummaryPrompt(session: SDKSession, mode: ModeConfig): string {\n  const lastAssistantMessage = session.last_assistant_message || logger.happyPathError(\n    'SDK',\n    'Missing last_assistant_message in session for summary prompt',\n    { sessionId: session.id },\n    undefined,\n    ''\n  );\n\n  return `${mode.prompts.header_summary_checkpoint}\n${mode.prompts.summary_instruction}\n\n${mode.prompts.summary_context_label}\n${lastAssistantMessage}\n\n${mode.prompts.summary_format_instruction}\n<summary>\n  <request>${mode.prompts.xml_summary_request_placeholder}</request>\n  <investigated>${mode.prompts.xml_summary_investigated_placeholder}</investigated>\n  <learned>${mode.prompts.xml_summary_learned_placeholder}</learned>\n  <completed>${mode.prompts.xml_summary_completed_placeholder}</completed>\n  <next_steps>${mode.prompts.xml_summary_next_steps_placeholder}</next_steps>\n  <notes>${mode.prompts.xml_summary_notes_placeholder}</notes>\n</summary>\n\n${mode.prompts.summary_footer}`;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_buildContinuationPrompt_169": {
      "name": "buildContinuationPrompt",
      "type": "function",
      "start_line": 169,
      "end_line": 230,
      "content_hash": "05e9c2cda5acd6eee1de025d5f6adc1ef1be7d62",
      "content": "export function buildContinuationPrompt(userPrompt: string, promptNumber: number, claudeSessionId: string, mode: ModeConfig): string {\n  return `${mode.prompts.continuation_greeting}\n\n<observed_from_primary_session>\n  <user_request>${userPrompt}</user_request>\n  <requested_at>${new Date().toISOString().split('T')[0]}</requested_at>\n</observed_from_primary_session>\n\n${mode.prompts.system_identity}\n\n${mode.prompts.observer_role}\n\n${mode.prompts.spatial_awareness}\n\n${mode.prompts.recording_focus}\n\n${mode.prompts.skip_guidance}\n\n${mode.prompts.continuation_instruction}\n\n${mode.prompts.output_format_header}\n\n\\`\\`\\`xml\n<observation>\n  <type>[ ${mode.observation_types.map(t => t.id).join(' | ')} ]</type>\n  <!--\n    ${mode.prompts.type_guidance}\n  -->\n  <title>${mode.prompts.xml_title_placeholder}</title>\n  <subtitle>${mode.prompts.xml_subtitle_placeholder}</subtitle>\n  <facts>\n    <fact>${mode.prompts.xml_fact_placeholder}</fact>\n    <fact>${mode.prompts.xml_fact_placeholder}</fact>\n    <fact>${mode.prompts.xml_fact_placeholder}</fact>\n  </facts>\n  <!--\n    ${mode.prompts.field_guidance}\n  -->\n  <narrative>${mode.prompts.xml_narrative_placeholder}</narrative>\n  <concepts>\n    <concept>${mode.prompts.xml_concept_placeholder}</concept>\n    <concept>${mode.prompts.xml_concept_placeholder}</concept>\n  </concepts>\n  <!--\n    ${mode.prompts.concept_guidance}\n  -->\n  <files_read>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n  </files_read>\n  <files_modified>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n    <file>${mode.prompts.xml_file_placeholder}</file>\n  </files_modified>\n</observation>\n\\`\\`\\`\n${mode.prompts.format_examples}\n\n${mode.prompts.footer}\n\n${mode.prompts.header_memory_continued}`;\n} ",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}