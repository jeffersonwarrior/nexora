{
  "file_path": "/work/external-deps/claude-swarm/dist/utils/validation.js",
  "file_hash": "8171ccac596d9eccd751141dab6dfd311ff98315",
  "updated_at": "2025-12-26T17:34:24.316614",
  "symbols": {
    "function_validateFeature_15": {
      "name": "validateFeature",
      "type": "function",
      "start_line": 15,
      "end_line": 67,
      "content_hash": "bdcc4add0e2e9c2cedee4236f2263a5deaf36bb8",
      "content": "export async function validateFeature(feature, projectDir) {\n    const checks = [];\n    let overallPassed = true;\n    let errorMessage;\n    // Skip validation if not enabled\n    if (!feature.validation?.enabled) {\n        return {\n            passed: true,\n            checks: [],\n            timestamp: new Date().toISOString(),\n        };\n    }\n    const config = feature.validation;\n    // Check 1: Coverage target\n    if (config.coverageTarget !== undefined && config.coverageTarget > 0) {\n        const coverageCheck = await measureCoverage(projectDir, config.verifyCommand, config.expectedPackages, config.coverageTarget);\n        checks.push(coverageCheck);\n        if (!coverageCheck.passed && config.enforceBlocking) {\n            overallPassed = false;\n            errorMessage = coverageCheck.details || \"Coverage below target\";\n        }\n    }\n    // Check 2: Tests must pass\n    if (config.testPassRequired) {\n        const testCheck = await runTests(projectDir, config.verifyCommand, config.expectedPackages);\n        checks.push(testCheck);\n        if (!testCheck.passed && config.enforceBlocking) {\n            overallPassed = false;\n            errorMessage = testCheck.details || \"Tests failed\";\n        }\n    }\n    // Check 3: Git verification - verify changes match expected packages\n    if (feature.gitVerification &&\n        config.expectedPackages &&\n        config.expectedPackages.length > 0) {\n        const gitCheck = verifyExpectedPackages(feature.gitVerification, config.expectedPackages);\n        checks.push({\n            name: \"git-packages\",\n            passed: gitCheck.matched,\n            details: gitCheck.details,\n        });\n        if (!gitCheck.matched && config.enforceBlocking) {\n            overallPassed = false;\n            errorMessage = gitCheck.details;\n        }\n    }\n    return {\n        passed: overallPassed,\n        checks,\n        error: errorMessage,\n        timestamp: new Date().toISOString(),\n    };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_measureCoverage_71": {
      "name": "measureCoverage",
      "type": "function",
      "start_line": 71,
      "end_line": 115,
      "content_hash": "27f518267cdb4c78237c439a53f8e5c80be7eb3c",
      "content": "async function measureCoverage(projectDir, verifyCommand, expectedPackages, targetCoverage) {\n    try {\n        // Determine coverage command\n        let command;\n        if (verifyCommand) {\n            command = verifyCommand;\n        }\n        else if (expectedPackages && expectedPackages.length > 0) {\n            // Default: go test -cover for specified packages\n            const packages = expectedPackages.join(\" \");\n            command = `go test -cover ${packages}`;\n        }\n        else {\n            command = \"go test -cover ./...\";\n        }\n        // Run coverage measurement\n        const output = execSync(command, {\n            cwd: projectDir,\n            encoding: \"utf-8\",\n            timeout: 60000, // 60s timeout\n        });\n        // Parse coverage from output\n        const coverage = parseCoverageFromOutput(output);\n        const passed = coverage >= targetCoverage;\n        return {\n            name: \"coverage\",\n            passed,\n            expected: targetCoverage,\n            actual: coverage,\n            details: passed\n                ? `Coverage ${coverage.toFixed(1)}% meets target ${targetCoverage}%`\n                : `Coverage ${coverage.toFixed(1)}% below target ${targetCoverage}%`,\n        };\n    }\n    catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        return {\n            name: \"coverage\",\n            passed: false,\n            expected: targetCoverage,\n            actual: 0,\n            details: `Coverage measurement failed: ${message}`,\n        };\n    }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_runTests_119": {
      "name": "runTests",
      "type": "function",
      "start_line": 119,
      "end_line": 159,
      "content_hash": "71216bfdb842073f58fd034f5c166893b14b0ca9",
      "content": "async function runTests(projectDir, verifyCommand, expectedPackages) {\n    try {\n        // Determine test command\n        let command;\n        if (verifyCommand) {\n            command = verifyCommand;\n        }\n        else if (expectedPackages && expectedPackages.length > 0) {\n            const packages = expectedPackages.join(\" \");\n            command = `go test ${packages}`;\n        }\n        else {\n            command = \"go test ./...\";\n        }\n        // Run tests\n        const output = execSync(command, {\n            cwd: projectDir,\n            encoding: \"utf-8\",\n            timeout: 300000, // 5min timeout\n        });\n        // Parse test results\n        const testsPassed = !output.includes(\"FAIL\");\n        const testCount = countTests(output);\n        return {\n            name: \"tests\",\n            passed: testsPassed,\n            actual: testCount,\n            details: testsPassed\n                ? `All ${testCount} tests passed`\n                : `Tests failed - see output`,\n        };\n    }\n    catch (error) {\n        const message = error instanceof Error ? error.message : String(error);\n        return {\n            name: \"tests\",\n            passed: false,\n            details: `Test execution failed: ${message}`,\n        };\n    }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_parseCoverageFromOutput_164": {
      "name": "parseCoverageFromOutput",
      "type": "function",
      "start_line": 164,
      "end_line": 185,
      "content_hash": "4e4bfaa25fe16eac53d1ec9ed0eb7696fa9e06d8",
      "content": "function parseCoverageFromOutput(output) {\n    const lines = output.split(\"\\n\");\n    // Look for coverage lines\n    const coverageLines = lines.filter((line) => line.includes(\"coverage:\"));\n    if (coverageLines.length === 0) {\n        return 0;\n    }\n    // Extract percentages and average them\n    const percentages = [];\n    for (const line of coverageLines) {\n        const match = line.match(/coverage:\\s+([\\d.]+)%/);\n        if (match) {\n            percentages.push(parseFloat(match[1]));\n        }\n    }\n    if (percentages.length === 0) {\n        return 0;\n    }\n    // Return average coverage\n    const sum = percentages.reduce((a, b) => a + b, 0);\n    return sum / percentages.length;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_countTests_189": {
      "name": "countTests",
      "type": "function",
      "start_line": 189,
      "end_line": 199,
      "content_hash": "4797f012477a495ba068d8c432054a474edef250",
      "content": "function countTests(output) {\n    const lines = output.split(\"\\n\");\n    let count = 0;\n    for (const line of lines) {\n        // Match lines like \"--- PASS: TestFoo (0.00s)\"\n        if (line.match(/^---\\s+(PASS|FAIL):/)) {\n            count++;\n        }\n    }\n    return count;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_createValidationConfig_203": {
      "name": "createValidationConfig",
      "type": "function",
      "start_line": 203,
      "end_line": 212,
      "content_hash": "b186171184971ded71ca943bec7c2e825031eb52",
      "content": "export function createValidationConfig(options = {}) {\n    return {\n        enabled: options.enabled ?? true,\n        coverageTarget: options.coverageTarget,\n        testPassRequired: options.testPassRequired ?? true,\n        enforceBlocking: options.enforceBlocking ?? true,\n        verifyCommand: options.verifyCommand,\n        expectedPackages: options.expectedPackages,\n    };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}