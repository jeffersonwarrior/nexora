{
  "file_path": "/work/external-deps/helix-db/helix-db/src/protocol/request.rs",
  "file_hash": "4d118e03d64ee2e3532e15deb0fba691bede5835",
  "updated_at": "2025-12-26T17:34:25.117072",
  "symbols": {
    "struct_Request_16": {
      "name": "Request",
      "type": "struct",
      "start_line": 16,
      "end_line": 26,
      "content_hash": "61f57668096112a00311a0c00403929077699296",
      "content": "pub struct Request {\n    pub name: String,\n    pub req_type: RequestType,\n    pub api_key: Option<String>,\n    /// This contains the input parameters serialized with in_fmt\n    pub body: Bytes,\n    pub in_fmt: Format,\n    pub out_fmt: Format,\n}\n\n#[derive(Debug, Clone, Copy, PartialEq)]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "enum_RequestType_27": {
      "name": "RequestType",
      "type": "enum",
      "start_line": 27,
      "end_line": 31,
      "content_hash": "53e2e92764ed749466e2dc80983e947ead33755a",
      "content": "pub enum RequestType {\n    Query,\n    MCP,\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "impl_FromRequest_32": {
      "name": "FromRequest",
      "type": "impl",
      "start_line": 32,
      "end_line": 117,
      "content_hash": "179f00a844b7c521c59ea98f5b4debf0b3ca322a",
      "content": "impl<S> FromRequest<S> for Request\nwhere\n    S: Send + Sync,\n{\n    #[doc = \" If the extractor fails it\\'ll use this \\\"rejection\\\" type. A rejection is\"]\n    #[doc = \" a kind of error that can be converted into a response.\"]\n    type Rejection = StatusCode;\n\n    #[doc = \" Perform the extraction.\"]\n    async fn from_request(req: axum::extract::Request, state: &S) -> Result<Self, Self::Rejection> {\n        let path = req.uri().path();\n\n        let (name, req_type) = match path.strip_prefix(\"/mcp/\") {\n            Some(n) => (n.to_string(), RequestType::MCP),\n            None => (\n                path.strip_prefix('/')\n                    .expect(\"paths should start with a '/'\")\n                    .to_string(),\n                RequestType::Query,\n            ),\n        };\n\n        if name.contains('/') || name.is_empty() {\n            // TODO: improve errors\n            return Err(StatusCode::BAD_REQUEST);\n        }\n\n        let headers = req.headers();\n        let in_fmt = match headers.get(CONTENT_TYPE) {\n            Some(v) => match v.to_str() {\n                Ok(s) => s.parse().map_err(|_| StatusCode::UNSUPPORTED_MEDIA_TYPE)?,\n                Err(_) => return Err(StatusCode::UNSUPPORTED_MEDIA_TYPE),\n            },\n            None => Format::default(),\n        };\n\n        let api_key = {\n            #[cfg(feature = \"api-key\")]\n            match headers.get(\"x-api-key\") {\n                Some(v) => match v.to_str() {\n                    Ok(s) => Some(s.to_string()),\n                    Err(_) => return Err(StatusCode::BAD_REQUEST),\n                },\n                None => return Err(StatusCode::BAD_REQUEST),\n            }\n            #[cfg(not(feature = \"api-key\"))]\n            None::<String>\n        };\n\n        let out_fmt = match headers.get(ACCEPT) {\n            Some(v) => match v.to_str() {\n                Ok(s) => s.parse().unwrap_or_default(),\n                Err(_) => return Err(StatusCode::BAD_REQUEST),\n            },\n            None => Format::default(),\n        };\n\n        let body = match Bytes::from_request(req, state).await {\n            Ok(b) => b,\n            Err(e) => {\n                error!(?e, \"Error getting bytes\");\n                return Err(StatusCode::INTERNAL_SERVER_ERROR);\n            }\n        };\n        let out = Request {\n            name,\n            req_type,\n            api_key,\n            body,\n            in_fmt,\n            out_fmt,\n        };\n\n        Ok(out)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    // ============================================================================\n    // Request Construction Tests\n    // ============================================================================\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_construction_118": {
      "name": "test_request_construction",
      "type": "method",
      "start_line": 118,
      "end_line": 134,
      "content_hash": "aa13b38e26c2fd10a4852d554d46091a5d557eb0",
      "content": "    fn test_request_construction() {\n        let body = Bytes::from(\"test body\");\n        let request = Request {\n            name: \"test_query\".to_string(),\n            req_type: RequestType::Query,\n            api_key: None,\n            body: body.clone(),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert_eq!(request.name, \"test_query\");\n        assert!(matches!(request.req_type, RequestType::Query));\n        assert_eq!(request.body, body);\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_clone_135": {
      "name": "test_request_clone",
      "type": "method",
      "start_line": 135,
      "end_line": 151,
      "content_hash": "c2262de5bd934cfda8f3b78e1998f71604ed9e89",
      "content": "    fn test_request_clone() {\n        let body = Bytes::from(\"clone test\");\n        let request = Request {\n            name: \"original\".to_string(),\n            req_type: RequestType::MCP,\n            api_key: None,\n            body: body.clone(),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        let cloned = request.clone();\n        assert_eq!(cloned.name, request.name);\n        assert_eq!(cloned.body, request.body);\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_debug_152": {
      "name": "test_request_debug",
      "type": "method",
      "start_line": 152,
      "end_line": 171,
      "content_hash": "1d206672582624009d02e4fc63bc54501c8ef3c7",
      "content": "    fn test_request_debug() {\n        let request = Request {\n            name: \"debug_test\".to_string(),\n            req_type: RequestType::Query,\n            api_key: None,\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        let debug_str = format!(\"{:?}\", request);\n        assert!(debug_str.contains(\"debug_test\"));\n        assert!(debug_str.contains(\"Query\"));\n    }\n\n    // ============================================================================\n    // RequestType Tests\n    // ============================================================================\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_type_query_172": {
      "name": "test_request_type_query",
      "type": "method",
      "start_line": 172,
      "end_line": 180,
      "content_hash": "3f4aa721c1bdf32ec453261e0c0a85e9e67b3d14",
      "content": "    fn test_request_type_query() {\n        let rt = RequestType::Query;\n        assert!(matches!(rt, RequestType::Query));\n\n        let debug_str = format!(\"{:?}\", rt);\n        assert!(debug_str.contains(\"Query\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_type_mcp_181": {
      "name": "test_request_type_mcp",
      "type": "method",
      "start_line": 181,
      "end_line": 189,
      "content_hash": "13bac9ccdfd1ac8ca674dba922d535dc1f98e719",
      "content": "    fn test_request_type_mcp() {\n        let rt = RequestType::MCP;\n        assert!(matches!(rt, RequestType::MCP));\n\n        let debug_str = format!(\"{:?}\", rt);\n        assert!(debug_str.contains(\"MCP\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_type_copy_190": {
      "name": "test_request_type_copy",
      "type": "method",
      "start_line": 190,
      "end_line": 199,
      "content_hash": "38eb43f5b17911467ac71ff173df41363ba14d00",
      "content": "    fn test_request_type_copy() {\n        let rt1 = RequestType::Query;\n        let rt2 = rt1; // Copy trait\n\n        // Both should be usable\n        assert!(matches!(rt1, RequestType::Query));\n        assert!(matches!(rt2, RequestType::Query));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_type_clone_200": {
      "name": "test_request_type_clone",
      "type": "method",
      "start_line": 200,
      "end_line": 212,
      "content_hash": "738241373ae7f44419c7eae0e421a7d3202231f5",
      "content": "    fn test_request_type_clone() {\n        let rt1 = RequestType::MCP;\n        let rt2 = rt1.clone();\n\n        assert!(matches!(rt1, RequestType::MCP));\n        assert!(matches!(rt2, RequestType::MCP));\n    }\n\n    // ============================================================================\n    // Request with Different Content\n    // ============================================================================\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_empty_body_213": {
      "name": "test_request_empty_body",
      "type": "method",
      "start_line": 213,
      "end_line": 226,
      "content_hash": "7ae78c57bf0fbf646f721edf08af6c22cf59ac0a",
      "content": "    fn test_request_empty_body() {\n        let request = Request {\n            name: \"empty_body\".to_string(),\n            req_type: RequestType::Query,\n            api_key: None,\n            body: Bytes::new(),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert!(request.body.is_empty());\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_large_body_227": {
      "name": "test_request_large_body",
      "type": "method",
      "start_line": 227,
      "end_line": 243,
      "content_hash": "6157cf7f70194abb9087610e7694f9f7bfbbede3",
      "content": "    fn test_request_large_body() {\n        let large_data = vec![0u8; 10_000];\n        let body = Bytes::from(large_data.clone());\n\n        let request = Request {\n            name: \"large_body\".to_string(),\n            req_type: RequestType::Query,\n            api_key: None,\n            body: body.clone(),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert_eq!(request.body.len(), 10_000);\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_utf8_name_244": {
      "name": "test_request_utf8_name",
      "type": "method",
      "start_line": 244,
      "end_line": 262,
      "content_hash": "4a97da017c3da891865e79d898212b986ed0489e",
      "content": "    fn test_request_utf8_name() {\n        let request = Request {\n            name: \"test_\u4e16\u754c_query\".to_string(),\n            req_type: RequestType::Query,\n            api_key: None,\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert!(request.name.contains(\"\u4e16\u754c\"));\n    }\n\n    // ============================================================================\n    // API Key Tests\n    // ============================================================================\n\n    #[cfg(feature = \"api-key\")]\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_with_api_key_263": {
      "name": "test_request_with_api_key",
      "type": "method",
      "start_line": 263,
      "end_line": 279,
      "content_hash": "ef5c96a247056c8ab61c8c8febeae14389eba373",
      "content": "    fn test_request_with_api_key() {\n        let key = \"my-secret-api-key\".to_string();\n        let request = Request {\n            name: \"secure_query\".to_string(),\n            req_type: RequestType::Query,\n            api_key: Some(key.clone()),\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert!(request.api_key.is_some());\n        assert_eq!(request.api_key.unwrap(), key);\n    }\n\n    #[cfg(feature = \"api-key\")]\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_api_key_different_values_280": {
      "name": "test_api_key_different_values",
      "type": "method",
      "start_line": 280,
      "end_line": 305,
      "content_hash": "d09bdf38dbe2b7c6fc2d83b96d361b555f602e6a",
      "content": "    fn test_api_key_different_values() {\n        let key1 = \"api-key-1\".to_string();\n        let key2 = \"api-key-2\".to_string();\n\n        let request1 = Request {\n            name: \"test1\".to_string(),\n            req_type: RequestType::Query,\n            api_key: Some(key1.clone()),\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        let request2 = Request {\n            name: \"test2\".to_string(),\n            req_type: RequestType::Query,\n            api_key: Some(key2.clone()),\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert_ne!(request1.api_key.unwrap(), request2.api_key.unwrap());\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_request_without_api_key_306": {
      "name": "test_request_without_api_key",
      "type": "method",
      "start_line": 306,
      "end_line": 320,
      "content_hash": "5378332facbcac7e230c92f2ff94092d46ac4d37",
      "content": "    fn test_request_without_api_key() {\n        let request = Request {\n            name: \"unsecured_query\".to_string(),\n            req_type: RequestType::Query,\n            api_key: None,\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        assert!(request.api_key.is_none());\n    }\n\n    #[cfg(feature = \"api-key\")]\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_api_key_clone_321": {
      "name": "test_api_key_clone",
      "type": "method",
      "start_line": 321,
      "end_line": 335,
      "content_hash": "9345713ee4d89be50219913b6cdb44738cb3cb78",
      "content": "    fn test_api_key_clone() {\n        let key = \"test-api-key\".to_string();\n        let request = Request {\n            name: \"test\".to_string(),\n            req_type: RequestType::Query,\n            api_key: Some(key),\n            body: Bytes::from(\"test\"),\n            in_fmt: Format::Json,\n            out_fmt: Format::Json,\n        };\n\n        let cloned = request.clone();\n        assert_eq!(cloned.api_key, request.api_key);\n    }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}