{
  "file_path": "/work/.local/tools/modelscan/sdk/storage/storage_test.go",
  "file_hash": "0b0058e188f5fd47143539ff84a416cf2b82d7c4",
  "updated_at": "2025-12-26T17:34:25.089687",
  "symbols": {
    "function_ptr_17": {
      "name": "ptr",
      "type": "function",
      "start_line": 17,
      "end_line": 18,
      "content_hash": "4674d82c07b1b0d9849797dbae50a507dffe40fd",
      "content": "func ptr(s string) *string { return &s }\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_setupTestDB_19": {
      "name": "setupTestDB",
      "type": "function",
      "start_line": 19,
      "end_line": 128,
      "content_hash": "8fb9e5ad16a4b61bf568ecc0acd696bb18907f5f",
      "content": "func setupTestDB(t *testing.T) (*sql.DB, string) {\n\tt.Helper()\n\n\t// Create temporary database\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\n\t// Open database\n\tdb, err := sql.Open(\"sqlite3\", dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to open test database: %v\", err)\n\t}\n\n\t// Run migrations\n\t_, err = db.Exec(`\n\t\tCREATE TABLE IF NOT EXISTS schema_migrations (\n\t\t\tversion VARCHAR(255) PRIMARY KEY,\n\t\t\tapplied_at DATETIME DEFAULT CURRENT_TIMESTAMP\n\t\t);\n\t\t\n\t\tCREATE TABLE IF NOT EXISTS agents (\n\t\t\tid VARCHAR(255) PRIMARY KEY,\n\t\t\tname VARCHAR(255) NOT NULL,\n\t\t\tcapabilities TEXT,\n\t\t\tconfig TEXT,\n\t\t\tstatus VARCHAR(50) DEFAULT 'idle',\n\t\t\tcreated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tupdated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n\t\t);\n\t\t\n\t\tCREATE TABLE IF NOT EXISTS teams (\n\t\t\tid VARCHAR(255) PRIMARY KEY,\n\t\t\tname VARCHAR(255) NOT NULL,\n\t\t\tdescription TEXT,\n\t\t\tconfig TEXT,\n\t\t\tmetadata TEXT,\n\t\t\tcreated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tupdated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n\t\t);\n\t\t\n\t\tCREATE TABLE IF NOT EXISTS team_members (\n\t\t\tteam_id VARCHAR(255) NOT NULL,\n\t\t\tagent_id VARCHAR(255) NOT NULL,\n\t\t\trole VARCHAR(100) DEFAULT 'member',\n\t\t\tjoined_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tupdated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tPRIMARY KEY (team_id, agent_id),\n\t\t\tFOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE CASCADE,\n\t\t\tFOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE\n\t\t);\n\t\t\n\t\tCREATE TABLE IF NOT EXISTS tasks (\n\t\t\tid VARCHAR(255) PRIMARY KEY,\n\t\t\tagent_id VARCHAR(255) NOT NULL,\n\t\t\tteam_id VARCHAR(255),\n\t\t\ttype VARCHAR(100) NOT NULL,\n\t\t\tstatus VARCHAR(50) DEFAULT 'pending',\n\t\t\tpriority INTEGER DEFAULT 0,\n\t\t\tinput TEXT,\n\t\t\toutput TEXT,\n\t\t\tmetadata TEXT,\n\t\t\tcreated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tstarted_at DATETIME,\n\t\t\tcompleted_at DATETIME,\n\t\t\tupdated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tFOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE,\n\t\t\tFOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE SET NULL\n\t\t);\n\t\t\n\t\tCREATE TABLE IF NOT EXISTS messages (\n\t\t\tid VARCHAR(255) PRIMARY KEY,\n\t\t\ttask_id VARCHAR(255) NOT NULL,\n\t\t\tagent_id VARCHAR(255) NOT NULL,\n\t\t\tteam_id VARCHAR(255),\n\t\t\ttype VARCHAR(100) NOT NULL,\n\t\t\tcontent TEXT,\n\t\t\tmetadata TEXT,\n\t\t\tcreated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tFOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,\n\t\t\tFOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE,\n\t\t\tFOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE SET NULL\n\t\t);\n\t\t\n\t\tCREATE TABLE IF NOT EXISTS tool_executions (\n\t\t\tid VARCHAR(255) PRIMARY KEY,\n\t\t\ttask_id VARCHAR(255) NOT NULL,\n\t\t\tagent_id VARCHAR(255) NOT NULL,\n\t\t\ttool_name VARCHAR(255) NOT NULL,\n\t\t\ttool_type VARCHAR(100),\n\t\t\tinput TEXT,\n\t\t\toutput TEXT,\n\t\t\terror TEXT,\n\t\t\tstatus VARCHAR(50) DEFAULT 'running',\n\t\t\tduration INTEGER DEFAULT 0,\n\t\t\tmetadata TEXT,\n\t\t\tstarted_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n\t\t\tcompleted_at DATETIME,\n\t\t\tFOREIGN KEY (task_id) REFERENCES tasks(id) ON DELETE CASCADE,\n\t\t\tFOREIGN KEY (agent_id) REFERENCES agents(id) ON DELETE CASCADE\n\t\t);\n\t\t\n\t\tINSERT OR IGNORE INTO schema_migrations (version) VALUES ('001_initial');\n\t`)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to setup test schema: %v\", err)\n\t}\n\n\treturn db, dbPath\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorageLifecycle_129": {
      "name": "TestStorageLifecycle",
      "type": "function",
      "start_line": 129,
      "end_line": 158,
      "content_hash": "342bba7015880d30b263e4ef90af004c82d36ca5",
      "content": "func TestStorageLifecycle(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Test health check\n\tif err := storage.PerformHealthCheck(ctx); err != nil {\n\t\tt.Fatalf(\"Health check failed: %v\", err)\n\t}\n\n\t// Test storage stats\n\tstats, err := storage.GetStorageStats(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get storage stats: %v\", err)\n\t}\n\n\t// Verify initial stats\n\tif stats[\"agents\"] != 0 {\n\t\tt.Errorf(\"Expected 0 agents, got %v\", stats[\"agents\"])\n\t}\n\tif stats[\"tasks\"] != 0 {\n\t\tt.Errorf(\"Expected 0 tasks, got %v\", stats[\"tasks\"])\n\t}\n\tif stats[\"messages\"] != 0 {\n\t\tt.Errorf(\"Expected 0 messages, got %v\", stats[\"messages\"])\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_159": {
      "name": "TestAgentRepository",
      "type": "function",
      "start_line": 159,
      "end_line": 279,
      "content_hash": "70ce1a5660dc3c416b032b86fec0c94253b5cf18",
      "content": "func TestAgentRepository(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Test creating an agent\n\tagent := &Agent{\n\t\tID:           \"test-agent-1\",\n\t\tName:         \"Test Agent\",\n\t\tCapabilities: []string{\"text-generation\", \"analysis\"},\n\t\tConfig:       `{\"model\": \"gpt-4\"}`,\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\n\terr := repo.Create(ctx, agent)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create agent: %v\", err)\n\t}\n\n\t// Test getting an agent\n\tretrieved, err := repo.Get(ctx, \"test-agent-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get agent: %v\", err)\n\t}\n\n\tif retrieved.Name != agent.Name {\n\t\tt.Errorf(\"Expected name %s, got %s\", agent.Name, retrieved.Name)\n\t}\n\n\tif len(retrieved.Capabilities) != len(agent.Capabilities) {\n\t\tt.Errorf(\"Expected %d capabilities, got %d\", len(agent.Capabilities), len(retrieved.Capabilities))\n\t}\n\n\t// Test updating an agent\n\tagent.Status = \"active\"\n\tagent.Capabilities = append(agent.Capabilities, \"summarization\")\n\n\terr = repo.Update(ctx, agent)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to update agent: %v\", err)\n\t}\n\n\t// Verify update\n\tupdated, err := repo.Get(ctx, \"test-agent-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get updated agent: %v\", err)\n\t}\n\n\tif updated.Status != \"active\" {\n\t\tt.Errorf(\"Expected status active, got %s\", updated.Status)\n\t}\n\n\t// Test listing agents\n\tagents, err := repo.ListActive(ctx, 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to list agents: %v\", err)\n\t}\n\n\tif len(agents) != 1 {\n\t\tt.Errorf(\"Expected 1 agent, got %d\", len(agents))\n\t}\n\n\t// Test List (all agents)\n\tallAgents, err := repo.List(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to list all agents: %v\", err)\n\t}\n\n\tif len(allAgents) != 1 {\n\t\tt.Errorf(\"Expected 1 agent in List, got %d\", len(allAgents))\n\t}\n\n\t// Test UpdateStatus\n\terr = repo.UpdateStatus(ctx, \"test-agent-1\", \"busy\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to update status: %v\", err)\n\t}\n\n\t// Verify status update\n\tstatusUpdated, err := repo.Get(ctx, \"test-agent-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get agent after status update: %v\", err)\n\t}\n\n\tif statusUpdated.Status != \"busy\" {\n\t\tt.Errorf(\"Expected status busy, got %s\", statusUpdated.Status)\n\t}\n\n\t// Test ListByStatus\n\tbusyAgents, err := repo.ListByStatus(ctx, \"busy\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to list agents by status: %v\", err)\n\t}\n\n\tif len(busyAgents) != 1 {\n\t\tt.Errorf(\"Expected 1 busy agent, got %d\", len(busyAgents))\n\t}\n\n\t// Test Delete\n\terr = repo.Delete(ctx, \"test-agent-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to delete agent: %v\", err)\n\t}\n\n\t// Verify deletion\n\t_, err = repo.Get(ctx, \"test-agent-1\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when getting deleted agent\")\n\t}\n\n\t// Test delete non-existent agent\n\terr = repo.Delete(ctx, \"non-existent\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when deleting non-existent agent\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_280": {
      "name": "TestTaskRepository",
      "type": "function",
      "start_line": 280,
      "end_line": 345,
      "content_hash": "e0972e706c7b6c95bc98a8e6566ee5ba44a60886",
      "content": "func TestTaskRepository(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewTaskRepository(db)\n\n\t// Test creating a task\n\ttask := &Task{\n\t\tID:        \"test-task-1\",\n\t\tAgentID:   \"test-agent-1\",\n\t\tType:      \"text-generation\",\n\t\tStatus:    \"pending\",\n\t\tPriority:  1,\n\t\tInput:     \"Write a test\",\n\t\tMetadata:  map[string]interface{}{\"test\": true},\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\n\terr := repo.Create(ctx, task)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create task: %v\", err)\n\t}\n\n\t// Test getting a task\n\tretrieved, err := repo.Get(ctx, \"test-task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get task: %v\", err)\n\t}\n\n\tif retrieved.Type != task.Type {\n\t\tt.Errorf(\"Expected type %s, got %s\", task.Type, retrieved.Type)\n\t}\n\n\tif retrieved.Metadata[\"test\"] != true {\n\t\tt.Errorf(\"Expected metadata test=true, got %v\", retrieved.Metadata[\"test\"])\n\t}\n\n\t// Test updating task status\n\terr = repo.UpdateStatus(ctx, \"test-task-1\", \"running\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to update task status: %v\", err)\n\t}\n\n\t// Verify status update\n\tupdated, err := repo.Get(ctx, \"test-task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get updated task: %v\", err)\n\t}\n\n\tif updated.Status != \"running\" {\n\t\tt.Errorf(\"Expected status running, got %s\", updated.Status)\n\t}\n\n\t// Test listing tasks by status\n\ttasks, err := repo.ListByStatus(ctx, \"running\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to list tasks by status: %v\", err)\n\t}\n\n\tif len(tasks) != 1 {\n\t\tt.Errorf(\"Expected 1 task, got %d\", len(tasks))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_346": {
      "name": "TestTeamRepository",
      "type": "function",
      "start_line": 346,
      "end_line": 422,
      "content_hash": "fd4387b3fc86229928088fdf23e24f862c1b3cad",
      "content": "func TestTeamRepository(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewTeamRepository(db)\n\n\t// Create a team\n\tteam := &Team{\n\t\tID:          \"test-team-1\",\n\t\tName:        \"Test Team\",\n\t\tDescription: \"A test team\",\n\t\tConfig:      `{\"version\": \"1.0\"}`,\n\t\tMetadata:    map[string]interface{}{\"test\": true},\n\t\tCreatedAt:   time.Now(),\n\t\tUpdatedAt:   time.Now(),\n\t}\n\n\terr := repo.Create(ctx, team)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create team: %v\", err)\n\t}\n\n\t// Test getting a team\n\tretrieved, err := repo.Get(ctx, \"test-team-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get team: %v\", err)\n\t}\n\n\tif retrieved.Name != team.Name {\n\t\tt.Errorf(\"Expected name %s, got %s\", team.Name, retrieved.Name)\n\t}\n\n\t// Test adding team members\n\terr = repo.AddMember(ctx, \"test-team-1\", \"agent-1\", \"lead\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to add team member: %v\", err)\n\t}\n\n\terr = repo.AddMember(ctx, \"test-team-1\", \"agent-2\", \"member\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to add second team member: %v\", err)\n\t}\n\n\t// Test getting team members\n\tmembers, err := repo.GetMembers(ctx, \"test-team-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get team members: %v\", err)\n\t}\n\n\tif len(members) != 2 {\n\t\tt.Errorf(\"Expected 2 members, got %d\", len(members))\n\t}\n\n\t// Test updating member role\n\terr = repo.UpdateMemberRole(ctx, \"test-team-1\", \"agent-2\", \"lead\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to update member role: %v\", err)\n\t}\n\n\t// Test removing team member\n\terr = repo.RemoveMember(ctx, \"test-team-1\", \"agent-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to remove team member: %v\", err)\n\t}\n\n\t// Verify removal\n\tmembers, err = repo.GetMembers(ctx, \"test-team-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get team members after removal: %v\", err)\n\t}\n\n\tif len(members) != 1 {\n\t\tt.Errorf(\"Expected 1 member after removal, got %d\", len(members))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_423": {
      "name": "TestMessageRepository",
      "type": "function",
      "start_line": 423,
      "end_line": 476,
      "content_hash": "5dc7039b316b31096a82530ee1d42d93665a8088",
      "content": "func TestMessageRepository(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewMessageRepository(db)\n\n\t// Create a message\n\tmessage := &Message{\n\t\tID:        \"test-message-1\",\n\t\tTaskID:    \"test-task-1\",\n\t\tAgentID:   \"test-agent-1\",\n\t\tType:      \"user_message\",\n\t\tContent:   \"Hello, world!\",\n\t\tMetadata:  map[string]interface{}{\"test\": true},\n\t\tCreatedAt: time.Now(),\n\t}\n\n\terr := repo.Create(ctx, message)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create message: %v\", err)\n\t}\n\n\t// Test getting a message\n\tretrieved, err := repo.Get(ctx, \"test-message-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get message: %v\", err)\n\t}\n\n\tif retrieved.Content != message.Content {\n\t\tt.Errorf(\"Expected content %s, got %s\", message.Content, retrieved.Content)\n\t}\n\n\t// Test listing messages by task\n\tmessages, err := repo.ListByTask(ctx, \"test-task-1\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to list messages by task: %v\", err)\n\t}\n\n\tif len(messages) != 1 {\n\t\tt.Errorf(\"Expected 1 message, got %d\", len(messages))\n\t}\n\n\t// Test conversation thread\n\tthread, err := repo.GetConversationThread(ctx, \"test-task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get conversation thread: %v\", err)\n\t}\n\n\tif len(thread) != 1 {\n\t\tt.Errorf(\"Expected 1 message in thread, got %d\", len(thread))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_477": {
      "name": "TestToolExecutionRepository",
      "type": "function",
      "start_line": 477,
      "end_line": 543,
      "content_hash": "24b9b79e4bdf5cd0471721a55a7bfdd8ebe739d4",
      "content": "func TestToolExecutionRepository(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewToolExecutionRepository(db)\n\n\t// Create a tool execution\n\texecution := &ToolExecution{\n\t\tID:        \"test-exec-1\",\n\t\tTaskID:    \"test-task-1\",\n\t\tAgentID:   \"test-agent-1\",\n\t\tToolName:  \"test_tool\",\n\t\tToolType:  \"utility\",\n\t\tInput:     \"test input\",\n\t\tStatus:    \"running\",\n\t\tDuration:  0,\n\t\tMetadata:  map[string]interface{}{\"test\": true},\n\t\tStartedAt: time.Now(),\n\t}\n\n\terr := repo.Create(ctx, execution)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create tool execution: %v\", err)\n\t}\n\n\t// Test getting a tool execution\n\tretrieved, err := repo.Get(ctx, \"test-exec-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get tool execution: %v\", err)\n\t}\n\n\tif retrieved.ToolName != execution.ToolName {\n\t\tt.Errorf(\"Expected tool name %s, got %s\", execution.ToolName, retrieved.ToolName)\n\t}\n\n\t// Test marking as completed\n\terr = repo.MarkCompleted(ctx, \"test-exec-1\", \"test output\", \"completed\", 1000)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to mark tool execution completed: %v\", err)\n\t}\n\n\t// Verify completion\n\tcompleted, err := repo.Get(ctx, \"test-exec-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get completed tool execution: %v\", err)\n\t}\n\n\tif completed.Status != \"completed\" {\n\t\tt.Errorf(\"Expected status completed, got %s\", completed.Status)\n\t}\n\n\tif completed.Duration != 1000 {\n\t\tt.Errorf(\"Expected duration 1000, got %d\", completed.Duration)\n\t}\n\n\t// Test listing tool executions by task\n\texecutions, err := repo.ListByTask(ctx, \"test-task-1\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to list tool executions by task: %v\", err)\n\t}\n\n\tif len(executions) != 1 {\n\t\tt.Errorf(\"Expected 1 execution, got %d\", len(executions))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorageIntegration_544": {
      "name": "TestStorageIntegration",
      "type": "function",
      "start_line": 544,
      "end_line": 580,
      "content_hash": "cab3ea61bdda2b6944d49bbe4eff9db5931c9a1d",
      "content": "func TestStorageIntegration(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Test zero-state initialization\n\terr := storage.InitializeZeroState(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to initialize zero state: %v\", err)\n\t}\n\n\t// Test creating with defaults\n\tagent := storage.NewAgentWithDefaults(\"Test Agent\", \"llm\", []string{\"text-generation\"})\n\terr = storage.Agents.Create(ctx, agent)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create agent: %v\", err)\n\t}\n\n\t// Test cleanup\n\terr = storage.CleanupOldData(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to cleanup old data: %v\", err)\n\t}\n\n\t// Test stats\n\tstats, err := storage.GetStorageStats(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to get stats: %v\", err)\n\t}\n\n\tif stats[\"agents\"] != 1 {\n\t\tt.Errorf(\"Expected 1 agent in stats, got %v\", stats[\"agents\"])\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_CompleteCRUD_581": {
      "name": "TestTaskRepository_CompleteCRUD",
      "type": "function",
      "start_line": 581,
      "end_line": 655,
      "content_hash": "557075ebfba7b476012bd5365853df15bdda42ec",
      "content": "func TestTaskRepository_CompleteCRUD(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create an agent first\n\tagent := &Agent{\n\t\tID:           \"test-agent\",\n\t\tName:         \"Test Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\t// Test Create\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"test-agent\",\n\t\tType:      \"test\",\n\t\tStatus:    \"pending\",\n\t\tPriority:  1,\n\t\tInput:     \"test input\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\n\terr := taskRepo.Create(ctx, task)\n\tif err != nil {\n\t\tt.Fatalf(\"Create failed: %v\", err)\n\t}\n\n\t// Test Update\n\ttask.Status = \"running\"\n\ttask.Output = \"test output\"\n\terr = taskRepo.Update(ctx, task)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Verify update\n\tupdated, err := taskRepo.Get(ctx, \"task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get after update failed: %v\", err)\n\t}\n\tif updated.Status != \"running\" {\n\t\tt.Errorf(\"Expected status 'running', got '%s'\", updated.Status)\n\t}\n\n\t// Test ListByAgent\n\ttasks, err := taskRepo.ListByAgent(ctx, \"test-agent\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByAgent failed: %v\", err)\n\t}\n\tif len(tasks) != 1 {\n\t\tt.Errorf(\"Expected 1 task, got %d\", len(tasks))\n\t}\n\n\t// Test Delete\n\terr = taskRepo.Delete(ctx, \"task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Delete failed: %v\", err)\n\t}\n\n\t// Verify deletion\n\t_, err = taskRepo.Get(ctx, \"task-1\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when getting deleted task\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_CompleteCRUD_656": {
      "name": "TestTeamRepository_CompleteCRUD",
      "type": "function",
      "start_line": 656,
      "end_line": 722,
      "content_hash": "1b91faa1ce16943b3b3a960a5e35ba0305630fa8",
      "content": "func TestTeamRepository_CompleteCRUD(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tteamRepo := NewTeamRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create agents\n\tagent1 := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Agent 1\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent1)\n\n\t// Test Create\n\tteam := &Team{\n\t\tID:          \"team-1\",\n\t\tName:        \"Test Team\",\n\t\tDescription: \"A test team\",\n\t\tConfig:      `{\"test\": true}`,\n\t\tMetadata:    map[string]interface{}{\"key\": \"value\"},\n\t\tCreatedAt:   time.Now(),\n\t\tUpdatedAt:   time.Now(),\n\t}\n\n\terr := teamRepo.Create(ctx, team)\n\tif err != nil {\n\t\tt.Fatalf(\"Create failed: %v\", err)\n\t}\n\n\t// Test Update\n\tteam.Description = \"Updated description\"\n\terr = teamRepo.Update(ctx, team)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Test List\n\tteams, err := teamRepo.List(ctx, 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"List failed: %v\", err)\n\t}\n\tif len(teams) != 1 {\n\t\tt.Errorf(\"Expected 1 team, got %d\", len(teams))\n\t}\n\n\t// Test GetAgentTeams\n\tagentTeams, err := teamRepo.GetAgentTeams(ctx, \"agent-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"GetAgentTeams failed: %v\", err)\n\t}\n\tif len(agentTeams) != 0 {\n\t\tt.Errorf(\"Expected 0 teams for agent, got %d\", len(agentTeams))\n\t}\n\n\t// Test Delete\n\terr = teamRepo.Delete(ctx, \"team-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Delete failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_CompleteCRUD_723": {
      "name": "TestMessageRepository_CompleteCRUD",
      "type": "function",
      "start_line": 723,
      "end_line": 799,
      "content_hash": "4fbca832b10729ae2174358e2819a610faa5692e",
      "content": "func TestMessageRepository_CompleteCRUD(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tmsgRepo := NewMessageRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create agent and task\n\tagent := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Agent 1\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tType:      \"test\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Test Create\n\tmsg := &Message{\n\t\tID:        \"msg-1\",\n\t\tTaskID:    \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tType:      \"text\",\n\t\tContent:   \"Hello\",\n\t\tCreatedAt: time.Now(),\n\t}\n\n\terr := msgRepo.Create(ctx, msg)\n\tif err != nil {\n\t\tt.Fatalf(\"Create failed: %v\", err)\n\t}\n\n\t// Test ListByAgent\n\tmessages, err := msgRepo.ListByAgent(ctx, \"agent-1\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByAgent failed: %v\", err)\n\t}\n\tif len(messages) != 1 {\n\t\tt.Errorf(\"Expected 1 message, got %d\", len(messages))\n\t}\n\n\t// Test DeleteByTask\n\terr = msgRepo.DeleteByTask(ctx, \"task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"DeleteByTask failed: %v\", err)\n\t}\n\n\t// Test Delete\n\tmsg2 := &Message{\n\t\tID:        \"msg-2\",\n\t\tTaskID:    \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tType:      \"text\",\n\t\tContent:   \"Test\",\n\t\tCreatedAt: time.Now(),\n\t}\n\tmsgRepo.Create(ctx, msg2)\n\n\terr = msgRepo.Delete(ctx, \"msg-2\")\n\tif err != nil {\n\t\tt.Fatalf(\"Delete failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_CompleteCRUD_800": {
      "name": "TestToolExecutionRepository_CompleteCRUD",
      "type": "function",
      "start_line": 800,
      "end_line": 902,
      "content_hash": "243ea38a7157382381ad18fdfdedb737e7ce4836",
      "content": "func TestToolExecutionRepository_CompleteCRUD(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttoolRepo := NewToolExecutionRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create agent and task\n\tagent := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Agent 1\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tType:      \"test\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Test Create\n\ttool := &ToolExecution{\n\t\tID:        \"tool-1\",\n\t\tTaskID:    \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tToolName:  \"test_tool\",\n\t\tStatus:    \"running\",\n\t\tStartedAt: time.Now(),\n\t}\n\n\terr := toolRepo.Create(ctx, tool)\n\tif err != nil {\n\t\tt.Fatalf(\"Create failed: %v\", err)\n\t}\n\n\t// Test Update\n\ttool.Status = \"completed\"\n\ttool.Output = \"success\"\n\terr = toolRepo.Update(ctx, tool)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Test MarkFailed\n\ttool2 := &ToolExecution{\n\t\tID:        \"tool-2\",\n\t\tTaskID:    \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tToolName:  \"test_tool2\",\n\t\tStatus:    \"running\",\n\t\tStartedAt: time.Now(),\n\t}\n\ttoolRepo.Create(ctx, tool2)\n\n\terr = toolRepo.MarkFailed(ctx, \"tool-2\", \"Test error\", 100)\n\tif err != nil {\n\t\tt.Fatalf(\"MarkFailed failed: %v\", err)\n\t}\n\n\t// Test ListByAgent\n\ttools, err := toolRepo.ListByAgent(ctx, \"agent-1\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByAgent failed: %v\", err)\n\t}\n\tif len(tools) != 2 {\n\t\tt.Errorf(\"Expected 2 tools, got %d\", len(tools))\n\t}\n\n\t// Test ListByTool\n\ttoolsByName, err := toolRepo.ListByTool(ctx, \"test_tool\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByTool failed: %v\", err)\n\t}\n\tif len(toolsByName) != 1 {\n\t\tt.Errorf(\"Expected 1 tool, got %d\", len(toolsByName))\n\t}\n\n\t// Test GetUsageStats\n\tstats, err := toolRepo.GetUsageStats(ctx, time.Now().Add(-1*time.Hour))\n\tif err != nil {\n\t\tt.Fatalf(\"GetUsageStats failed: %v\", err)\n\t}\n\tif len(stats) < 1 {\n\t\tt.Errorf(\"Expected at least 1 stat entry, got %d\", len(stats))\n\t}\n\n\t// Test DeleteByTask\n\terr = toolRepo.DeleteByTask(ctx, \"task-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"DeleteByTask failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_HelperFunctions_903": {
      "name": "TestStorage_HelperFunctions",
      "type": "function",
      "start_line": 903,
      "end_line": 975,
      "content_hash": "22479cd43f50b2722292010e506675298dc91277",
      "content": "func TestStorage_HelperFunctions(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Test NewTaskWithDefaults\n\ttask := storage.NewTaskWithDefaults(\"agent-1\", \"test\", \"test input\", 1)\n\tif task.ID == \"\" {\n\t\tt.Error(\"Task ID should be generated\")\n\t}\n\tif task.AgentID != \"agent-1\" {\n\t\tt.Errorf(\"Expected agent ID 'agent-1', got '%s'\", task.AgentID)\n\t}\n\n\t// Test NewMessageWithDefaults\n\tmsg := storage.NewMessageWithDefaults(\"task-1\", \"agent-1\", \"text\", \"Hello\")\n\tif msg.ID == \"\" {\n\t\tt.Error(\"Message ID should be generated\")\n\t}\n\tif msg.Content != \"Hello\" {\n\t\tt.Errorf(\"Expected content 'Hello', got '%s'\", msg.Content)\n\t}\n\n\t// Test NewTeamWithDefaults\n\tteam := storage.NewTeamWithDefaults(\"Test Team\", \"Description\")\n\tif team.ID == \"\" {\n\t\tt.Error(\"Team ID should be generated\")\n\t}\n\tif team.Name != \"Test Team\" {\n\t\tt.Errorf(\"Expected name 'Test Team', got '%s'\", team.Name)\n\t}\n\n\t// Test NewToolExecutionWithDefaults\n\ttool := storage.NewToolExecutionWithDefaults(\"task-1\", \"agent-1\", \"test_tool\", \"function\", \"input\")\n\tif tool.ID == \"\" {\n\t\tt.Error(\"Tool ID should be generated\")\n\t}\n\tif tool.ToolName != \"test_tool\" {\n\t\tt.Errorf(\"Expected tool name 'test_tool', got '%s'\", tool.ToolName)\n\t}\n\n\t// Test SetAllAgentsIdle\n\tagent := storage.NewAgentWithDefaults(\"Test Agent\", \"llm\", []string{\"test\"})\n\tagent.Status = \"busy\"\n\tstorage.Agents.Create(ctx, agent)\n\n\terr := storage.SetAllAgentsIdle(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"SetAllAgentsIdle failed: %v\", err)\n\t}\n\n\t// Test CancelAllPendingTasks\n\terr = storage.CancelAllPendingTasks(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"CancelAllPendingTasks failed: %v\", err)\n\t}\n\n\t// Test PerformHealthCheck\n\terr = storage.PerformHealthCheck(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"PerformHealthCheck failed: %v\", err)\n\t}\n\t// Health check passed\n\n\t// Test Close\n\terr = storage.Close()\n\tif err != nil {\n\t\tt.Fatalf(\"Close failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDatabase_Lifecycle_976": {
      "name": "TestDatabase_Lifecycle",
      "type": "function",
      "start_line": 976,
      "end_line": 1015,
      "content_hash": "a75eaa7714b76b18ea8c4c99bfff4a146e42d0ea",
      "content": "func TestDatabase_Lifecycle(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := tempDir + \"/test.db\"\n\n\t// Test NewAgentDB\n\tdb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"NewAgentDB failed: %v\", err)\n\t}\n\n\t// Test GetDB\n\tsqlDB := db.GetDB()\n\tif sqlDB == nil {\n\t\tt.Error(\"GetDB returned nil\")\n\t}\n\n\t// Test that tables were created\n\tctx := context.Background()\n\tvar count int\n\terr = sqlDB.QueryRowContext(ctx, \"SELECT COUNT(*) FROM sqlite_master WHERE type='table'\").Scan(&count)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to query tables: %v\", err)\n\t}\n\tif count < 5 {\n\t\tt.Errorf(\"Expected at least 5 tables, got %d\", count)\n\t}\n\n\t// Test CleanupOldData\n\terr = db.CleanupOldData(ctx, 24*time.Hour)\n\tif err != nil {\n\t\tt.Fatalf(\"CleanupOldData failed: %v\", err)\n\t}\n\n\t// Test Close\n\terr = db.Close()\n\tif err != nil {\n\t\tt.Fatalf(\"Close failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_SetActive_1016": {
      "name": "TestAgentRepository_SetActive",
      "type": "function",
      "start_line": 1016,
      "end_line": 1057,
      "content_hash": "63f9ffb73f65194a7d6a862aaa8928bcdd5c20a5",
      "content": "func TestAgentRepository_SetActive(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Create agents\n\tagent1 := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Agent 1\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\trepo.Create(ctx, agent1)\n\n\t// Test SetActive\n\terr := repo.UpdateStatus(ctx, \"agent-1\", \"active\")\n\tif err != nil {\n\t\tt.Fatalf(\"SetActive failed: %v\", err)\n\t}\n\n\t// Verify status changed to active\n\tupdated, _ := repo.Get(ctx, \"agent-1\")\n\tif updated.Status != \"active\" {\n\t\tt.Errorf(\"Expected status 'active', got '%s'\", updated.Status)\n\t}\n\n\t// Test SetActive false\n\terr = repo.UpdateStatus(ctx, \"agent-1\", \"idle\")\n\tif err != nil {\n\t\tt.Fatalf(\"SetActive false failed: %v\", err)\n\t}\n\n\tupdated, _ = repo.Get(ctx, \"agent-1\")\n\tif updated.Status != \"idle\" {\n\t\tt.Errorf(\"Expected status 'idle', got '%s'\", updated.Status)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_ListByTeam_1058": {
      "name": "TestTaskRepository_ListByTeam",
      "type": "function",
      "start_line": 1058,
      "end_line": 1107,
      "content_hash": "b95009641f47da7f1e4fb2da2e53fb8483940301",
      "content": "func TestTaskRepository_ListByTeam(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\tteamRepo := NewTeamRepository(db)\n\n\t// Create agent, team, and task\n\tagent := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Agent 1\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\tteam := &Team{\n\t\tID:        \"team-1\",\n\t\tName:      \"Team 1\",\n\t\tConfig:    \"{}\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\tteamRepo.Create(ctx, team)\n\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tTeamID:    ptr(\"team-1\"),\n\t\tType:      \"test\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Test ListByTeam\n\ttasks, err := taskRepo.ListByTeam(ctx, \"team-1\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByTeam failed: %v\", err)\n\t}\n\tif len(tasks) != 1 {\n\t\tt.Errorf(\"Expected 1 task, got %d\", len(tasks))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_ListByTeam_1108": {
      "name": "TestMessageRepository_ListByTeam",
      "type": "function",
      "start_line": 1108,
      "end_line": 1169,
      "content_hash": "d59c86f04822e5fbd8e8d0b9fccc69e79f22a8af",
      "content": "func TestMessageRepository_ListByTeam(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tmsgRepo := NewMessageRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\tteamRepo := NewTeamRepository(db)\n\n\t// Create dependencies\n\tagent := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Agent 1\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\tteam := &Team{\n\t\tID:        \"team-1\",\n\t\tName:      \"Team 1\",\n\t\tConfig:    \"{}\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\tteamRepo.Create(ctx, team)\n\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tTeamID:    ptr(\"team-1\"),\n\t\tType:      \"test\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\tmsg := &Message{\n\t\tID:        \"msg-1\",\n\t\tTaskID:    \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tTeamID:    ptr(\"team-1\"),\n\t\tType:      \"text\",\n\t\tContent:   \"Hello\",\n\t\tCreatedAt: time.Now(),\n\t}\n\tmsgRepo.Create(ctx, msg)\n\n\t// Test ListByTeam\n\tmessages, err := msgRepo.ListByTeam(ctx, \"team-1\", 10, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByTeam failed: %v\", err)\n\t}\n\tif len(messages) != 1 {\n\t\tt.Errorf(\"Expected 1 message, got %d\", len(messages))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_SetActiveMultiple_1170": {
      "name": "TestAgentRepository_SetActiveMultiple",
      "type": "function",
      "start_line": 1170,
      "end_line": 1247,
      "content_hash": "37fc8ae1742b8723929d893e8d886bbfbed4381a",
      "content": "func TestAgentRepository_SetActiveMultiple(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Create multiple agents\n\tagents := []*Agent{\n\t\t{\n\t\t\tID:           \"agent-1\",\n\t\t\tName:         \"Agent 1\",\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       \"active\",\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t},\n\t\t{\n\t\t\tID:           \"agent-2\",\n\t\t\tName:         \"Agent 2\",\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       \"active\",\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t},\n\t\t{\n\t\t\tID:           \"agent-3\",\n\t\t\tName:         \"Agent 3\",\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       \"active\",\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t},\n\t}\n\n\tfor _, agent := range agents {\n\t\tif err := repo.Create(ctx, agent); err != nil {\n\t\t\tt.Fatalf(\"Failed to create agent: %v\", err)\n\t\t}\n\t}\n\n\t// Test SetActive with specific agents\n\terr := repo.SetActive(ctx, []string{\"agent-1\", \"agent-3\"})\n\tif err != nil {\n\t\tt.Fatalf(\"SetActive failed: %v\", err)\n\t}\n\n\t// Verify correct agents are active\n\tagent1, _ := repo.Get(ctx, \"agent-1\")\n\tif agent1.Status != \"active\" {\n\t\tt.Errorf(\"Expected agent-1 to be active, got %s\", agent1.Status)\n\t}\n\n\tagent2, _ := repo.Get(ctx, \"agent-2\")\n\tif agent2.Status != \"inactive\" {\n\t\tt.Errorf(\"Expected agent-2 to be inactive, got %s\", agent2.Status)\n\t}\n\n\tagent3, _ := repo.Get(ctx, \"agent-3\")\n\tif agent3.Status != \"active\" {\n\t\tt.Errorf(\"Expected agent-3 to be active, got %s\", agent3.Status)\n\t}\n\n\t// Test SetActive with empty list (all should be inactive)\n\terr = repo.SetActive(ctx, []string{})\n\tif err != nil {\n\t\tt.Fatalf(\"SetActive with empty list failed: %v\", err)\n\t}\n\n\t// Verify all are inactive\n\tfor _, agentID := range []string{\"agent-1\", \"agent-2\", \"agent-3\"} {\n\t\tagent, _ := repo.Get(ctx, agentID)\n\t\tif agent.Status != \"inactive\" {\n\t\t\tt.Errorf(\"Expected %s to be inactive after empty SetActive, got %s\", agentID, agent.Status)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentDB_CleanupScheduler_1248": {
      "name": "TestAgentDB_CleanupScheduler",
      "type": "function",
      "start_line": 1248,
      "end_line": 1274,
      "content_hash": "c96bda74025671c1c8b84453a2e2c412a2930e86",
      "content": "func TestAgentDB_CleanupScheduler(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create AgentDB: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\n\t// Start cleanup scheduler with short interval\n\tadb.StartCleanupScheduler(ctx, 100*time.Millisecond, 24*time.Hour)\n\n\t// Let it run for a bit\n\ttime.Sleep(250 * time.Millisecond)\n\n\t// Cancel context to stop scheduler\n\tcancel()\n\n\t// Give it time to stop\n\ttime.Sleep(100 * time.Millisecond)\n\n\t// If we got here without hanging, the test passes\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_Get_1275": {
      "name": "TestMessageRepository_Get",
      "type": "function",
      "start_line": 1275,
      "end_line": 1339,
      "content_hash": "4e5948f8801f0083ad9ab827ebdba012c15cdb9c",
      "content": "func TestMessageRepository_Get(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tmsgRepo := NewMessageRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create agent and task first\n\tagent := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Test Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tInput:     \"test input\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create message\n\tmsg := &Message{\n\t\tID:        \"msg-1\",\n\t\tTaskID:    \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tType:      \"user\",\n\t\tContent:   \"test message\",\n\t\tCreatedAt: time.Now(),\n\t}\n\n\terr := msgRepo.Create(ctx, msg)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create message: %v\", err)\n\t}\n\n\t// Test Get\n\tretrieved, err := msgRepo.Get(ctx, \"msg-1\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif retrieved.ID != \"msg-1\" {\n\t\tt.Errorf(\"Expected ID msg-1, got %s\", retrieved.ID)\n\t}\n\tif retrieved.Content != \"test message\" {\n\t\tt.Errorf(\"Expected content 'test message', got %s\", retrieved.Content)\n\t}\n\n\t// Test Get with non-existent ID\n\t_, err = msgRepo.Get(ctx, \"non-existent\")\n\tif err == nil {\n\t\tt.Error(\"Expected error for non-existent message\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_InitializeZeroState_1340": {
      "name": "TestStorage_InitializeZeroState",
      "type": "function",
      "start_line": 1340,
      "end_line": 1386,
      "content_hash": "bddb7ba557595a26f7500d19f47c04423de25218",
      "content": "func TestStorage_InitializeZeroState(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Create some agents and tasks\n\tagent := &Agent{\n\t\tID:           \"agent-1\",\n\t\tName:         \"Test Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"active\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tstorage.Agents.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-1\",\n\t\tAgentID:   \"agent-1\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"running\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\tstorage.Tasks.Create(ctx, task)\n\n\t// Initialize zero state\n\terr := storage.InitializeZeroState(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"InitializeZeroState failed: %v\", err)\n\t}\n\n\t// Verify agent is inactive\n\tupdatedAgent, _ := storage.Agents.Get(ctx, \"agent-1\")\n\tif updatedAgent.Status != \"idle\" {\n\t\tt.Errorf(\"Expected agent to be idle, got %s\", updatedAgent.Status)\n\t}\n\n\t// Verify task is cancelled\n\tupdatedTask, _ := storage.Tasks.Get(ctx, \"task-1\")\n\tif updatedTask.Status != \"cancelled\" {\n\t\tt.Errorf(\"Expected task to be cancelled, got %s\", updatedTask.Status)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_CloseIdempotent_1387": {
      "name": "TestStorage_CloseIdempotent",
      "type": "function",
      "start_line": 1387,
      "end_line": 1404,
      "content_hash": "4eecf01e8262e63d309974a9404b4e48e069bb0a",
      "content": "func TestStorage_CloseIdempotent(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// First close\n\terr := storage.Close()\n\tif err != nil {\n\t\tt.Errorf(\"First Close failed: %v\", err)\n\t}\n\n\t// Second close should not error (idempotent)\n\terr = storage.Close()\n\tif err != nil {\n\t\tt.Errorf(\"Second Close failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentDB_CloseIdempotent_1405": {
      "name": "TestAgentDB_CloseIdempotent",
      "type": "function",
      "start_line": 1405,
      "end_line": 1426,
      "content_hash": "fd4f8e8edecc7c4cd56c2ab5cf3e09ba3d8f2680",
      "content": "func TestAgentDB_CloseIdempotent(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create AgentDB: %v\", err)\n\t}\n\n\t// First close\n\terr = adb.Close()\n\tif err != nil {\n\t\tt.Errorf(\"First Close failed: %v\", err)\n\t}\n\n\t// Second close should not error\n\terr = adb.Close()\n\tif err != nil {\n\t\tt.Errorf(\"Second Close failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentDB_Migration_1427": {
      "name": "TestAgentDB_Migration",
      "type": "function",
      "start_line": 1427,
      "end_line": 1468,
      "content_hash": "d2b0491433b4f75d6472823eca52c78f883d1f0c",
      "content": "func TestAgentDB_Migration(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test_migration.db\")\n\n\t// Create database with version 1 schema only\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create AgentDB: %v\", err)\n\t}\n\n\t// Verify migrations were applied\n\tvar version int\n\terr = adb.GetDB().QueryRow(\"SELECT MAX(version) FROM schema_migrations\").Scan(&version)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to check migration version: %v\", err)\n\t}\n\n\tif version < 1 {\n\t\tt.Errorf(\"Expected at least migration version 1, got %d\", version)\n\t}\n\n\tadb.Close()\n\n\t// Reopen database - migrations should not run again\n\tadb2, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to reopen AgentDB: %v\", err)\n\t}\n\tdefer adb2.Close()\n\n\t// Verify version is still the same or higher\n\tvar version2 int\n\terr = adb2.GetDB().QueryRow(\"SELECT MAX(version) FROM schema_migrations\").Scan(&version2)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to check migration version after reopen: %v\", err)\n\t}\n\n\tif version2 < version {\n\t\tt.Errorf(\"Migration version decreased from %d to %d\", version, version2)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentDB_TablesCreated_1469": {
      "name": "TestAgentDB_TablesCreated",
      "type": "function",
      "start_line": 1469,
      "end_line": 1501,
      "content_hash": "db74a08b1b29360c2fdae92ffe3d51a662071786",
      "content": "func TestAgentDB_TablesCreated(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test_tables.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create AgentDB: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\t// Check that all expected tables exist\n\texpectedTables := []string{\n\t\t\"schema_migrations\",\n\t\t\"agents\",\n\t\t\"teams\",\n\t\t\"tasks\",\n\t\t\"messages\",\n\t\t\"tool_executions\",\n\t}\n\n\tfor _, table := range expectedTables {\n\t\tvar count int\n\t\tquery := \"SELECT COUNT(*) FROM sqlite_master WHERE type='table' AND name=?\"\n\t\terr := adb.GetDB().QueryRow(query, table).Scan(&count)\n\t\tif err != nil {\n\t\t\tt.Fatalf(\"Failed to check for table %s: %v\", table, err)\n\t\t}\n\t\tif count == 0 {\n\t\t\tt.Errorf(\"Expected table %s was not created\", table)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_PerformHealthCheck_WithData_1502": {
      "name": "TestStorage_PerformHealthCheck_WithData",
      "type": "function",
      "start_line": 1502,
      "end_line": 1526,
      "content_hash": "3a7f3a10f574f7d52658bba287c58f596b0cd75f",
      "content": "func TestStorage_PerformHealthCheck_WithData(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Add some data\n\tagent := &Agent{\n\t\tID:           \"agent-health\",\n\t\tName:         \"Health Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tstorage.Agents.Create(ctx, agent)\n\n\t// Perform health check\n\terr := storage.PerformHealthCheck(ctx)\n\tif err != nil {\n\t\tt.Errorf(\"PerformHealthCheck failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_SetAllAgentsIdle_1527": {
      "name": "TestStorage_SetAllAgentsIdle",
      "type": "function",
      "start_line": 1527,
      "end_line": 1572,
      "content_hash": "46850b826410d731a987f653ce84c4a0dbde7216",
      "content": "func TestStorage_SetAllAgentsIdle(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Create agents with different statuses\n\tagents := []*Agent{\n\t\t{\n\t\t\tID:           \"agent-active\",\n\t\t\tName:         \"Active Agent\",\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       \"active\",\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t},\n\t\t{\n\t\t\tID:           \"agent-running\",\n\t\t\tName:         \"Running Agent\",\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       \"running\",\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t},\n\t}\n\n\tfor _, agent := range agents {\n\t\tstorage.Agents.Create(ctx, agent)\n\t}\n\n\t// Set all to idle\n\terr := storage.SetAllAgentsIdle(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"SetAllAgentsIdle failed: %v\", err)\n\t}\n\n\t// Verify all are idle\n\tfor _, agent := range agents {\n\t\tupdated, _ := storage.Agents.Get(ctx, agent.ID)\n\t\tif updated.Status != \"idle\" {\n\t\t\tt.Errorf(\"Expected agent %s to be idle, got %s\", agent.ID, updated.Status)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_CancelAllPendingTasks_1573": {
      "name": "TestStorage_CancelAllPendingTasks",
      "type": "function",
      "start_line": 1573,
      "end_line": 1645,
      "content_hash": "e6035ff8a7a1f75b31ce43160623865d02896637",
      "content": "func TestStorage_CancelAllPendingTasks(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Create an agent first\n\tagent := &Agent{\n\t\tID:           \"agent-tasks\",\n\t\tName:         \"Task Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tstorage.Agents.Create(ctx, agent)\n\n\t// Create tasks with different statuses\n\ttasks := []*Task{\n\t\t{\n\t\t\tID:        \"task-pending\",\n\t\t\tAgentID:   \"agent-tasks\",\n\t\t\tInput:     \"test1\",\n\t\t\tStatus:    \"pending\",\n\t\t\tCreatedAt: time.Now(),\n\t\t\tUpdatedAt: time.Now(),\n\t\t},\n\t\t{\n\t\t\tID:        \"task-running\",\n\t\t\tAgentID:   \"agent-tasks\",\n\t\t\tInput:     \"test2\",\n\t\t\tStatus:    \"running\",\n\t\t\tCreatedAt: time.Now(),\n\t\t\tUpdatedAt: time.Now(),\n\t\t},\n\t\t{\n\t\t\tID:        \"task-completed\",\n\t\t\tAgentID:   \"agent-tasks\",\n\t\t\tInput:     \"test3\",\n\t\t\tStatus:    \"completed\",\n\t\t\tCreatedAt: time.Now(),\n\t\t\tUpdatedAt: time.Now(),\n\t\t},\n\t}\n\n\tfor _, task := range tasks {\n\t\tstorage.Tasks.Create(ctx, task)\n\t}\n\n\t// Cancel all pending\n\terr := storage.CancelAllPendingTasks(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"CancelAllPendingTasks failed: %v\", err)\n\t}\n\n\t// Verify pending and running are cancelled, completed is unchanged\n\tpendingTask, _ := storage.Tasks.Get(ctx, \"task-pending\")\n\tif pendingTask.Status != \"cancelled\" {\n\t\tt.Errorf(\"Expected pending task to be cancelled, got %s\", pendingTask.Status)\n\t}\n\n\trunningTask, _ := storage.Tasks.Get(ctx, \"task-running\")\n\tif runningTask.Status != \"cancelled\" {\n\t\tt.Errorf(\"Expected running task to be cancelled, got %s\", runningTask.Status)\n\t}\n\n\tcompletedTask, _ := storage.Tasks.Get(ctx, \"task-completed\")\n\tif completedTask.Status != \"completed\" {\n\t\tt.Errorf(\"Expected completed task to remain completed, got %s\", completedTask.Status)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_Update_AllFields_1646": {
      "name": "TestAgentRepository_Update_AllFields",
      "type": "function",
      "start_line": 1646,
      "end_line": 1692,
      "content_hash": "de9c623fb1157c7b8e4e7f55bb18b2664a591ca2",
      "content": "func TestAgentRepository_Update_AllFields(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Create initial agent\n\tagent := &Agent{\n\t\tID:           \"agent-update-test\",\n\t\tName:         \"Original Name\",\n\t\tCapabilities: []string{\"old\"},\n\t\tConfig:       `{\"key\":\"old\"}`,\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\trepo.Create(ctx, agent)\n\n\t// Update all fields\n\tagent.Name = \"Updated Name\"\n\tagent.Capabilities = []string{\"new\", \"updated\"}\n\tagent.Config = `{\"key\":\"new\",\"extra\":\"data\"}`\n\tagent.Status = \"active\"\n\n\terr := repo.Update(ctx, agent)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Verify updates\n\tupdated, err := repo.Get(ctx, \"agent-update-test\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif updated.Name != \"Updated Name\" {\n\t\tt.Errorf(\"Name not updated: got %s\", updated.Name)\n\t}\n\tif len(updated.Capabilities) != 2 {\n\t\tt.Errorf(\"Capabilities not updated: got %v\", updated.Capabilities)\n\t}\n\tif !strings.Contains(updated.Config, \"new\") {\n\t\tt.Errorf(\"Config not updated: got %v\", updated.Config)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_UpdateStatus_AllStatuses_1693": {
      "name": "TestAgentRepository_UpdateStatus_AllStatuses",
      "type": "function",
      "start_line": 1693,
      "end_line": 1726,
      "content_hash": "c122736b11ffd5df0dcabd1e899e7121008b3593",
      "content": "func TestAgentRepository_UpdateStatus_AllStatuses(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-status-test\",\n\t\tName:         \"Status Test\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\trepo.Create(ctx, agent)\n\n\t// Test different status transitions\n\tstatuses := []string{\"active\", \"running\", \"idle\", \"error\", \"inactive\"}\n\n\tfor _, status := range statuses {\n\t\terr := repo.UpdateStatus(ctx, \"agent-status-test\", status)\n\t\tif err != nil {\n\t\t\tt.Fatalf(\"UpdateStatus to %s failed: %v\", status, err)\n\t\t}\n\n\t\tupdated, _ := repo.Get(ctx, \"agent-status-test\")\n\t\tif updated.Status != status {\n\t\t\tt.Errorf(\"Expected status %s, got %s\", status, updated.Status)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_Delete_Success_1727": {
      "name": "TestMessageRepository_Delete_Success",
      "type": "function",
      "start_line": 1727,
      "end_line": 1780,
      "content_hash": "1de3141f2cb1ab89942d7ab77dd64e1cf1d0628a",
      "content": "func TestMessageRepository_Delete_Success(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tmsgRepo := NewMessageRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create dependencies\n\tagent := &Agent{\n\t\tID:           \"agent-delete-msg\",\n\t\tName:         \"Test Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-delete-msg\",\n\t\tAgentID:   \"agent-delete-msg\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create message\n\tmsg := &Message{\n\t\tID:        \"msg-to-delete\",\n\t\tTaskID:    \"task-delete-msg\",\n\t\tAgentID:   \"agent-delete-msg\",\n\t\tType:      \"user\",\n\t\tContent:   \"test message\",\n\t\tCreatedAt: time.Now(),\n\t}\n\tmsgRepo.Create(ctx, msg)\n\n\t// Delete message\n\terr := msgRepo.Delete(ctx, \"msg-to-delete\")\n\tif err != nil {\n\t\tt.Fatalf(\"Delete failed: %v\", err)\n\t}\n\n\t// Verify deletion\n\t_, err = msgRepo.Get(ctx, \"msg-to-delete\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when getting deleted message\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestNewAgentDB_ErrorHandling_1781": {
      "name": "TestNewAgentDB_ErrorHandling",
      "type": "function",
      "start_line": 1781,
      "end_line": 1787,
      "content_hash": "646693bbf1d6781de1263fdab4b8c12e73ad4893",
      "content": "func TestNewAgentDB_ErrorHandling(t *testing.T) {\n\t_, err := NewAgentDB(\"/invalid/path/that/cannot/exist/test.db\")\n\tif err == nil {\n\t\tt.Error(\"Expected error with invalid path\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_PerformHealthCheck_Empty_1788": {
      "name": "TestStorage_PerformHealthCheck_Empty",
      "type": "function",
      "start_line": 1788,
      "end_line": 1801,
      "content_hash": "40d32af12d14785f08b8b902852c5ead20d6739f",
      "content": "func TestStorage_PerformHealthCheck_Empty(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Health check on empty database should succeed\n\terr := storage.PerformHealthCheck(ctx)\n\tif err != nil {\n\t\tt.Errorf(\"PerformHealthCheck on empty DB failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_UpdateStatus_NonExistent_1802": {
      "name": "TestAgentRepository_UpdateStatus_NonExistent",
      "type": "function",
      "start_line": 1802,
      "end_line": 1816,
      "content_hash": "2581e6b00b469bfbd97a7da7a7485d52f1613d8d",
      "content": "func TestAgentRepository_UpdateStatus_NonExistent(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Try to update status of non-existent agent\n\terr := repo.UpdateStatus(ctx, \"nonexistent\", \"active\")\n\t// Should not error (UPDATE with no matches is not an error in SQL)\n\tif err != nil {\n\t\tt.Logf(\"UpdateStatus on non-existent agent: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_DeleteByTask_Multiple_1817": {
      "name": "TestMessageRepository_DeleteByTask_Multiple",
      "type": "function",
      "start_line": 1817,
      "end_line": 1874,
      "content_hash": "449128f09d725fad0d864a7687e75dce0325714e",
      "content": "func TestMessageRepository_DeleteByTask_Multiple(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tmsgRepo := NewMessageRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create dependencies\n\tagent := &Agent{\n\t\tID:           \"agent-multi-msg\",\n\t\tName:         \"Multi Message Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-multi-msg\",\n\t\tAgentID:   \"agent-multi-msg\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create multiple messages\n\tfor i := 0; i < 5; i++ {\n\t\tmsg := &Message{\n\t\t\tID:        fmt.Sprintf(\"msg-%d\", i),\n\t\t\tTaskID:    \"task-multi-msg\",\n\t\t\tAgentID:   \"agent-multi-msg\",\n\t\t\tType:      \"user\",\n\t\t\tContent:   fmt.Sprintf(\"message %d\", i),\n\t\t\tCreatedAt: time.Now(),\n\t\t}\n\t\tmsgRepo.Create(ctx, msg)\n\t}\n\n\t// Delete all messages for task\n\terr := msgRepo.DeleteByTask(ctx, \"task-multi-msg\")\n\tif err != nil {\n\t\tt.Fatalf(\"DeleteByTask failed: %v\", err)\n\t}\n\n\t// Verify all deleted\n\tfor i := 0; i < 5; i++ {\n\t\t_, err := msgRepo.Get(ctx, fmt.Sprintf(\"msg-%d\", i))\n\t\tif err == nil {\n\t\t\tt.Errorf(\"Message msg-%d should have been deleted\", i)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_CleanupOldData_NoOldData_1875": {
      "name": "TestStorage_CleanupOldData_NoOldData",
      "type": "function",
      "start_line": 1875,
      "end_line": 1888,
      "content_hash": "ad96fa0b9582c2165bdcbecf12f99c69d90c213a",
      "content": "func TestStorage_CleanupOldData_NoOldData(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 24*time.Hour)\n\n\t// Run cleanup on empty/new database\n\terr := storage.CleanupOldData(ctx)\n\tif err != nil {\n\t\tt.Errorf(\"CleanupOldData with no old data failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_Update_AllFields_1889": {
      "name": "TestTaskRepository_Update_AllFields",
      "type": "function",
      "start_line": 1889,
      "end_line": 1946,
      "content_hash": "74a4043e2f084a3a82a966c9758e22d60b889ad8",
      "content": "func TestTaskRepository_Update_AllFields(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-task-update\",\n\t\tName:         \"Task Update Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\t// Create task\n\ttask := &Task{\n\t\tID:        \"task-update\",\n\t\tAgentID:   \"agent-task-update\",\n\t\tInput:     \"original input\",\n\t\tOutput:    \"\",\n\t\tStatus:    \"pending\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Update all fields\n\ttask.Input = \"updated input\"\n\ttask.Output = \"some output\"\n\ttask.Status = \"completed\"\n\n\terr := taskRepo.Update(ctx, task)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Verify updates\n\tupdated, err := taskRepo.Get(ctx, \"task-update\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif updated.Input != \"updated input\" {\n\t\tt.Errorf(\"Input not updated\")\n\t}\n\tif updated.Output != \"some output\" {\n\t\tt.Errorf(\"Output not updated\")\n\t}\n\tif updated.Status != \"completed\" {\n\t\tt.Errorf(\"Status not updated\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_List_WithStatus_1947": {
      "name": "TestAgentRepository_List_WithStatus",
      "type": "function",
      "start_line": 1947,
      "end_line": 1978,
      "content_hash": "c5b65e42407b8eadd6490203f8412ecb3ed000a6",
      "content": "func TestAgentRepository_List_WithStatus(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Create agents with different statuses\n\tstatuses := []string{\"active\", \"idle\", \"running\", \"error\"}\n\tfor i, status := range statuses {\n\t\tagent := &Agent{\n\t\t\tID:           fmt.Sprintf(\"agent-list-%d\", i),\n\t\t\tName:         fmt.Sprintf(\"Agent %d\", i),\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       status,\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t}\n\t\trepo.Create(ctx, agent)\n\t}\n\n\t// List all agents\n\tagents, err := repo.List(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"List failed: %v\", err)\n\t}\n\n\tif len(agents) < 4 {\n\t\tt.Errorf(\"Expected at least 4 agents, got %d\", len(agents))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_ListByStatus_1979": {
      "name": "TestTaskRepository_ListByStatus",
      "type": "function",
      "start_line": 1979,
      "end_line": 2036,
      "content_hash": "73bc4c207d82c163bf148ad3c44df54711b66528",
      "content": "func TestTaskRepository_ListByStatus(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-status-list\",\n\t\tName:         \"Status List Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\t// Create tasks with different statuses\n\tstatuses := map[string]int{\n\t\t\"pending\":   2,\n\t\t\"running\":   1,\n\t\t\"completed\": 3,\n\t}\n\n\tfor status, count := range statuses {\n\t\tfor i := 0; i < count; i++ {\n\t\t\ttask := &Task{\n\t\t\t\tID:        fmt.Sprintf(\"task-%s-%d\", status, i),\n\t\t\t\tAgentID:   \"agent-status-list\",\n\t\t\t\tInput:     \"test\",\n\t\t\t\tStatus:    status,\n\t\t\t\tCreatedAt: time.Now(),\n\t\t\t\tUpdatedAt: time.Now(),\n\t\t\t}\n\t\t\ttaskRepo.Create(ctx, task)\n\t\t}\n\t}\n\n\t// List tasks by status\n\tpendingTasks, err := taskRepo.ListByStatus(ctx, \"pending\", 100, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByStatus failed: %v\", err)\n\t}\n\tif len(pendingTasks) != 2 {\n\t\tt.Errorf(\"Expected 2 pending tasks, got %d\", len(pendingTasks))\n\t}\n\n\tcompletedTasks, err := taskRepo.ListByStatus(ctx, \"completed\", 100, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByStatus failed: %v\", err)\n\t}\n\tif len(completedTasks) != 3 {\n\t\tt.Errorf(\"Expected 3 completed tasks, got %d\", len(completedTasks))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_Update_NonExistent_2037": {
      "name": "TestAgentRepository_Update_NonExistent",
      "type": "function",
      "start_line": 2037,
      "end_line": 2061,
      "content_hash": "08a7277eae734d327a2a5f2bad7321dca5085e16",
      "content": "func TestAgentRepository_Update_NonExistent(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Try to update non-existent agent\n\tagent := &Agent{\n\t\tID:           \"nonexistent\",\n\t\tName:         \"Ghost Agent\",\n\t\tCapabilities: []string{\"none\"},\n\t\tConfig:       \"{}\",\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\n\terr := repo.Update(ctx, agent)\n\t// Should not error (UPDATE with no matches is not an SQL error)\n\tif err != nil {\n\t\tt.Logf(\"Update on non-existent agent: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_Update_NilCapabilities_2062": {
      "name": "TestAgentRepository_Update_NilCapabilities",
      "type": "function",
      "start_line": 2062,
      "end_line": 2095,
      "content_hash": "cf89375d0501b8f4db1b41d3d8acb342f7145081",
      "content": "func TestAgentRepository_Update_NilCapabilities(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\trepo := NewAgentRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-nil-cap\",\n\t\tName:         \"Nil Cap Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tConfig:       \"{}\",\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\trepo.Create(ctx, agent)\n\n\t// Update with nil capabilities\n\tagent.Capabilities = nil\n\terr := repo.Update(ctx, agent)\n\tif err != nil {\n\t\tt.Fatalf(\"Update with nil capabilities failed: %v\", err)\n\t}\n\n\t// Verify update\n\tupdated, _ := repo.Get(ctx, \"agent-nil-cap\")\n\tif updated.Capabilities == nil {\n\t\t// This is fine - nil is stored as empty JSON array\n\t\tt.Logf(\"Capabilities stored as nil/empty\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageRepository_Delete_NonExistent_2096": {
      "name": "TestMessageRepository_Delete_NonExistent",
      "type": "function",
      "start_line": 2096,
      "end_line": 2110,
      "content_hash": "890817c64bef78ad2a8faf4c27dd2cfc5e57eafe",
      "content": "func TestMessageRepository_Delete_NonExistent(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tmsgRepo := NewMessageRepository(db)\n\n\t// Try to delete non-existent message\n\terr := msgRepo.Delete(ctx, \"nonexistent-msg\")\n\t// Should not error (DELETE with no matches is not an SQL error)\n\tif err != nil {\n\t\tt.Logf(\"Delete on non-existent message: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_InitializeZeroState_MultipleAgents_2111": {
      "name": "TestStorage_InitializeZeroState_MultipleAgents",
      "type": "function",
      "start_line": 2111,
      "end_line": 2168,
      "content_hash": "cade86815614484521ef4e138a0fe385162331b6",
      "content": "func TestStorage_InitializeZeroState_MultipleAgents(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 24*time.Hour)\n\n\t// Create multiple agents with different statuses\n\tstatuses := []string{\"active\", \"running\", \"error\"}\n\tfor i, status := range statuses {\n\t\tagent := &Agent{\n\t\t\tID:           fmt.Sprintf(\"agent-zero-%d\", i),\n\t\t\tName:         fmt.Sprintf(\"Agent %d\", i),\n\t\t\tCapabilities: []string{\"test\"},\n\t\t\tStatus:       status,\n\t\t\tCreatedAt:    time.Now(),\n\t\t\tUpdatedAt:    time.Now(),\n\t\t}\n\t\tstorage.Agents.Create(ctx, agent)\n\t}\n\n\t// Create multiple tasks with different statuses\n\ttaskStatuses := []string{\"pending\", \"running\"}\n\tfor i, status := range taskStatuses {\n\t\ttask := &Task{\n\t\t\tID:        fmt.Sprintf(\"task-zero-%d\", i),\n\t\t\tAgentID:   fmt.Sprintf(\"agent-zero-%d\", i),\n\t\t\tInput:     \"test\",\n\t\t\tStatus:    status,\n\t\t\tCreatedAt: time.Now(),\n\t\t\tUpdatedAt: time.Now(),\n\t\t}\n\t\tstorage.Tasks.Create(ctx, task)\n\t}\n\n\t// Initialize zero state\n\terr := storage.InitializeZeroState(ctx)\n\tif err != nil {\n\t\tt.Fatalf(\"InitializeZeroState failed: %v\", err)\n\t}\n\n\t// Verify all agents are idle\n\tfor i := range statuses {\n\t\tagent, _ := storage.Agents.Get(ctx, fmt.Sprintf(\"agent-zero-%d\", i))\n\t\tif agent.Status != \"idle\" {\n\t\t\tt.Errorf(\"Agent %d should be idle, got %s\", i, agent.Status)\n\t\t}\n\t}\n\n\t// Verify all tasks are cancelled\n\tfor i := range taskStatuses {\n\t\ttask, _ := storage.Tasks.Get(ctx, fmt.Sprintf(\"task-zero-%d\", i))\n\t\tif task.Status != \"cancelled\" {\n\t\t\tt.Errorf(\"Task %d should be cancelled, got %s\", i, task.Status)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_PerformHealthCheck_WithErrors_2169": {
      "name": "TestStorage_PerformHealthCheck_WithErrors",
      "type": "function",
      "start_line": 2169,
      "end_line": 2201,
      "content_hash": "22b4b136b5dabf6ef881cb499098c965c17bcb7a",
      "content": "func TestStorage_PerformHealthCheck_WithErrors(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 24*time.Hour)\n\n\t// Add some data to verify DB is working\n\tagent := &Agent{\n\t\tID:           \"health-agent\",\n\t\tName:         \"Health Check Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tstorage.Agents.Create(ctx, agent)\n\n\t// Perform health check\n\terr := storage.PerformHealthCheck(ctx)\n\tif err != nil {\n\t\tt.Errorf(\"PerformHealthCheck failed: %v\", err)\n\t}\n\n\t// Close DB and try health check - should fail\n\tstorage.Close()\n\n\terr = storage.PerformHealthCheck(ctx)\n\tif err == nil {\n\t\tt.Error(\"Expected PerformHealthCheck to fail on closed DB\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_CleanupOldData_EmptyTables_2202": {
      "name": "TestStorage_CleanupOldData_EmptyTables",
      "type": "function",
      "start_line": 2202,
      "end_line": 2215,
      "content_hash": "962ee6b1ed7f6a1f1ad568e0af69f9142fc5cdee",
      "content": "func TestStorage_CleanupOldData_EmptyTables(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 1*time.Hour)\n\n\t// Run cleanup on empty database\n\terr := storage.CleanupOldData(ctx)\n\tif err != nil {\n\t\tt.Errorf(\"CleanupOldData on empty DB failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_CleanupOldData_MessagesAndTools_2216": {
      "name": "TestStorage_CleanupOldData_MessagesAndTools",
      "type": "function",
      "start_line": 2216,
      "end_line": 2272,
      "content_hash": "fd543edbaac15bf5eecbd01225857e6ecc28e9d2",
      "content": "func TestStorage_CleanupOldData_MessagesAndTools(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tstorage := NewStorage(db, 24*time.Hour)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"cleanup-agent\",\n\t\tName:         \"Cleanup Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tstorage.Agents.Create(ctx, agent)\n\n\t// Create task\n\ttask := &Task{\n\t\tID:        \"cleanup-task\",\n\t\tAgentID:   \"cleanup-agent\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"completed\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\tstorage.Tasks.Create(ctx, task)\n\n\t// Create message\n\tmsg := &Message{\n\t\tID:        \"cleanup-msg\",\n\t\tTaskID:    \"cleanup-task\",\n\t\tAgentID:   \"cleanup-agent\",\n\t\tType:      \"user\",\n\t\tContent:   \"test message\",\n\t\tCreatedAt: time.Now(),\n\t}\n\tstorage.Messages.Create(ctx, msg)\n\n\t// Create tool execution\n\ttool := &ToolExecution{\n\t\tID:       \"cleanup-tool\",\n\t\tTaskID:   \"cleanup-task\",\n\t\tAgentID:  \"cleanup-agent\",\n\t\tToolName: \"test-tool\",\n\t\tStatus:   \"completed\",\n\t}\n\tstorage.ToolExecutions.Create(ctx, tool)\n\n\t// Run cleanup\n\terr := storage.CleanupOldData(ctx)\n\tif err != nil {\n\t\tt.Errorf(\"CleanupOldData failed: %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDatabase_CreateTables_Idempotent_2273": {
      "name": "TestDatabase_CreateTables_Idempotent",
      "type": "function",
      "start_line": 2273,
      "end_line": 2301,
      "content_hash": "c04680a7accaa1950b2778cadf8ec1040607d4a4",
      "content": "func TestDatabase_CreateTables_Idempotent(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test_tables_idempotent.db\")\n\n\t// Create database twice\n\tadb1, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"First NewAgentDB failed: %v\", err)\n\t}\n\tadb1.Close()\n\n\t// Reopen - tables should already exist\n\tadb2, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Second NewAgentDB failed: %v\", err)\n\t}\n\tdefer adb2.Close()\n\n\t// Verify tables exist\n\tvar count int\n\terr = adb2.GetDB().QueryRow(\"SELECT COUNT(*) FROM sqlite_master WHERE type='table'\").Scan(&count)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to count tables: %v\", err)\n\t}\n\tif count == 0 {\n\t\tt.Error(\"No tables found after second init\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDatabase_Close_ErrorHandling_2302": {
      "name": "TestDatabase_Close_ErrorHandling",
      "type": "function",
      "start_line": 2302,
      "end_line": 2323,
      "content_hash": "2ca39debf35b879946c1bfed3bc4abf7989dcfae",
      "content": "func TestDatabase_Close_ErrorHandling(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test_close_error.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"NewAgentDB failed: %v\", err)\n\t}\n\n\t// Close successfully\n\terr = adb.Close()\n\tif err != nil {\n\t\tt.Errorf(\"First close failed: %v\", err)\n\t}\n\n\t// Close again - should not panic\n\terr = adb.Close()\n\tif err != nil {\n\t\tt.Logf(\"Second close returned error (may be expected): %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_ListByAgent_Pagination_2324": {
      "name": "TestTaskRepository_ListByAgent_Pagination",
      "type": "function",
      "start_line": 2324,
      "end_line": 2373,
      "content_hash": "0fb2668435330093aa459bd850a4b7b076c5c66d",
      "content": "func TestTaskRepository_ListByAgent_Pagination(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttaskRepo := NewTaskRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-pagination\",\n\t\tName:         \"Pagination Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\t// Create 10 tasks\n\tfor i := 0; i < 10; i++ {\n\t\ttask := &Task{\n\t\t\tID:        fmt.Sprintf(\"task-page-%d\", i),\n\t\t\tAgentID:   \"agent-pagination\",\n\t\t\tInput:     fmt.Sprintf(\"input %d\", i),\n\t\t\tStatus:    \"pending\",\n\t\t\tCreatedAt: time.Now(),\n\t\t\tUpdatedAt: time.Now(),\n\t\t}\n\t\ttaskRepo.Create(ctx, task)\n\t}\n\n\t// Test pagination\n\tpage1, err := taskRepo.ListByAgent(ctx, \"agent-pagination\", 5, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByAgent page 1 failed: %v\", err)\n\t}\n\tif len(page1) != 5 {\n\t\tt.Errorf(\"Expected 5 tasks in page 1, got %d\", len(page1))\n\t}\n\n\tpage2, err := taskRepo.ListByAgent(ctx, \"agent-pagination\", 5, 5)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByAgent page 2 failed: %v\", err)\n\t}\n\tif len(page2) != 5 {\n\t\tt.Errorf(\"Expected 5 tasks in page 2, got %d\", len(page2))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_Create_WithMetadata_2374": {
      "name": "TestTeamRepository_Create_WithMetadata",
      "type": "function",
      "start_line": 2374,
      "end_line": 2407,
      "content_hash": "58d95177fb7941e2873101e175965d4ea741ced3",
      "content": "func TestTeamRepository_Create_WithMetadata(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tteamRepo := NewTeamRepository(db)\n\n\t// Create team with metadata\n\tteam := &Team{\n\t\tID:          \"team-metadata\",\n\t\tName:        \"Metadata Team\",\n\t\tDescription: \"Team with metadata\",\n\t\tConfig:      `{\"setting\":\"value\"}`,\n\t\tMetadata:    map[string]interface{}{\"key\": \"value\", \"count\": 42},\n\t\tCreatedAt:   time.Now(),\n\t\tUpdatedAt:   time.Now(),\n\t}\n\n\terr := teamRepo.Create(ctx, team)\n\tif err != nil {\n\t\tt.Fatalf(\"Create failed: %v\", err)\n\t}\n\n\t// Verify creation\n\tretrieved, err := teamRepo.Get(ctx, \"team-metadata\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif retrieved.Name != \"Metadata Team\" {\n\t\tt.Errorf(\"Name mismatch: got %s\", retrieved.Name)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_Update_AllFields_2408": {
      "name": "TestTeamRepository_Update_AllFields",
      "type": "function",
      "start_line": 2408,
      "end_line": 2450,
      "content_hash": "5c21004a7ad95fbfdbbb2bea1f23f3a0ad3faafd",
      "content": "func TestTeamRepository_Update_AllFields(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tteamRepo := NewTeamRepository(db)\n\n\t// Create team\n\tteam := &Team{\n\t\tID:          \"team-update-all\",\n\t\tName:        \"Original Name\",\n\t\tDescription: \"Original Description\",\n\t\tConfig:      `{\"old\":\"value\"}`,\n\t\tCreatedAt:   time.Now(),\n\t\tUpdatedAt:   time.Now(),\n\t}\n\tteamRepo.Create(ctx, team)\n\n\t// Update all fields\n\tteam.Name = \"Updated Name\"\n\tteam.Description = \"Updated Description\"\n\tteam.Config = `{\"new\":\"value\"}`\n\tteam.Metadata = map[string]interface{}{\"updated\": true}\n\n\terr := teamRepo.Update(ctx, team)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Verify updates\n\tupdated, err := teamRepo.Get(ctx, \"team-update-all\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif updated.Name != \"Updated Name\" {\n\t\tt.Errorf(\"Name not updated\")\n\t}\n\tif updated.Description != \"Updated Description\" {\n\t\tt.Errorf(\"Description not updated\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_Delete_Verified_2451": {
      "name": "TestTeamRepository_Delete_Verified",
      "type": "function",
      "start_line": 2451,
      "end_line": 2480,
      "content_hash": "35124c402a9f868179293fe4fef93d06b66b7e2e",
      "content": "func TestTeamRepository_Delete_Verified(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tteamRepo := NewTeamRepository(db)\n\n\t// Create team\n\tteam := &Team{\n\t\tID:          \"team-delete\",\n\t\tName:        \"Delete Me\",\n\t\tDescription: \"To be deleted\",\n\t\tCreatedAt:   time.Now(),\n\t\tUpdatedAt:   time.Now(),\n\t}\n\tteamRepo.Create(ctx, team)\n\n\t// Delete team\n\terr := teamRepo.Delete(ctx, \"team-delete\")\n\tif err != nil {\n\t\tt.Fatalf(\"Delete failed: %v\", err)\n\t}\n\n\t// Verify deletion\n\t_, err = teamRepo.Get(ctx, \"team-delete\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when getting deleted team\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_List_Multiple_2481": {
      "name": "TestTeamRepository_List_Multiple",
      "type": "function",
      "start_line": 2481,
      "end_line": 2510,
      "content_hash": "712240744547f37c2636a52a1df9134744f2d6a3",
      "content": "func TestTeamRepository_List_Multiple(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\tteamRepo := NewTeamRepository(db)\n\n\t// Create multiple teams\n\tfor i := 0; i < 5; i++ {\n\t\tteam := &Team{\n\t\t\tID:          fmt.Sprintf(\"team-list-%d\", i),\n\t\t\tName:        fmt.Sprintf(\"Team %d\", i),\n\t\t\tDescription: fmt.Sprintf(\"Description %d\", i),\n\t\t\tCreatedAt:   time.Now(),\n\t\t\tUpdatedAt:   time.Now(),\n\t\t}\n\t\tteamRepo.Create(ctx, team)\n\t}\n\n\t// List all teams\n\tteams, err := teamRepo.List(ctx, 100, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"List failed: %v\", err)\n\t}\n\n\tif len(teams) < 5 {\n\t\tt.Errorf(\"Expected at least 5 teams, got %d\", len(teams))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_Create_Complete_2511": {
      "name": "TestToolExecutionRepository_Create_Complete",
      "type": "function",
      "start_line": 2511,
      "end_line": 2573,
      "content_hash": "f5be0176abc611d2eb198ec96eeff0ccab6b215f",
      "content": "func TestToolExecutionRepository_Create_Complete(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttoolRepo := NewToolExecutionRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create dependencies\n\tagent := &Agent{\n\t\tID:           \"agent-tool-exec\",\n\t\tName:         \"Tool Exec Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-tool-exec\",\n\t\tAgentID:   \"agent-tool-exec\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"running\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create tool execution with all fields\n\ttoolExec := &ToolExecution{\n\t\tID:       \"tool-complete\",\n\t\tTaskID:   \"task-tool-exec\",\n\t\tAgentID:  \"agent-tool-exec\",\n\t\tToolName: \"test-tool\",\n\t\tToolType: \"function\",\n\t\tInput:    `{\"param\":\"value\"}`,\n\t\tOutput:   `{\"result\":\"success\"}`,\n\t\tError:    \"\",\n\t\tStatus:   \"completed\",\n\t\tDuration: 150,\n\t}\n\n\terr := toolRepo.Create(ctx, toolExec)\n\tif err != nil {\n\t\tt.Fatalf(\"Create failed: %v\", err)\n\t}\n\n\t// Verify creation\n\tretrieved, err := toolRepo.Get(ctx, \"tool-complete\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif retrieved.ToolName != \"test-tool\" {\n\t\tt.Errorf(\"ToolName mismatch\")\n\t}\n\tif retrieved.Duration != 150 {\n\t\tt.Errorf(\"Duration mismatch\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_Update_Complete_2574": {
      "name": "TestToolExecutionRepository_Update_Complete",
      "type": "function",
      "start_line": 2574,
      "end_line": 2637,
      "content_hash": "611ddef3d56431634626f3f14c6495e1b20ff803",
      "content": "func TestToolExecutionRepository_Update_Complete(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttoolRepo := NewToolExecutionRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create dependencies\n\tagent := &Agent{\n\t\tID:           \"agent-tool-update\",\n\t\tName:         \"Tool Update Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-tool-update\",\n\t\tAgentID:   \"agent-tool-update\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"running\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create tool execution\n\ttoolExec := &ToolExecution{\n\t\tID:       \"tool-update\",\n\t\tTaskID:   \"task-tool-update\",\n\t\tAgentID:  \"agent-tool-update\",\n\t\tToolName: \"test-tool\",\n\t\tStatus:   \"running\",\n\t}\n\ttoolRepo.Create(ctx, toolExec)\n\n\t// Update tool execution\n\ttoolExec.Status = \"completed\"\n\ttoolExec.Output = `{\"result\":\"done\"}`\n\ttoolExec.Duration = 200\n\n\terr := toolRepo.Update(ctx, toolExec)\n\tif err != nil {\n\t\tt.Fatalf(\"Update failed: %v\", err)\n\t}\n\n\t// Verify update\n\tupdated, err := toolRepo.Get(ctx, \"tool-update\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif updated.Status != \"completed\" {\n\t\tt.Errorf(\"Status not updated\")\n\t}\n\tif updated.Duration != 200 {\n\t\tt.Errorf(\"Duration not updated\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_MarkFailed_2638": {
      "name": "TestToolExecutionRepository_MarkFailed",
      "type": "function",
      "start_line": 2638,
      "end_line": 2697,
      "content_hash": "7b3a3ee913af48c3126ce0c9ceebddfb35b76e4b",
      "content": "func TestToolExecutionRepository_MarkFailed(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttoolRepo := NewToolExecutionRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create dependencies\n\tagent := &Agent{\n\t\tID:           \"agent-tool-fail\",\n\t\tName:         \"Tool Fail Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-tool-fail\",\n\t\tAgentID:   \"agent-tool-fail\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"running\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create tool execution\n\ttoolExec := &ToolExecution{\n\t\tID:       \"tool-fail\",\n\t\tTaskID:   \"task-tool-fail\",\n\t\tAgentID:  \"agent-tool-fail\",\n\t\tToolName: \"failing-tool\",\n\t\tStatus:   \"running\",\n\t}\n\ttoolRepo.Create(ctx, toolExec)\n\n\t// Mark as failed\n\terr := toolRepo.MarkFailed(ctx, \"tool-fail\", \"Something went wrong\", 100)\n\tif err != nil {\n\t\tt.Fatalf(\"MarkFailed failed: %v\", err)\n\t}\n\n\t// Verify failure status\n\tfailed, err := toolRepo.Get(ctx, \"tool-fail\")\n\tif err != nil {\n\t\tt.Fatalf(\"Get failed: %v\", err)\n\t}\n\n\tif failed.Status != \"failed\" {\n\t\tt.Errorf(\"Status should be failed, got %s\", failed.Status)\n\t}\n\tif failed.Error != \"Something went wrong\" {\n\t\tt.Errorf(\"Error message not set correctly\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_ListByAgent_2698": {
      "name": "TestToolExecutionRepository_ListByAgent",
      "type": "function",
      "start_line": 2698,
      "end_line": 2750,
      "content_hash": "b28b29ca7b0e0af760d480a1278fb4028068dbec",
      "content": "func TestToolExecutionRepository_ListByAgent(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttoolRepo := NewToolExecutionRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-tool-list\",\n\t\tName:         \"Tool List Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-tool-list\",\n\t\tAgentID:   \"agent-tool-list\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"running\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create multiple tool executions\n\tfor i := 0; i < 3; i++ {\n\t\ttoolExec := &ToolExecution{\n\t\t\tID:       fmt.Sprintf(\"tool-list-%d\", i),\n\t\t\tTaskID:   \"task-tool-list\",\n\t\t\tAgentID:  \"agent-tool-list\",\n\t\t\tToolName: fmt.Sprintf(\"tool-%d\", i),\n\t\t\tStatus:   \"completed\",\n\t\t}\n\t\ttoolRepo.Create(ctx, toolExec)\n\t}\n\n\t// List by agent\n\texecutions, err := toolRepo.ListByAgent(ctx, \"agent-tool-list\", 100, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByAgent failed: %v\", err)\n\t}\n\n\tif len(executions) < 3 {\n\t\tt.Errorf(\"Expected at least 3 executions, got %d\", len(executions))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_ListByTool_2751": {
      "name": "TestToolExecutionRepository_ListByTool",
      "type": "function",
      "start_line": 2751,
      "end_line": 2810,
      "content_hash": "240107923ce6562a8f68b9adb8fc9c1156404358",
      "content": "func TestToolExecutionRepository_ListByTool(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx := context.Background()\n\ttoolRepo := NewToolExecutionRepository(db)\n\tagentRepo := NewAgentRepository(db)\n\ttaskRepo := NewTaskRepository(db)\n\n\t// Create agent\n\tagent := &Agent{\n\t\tID:           \"agent-tool-name\",\n\t\tName:         \"Tool Name Agent\",\n\t\tCapabilities: []string{\"test\"},\n\t\tStatus:       \"idle\",\n\t\tCreatedAt:    time.Now(),\n\t\tUpdatedAt:    time.Now(),\n\t}\n\tagentRepo.Create(ctx, agent)\n\n\ttask := &Task{\n\t\tID:        \"task-tool-name\",\n\t\tAgentID:   \"agent-tool-name\",\n\t\tInput:     \"test\",\n\t\tStatus:    \"running\",\n\t\tCreatedAt: time.Now(),\n\t\tUpdatedAt: time.Now(),\n\t}\n\ttaskRepo.Create(ctx, task)\n\n\t// Create executions for specific tool\n\tfor i := 0; i < 3; i++ {\n\t\ttoolExec := &ToolExecution{\n\t\t\tID:       fmt.Sprintf(\"tool-specific-%d\", i),\n\t\t\tTaskID:   \"task-tool-name\",\n\t\t\tAgentID:  \"agent-tool-name\",\n\t\t\tToolName: \"specific-tool\",\n\t\t\tStatus:   \"completed\",\n\t\t}\n\t\ttoolRepo.Create(ctx, toolExec)\n\t}\n\n\t// List by tool name\n\texecutions, err := toolRepo.ListByTool(ctx, \"specific-tool\", 100, 0)\n\tif err != nil {\n\t\tt.Fatalf(\"ListByTool failed: %v\", err)\n\t}\n\n\tif len(executions) < 3 {\n\t\tt.Errorf(\"Expected at least 3 executions for specific-tool, got %d\", len(executions))\n\t}\n\n\t// Verify all are for the right tool\n\tfor _, exec := range executions {\n\t\tif exec.ToolName != \"specific-tool\" {\n\t\t\tt.Errorf(\"Expected tool name 'specific-tool', got %s\", exec.ToolName)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestNewAgentDB_Success_2811": {
      "name": "TestNewAgentDB_Success",
      "type": "function",
      "start_line": 2811,
      "end_line": 2832,
      "content_hash": "6cea2d786254b050e53b4e8d03c20aa4d610b2e1",
      "content": "func TestNewAgentDB_Success(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"NewAgentDB failed: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\t// Verify all tables exist\n\ttables := []string{\"agents\", \"tasks\", \"messages\", \"teams\", \"team_members\", \"tool_executions\", \"schema_migrations\", \"agent_stats\"}\n\tdb := adb.GetDB()\n\tfor _, table := range tables {\n\t\tvar count int\n\t\terr := db.QueryRow(\"SELECT COUNT(*) FROM \" + table).Scan(&count)\n\t\tif err != nil {\n\t\t\tt.Errorf(\"Failed to query table %s: %v\", table, err)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_Delete_ContextCancel_2833": {
      "name": "TestTaskRepository_Delete_ContextCancel",
      "type": "function",
      "start_line": 2833,
      "end_line": 2846,
      "content_hash": "660c6f3cc729eea16c07d09a423c5145b446c0c0",
      "content": "func TestTaskRepository_Delete_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\trepo := NewTaskRepository(db)\n\n\terr := repo.Delete(ctx, \"nonexistent\")\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_UpdateStatus_ContextCancel_2847": {
      "name": "TestTaskRepository_UpdateStatus_ContextCancel",
      "type": "function",
      "start_line": 2847,
      "end_line": 2860,
      "content_hash": "d7bbce043d132399391cd45efedc25fe57a509b8",
      "content": "func TestTaskRepository_UpdateStatus_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\trepo := NewTaskRepository(db)\n\n\terr := repo.UpdateStatus(ctx, \"nonexistent\", \"idle\")\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_RemoveMember_ContextCancel_2861": {
      "name": "TestTeamRepository_RemoveMember_ContextCancel",
      "type": "function",
      "start_line": 2861,
      "end_line": 2874,
      "content_hash": "02565c9a445fd1ae8d273d51bcee0934ad0b15a8",
      "content": "func TestTeamRepository_RemoveMember_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\trepo := NewTeamRepository(db)\n\n\terr := repo.RemoveMember(ctx, \"nonexistent-team\", \"nonexistent-agent\")\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_UpdateMemberRole_ContextCancel_2875": {
      "name": "TestTeamRepository_UpdateMemberRole_ContextCancel",
      "type": "function",
      "start_line": 2875,
      "end_line": 2888,
      "content_hash": "6ee8784dd05c42ac45115e4808d566d9da6bc1d7",
      "content": "func TestTeamRepository_UpdateMemberRole_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\trepo := NewTeamRepository(db)\n\n\terr := repo.UpdateMemberRole(ctx, \"nonexistent-team\", \"nonexistent-agent\", \"admin\")\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_MarkCompleted_ContextCancel_2889": {
      "name": "TestToolExecutionRepository_MarkCompleted_ContextCancel",
      "type": "function",
      "start_line": 2889,
      "end_line": 2902,
      "content_hash": "1e1f8dac826e7530940ecb505974dd90986b5b20",
      "content": "func TestToolExecutionRepository_MarkCompleted_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\trepo := NewToolExecutionRepository(db)\n\n\terr := repo.MarkCompleted(ctx, \"nonexistent\", \"output\", \"completed\", 100)\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_MarkFailed_ContextCancel_2903": {
      "name": "TestToolExecutionRepository_MarkFailed_ContextCancel",
      "type": "function",
      "start_line": 2903,
      "end_line": 2916,
      "content_hash": "208f4ac3a89f044bd768e823a5766bdb876da10d",
      "content": "func TestToolExecutionRepository_MarkFailed_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\trepo := NewToolExecutionRepository(db)\n\n\terr := repo.MarkFailed(ctx, \"nonexistent\", \"error msg\", 100)\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_InitializeZeroState_ContextCancel_2917": {
      "name": "TestStorage_InitializeZeroState_ContextCancel",
      "type": "function",
      "start_line": 2917,
      "end_line": 2939,
      "content_hash": "ce597a04e35208f44419657f3d3d59547981dae6",
      "content": "func TestStorage_InitializeZeroState_ContextCancel(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"NewAgentDB failed: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\ts := NewStorage(adb.GetDB(), time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\n\terr = s.InitializeZeroState(ctx)\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n\n// Phase 3: Additional coverage for low-coverage functions\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_GetAgentTeams_MultipleTeamsWithMetadata_2940": {
      "name": "TestTeamRepository_GetAgentTeams_MultipleTeamsWithMetadata",
      "type": "function",
      "start_line": 2940,
      "end_line": 2996,
      "content_hash": "de26762b7a9c9580d2e19cd63e1e2664d1a0ac32",
      "content": "func TestTeamRepository_GetAgentTeams_MultipleTeamsWithMetadata(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\tctx := context.Background()\n\n\t// Create agent\n\tagent := s.NewAgentWithDefaults(\"test-agent\", \"test\", nil)\n\tif err := s.Agents.Create(ctx, agent); err != nil {\n\t\tt.Fatalf(\"Create agent: %v\", err)\n\t}\n\n\t// Create teams with metadata\n\tteam1 := s.NewTeamWithDefaults(\"team1\", \"Team 1\")\n\tteam1.Metadata = map[string]interface{}{\"priority\": \"high\", \"type\": \"dev\"}\n\tif err := s.Teams.Create(ctx, team1); err != nil {\n\t\tt.Fatalf(\"Create team1: %v\", err)\n\t}\n\n\tteam2 := s.NewTeamWithDefaults(\"team2\", \"Team 2\")\n\tteam2.Metadata = map[string]interface{}{\"priority\": \"low\", \"type\": \"ops\"}\n\tif err := s.Teams.Create(ctx, team2); err != nil {\n\t\tt.Fatalf(\"Create team2: %v\", err)\n\t}\n\n\t// Add agent to teams with different roles\n\tif err := s.Teams.AddMember(ctx, team1.ID, agent.ID, \"member\"); err != nil {\n\t\tt.Fatalf(\"Add to team1: %v\", err)\n\t}\n\tif err := s.Teams.AddMember(ctx, team2.ID, agent.ID, \"leader\"); err != nil {\n\t\tt.Fatalf(\"Add to team2: %v\", err)\n\t}\n\n\t// Get agent's teams - this covers the query path and metadata deserialization\n\tteams, err := s.Teams.GetAgentTeams(ctx, agent.ID)\n\tif err != nil {\n\t\tt.Fatalf(\"GetAgentTeams: %v\", err)\n\t}\n\n\tif len(teams) != 2 {\n\t\tt.Fatalf(\"Expected 2 teams, got %d\", len(teams))\n\t}\n\n\t// Verify metadata deserialization\n\tfor _, team := range teams {\n\t\tif team.Metadata == nil {\n\t\t\tt.Error(\"Expected metadata to be deserialized\")\n\t\t}\n\t\tif team.ID == team1.ID {\n\t\t\tif team.Metadata[\"priority\"] != \"high\" {\n\t\t\t\tt.Errorf(\"Expected priority=high for team1, got %v\", team.Metadata[\"priority\"])\n\t\t\t}\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_GetAgentTeams_NoMemberships_2997": {
      "name": "TestTeamRepository_GetAgentTeams_NoMemberships",
      "type": "function",
      "start_line": 2997,
      "end_line": 3020,
      "content_hash": "bf58d8dff871c67ca1836ffe750562aa5a9277e0",
      "content": "func TestTeamRepository_GetAgentTeams_NoMemberships(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\tctx := context.Background()\n\n\t// Create agent but don't add to any teams\n\tagent := s.NewAgentWithDefaults(\"solo-agent\", \"test\", nil)\n\tif err := s.Agents.Create(ctx, agent); err != nil {\n\t\tt.Fatalf(\"Create agent: %v\", err)\n\t}\n\n\t// Should return empty list, not error\n\tteams, err := s.Teams.GetAgentTeams(ctx, agent.ID)\n\tif err != nil {\n\t\tt.Fatalf(\"GetAgentTeams should not error on no teams: %v\", err)\n\t}\n\n\tif len(teams) != 0 {\n\t\tt.Errorf(\"Expected 0 teams for agent with no memberships, got %d\", len(teams))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_CleanupOldData_ContextCancel_3021": {
      "name": "TestStorage_CleanupOldData_ContextCancel",
      "type": "function",
      "start_line": 3021,
      "end_line": 3035,
      "content_hash": "34e23adde095393f0dc077f51bdbd24bbef2d9e4",
      "content": "func TestStorage_CleanupOldData_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel() // Cancel immediately\n\n\terr := s.CleanupOldData(ctx)\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Errorf(\"Expected context canceled error, got %v\", err)\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestStorage_Close_NilDB_3036": {
      "name": "TestStorage_Close_NilDB",
      "type": "function",
      "start_line": 3036,
      "end_line": 3045,
      "content_hash": "5a6dc570a60bd66f1a6b46cb0a959489a10b44ac",
      "content": "func TestStorage_Close_NilDB(t *testing.T) {\n\ts := &Storage{db: nil}\n\terr := s.Close()\n\tif err != nil {\n\t\tt.Errorf(\"Close with nil db should not error, got %v\", err)\n\t}\n}\n\n// Phase 4: Final push to 81%+\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentDB_Close_DoubleClose_3046": {
      "name": "TestAgentDB_Close_DoubleClose",
      "type": "function",
      "start_line": 3046,
      "end_line": 3063,
      "content_hash": "ca3d2e2afffd75af00a96bc79bd2505db1182faa",
      "content": "func TestAgentDB_Close_DoubleClose(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"NewAgentDB failed: %v\", err)\n\t}\n\n\terr = adb.Close()\n\tif err != nil {\n\t\tt.Errorf(\"First close failed: %v\", err)\n\t}\n\n\t// Closing again should not panic\n\t_ = adb.Close()\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_Get_NotFound_3064": {
      "name": "TestToolExecutionRepository_Get_NotFound",
      "type": "function",
      "start_line": 3064,
      "end_line": 3076,
      "content_hash": "3949d3315295518a866359c5dc1e6624a4532e70",
      "content": "func TestToolExecutionRepository_Get_NotFound(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\tctx := context.Background()\n\n\t_, err := s.ToolExecutions.Get(ctx, \"nonexistent-id\")\n\tif err == nil {\n\t\tt.Error(\"Expected error for nonexistent tool execution\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_Update_AllFields_3077": {
      "name": "TestToolExecutionRepository_Update_AllFields",
      "type": "function",
      "start_line": 3077,
      "end_line": 3137,
      "content_hash": "8818b6d5534f3fa355b403243d55a059f64a8350",
      "content": "func TestToolExecutionRepository_Update_AllFields(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\tctx := context.Background()\n\n\t// Create agent\n\tagent := s.NewAgentWithDefaults(\"test-agent\", \"test\", nil)\n\tif err := s.Agents.Create(ctx, agent); err != nil {\n\t\tt.Fatalf(\"Create agent: %v\", err)\n\t}\n\n\t// Create tool execution\n\ttoolExec := &ToolExecution{\n\t\tID:        \"test-exec\",\n\t\tAgentID:   agent.ID,\n\t\tToolName:  \"test-tool\",\n\t\tToolType:  \"test\",\n\t\tStatus:    \"pending\",\n\t\tStartedAt: time.Now(),\n\t\tMetadata:  map[string]interface{}{\"key\": \"value\"},\n\t}\n\tif err := s.ToolExecutions.Create(ctx, toolExec); err != nil {\n\t\tt.Fatalf(\"Create: %v\", err)\n\t}\n\n\t// Update all fields\n\ttoolExec.Status = \"completed\"\n\ttoolExec.Output = \"success output\"\n\ttoolExec.Duration = 1234\n\ttoolExec.Metadata[\"updated\"] = true\n\tcompletedAt := time.Now()\n\ttoolExec.CompletedAt = &completedAt\n\n\tif err := s.ToolExecutions.Update(ctx, toolExec); err != nil {\n\t\tt.Fatalf(\"Update: %v\", err)\n\t}\n\n\t// Verify all fields updated\n\tretrieved, err := s.ToolExecutions.Get(ctx, toolExec.ID)\n\tif err != nil {\n\t\tt.Fatalf(\"Get: %v\", err)\n\t}\n\n\tif retrieved.Status != \"completed\" {\n\t\tt.Errorf(\"Expected status completed, got %s\", retrieved.Status)\n\t}\n\tif retrieved.Output != \"success output\" {\n\t\tt.Errorf(\"Expected output, got %s\", retrieved.Output)\n\t}\n\tif retrieved.Duration != 1234 {\n\t\tt.Errorf(\"Expected duration 1234, got %d\", retrieved.Duration)\n\t}\n\tif retrieved.Metadata[\"updated\"] != true {\n\t\tt.Error(\"Expected updated=true in metadata\")\n\t}\n}\n\n// Phase 5: Push to 82%+\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTaskRepository_Update_ContextCancel_3138": {
      "name": "TestTaskRepository_Update_ContextCancel",
      "type": "function",
      "start_line": 3138,
      "end_line": 3153,
      "content_hash": "c08b5a6890035f3a481102409a6cc53a40b496f7",
      "content": "func TestTaskRepository_Update_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel() // Cancel immediately\n\n\ttask := s.NewTaskWithDefaults(\"agent-id\", \"task-type\", \"input\", 1)\n\terr := s.Tasks.Update(ctx, task)\n\tif err == nil {\n\t\tt.Error(\"Expected context canceled error\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_Update_ContextCancel_3154": {
      "name": "TestTeamRepository_Update_ContextCancel",
      "type": "function",
      "start_line": 3154,
      "end_line": 3169,
      "content_hash": "ae2aae7b1e05153cff8de493dbd5556be61d51f1",
      "content": "func TestTeamRepository_Update_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\n\tteam := s.NewTeamWithDefaults(\"team-name\", \"description\")\n\terr := s.Teams.Update(ctx, team)\n\tif err == nil {\n\t\tt.Error(\"Expected context canceled error\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_Delete_ContextCancel_3170": {
      "name": "TestTeamRepository_Delete_ContextCancel",
      "type": "function",
      "start_line": 3170,
      "end_line": 3184,
      "content_hash": "5a33bf2602c31c7c492e5c15da1f357ccdf78560",
      "content": "func TestTeamRepository_Delete_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\n\terr := s.Teams.Delete(ctx, \"team-id\")\n\tif err == nil {\n\t\tt.Error(\"Expected context canceled error\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_Update_ContextCancel_3185": {
      "name": "TestToolExecutionRepository_Update_ContextCancel",
      "type": "function",
      "start_line": 3185,
      "end_line": 3206,
      "content_hash": "5811d020c94fc2101ef85bd51096893739e67ccd",
      "content": "func TestToolExecutionRepository_Update_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\n\ttoolExec := &ToolExecution{\n\t\tID:        \"test-id\",\n\t\tAgentID:   \"agent-id\",\n\t\tToolName:  \"tool\",\n\t\tStatus:    \"pending\",\n\t\tStartedAt: time.Now(),\n\t}\n\terr := s.ToolExecutions.Update(ctx, toolExec)\n\tif err == nil {\n\t\tt.Error(\"Expected context canceled error\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_Delete_ContextCancel_3207": {
      "name": "TestAgentRepository_Delete_ContextCancel",
      "type": "function",
      "start_line": 3207,
      "end_line": 3221,
      "content_hash": "bea4d083cfbd99a729b91de66dc5050cf4a4fa13",
      "content": "func TestAgentRepository_Delete_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel()\n\n\terr := s.Agents.Delete(ctx, \"agent-id\")\n\tif err == nil {\n\t\tt.Error(\"Expected context canceled error\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestAgentRepository_UpdateStatus_ContextCancel_3222": {
      "name": "TestAgentRepository_UpdateStatus_ContextCancel",
      "type": "function",
      "start_line": 3222,
      "end_line": 3236,
      "content_hash": "2f6696c338d4c87b0e04d4f6a86e0b115e7f3c42",
      "content": "func TestAgentRepository_UpdateStatus_ContextCancel(t *testing.T) {\n\tdb, _ := setupTestDB(t)\n\tdefer db.Close()\n\n\ts := NewStorage(db, time.Hour)\n\n\tctx, cancel := context.WithCancel(context.Background())\n\tcancel() // Cancel immediately\n\n\terr := s.Agents.UpdateStatus(ctx, \"test-agent\", \"active\")\n\tif err == nil || !strings.Contains(err.Error(), \"context\") {\n\t\tt.Error(\"Expected context cancellation error\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_AddMember_Errors_3237": {
      "name": "TestTeamRepository_AddMember_Errors",
      "type": "function",
      "start_line": 3237,
      "end_line": 3255,
      "content_hash": "584e2fba7e679f2465ba5658b40386795e792a35",
      "content": "func TestTeamRepository_AddMember_Errors(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create test database: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\tteamRepo := NewTeamRepository(adb.GetDB())\n\n\t// Test adding member to non-existent team\n\tctx := context.Background()\n\terr = teamRepo.AddMember(ctx, \"non-existent-team\", \"agent-1\", \"member\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when adding member to non-existent team\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_RemoveMember_Errors_3256": {
      "name": "TestTeamRepository_RemoveMember_Errors",
      "type": "function",
      "start_line": 3256,
      "end_line": 3274,
      "content_hash": "5edac52f6e178294ff5bfe229aacda78ffc6a56a",
      "content": "func TestTeamRepository_RemoveMember_Errors(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create test database: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\tteamRepo := NewTeamRepository(adb.GetDB())\n\n\t// Test removing member from non-existent team\n\tctx := context.Background()\n\terr = teamRepo.RemoveMember(ctx, \"non-existent-team\", \"agent-1\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when removing member from non-existent team\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestTeamRepository_UpdateMemberRole_Errors_3275": {
      "name": "TestTeamRepository_UpdateMemberRole_Errors",
      "type": "function",
      "start_line": 3275,
      "end_line": 3293,
      "content_hash": "ee1870bdbf2b585a8d0c573baf62cad182204b83",
      "content": "func TestTeamRepository_UpdateMemberRole_Errors(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create test database: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\tteamRepo := NewTeamRepository(adb.GetDB())\n\n\t// Test updating role for non-existent membership\n\tctx := context.Background()\n\terr = teamRepo.UpdateMemberRole(ctx, \"non-existent-team\", \"agent-1\", \"admin\")\n\tif err == nil {\n\t\tt.Error(\"Expected error when updating non-existent membership\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_MarkCompleted_Errors_3294": {
      "name": "TestToolExecutionRepository_MarkCompleted_Errors",
      "type": "function",
      "start_line": 3294,
      "end_line": 3312,
      "content_hash": "0b8602394c8714b59f6b862c13742b0fa933ee1d",
      "content": "func TestToolExecutionRepository_MarkCompleted_Errors(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create test database: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\ttoolRepo := NewToolExecutionRepository(adb.GetDB())\n\n\t// Test marking non-existent execution as completed\n\tctx := context.Background()\n\terr = toolRepo.MarkCompleted(ctx, \"non-existent-id\", \"success\", \"completed\", 100)\n\tif err == nil {\n\t\tt.Error(\"Expected error when marking non-existent execution as completed\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_MarkFailed_Errors_3313": {
      "name": "TestToolExecutionRepository_MarkFailed_Errors",
      "type": "function",
      "start_line": 3313,
      "end_line": 3331,
      "content_hash": "1c239fb3a3f4e00582b02bf905460f7457bda423",
      "content": "func TestToolExecutionRepository_MarkFailed_Errors(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create test database: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\ttoolRepo := NewToolExecutionRepository(adb.GetDB())\n\n\t// Test marking non-existent execution as failed\n\tctx := context.Background()\n\terr = toolRepo.MarkFailed(ctx, \"non-existent-id\", \"test error\", 100)\n\tif err == nil {\n\t\tt.Error(\"Expected error when marking non-existent execution as failed\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestToolExecutionRepository_DeleteByTask_Success_3332": {
      "name": "TestToolExecutionRepository_DeleteByTask_Success",
      "type": "function",
      "start_line": 3332,
      "end_line": 3382,
      "content_hash": "2c540a2f83f469d9a08cddfd82c0a8cdff8dfc58",
      "content": "func TestToolExecutionRepository_DeleteByTask_Success(t *testing.T) {\n\ttempDir := t.TempDir()\n\tdbPath := filepath.Join(tempDir, \"test.db\")\n\tadb, err := NewAgentDB(dbPath)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to create test database: %v\", err)\n\t}\n\tdefer adb.Close()\n\n\ttoolRepo := NewToolExecutionRepository(adb.GetDB())\n\ttaskRepo := NewTaskRepository(adb.GetDB())\n\tagentRepo := NewAgentRepository(adb.GetDB())\n\n\t// Create task and agent\n\tctx := context.Background()\n\tagent := &Agent{ID: \"agent-1\", Name: \"Test Agent\"}\n\tif err := agentRepo.Create(ctx, agent); err != nil {\n\t\tt.Fatalf(\"Failed to create agent: %v\", err)\n\t}\n\n\ttask := &Task{ID: \"task-1\", AgentID: \"agent-1\", Status: \"pending\"}\n\tif err := taskRepo.Create(ctx, task); err != nil {\n\t\tt.Fatalf(\"Failed to create task: %v\", err)\n\t}\n\n\t// Create tool execution\n\texecution := &ToolExecution{\n\t\tID:       \"exec-1\",\n\t\tTaskID:   \"task-1\",\n\t\tAgentID:  \"agent-1\",\n\t\tToolName: \"test-tool\",\n\t\tStatus:   \"completed\",\n\t}\n\tif err := toolRepo.Create(ctx, execution); err != nil {\n\t\tt.Fatalf(\"Failed to create execution: %v\", err)\n\t}\n\n\t// Delete by task\n\tif err := toolRepo.DeleteByTask(ctx, \"task-1\"); err != nil {\n\t\tt.Errorf(\"DeleteByTask failed: %v\", err)\n\t}\n\n\t// Verify deleted\n\texecutions, err := toolRepo.ListByTask(ctx, \"task-1\", 10, 0)\n\tif err != nil {\n\t\tt.Errorf(\"ListByTask failed: %v\", err)\n\t}\n\tif len(executions) != 0 {\n\t\tt.Errorf(\"Expected 0 executions after delete, got %d\", len(executions))\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}