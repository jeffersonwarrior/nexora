{
  "file_path": "/work/internal/aiops/aiops.go",
  "file_hash": "a601222340cd8fa3992e5ef22927ca58a57d3426",
  "updated_at": "2025-12-26T17:34:20.132023",
  "symbols": {
    "struct_ToolCall_14": {
      "name": "ToolCall",
      "type": "struct",
      "start_line": 14,
      "end_line": 23,
      "content_hash": "61b915b401c0e3bf780ab93ff8eb3c65db888edd",
      "content": "type ToolCall struct {\n\tID        string         `json:\"id\"`\n\tName      string         `json:\"name\"`\n\tParams    map[string]any `json:\"params\"`\n\tResult    string         `json:\"result,omitempty\"`\n\tError     string         `json:\"error,omitempty\"`\n\tTimestamp time.Time      `json:\"timestamp\"`\n}\n\n// Action represents a high-level action taken by the agent.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_Action_24": {
      "name": "Action",
      "type": "struct",
      "start_line": 24,
      "end_line": 30,
      "content_hash": "6cdeb470d6c7d868e2f7ae78b52363e105b6133d",
      "content": "type Action struct {\n\tDescription string     `json:\"description\"`\n\tToolCalls   []ToolCall `json:\"tool_calls,omitempty\"`\n\tTimestamp   time.Time  `json:\"timestamp\"`\n}\n\n// EditResolution contains the result of resolving a fuzzy edit.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_EditResolution_31": {
      "name": "EditResolution",
      "type": "struct",
      "start_line": 31,
      "end_line": 38,
      "content_hash": "f6a710b25488ae94d762d90cb63e2a0ff4a20a82",
      "content": "type EditResolution struct {\n\tExactOldString string  `json:\"exact_old_string\"`\n\tConfidence     float64 `json:\"confidence\"`\n\tLineNumber     int     `json:\"line_number,omitempty\"`\n\tContext        string  `json:\"context,omitempty\"`\n}\n\n// LoopDetection contains the result of loop detection analysis.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_LoopDetection_39": {
      "name": "LoopDetection",
      "type": "struct",
      "start_line": 39,
      "end_line": 47,
      "content_hash": "9c0794fb354511ad6ef05bfbce9ca2656a916838",
      "content": "type LoopDetection struct {\n\tIsLooping   bool   `json:\"is_looping\"`\n\tReason      string `json:\"reason,omitempty\"`\n\tSuggestion  string `json:\"suggestion,omitempty\"`\n\tIterations  int    `json:\"iterations\"`\n\tPatternType string `json:\"pattern_type,omitempty\"` // \"repetition\", \"oscillation\", \"no_progress\"\n}\n\n// DriftDetection contains the result of task drift analysis.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_DriftDetection_48": {
      "name": "DriftDetection",
      "type": "struct",
      "start_line": 48,
      "end_line": 56,
      "content_hash": "a95a8f63bf4b6d494eb389a41ccfbe4755f74823",
      "content": "type DriftDetection struct {\n\tIsDrifting   bool    `json:\"is_drifting\"`\n\tReason       string  `json:\"reason,omitempty\"`\n\tSuggestion   string  `json:\"suggestion,omitempty\"`\n\tDriftScore   float64 `json:\"drift_score\"` // 0.0 = on track, 1.0 = completely off\n\tOriginalTask string  `json:\"original_task,omitempty\"`\n}\n\n// ValidationResult contains the result of tool call validation.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_ValidationResult_57": {
      "name": "ValidationResult",
      "type": "struct",
      "start_line": 57,
      "end_line": 64,
      "content_hash": "2d6ca79bffd597fc7dfa0181759f1578b4fec50a",
      "content": "type ValidationResult struct {\n\tValid       bool           `json:\"valid\"`\n\tErrors      []string       `json:\"errors,omitempty\"`\n\tWarnings    []string       `json:\"warnings,omitempty\"`\n\tFixedParams map[string]any `json:\"fixed_params,omitempty\"`\n}\n\n// ModelInfo contains information about the local model.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_ModelInfo_65": {
      "name": "ModelInfo",
      "type": "struct",
      "start_line": 65,
      "end_line": 72,
      "content_hash": "73a0f20b461b709c51c43aa5798faa406054c782",
      "content": "type ModelInfo struct {\n\tName      string        `json:\"name\"`\n\tRuntime   string        `json:\"runtime\"` // \"ollama\", \"llamacpp\", \"mlx\"\n\tAvailable bool          `json:\"available\"`\n\tLatency   time.Duration `json:\"latency,omitempty\"`\n}\n\n// ScriptPlan describes a batched operation plan.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_ScriptPlan_73": {
      "name": "ScriptPlan",
      "type": "struct",
      "start_line": 73,
      "end_line": 83,
      "content_hash": "2add4363ca55cc3b253556d58d5bb1c0fa44c5f3",
      "content": "type ScriptPlan struct {\n\tPatternType string     `json:\"pattern_type\"` // \"multi_grep\", \"multi_view\", \"multi_edit\", \"pipeline\"\n\tToolCalls   []ToolCall `json:\"tool_calls\"`\n\tDescription string     `json:\"description\"`\n\tEstimated   struct {\n\t\tSpeedup    float64 `json:\"speedup\"`     // e.g., 5.0 = 5x faster\n\t\tToolsSaved int     `json:\"tools_saved\"` // number of tool calls saved\n\t} `json:\"estimated\"`\n}\n\n// Script is a generated executable script.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_Script_84": {
      "name": "Script",
      "type": "struct",
      "start_line": 84,
      "end_line": 90,
      "content_hash": "60f3bcd67bc17f5a4ff7b663cf75134b3d70d250",
      "content": "type Script struct {\n\tLanguage string      `json:\"language\"` // \"bash\", \"python\"\n\tCode     string      `json:\"code\"`\n\tPlan     *ScriptPlan `json:\"plan,omitempty\"`\n}\n\n// ScriptResult contains the result of script execution.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_ScriptResult_91": {
      "name": "ScriptResult",
      "type": "struct",
      "start_line": 91,
      "end_line": 111,
      "content_hash": "7bf4bacb9dfaa9a15c92e64c0c9fb9930a986cc5",
      "content": "type ScriptResult struct {\n\tSuccess  bool    `json:\"success\"`\n\tOutput   string  `json:\"output\"`\n\tError    string  `json:\"error,omitempty\"`\n\tExitCode int     `json:\"exit_code\"`\n\tDuration int64   `json:\"duration_ms\"`\n\tScript   *Script `json:\"script,omitempty\"`\n}\n\n// Pattern types for Scriptor.\nconst (\n\tPatternMultiGrep = \"multi_grep\" // Multiple grep calls \u2192 single regex\n\tPatternMultiView = \"multi_view\" // Multiple view calls \u2192 single range\n\tPatternMultiEdit = \"multi_edit\" // Multiple edits same file \u2192 batch\n\tPatternPipeline  = \"pipeline\"   // Search/read cycles \u2192 pipeline\n\tPatternMultiLS   = \"multi_ls\"   // Multiple ls calls \u2192 find\n\tPatternMultiTest = \"multi_test\" // Multiple test runs \u2192 single json run\n\tPatternExistence = \"existence\"  // File existence checks \u2192 test -f batch\n)\n\n// Scriptor batches multiple tool operations into single scripts.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "interface_Scriptor_112": {
      "name": "Scriptor",
      "type": "interface",
      "start_line": 112,
      "end_line": 126,
      "content_hash": "5d69216a25dc74b0e1e50823c91046d77342692c",
      "content": "type Scriptor interface {\n\t// DetectPattern analyzes tool calls for batchable patterns.\n\tDetectPattern(ctx context.Context, calls []ToolCall) (*ScriptPlan, error)\n\n\t// Compile generates an executable script from a plan.\n\tCompile(ctx context.Context, plan *ScriptPlan) (*Script, error)\n\n\t// Execute runs a script and captures output.\n\tExecute(ctx context.Context, script *Script) (*ScriptResult, error)\n\n\t// Report formats a script result for the big model.\n\tReport(result *ScriptResult) string\n}\n\n// Ops is the main interface for the local AI ops agent.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "interface_Ops_127": {
      "name": "Ops",
      "type": "interface",
      "start_line": 127,
      "end_line": 153,
      "content_hash": "0da7be7823af041c99b07d8e1d73e8847da8a75a",
      "content": "type Ops interface {\n\t// ResolveEdit resolves a fuzzy old_string to an exact match in the file.\n\tResolveEdit(ctx context.Context, fileContent, oldString, newString string) (*EditResolution, error)\n\n\t// DetectLoop analyzes recent tool calls for loop patterns.\n\tDetectLoop(ctx context.Context, calls []ToolCall) (*LoopDetection, error)\n\n\t// DetectDrift checks if recent actions have drifted from the original task.\n\tDetectDrift(ctx context.Context, task string, recentActions []Action) (*DriftDetection, error)\n\n\t// Compress summarizes content to fit within token budget.\n\tCompress(ctx context.Context, content string, maxTokens int) (string, error)\n\n\t// ValidateToolCall validates and optionally fixes tool call parameters.\n\tValidateToolCall(ctx context.Context, tool string, params map[string]any) (*ValidationResult, error)\n\n\t// Scriptor returns the script batching interface.\n\tScriptor() Scriptor\n\n\t// Available returns true if a local model is available.\n\tAvailable() bool\n\n\t// ModelInfo returns information about the local model.\n\tModelInfo() ModelInfo\n}\n\n// Config holds the configuration for the aiops agent.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_Config_154": {
      "name": "Config",
      "type": "struct",
      "start_line": 154,
      "end_line": 177,
      "content_hash": "5dfb7fa59a95a98cce0f9ce4030f234e5db553b4",
      "content": "type Config struct {\n\tEnabled  bool          `json:\"enabled\" yaml:\"enabled\"`\n\tEndpoint string        `json:\"endpoint\" yaml:\"endpoint\"` // e.g., \"http://gpu-box:8420\"\n\tTimeout  time.Duration `json:\"timeout\" yaml:\"timeout\"`\n\tFallback bool          `json:\"fallback\" yaml:\"fallback\"` // continue without aiops if unavailable\n\n\tScriptor struct {\n\t\tEnabled      bool     `json:\"enabled\" yaml:\"enabled\"`\n\t\tMinBatchSize int      `json:\"min_batch_size\" yaml:\"min_batch_size\"`\n\t\tLanguages    []string `json:\"languages\" yaml:\"languages\"`\n\t} `json:\"scriptor\" yaml:\"scriptor\"`\n\n\tLoopDetection struct {\n\t\tEnabled   bool `json:\"enabled\" yaml:\"enabled\"`\n\t\tThreshold int  `json:\"threshold\" yaml:\"threshold\"` // same tool N times\n\t} `json:\"loop_detection\" yaml:\"loop_detection\"`\n\n\tDriftDetection struct {\n\t\tEnabled       bool `json:\"enabled\" yaml:\"enabled\"`\n\t\tCheckInterval int  `json:\"check_interval\" yaml:\"check_interval\"` // check every N tool calls\n\t} `json:\"drift_detection\" yaml:\"drift_detection\"`\n}\n\n// DefaultConfig returns the default configuration.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_DefaultConfig_178": {
      "name": "DefaultConfig",
      "type": "function",
      "start_line": 178,
      "end_line": 193,
      "content_hash": "7bb729c642d47937de199f7daef55c9d0ca62267",
      "content": "func DefaultConfig() Config {\n\tcfg := Config{\n\t\tEnabled:  false, // disabled by default until endpoint configured\n\t\tEndpoint: \"\",\n\t\tTimeout:  5 * time.Second,\n\t\tFallback: true,\n\t}\n\tcfg.Scriptor.Enabled = true\n\tcfg.Scriptor.MinBatchSize = 3\n\tcfg.Scriptor.Languages = []string{\"bash\", \"python\"}\n\tcfg.LoopDetection.Enabled = true\n\tcfg.LoopDetection.Threshold = 5\n\tcfg.DriftDetection.Enabled = true\n\tcfg.DriftDetection.CheckInterval = 10\n\treturn cfg\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}