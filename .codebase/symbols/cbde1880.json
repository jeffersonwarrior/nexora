{
  "file_path": "/work/internal/tui/components/completions/completions.go",
  "file_hash": "589991e5ed9bf8a129fc7f5bfba90fac5e0c9bb0",
  "updated_at": "2025-12-26T17:34:22.468703",
  "symbols": {
    "struct_Completion_16": {
      "name": "Completion",
      "type": "struct",
      "start_line": 16,
      "end_line": 20,
      "content_hash": "3e85cd5b594aba6e9c7b5c27eca01956aa8fbb7d",
      "content": "type Completion struct {\n\tTitle string // The title of the completion item\n\tValue any    // The value of the completion item\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_OpenCompletionsMsg_21": {
      "name": "OpenCompletionsMsg",
      "type": "struct",
      "start_line": 21,
      "end_line": 27,
      "content_hash": "214a31852015b621c9c47ac2743b2224a34e75cf",
      "content": "type OpenCompletionsMsg struct {\n\tCompletions []Completion\n\tX           int // X position for the completions popup\n\tY           int // Y position for the completions popup\n\tMaxResults  int // Maximum number of results to render, 0 for no limit\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_FilterCompletionsMsg_28": {
      "name": "FilterCompletionsMsg",
      "type": "struct",
      "start_line": 28,
      "end_line": 34,
      "content_hash": "0a88dcdaf3729de19e40522a5531f5483982f167",
      "content": "type FilterCompletionsMsg struct {\n\tQuery  string // The query to filter completions\n\tReopen bool\n\tX      int // X position for the completions popup\n\tY      int // Y position for the completions popup\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_RepositionCompletionsMsg_35": {
      "name": "RepositionCompletionsMsg",
      "type": "struct",
      "start_line": 35,
      "end_line": 38,
      "content_hash": "60303056f37fe96512537ec5b13a4435bfe3d385",
      "content": "type RepositionCompletionsMsg struct {\n\tX, Y int\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_CompletionsClosedMsg_39": {
      "name": "CompletionsClosedMsg",
      "type": "struct",
      "start_line": 39,
      "end_line": 40,
      "content_hash": "71b80dfe2f34c28dbc47f9b7b886422752e5c989",
      "content": "type CompletionsClosedMsg struct{}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_CompletionsOpenedMsg_41": {
      "name": "CompletionsOpenedMsg",
      "type": "struct",
      "start_line": 41,
      "end_line": 42,
      "content_hash": "b77abcffb091e7b597ed5061818de8f794aba760",
      "content": "type CompletionsOpenedMsg struct{}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_CloseCompletionsMsg_43": {
      "name": "CloseCompletionsMsg",
      "type": "struct",
      "start_line": 43,
      "end_line": 44,
      "content_hash": "1cf1375453973e75b7da684fa6b48dbd7dc7f653",
      "content": "type CloseCompletionsMsg struct{}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_SelectCompletionMsg_45": {
      "name": "SelectCompletionMsg",
      "type": "struct",
      "start_line": 45,
      "end_line": 49,
      "content_hash": "8e5762cd02da784affdbd9617004b6ffa77fcfcc",
      "content": "type SelectCompletionMsg struct {\n\tValue  any // The value of the selected completion item\n\tInsert bool\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "interface_Completions_50": {
      "name": "Completions",
      "type": "interface",
      "start_line": 50,
      "end_line": 61,
      "content_hash": "b70178b11688ca50d78d7d2e69489430ad9c47c8",
      "content": "type Completions interface {\n\tutil.Model\n\tOpen() bool\n\tQuery() string // Returns the current filter query\n\tKeyMap() KeyMap\n\tPosition() (int, int) // Returns the X and Y position of the completions popup\n\tWidth() int\n\tHeight() int\n}\n\ntype listModel = list.FilterableList[list.CompletionItem[any]]\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_completionsCmp_62": {
      "name": "completionsCmp",
      "type": "struct",
      "start_line": 62,
      "end_line": 76,
      "content_hash": "e598d18c089ff3517b0972db43e9d8874345dede",
      "content": "type completionsCmp struct {\n\twWidth    int // The window width\n\twHeight   int // The window height\n\twidth     int\n\tlastWidth int\n\theight    int  // Height of the completions component`\n\tx, xorig  int  // X position for the completions popup\n\ty         int  // Y position for the completions popup\n\topen      bool // Indicates if the completions are open\n\tkeyMap    KeyMap\n\n\tlist  listModel\n\tquery string // The current filter query\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_New_77": {
      "name": "New",
      "type": "function",
      "start_line": 77,
      "end_line": 106,
      "content_hash": "216a7dfdc18e6b55f95bbb030a3c14349cc3114f",
      "content": "func New() Completions {\n\tcompletionsKeyMap := DefaultKeyMap()\n\tkeyMap := list.DefaultKeyMap()\n\tkeyMap.Up.SetEnabled(false)\n\tkeyMap.Down.SetEnabled(false)\n\tkeyMap.HalfPageDown.SetEnabled(false)\n\tkeyMap.HalfPageUp.SetEnabled(false)\n\tkeyMap.Home.SetEnabled(false)\n\tkeyMap.End.SetEnabled(false)\n\tkeyMap.UpOneItem = completionsKeyMap.Up\n\tkeyMap.DownOneItem = completionsKeyMap.Down\n\n\tl := list.NewFilterableList(\n\t\t[]list.CompletionItem[any]{},\n\t\tlist.WithFilterInputHidden(),\n\t\tlist.WithFilterListOptions(\n\t\t\tlist.WithDirectionBackward(),\n\t\t\tlist.WithKeyMap(keyMap),\n\t\t),\n\t)\n\treturn &completionsCmp{\n\t\twidth:  0,\n\t\theight: maxCompletionsHeight,\n\t\tlist:   l,\n\t\tquery:  \"\",\n\t\tkeyMap: completionsKeyMap,\n\t}\n}\n\n// Init implements Completions.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Init_107": {
      "name": "Init",
      "type": "method",
      "start_line": 107,
      "end_line": 114,
      "content_hash": "ee578430d0f67db030d6484689561bb6ee4260f8",
      "content": "func (c *completionsCmp) Init() tea.Cmd {\n\treturn tea.Sequence(\n\t\tc.list.Init(),\n\t\tc.list.SetSize(c.width, c.height),\n\t)\n}\n\n// Update implements Completions.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Update_115": {
      "name": "Update",
      "type": "method",
      "start_line": 115,
      "end_line": 239,
      "content_hash": "535209fc1797dc5717e86fb2d2838712493f911f",
      "content": "func (c *completionsCmp) Update(msg tea.Msg) (util.Model, tea.Cmd) {\n\tswitch msg := msg.(type) {\n\tcase tea.WindowSizeMsg:\n\t\tc.wWidth, c.wHeight = msg.Width, msg.Height\n\t\treturn c, nil\n\tcase tea.KeyPressMsg:\n\t\tswitch {\n\t\tcase key.Matches(msg, c.keyMap.Up):\n\t\t\tu, cmd := c.list.Update(msg)\n\t\t\tc.list = u.(listModel)\n\t\t\treturn c, cmd\n\n\t\tcase key.Matches(msg, c.keyMap.Down):\n\t\t\td, cmd := c.list.Update(msg)\n\t\t\tc.list = d.(listModel)\n\t\t\treturn c, cmd\n\t\tcase key.Matches(msg, c.keyMap.UpInsert):\n\t\t\ts := c.list.SelectedItem()\n\t\t\tif s == nil {\n\t\t\t\treturn c, nil\n\t\t\t}\n\t\t\tselectedItem := *s\n\t\t\tc.list.SetSelected(selectedItem.ID())\n\t\t\treturn c, util.CmdHandler(SelectCompletionMsg{\n\t\t\t\tValue:  selectedItem.Value(),\n\t\t\t\tInsert: true,\n\t\t\t})\n\t\tcase key.Matches(msg, c.keyMap.DownInsert):\n\t\t\ts := c.list.SelectedItem()\n\t\t\tif s == nil {\n\t\t\t\treturn c, nil\n\t\t\t}\n\t\t\tselectedItem := *s\n\t\t\tc.list.SetSelected(selectedItem.ID())\n\t\t\treturn c, util.CmdHandler(SelectCompletionMsg{\n\t\t\t\tValue:  selectedItem.Value(),\n\t\t\t\tInsert: true,\n\t\t\t})\n\t\tcase key.Matches(msg, c.keyMap.Select):\n\t\t\ts := c.list.SelectedItem()\n\t\t\tif s == nil {\n\t\t\t\treturn c, nil\n\t\t\t}\n\t\t\tselectedItem := *s\n\t\t\tc.open = false // Close completions after selection\n\t\t\treturn c, util.CmdHandler(SelectCompletionMsg{\n\t\t\t\tValue: selectedItem.Value(),\n\t\t\t})\n\t\tcase key.Matches(msg, c.keyMap.Cancel):\n\t\t\treturn c, util.CmdHandler(CloseCompletionsMsg{})\n\t\t}\n\tcase RepositionCompletionsMsg:\n\t\tc.x, c.y = msg.X, msg.Y\n\t\tc.adjustPosition()\n\tcase CloseCompletionsMsg:\n\t\tc.open = false\n\t\treturn c, util.CmdHandler(CompletionsClosedMsg{})\n\tcase OpenCompletionsMsg:\n\t\tc.open = true\n\t\tc.query = \"\"\n\t\tc.x, c.xorig = msg.X, msg.X\n\t\tc.y = msg.Y\n\t\titems := []list.CompletionItem[any]{}\n\t\tt := styles.CurrentTheme()\n\t\tfor _, completion := range msg.Completions {\n\t\t\titem := list.NewCompletionItem(\n\t\t\t\tcompletion.Title,\n\t\t\t\tcompletion.Value,\n\t\t\t\tlist.WithCompletionBackgroundColor(t.BgSubtle),\n\t\t\t)\n\t\t\titems = append(items, item)\n\t\t}\n\t\twidth := listWidth(items)\n\t\tif len(items) == 0 {\n\t\t\twidth = listWidth(c.list.Items())\n\t\t}\n\t\tif c.x+width >= c.wWidth {\n\t\t\tc.x = c.wWidth - width - 1\n\t\t}\n\t\tc.width = width\n\t\tc.height = max(min(maxCompletionsHeight, len(items)), 1) // Ensure at least 1 item height\n\t\tc.list.SetResultsSize(msg.MaxResults)\n\t\treturn c, tea.Batch(\n\t\t\tc.list.SetItems(items),\n\t\t\tc.list.SetSize(c.width, c.height),\n\t\t\tutil.CmdHandler(CompletionsOpenedMsg{}),\n\t\t)\n\tcase FilterCompletionsMsg:\n\t\tif !c.open && !msg.Reopen {\n\t\t\treturn c, nil\n\t\t}\n\t\tif msg.Query == c.query {\n\t\t\t// PERF: if same query, don't need to filter again\n\t\t\treturn c, nil\n\t\t}\n\t\tif len(c.list.Items()) == 0 &&\n\t\t\tlen(msg.Query) > len(c.query) &&\n\t\t\tstrings.HasPrefix(msg.Query, c.query) {\n\t\t\t// PERF: if c.query didn't match anything,\n\t\t\t// AND msg.Query is longer than c.query,\n\t\t\t// AND msg.Query is prefixed with c.query - which means\n\t\t\t//\t\tthat the user typed more chars after a 0 match,\n\t\t\t// it won't match anything, so return earlier.\n\t\t\treturn c, nil\n\t\t}\n\t\tc.query = msg.Query\n\t\tvar cmds []tea.Cmd\n\t\tcmds = append(cmds, c.list.Filter(msg.Query))\n\t\titems := c.list.Items()\n\t\titemsLen := len(items)\n\t\tc.xorig = msg.X\n\t\tc.x, c.y = msg.X, msg.Y\n\t\tc.adjustPosition()\n\t\tcmds = append(cmds, c.list.SetSize(c.width, c.height))\n\t\tif itemsLen == 0 {\n\t\t\tcmds = append(cmds, util.CmdHandler(CloseCompletionsMsg{}))\n\t\t} else if msg.Reopen {\n\t\t\tc.open = true\n\t\t\tcmds = append(cmds, util.CmdHandler(CompletionsOpenedMsg{}))\n\t\t}\n\t\treturn c, tea.Batch(cmds...)\n\t}\n\treturn c, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_adjustPosition_240": {
      "name": "adjustPosition",
      "type": "method",
      "start_line": 240,
      "end_line": 254,
      "content_hash": "7f12b48df486b543a6523aeb02e0b93cd9b36200",
      "content": "func (c *completionsCmp) adjustPosition() {\n\titems := c.list.Items()\n\titemsLen := len(items)\n\twidth := listWidth(items)\n\tc.lastWidth = c.width\n\tif c.x < 0 || width < c.lastWidth {\n\t\tc.x = c.xorig\n\t} else if c.x+width >= c.wWidth {\n\t\tc.x = c.wWidth - width - 1\n\t}\n\tc.width = width\n\tc.height = max(min(maxCompletionsHeight, itemsLen), 1)\n}\n\n// View implements Completions.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_View_255": {
      "name": "View",
      "type": "method",
      "start_line": 255,
      "end_line": 271,
      "content_hash": "8e3e8737badc4ce076e8e8772a87cf2f608b142c",
      "content": "func (c *completionsCmp) View() string {\n\tif !c.open || len(c.list.Items()) == 0 {\n\t\treturn \"\"\n\t}\n\n\tt := styles.CurrentTheme()\n\tstyle := t.S().Base.\n\t\tWidth(c.width).\n\t\tHeight(c.height).\n\t\tBackground(t.BgSubtle)\n\n\treturn style.Render(c.list.View())\n}\n\n// listWidth returns the width of the last 10 items in the list, which is used\n// to determine the width of the completions popup.\n// Note this only works for [completionItemCmp] items.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_listWidth_272": {
      "name": "listWidth",
      "type": "function",
      "start_line": 272,
      "end_line": 285,
      "content_hash": "dab9765ffe68778d31b1381a4700fbf980abbcfa",
      "content": "func listWidth(items []list.CompletionItem[any]) int {\n\tvar width int\n\tif len(items) == 0 {\n\t\treturn width\n\t}\n\n\tfor i := len(items) - 1; i >= 0 && i >= len(items)-10; i-- {\n\t\titemWidth := lipgloss.Width(items[i].Text()) + 2 // +2 for padding\n\t\twidth = max(width, itemWidth)\n\t}\n\n\treturn width\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Open_286": {
      "name": "Open",
      "type": "method",
      "start_line": 286,
      "end_line": 289,
      "content_hash": "42a7ddd587def5a9575470a7d7cefd0f9b96c182",
      "content": "func (c *completionsCmp) Open() bool {\n\treturn c.open\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Query_290": {
      "name": "Query",
      "type": "method",
      "start_line": 290,
      "end_line": 293,
      "content_hash": "0e25289b9429191933c0a1826e1f5947d9b404a7",
      "content": "func (c *completionsCmp) Query() string {\n\treturn c.query\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_KeyMap_294": {
      "name": "KeyMap",
      "type": "method",
      "start_line": 294,
      "end_line": 297,
      "content_hash": "ba824618c282d82e7e6ec4e62db90caacadc76f7",
      "content": "func (c *completionsCmp) KeyMap() KeyMap {\n\treturn c.keyMap\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Position_298": {
      "name": "Position",
      "type": "method",
      "start_line": 298,
      "end_line": 301,
      "content_hash": "39b0d56d7cfb9bda492519d59e6de6f0e885ced4",
      "content": "func (c *completionsCmp) Position() (int, int) {\n\treturn c.x, c.y - c.height\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Width_302": {
      "name": "Width",
      "type": "method",
      "start_line": 302,
      "end_line": 305,
      "content_hash": "aa787dee2544fe936e1e162b4b3c8d786cbf4bb4",
      "content": "func (c *completionsCmp) Width() int {\n\treturn c.width\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Height_306": {
      "name": "Height",
      "type": "method",
      "start_line": 306,
      "end_line": 308,
      "content_hash": "c8cfa5c983120b45f176cc97f5e099ec45bfd206",
      "content": "func (c *completionsCmp) Height() int {\n\treturn c.height\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}