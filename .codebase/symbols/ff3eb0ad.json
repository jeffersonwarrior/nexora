{
  "file_path": "/work/context-engine/scripts/quantize_reranker.py",
  "file_hash": "831fbf1a31ad06e6ad5ce6bbaace3ab6fdb7fafb",
  "updated_at": "2025-12-26T17:34:23.295575",
  "symbols": {
    "function_main_19": {
      "name": "main",
      "type": "function",
      "start_line": 19,
      "end_line": 52,
      "content_hash": "c1b70f9bddf00992bde5877b0698ab7418cc4f7a",
      "content": "def main():\n    try:\n        from onnxruntime.quantization import quantize_dynamic, QuantType  # type: ignore\n    except Exception:\n        print(\"ERROR: onnxruntime with quantization extras is required.\")\n        sys.exit(2)\n\n    in_path = os.environ.get(\"RERANKER_ONNX_PATH\", \"\").strip()\n    if not in_path or not os.path.exists(in_path):\n        print(\"ERROR: set RERANKER_ONNX_PATH to an existing .onnx file\")\n        sys.exit(2)\n\n    out_path = os.environ.get(\"OUTPUT_ONNX_PATH\", \"\").strip() or (\n        in_path[:-5] + \"_int8.onnx\"\n        if in_path.endswith(\".onnx\")\n        else in_path + \".int8.onnx\"\n    )\n\n    try:\n        quantize_dynamic(\n            model_input=in_path,\n            model_output=out_path,\n            weight_type=QuantType.QUInt8,\n            optimize_model=True,\n            extra_options={\n                \"ActivationSymmetric\": True,\n                \"WeightSymmetric\": True,\n            },\n        )\n        print(f\"Quantized model saved to {out_path}\")\n        sys.exit(0)\n    except Exception as e:\n        print(f\"ERROR: quantization failed: {e}\")\n        sys.exit(1)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}