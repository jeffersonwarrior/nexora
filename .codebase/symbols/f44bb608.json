{
  "file_path": "/work/internal/message/message_test.go",
  "file_hash": "92a9a4d822752900a2f2a13bede6e4fd045071c1",
  "updated_at": "2025-12-26T17:34:25.138324",
  "symbols": {
    "struct_MockQuerier_17": {
      "name": "MockQuerier",
      "type": "struct",
      "start_line": 17,
      "end_line": 23,
      "content_hash": "8971e8ced55d9901de56911ac3c14a06ce2e942d",
      "content": "type MockQuerier struct {\n\tcalls       []string\n\tmessages    map[string]db.Message\n\tshouldError bool // Flag to simulate database errors\n\tdeleteError bool // Flag to simulate delete errors specifically\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewMockQuerier_24": {
      "name": "NewMockQuerier",
      "type": "function",
      "start_line": 24,
      "end_line": 30,
      "content_hash": "f7563911c1509ab6de744cb618dd9b303e0f5556",
      "content": "func NewMockQuerier() *MockQuerier {\n\treturn &MockQuerier{\n\t\tcalls:    make([]string, 0),\n\t\tmessages: make(map[string]db.Message),\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CreateMessage_31": {
      "name": "CreateMessage",
      "type": "method",
      "start_line": 31,
      "end_line": 50,
      "content_hash": "5b3767aed7e4edf297f7164d8694e7b8500e245d",
      "content": "func (m *MockQuerier) CreateMessage(ctx context.Context, params db.CreateMessageParams) (db.Message, error) {\n\tm.calls = append(m.calls, \"CreateMessage\")\n\tif m.shouldError {\n\t\treturn db.Message{}, fmt.Errorf(\"database error\")\n\t}\n\tmsg := db.Message{\n\t\tID:               params.ID,\n\t\tSessionID:        params.SessionID,\n\t\tRole:             params.Role,\n\t\tParts:            params.Parts,\n\t\tModel:            params.Model,\n\t\tCreatedAt:        time.Now().Unix(),\n\t\tUpdatedAt:        time.Now().Unix(),\n\t\tProvider:         params.Provider,\n\t\tIsSummaryMessage: params.IsSummaryMessage,\n\t}\n\tm.messages[params.ID] = msg\n\treturn msg, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_DeleteMessage_51": {
      "name": "DeleteMessage",
      "type": "method",
      "start_line": 51,
      "end_line": 59,
      "content_hash": "60d1dae664d86ffb58e384450e0936f5a03755ed",
      "content": "func (m *MockQuerier) DeleteMessage(ctx context.Context, id string) error {\n\tm.calls = append(m.calls, \"DeleteMessage\")\n\tif m.deleteError {\n\t\treturn fmt.Errorf(\"delete error\")\n\t}\n\tdelete(m.messages, id)\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetMessage_60": {
      "name": "GetMessage",
      "type": "method",
      "start_line": 60,
      "end_line": 71,
      "content_hash": "9fd97ed5f966cd0eabeda38466201f281cb837e6",
      "content": "func (m *MockQuerier) GetMessage(ctx context.Context, id string) (db.Message, error) {\n\tm.calls = append(m.calls, \"GetMessage\")\n\tif m.shouldError {\n\t\treturn db.Message{}, fmt.Errorf(\"database error\")\n\t}\n\tmsg, exists := m.messages[id]\n\tif !exists {\n\t\treturn db.Message{}, sql.ErrNoRows\n\t}\n\treturn msg, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CreateSession_72": {
      "name": "CreateSession",
      "type": "method",
      "start_line": 72,
      "end_line": 82,
      "content_hash": "bb50f32d5ec76cc83a4a04d4ae1f1e7127c6f6e2",
      "content": "func (m *MockQuerier) CreateSession(ctx context.Context, params db.CreateSessionParams) (db.Session, error) {\n\tm.calls = append(m.calls, \"CreateSession\")\n\treturn db.Session{\n\t\tID:           params.ID,\n\t\tTitle:        params.Title,\n\t\tMessageCount: 0,\n\t\tCreatedAt:    time.Now().Unix(),\n\t\tUpdatedAt:    time.Now().Unix(),\n\t}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_DeleteSession_83": {
      "name": "DeleteSession",
      "type": "method",
      "start_line": 83,
      "end_line": 87,
      "content_hash": "0fa25231680453d5a5752fc22c5a9fd029db68ed",
      "content": "func (m *MockQuerier) DeleteSession(ctx context.Context, id string) error {\n\tm.calls = append(m.calls, \"DeleteSession\")\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetSessionByID_88": {
      "name": "GetSessionByID",
      "type": "method",
      "start_line": 88,
      "end_line": 92,
      "content_hash": "35dcf44e473a99e873021d38c156d373c6c0920b",
      "content": "func (m *MockQuerier) GetSessionByID(ctx context.Context, id string) (db.Session, error) {\n\tm.calls = append(m.calls, \"GetSessionByID\")\n\treturn db.Session{}, sql.ErrNoRows\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ListSessions_93": {
      "name": "ListSessions",
      "type": "method",
      "start_line": 93,
      "end_line": 97,
      "content_hash": "89a51c28384e584ca8db2aa4a9a0204aaa62826f",
      "content": "func (m *MockQuerier) ListSessions(ctx context.Context) ([]db.Session, error) {\n\tm.calls = append(m.calls, \"ListSessions\")\n\treturn []db.Session{}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_UpdateSession_98": {
      "name": "UpdateSession",
      "type": "method",
      "start_line": 98,
      "end_line": 102,
      "content_hash": "3ff2b659acaf1531f5efd8e8f56f4891e13381e8",
      "content": "func (m *MockQuerier) UpdateSession(ctx context.Context, params db.UpdateSessionParams) (db.Session, error) {\n\tm.calls = append(m.calls, \"UpdateSession\")\n\treturn db.Session{}, sql.ErrNoRows\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ListMessagesBySession_103": {
      "name": "ListMessagesBySession",
      "type": "method",
      "start_line": 103,
      "end_line": 116,
      "content_hash": "2403286610d425bb109e90755de2a95c0ecf817e",
      "content": "func (m *MockQuerier) ListMessagesBySession(ctx context.Context, sessionID string) ([]db.Message, error) {\n\tm.calls = append(m.calls, \"ListMessagesBySession\")\n\tif m.shouldError {\n\t\treturn nil, fmt.Errorf(\"database error\")\n\t}\n\tmessages := make([]db.Message, 0)\n\tfor _, msg := range m.messages {\n\t\tif msg.SessionID == sessionID {\n\t\t\tmessages = append(messages, msg)\n\t\t}\n\t}\n\treturn messages, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_DeleteSessionMessages_117": {
      "name": "DeleteSessionMessages",
      "type": "method",
      "start_line": 117,
      "end_line": 126,
      "content_hash": "b6e408684de9e5dbbb3553ba1e05c91eb968c7b6",
      "content": "func (m *MockQuerier) DeleteSessionMessages(ctx context.Context, sessionID string) error {\n\tm.calls = append(m.calls, \"DeleteSessionMessages\")\n\tfor id, msg := range m.messages {\n\t\tif msg.SessionID == sessionID {\n\t\t\tdelete(m.messages, id)\n\t\t}\n\t}\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_UpdateMessage_127": {
      "name": "UpdateMessage",
      "type": "method",
      "start_line": 127,
      "end_line": 135,
      "content_hash": "c5e2b19d44bc0b7fa3234ec49ef7cf1ed1f10de7",
      "content": "func (m *MockQuerier) UpdateMessage(ctx context.Context, params db.UpdateMessageParams) error {\n\tm.calls = append(m.calls, \"UpdateMessage\")\n\tif m.shouldError {\n\t\treturn fmt.Errorf(\"database error\")\n\t}\n\treturn nil\n}\n\n// File methods",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CreateFile_136": {
      "name": "CreateFile",
      "type": "method",
      "start_line": 136,
      "end_line": 140,
      "content_hash": "46e16b5136037faffafd473cb235fcd9208d90ab",
      "content": "func (m *MockQuerier) CreateFile(ctx context.Context, params db.CreateFileParams) (db.File, error) {\n\tm.calls = append(m.calls, \"CreateFile\")\n\treturn db.File{}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_DeleteFile_141": {
      "name": "DeleteFile",
      "type": "method",
      "start_line": 141,
      "end_line": 145,
      "content_hash": "629d25385eed7f4887069a908bd119610ec1f3ad",
      "content": "func (m *MockQuerier) DeleteFile(ctx context.Context, id string) error {\n\tm.calls = append(m.calls, \"DeleteFile\")\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetFile_146": {
      "name": "GetFile",
      "type": "method",
      "start_line": 146,
      "end_line": 150,
      "content_hash": "10bc7a11fbc035c5e564c9c79f659c22f1f60c4b",
      "content": "func (m *MockQuerier) GetFile(ctx context.Context, id string) (db.File, error) {\n\tm.calls = append(m.calls, \"GetFile\")\n\treturn db.File{}, sql.ErrNoRows\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_DeleteSessionFiles_151": {
      "name": "DeleteSessionFiles",
      "type": "method",
      "start_line": 151,
      "end_line": 155,
      "content_hash": "e940c74248e3fd7fb2037c8d0e1d889fc20b59ff",
      "content": "func (m *MockQuerier) DeleteSessionFiles(ctx context.Context, sessionID string) error {\n\tm.calls = append(m.calls, \"DeleteSessionFiles\")\n\treturn nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetFileByPathAndSession_156": {
      "name": "GetFileByPathAndSession",
      "type": "method",
      "start_line": 156,
      "end_line": 160,
      "content_hash": "c31b7f8d629151d4a3e796b2b8b0488e7fe2e6c9",
      "content": "func (m *MockQuerier) GetFileByPathAndSession(ctx context.Context, params db.GetFileByPathAndSessionParams) (db.File, error) {\n\tm.calls = append(m.calls, \"GetFileByPathAndSession\")\n\treturn db.File{}, sql.ErrNoRows\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ListFilesByPath_161": {
      "name": "ListFilesByPath",
      "type": "method",
      "start_line": 161,
      "end_line": 165,
      "content_hash": "2e11337edc3ab137173aac0b62441e1bec675f0d",
      "content": "func (m *MockQuerier) ListFilesByPath(ctx context.Context, path string) ([]db.File, error) {\n\tm.calls = append(m.calls, \"ListFilesByPath\")\n\treturn []db.File{}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ListFilesBySession_166": {
      "name": "ListFilesBySession",
      "type": "method",
      "start_line": 166,
      "end_line": 170,
      "content_hash": "2a927ee4d9d45dd2ac825f16a41163547a019b48",
      "content": "func (m *MockQuerier) ListFilesBySession(ctx context.Context, sessionID string) ([]db.File, error) {\n\tm.calls = append(m.calls, \"ListFilesBySession\")\n\treturn []db.File{}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ListLatestSessionFiles_171": {
      "name": "ListLatestSessionFiles",
      "type": "method",
      "start_line": 171,
      "end_line": 175,
      "content_hash": "b4d042b3458f400e51dc7af2ae0d2d60fe1274b1",
      "content": "func (m *MockQuerier) ListLatestSessionFiles(ctx context.Context, sessionID string) ([]db.File, error) {\n\tm.calls = append(m.calls, \"ListLatestSessionFiles\")\n\treturn []db.File{}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ListNewFiles_176": {
      "name": "ListNewFiles",
      "type": "method",
      "start_line": 176,
      "end_line": 180,
      "content_hash": "6aa08be7b72cbf094d2f2bdb5e7367942b7491d6",
      "content": "func (m *MockQuerier) ListNewFiles(ctx context.Context) ([]db.File, error) {\n\tm.calls = append(m.calls, \"ListNewFiles\")\n\treturn []db.File{}, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestNewService_181": {
      "name": "TestNewService",
      "type": "function",
      "start_line": 181,
      "end_line": 186,
      "content_hash": "6e5e777ba928bb63aaa77f28112ee9acf2c28194",
      "content": "func TestNewService(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\trequire.NotNil(t, svc)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateUserMessage_187": {
      "name": "TestCreateUserMessage",
      "type": "function",
      "start_line": 187,
      "end_line": 208,
      "content_hash": "6ec932c356e11087c9e086430bf5f053e7d3bd94",
      "content": "func TestCreateUserMessage(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\tparams := message.CreateMessageParams{\n\t\tRole: message.User,\n\t\tParts: []message.ContentPart{\n\t\t\tmessage.TextContent{Text: \"Hello, world!\"},\n\t\t},\n\t\tModel:    \"gpt-4\",\n\t\tProvider: \"openai\",\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\tassert.NotEmpty(t, msg.ID)\n\tassert.Equal(t, \"test-session\", msg.SessionID)\n\tassert.Equal(t, message.User, msg.Role)\n\tassert.Equal(t, \"Hello, world!\", msg.Content().Text)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateAssistantMessage_209": {
      "name": "TestCreateAssistantMessage",
      "type": "function",
      "start_line": 209,
      "end_line": 230,
      "content_hash": "987aed944554138280d59ea31a5c159d887394c4",
      "content": "func TestCreateAssistantMessage(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\tparams := message.CreateMessageParams{\n\t\tRole: message.Assistant,\n\t\tParts: []message.ContentPart{\n\t\t\tmessage.TextContent{Text: \"Hello! How can I help?\"},\n\t\t},\n\t\tModel:    \"gpt-4\",\n\t\tProvider: \"openai\",\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\tassert.NotEmpty(t, msg.ID)\n\tassert.Equal(t, \"test-session\", msg.SessionID)\n\tassert.Equal(t, message.Assistant, msg.Role)\n\tassert.Equal(t, \"Hello! How can I help?\", msg.Content().Text)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestGetMessage_231": {
      "name": "TestGetMessage",
      "type": "function",
      "start_line": 231,
      "end_line": 240,
      "content_hash": "d8e83a05da67d09d111f881b5d3e450ea3f00fa7",
      "content": "func TestGetMessage(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Test getting non-existent message\n\t_, err := svc.Get(ctx, \"non-existent\")\n\tassert.Error(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDeleteMessage_241": {
      "name": "TestDeleteMessage",
      "type": "function",
      "start_line": 241,
      "end_line": 250,
      "content_hash": "4fdbca6f1be662bd1b41b2157baac06ea73021bb",
      "content": "func TestDeleteMessage(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Test deleting non-existent message\n\terr := svc.Delete(ctx, \"non-existent\")\n\tassert.Error(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestListMessages_251": {
      "name": "TestListMessages",
      "type": "function",
      "start_line": 251,
      "end_line": 261,
      "content_hash": "e30433a927a8b9e5249426e66737b701fbb3d6b5",
      "content": "func TestListMessages(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Test listing messages for session\n\tmessages, err := svc.List(ctx, \"test-session\")\n\tassert.NoError(t, err)\n\tassert.NotNil(t, messages)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateMessageWithReasoning_262": {
      "name": "TestCreateMessageWithReasoning",
      "type": "function",
      "start_line": 262,
      "end_line": 288,
      "content_hash": "7c1eb76a55a896aeef089fae273a630b185ccc4e",
      "content": "func TestCreateMessageWithReasoning(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\tparams := message.CreateMessageParams{\n\t\tRole: message.Assistant,\n\t\tParts: []message.ContentPart{\n\t\t\tmessage.ReasoningContent{\n\t\t\t\tThinking:  \"Let me think about this problem...\",\n\t\t\t\tSignature: \"signature123\",\n\t\t\t},\n\t\t\tmessage.TextContent{Text: \"The answer is 42.\"},\n\t\t},\n\t\tModel:    \"o1-preview\",\n\t\tProvider: \"openai\",\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\tassert.NotEmpty(t, msg.ID)\n\tassert.Equal(t, \"test-session\", msg.SessionID)\n\tassert.Equal(t, message.Assistant, msg.Role)\n\tassert.Equal(t, \"Let me think about this problem...\", msg.ReasoningContent().Thinking)\n\tassert.Equal(t, \"The answer is 42.\", msg.Content().Text)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestUpdateMessage_289": {
      "name": "TestUpdateMessage",
      "type": "function",
      "start_line": 289,
      "end_line": 318,
      "content_hash": "bce3597cd5ef3c44dd79e3b3fb71ff0117281e93",
      "content": "func TestUpdateMessage(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Create a message first\n\tcreateParams := message.CreateMessageParams{\n\t\tRole:  message.User,\n\t\tParts: []message.ContentPart{message.TextContent{Text: \"Original content\"}},\n\t}\n\n\tcreated, err := svc.Create(ctx, \"test-session\", createParams)\n\trequire.NoError(t, err)\n\n\t// Update the message (update changes the content)\n\tupdatedParts := []message.ContentPart{message.TextContent{Text: \"Updated content\"}}\n\tupdatedMessage := message.Message{\n\t\tID:    created.ID,\n\t\tRole:  created.Role,\n\t\tParts: updatedParts,\n\t\tModel: \"test-model\",\n\t}\n\n\terr = svc.Update(ctx, updatedMessage)\n\trequire.NoError(t, err)\n\n\t// Verify the update was called\n\tassert.Contains(t, mock.calls, \"UpdateMessage\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDeleteSessionMessages_319": {
      "name": "TestDeleteSessionMessages",
      "type": "function",
      "start_line": 319,
      "end_line": 344,
      "content_hash": "50e613592d64aecd2ccfcba30428ddcfcd33ef49",
      "content": "func TestDeleteSessionMessages(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Create multiple messages\n\tsessionID := \"test-session\"\n\tfor i := 0; i < 3; i++ {\n\t\tparams := message.CreateMessageParams{\n\t\t\tRole:  message.User,\n\t\t\tParts: []message.ContentPart{message.TextContent{Text: fmt.Sprintf(\"Message %d\", i)}},\n\t\t}\n\t\t_, err := svc.Create(ctx, sessionID, params)\n\t\trequire.NoError(t, err)\n\t}\n\n\t// Delete all session messages\n\terr := svc.DeleteSessionMessages(ctx, sessionID)\n\trequire.NoError(t, err)\n\n\t// Verify all messages were deleted\n\tmessages, err := svc.List(ctx, sessionID)\n\trequire.NoError(t, err)\n\tassert.Empty(t, messages)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateMessageErrorHandling_345": {
      "name": "TestCreateMessageErrorHandling",
      "type": "function",
      "start_line": 345,
      "end_line": 360,
      "content_hash": "479b88204084e826014f82f573dec26588b2bc13",
      "content": "func TestCreateMessageErrorHandling(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Test with invalid JSON parts (this should trigger an error)\n\tparams := message.CreateMessageParams{\n\t\tRole:  message.User,\n\t\tParts: []message.ContentPart{}, // Empty parts should still work\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\tassert.NotEmpty(t, msg.ID)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestGetMessageNotFound_361": {
      "name": "TestGetMessageNotFound",
      "type": "function",
      "start_line": 361,
      "end_line": 371,
      "content_hash": "8545e9f332ceb6be7c9597f7ef8530ca7cfe5321",
      "content": "func TestGetMessageNotFound(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Try to get a message that doesn't exist\n\t_, err := svc.Get(ctx, \"nonexistent-id\")\n\tassert.Error(t, err)\n\tassert.Equal(t, sql.ErrNoRows, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDeleteMessageNotFound_372": {
      "name": "TestDeleteMessageNotFound",
      "type": "function",
      "start_line": 372,
      "end_line": 382,
      "content_hash": "31975246b648fb9753e27852430a7f305b67017a",
      "content": "func TestDeleteMessageNotFound(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Try to delete a message that doesn't exist\n\terr := svc.Delete(ctx, \"nonexistent-id\")\n\tassert.Error(t, err)\n\tassert.Equal(t, sql.ErrNoRows, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestListMessagesEmptySession_383": {
      "name": "TestListMessagesEmptySession",
      "type": "function",
      "start_line": 383,
      "end_line": 393,
      "content_hash": "930b8a4eee761c74ee009fb19f62764a482ebc08",
      "content": "func TestListMessagesEmptySession(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// List messages from a session with no messages\n\tmessages, err := svc.List(ctx, \"empty-session\")\n\trequire.NoError(t, err)\n\tassert.Empty(t, messages)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageContentAccess_394": {
      "name": "TestMessageContentAccess",
      "type": "function",
      "start_line": 394,
      "end_line": 431,
      "content_hash": "4baa4f8e9a9746bc3087ccca5206447177c7836b",
      "content": "func TestMessageContentAccess(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Create message with different content types\n\tparams := message.CreateMessageParams{\n\t\tRole: message.Assistant,\n\t\tParts: []message.ContentPart{\n\t\t\tmessage.TextContent{Text: \"Main response\"},\n\t\t\tmessage.ReasoningContent{\n\t\t\t\tThinking:  \"Step by step reasoning\",\n\t\t\t\tSignature: \"verified\",\n\t\t\t},\n\t\t},\n\t\tModel:    \"test-model\",\n\t\tProvider: \"test-provider\",\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\n\t// Test content access methods\n\tcontent := msg.Content()\n\trequire.NotNil(t, content)\n\tassert.Equal(t, \"Main response\", content.Text)\n\n\t// Test reasoning content\n\treasoning := msg.ReasoningContent()\n\trequire.NotNil(t, reasoning)\n\tassert.Equal(t, \"Step by step reasoning\", reasoning.Thinking)\n\tassert.Equal(t, \"verified\", reasoning.Signature)\n\n\t// Test string representations of content parts\n\tassert.NotEmpty(t, content.String())\n\tassert.NotEmpty(t, reasoning.String())\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateMessage_WithAllContentTypes_432": {
      "name": "TestCreateMessage_WithAllContentTypes",
      "type": "function",
      "start_line": 432,
      "end_line": 472,
      "content_hash": "6da6805c48b1770d99cb4e87f6957beaae4268b9",
      "content": "func TestCreateMessage_WithAllContentTypes(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Create message with all supported content types\n\tparams := message.CreateMessageParams{\n\t\tRole: message.Assistant,\n\t\tParts: []message.ContentPart{\n\t\t\tmessage.TextContent{Text: \"Main response\"},\n\t\t\tmessage.ReasoningContent{\n\t\t\t\tThinking:  \"Step by step reasoning\",\n\t\t\t\tSignature: \"verified\",\n\t\t\t},\n\t\t\tmessage.ImageURLContent{URL: \"https://example.com/image.png\"},\n\t\t\tmessage.BinaryContent{\n\t\t\t\tData:     []byte(\"binary data\"),\n\t\t\t\tMIMEType: \"application/octet-stream\",\n\t\t\t},\n\t\t\tmessage.ToolCall{\n\t\t\t\tID:    \"call_123\",\n\t\t\t\tName:  \"test_tool\",\n\t\t\t\tInput: `{\"input\": \"value\"}`,\n\t\t\t},\n\t\t\tmessage.ToolResult{\n\t\t\t\tToolCallID: \"call_123\",\n\t\t\t\tContent:    \"success\",\n\t\t\t},\n\t\t\tmessage.Finish{Reason: \"stop\"},\n\t\t},\n\t\tModel:    \"test-model\",\n\t\tProvider: \"test-provider\",\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\trequire.NotEmpty(t, msg.ID)\n\tassert.Equal(t, message.Assistant, msg.Role)\n\tassert.Len(t, msg.Parts, 7) // 7 parts (finish should not be added for assistant)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateMessage_UserRole_AddsFinishReason_473": {
      "name": "TestCreateMessage_UserRole_AddsFinishReason",
      "type": "function",
      "start_line": 473,
      "end_line": 505,
      "content_hash": "139db2176a5b48e6ca3ff8473f4f442b0e674677",
      "content": "func TestCreateMessage_UserRole_AddsFinishReason(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Create user message without finish reason\n\tparams := message.CreateMessageParams{\n\t\tRole: message.User,\n\t\tParts: []message.ContentPart{\n\t\t\tmessage.TextContent{Text: \"User input\"},\n\t\t},\n\t\tModel:    \"test-model\",\n\t\tProvider: \"test-provider\",\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\n\t// Should have 2 parts: original text + auto-added finish reason\n\tassert.Len(t, msg.Parts, 2)\n\n\t// Check that finish reason was added\n\thasFinish := false\n\tfor _, part := range msg.Parts {\n\t\tif finish, ok := part.(message.Finish); ok {\n\t\t\thasFinish = true\n\t\t\tassert.Equal(t, message.FinishReason(\"stop\"), finish.Reason)\n\t\t\tbreak\n\t\t}\n\t}\n\tassert.True(t, hasFinish, \"User message should have finish reason added\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateMessage_WithSummaryFlag_506": {
      "name": "TestCreateMessage_WithSummaryFlag",
      "type": "function",
      "start_line": 506,
      "end_line": 523,
      "content_hash": "fc9dae2371e930bc8839096237b00cbc9fa20730",
      "content": "func TestCreateMessage_WithSummaryFlag(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\tparams := message.CreateMessageParams{\n\t\tRole:             message.Assistant,\n\t\tParts:            []message.ContentPart{message.TextContent{Text: \"Summary\"}},\n\t\tModel:            \"test-model\",\n\t\tProvider:         \"test-provider\",\n\t\tIsSummaryMessage: true,\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\tassert.True(t, msg.IsSummaryMessage)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestCreateMessage_DBError_524": {
      "name": "TestCreateMessage_DBError",
      "type": "function",
      "start_line": 524,
      "end_line": 540,
      "content_hash": "d10867302bc3cbf12d7d67b3451adfc3eb2a5f64",
      "content": "func TestCreateMessage_DBError(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Mock a database error during creation\n\tmock.shouldError = true\n\n\tparams := message.CreateMessageParams{\n\t\tRole:  message.User,\n\t\tParts: []message.ContentPart{message.TextContent{Text: \"test\"}},\n\t}\n\n\t_, err := svc.Create(ctx, \"test-session\", params)\n\tassert.Error(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestUpdateMessage_ErrorHandling_541": {
      "name": "TestUpdateMessage_ErrorHandling",
      "type": "function",
      "start_line": 541,
      "end_line": 564,
      "content_hash": "7f0cd45b4a5247491668559e5d9b4f4996770c3c",
      "content": "func TestUpdateMessage_ErrorHandling(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// First create a message\n\tparams := message.CreateMessageParams{\n\t\tRole:  message.User,\n\t\tParts: []message.ContentPart{message.TextContent{Text: \"original\"}},\n\t}\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\n\t// Mock an error for update\n\tmock.shouldError = true\n\n\t// Try to update the message\n\tupdatedMsg := msg\n\tupdatedMsg.Parts = []message.ContentPart{message.TextContent{Text: \"updated\"}}\n\n\terr = svc.Update(ctx, updatedMsg)\n\tassert.Error(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDeleteSessionMessages_ErrorInList_565": {
      "name": "TestDeleteSessionMessages_ErrorInList",
      "type": "function",
      "start_line": 565,
      "end_line": 576,
      "content_hash": "bc6dd28696e7151e1067d9b4a24a6a51151041dc",
      "content": "func TestDeleteSessionMessages_ErrorInList(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Mock an error when listing messages\n\tmock.shouldError = true\n\n\terr := svc.DeleteSessionMessages(ctx, \"test-session\")\n\tassert.Error(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestDeleteSessionMessages_ErrorInDelete_577": {
      "name": "TestDeleteSessionMessages_ErrorInDelete",
      "type": "function",
      "start_line": 577,
      "end_line": 604,
      "content_hash": "9f07aeec8a5c30983471a839cc871dd2a13268bb",
      "content": "func TestDeleteSessionMessages_ErrorInDelete(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// First create some messages\n\tparams1 := message.CreateMessageParams{\n\t\tRole:  message.User,\n\t\tParts: []message.ContentPart{message.TextContent{Text: \"message1\"}},\n\t}\n\tparams2 := message.CreateMessageParams{\n\t\tRole:  message.Assistant,\n\t\tParts: []message.ContentPart{message.TextContent{Text: \"message2\"}},\n\t}\n\n\t_, createErr := svc.Create(ctx, \"test-session\", params1)\n\trequire.NoError(t, createErr)\n\t_, createErr = svc.Create(ctx, \"test-session\", params2)\n\trequire.NoError(t, createErr)\n\n\t// Mock an error only for delete operations\n\tmock.deleteError = true\n\n\t// Try to delete session messages - should fail on first delete\n\terr := svc.DeleteSessionMessages(ctx, \"test-session\")\n\tassert.Error(t, err)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMessageContentAccess_EmptyContent_605": {
      "name": "TestMessageContentAccess_EmptyContent",
      "type": "function",
      "start_line": 605,
      "end_line": 628,
      "content_hash": "bc5378f2d926e31870accde47233f161f199e976",
      "content": "func TestMessageContentAccess_EmptyContent(t *testing.T) {\n\tmock := NewMockQuerier()\n\tsvc := message.NewService(mock)\n\tctx := context.Background()\n\n\t// Create message with no specific content types\n\tparams := message.CreateMessageParams{\n\t\tRole:  message.User,\n\t\tParts: []message.ContentPart{message.Finish{Reason: \"stop\"}},\n\t}\n\n\tmsg, err := svc.Create(ctx, \"test-session\", params)\n\trequire.NoError(t, err)\n\n\t// Test content access methods when content is missing\n\tcontent := msg.Content()\n\tassert.NotNil(t, content)\n\tassert.Empty(t, content.Text)\n\n\treasoning := msg.ReasoningContent()\n\tassert.NotNil(t, reasoning)\n\tassert.Empty(t, reasoning.Thinking)\n\tassert.Empty(t, reasoning.Signature)\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}