{
  "file_path": "/work/external-deps/claude-mem/scripts/format-transcript-context.ts",
  "file_hash": "0cc94164444b599f21fd51cd3ce8549deb77824b",
  "updated_at": "2025-12-26T17:34:21.235235",
  "symbols": {
    "function_extractConversationTurns_36": {
      "name": "extractConversationTurns",
      "type": "function",
      "start_line": 36,
      "end_line": 115,
      "content_hash": "787cc222a61b7c1fddab956b80c927ba76f65bf3",
      "content": "function extractConversationTurns(parser: TranscriptParser): ConversationTurn[] {\n  const entries = parser.getAllEntries();\n  const turns: ConversationTurn[] = [];\n  let currentTurn: ConversationTurn | null = null;\n  let turnNumber = 0;\n\n  for (const entry of entries) {\n    // User messages start a new turn\n    if (entry.type === 'user') {\n      // If previous turn exists, push it\n      if (currentTurn) {\n        turns.push(currentTurn);\n      }\n\n      // Start new turn\n      turnNumber++;\n      currentTurn = {\n        turnNumber,\n        toolResults: []\n      };\n\n      // Extract user text (skip tool results)\n      if (typeof entry.content === 'string') {\n        currentTurn.userMessage = {\n          content: entry.content,\n          timestamp: entry.timestamp\n        };\n      } else if (Array.isArray(entry.content)) {\n        const textContent = entry.content\n          .filter((c: any) => c.type === 'text')\n          .map((c: any) => c.text)\n          .join('\\n');\n\n        if (textContent.trim()) {\n          currentTurn.userMessage = {\n            content: textContent,\n            timestamp: entry.timestamp\n          };\n        }\n\n        // Extract tool results\n        const toolResults = entry.content.filter((c: any) => c.type === 'tool_result');\n        for (const result of toolResults) {\n          currentTurn.toolResults!.push({\n            toolName: result.tool_use_id || 'unknown',\n            result: result.content,\n            timestamp: entry.timestamp\n          });\n        }\n      }\n    }\n\n    // Assistant messages\n    if (entry.type === 'assistant' && currentTurn) {\n      if (!Array.isArray(entry.content)) continue;\n\n      const textBlocks = entry.content.filter((c: any) => c.type === 'text');\n      const thinkingBlocks = entry.content.filter((c: any) => c.type === 'thinking');\n      const toolUseBlocks = entry.content.filter((c: any) => c.type === 'tool_use');\n\n      currentTurn.assistantMessage = {\n        textContent: textBlocks.map((c: any) => c.text).join('\\n'),\n        thinkingContent: thinkingBlocks.map((c: any) => c.thinking).join('\\n'),\n        toolUses: toolUseBlocks.map((t: any) => ({\n          name: t.name,\n          input: t.input,\n          timestamp: entry.timestamp\n        })),\n        timestamp: entry.timestamp\n      };\n    }\n  }\n\n  // Push last turn\n  if (currentTurn) {\n    turns.push(currentTurn);\n  }\n\n  return turns;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_formatTurnToMarkdown_117": {
      "name": "formatTurnToMarkdown",
      "type": "function",
      "start_line": 117,
      "end_line": 183,
      "content_hash": "a9100a319c309d12bf335a82f1c8e6eb8babe8f4",
      "content": "function formatTurnToMarkdown(turn: ConversationTurn): string {\n  let md = '';\n\n  md += `## Turn ${turn.turnNumber}\\n\\n`;\n\n  // User message\n  if (turn.userMessage) {\n    md += `### \ud83d\udc64 User Request\\n`;\n    md += `**Time:** ${new Date(turn.userMessage.timestamp).toLocaleString()}\\n\\n`;\n    md += '```\\n';\n    md += turn.userMessage.content.substring(0, 500);\n    if (turn.userMessage.content.length > 500) {\n      md += '\\n... (truncated)';\n    }\n    md += '\\n```\\n\\n';\n  }\n\n  // Assistant response\n  if (turn.assistantMessage) {\n    md += `### \ud83e\udd16 Assistant Response\\n`;\n    md += `**Time:** ${new Date(turn.assistantMessage.timestamp).toLocaleString()}\\n\\n`;\n\n    // Text content\n    if (turn.assistantMessage.textContent.trim()) {\n      md += '**Response:**\\n```\\n';\n      md += turn.assistantMessage.textContent.substring(0, 500);\n      if (turn.assistantMessage.textContent.length > 500) {\n        md += '\\n... (truncated)';\n      }\n      md += '\\n```\\n\\n';\n    }\n\n    // Thinking\n    if (turn.assistantMessage.thinkingContent?.trim()) {\n      md += '**Thinking:**\\n```\\n';\n      md += turn.assistantMessage.thinkingContent.substring(0, 300);\n      if (turn.assistantMessage.thinkingContent.length > 300) {\n        md += '\\n... (truncated)';\n      }\n      md += '\\n```\\n\\n';\n    }\n\n    // Tool uses\n    if (turn.assistantMessage.toolUses.length > 0) {\n      md += `**Tools Used:** ${turn.assistantMessage.toolUses.length}\\n\\n`;\n      for (const tool of turn.assistantMessage.toolUses) {\n        md += `- **${tool.name}**\\n`;\n        md += `  \\`\\`\\`json\\n`;\n        const inputStr = JSON.stringify(tool.input, null, 2);\n        md += inputStr.substring(0, 200);\n        if (inputStr.length > 200) {\n          md += '\\n  ... (truncated)';\n        }\n        md += '\\n  ```\\n';\n      }\n      md += '\\n';\n    }\n  }\n\n  // Tool results summary\n  if (turn.toolResults && turn.toolResults.length > 0) {\n    md += `**Tool Results:** ${turn.toolResults.length} results received\\n\\n`;\n  }\n\n  md += '---\\n\\n';\n  return md;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_formatTranscriptToMarkdown_185": {
      "name": "formatTranscriptToMarkdown",
      "type": "function",
      "start_line": 185,
      "end_line": 222,
      "content_hash": "ac9331ff10ffa9bdbd52d83808b8605306ec5a18",
      "content": "function formatTranscriptToMarkdown(transcriptPath: string): string {\n  const parser = new TranscriptParser(transcriptPath);\n  const turns = extractConversationTurns(parser);\n  const stats = parser.getParseStats();\n  const tokens = parser.getTotalTokenUsage();\n\n  let md = `# Transcript Context Analysis\\n\\n`;\n  md += `**File:** ${basename(transcriptPath)}\\n`;\n  md += `**Parsed:** ${new Date().toLocaleString()}\\n\\n`;\n\n  md += `## Statistics\\n\\n`;\n  md += `- Total entries: ${stats.totalLines}\\n`;\n  md += `- Successfully parsed: ${stats.parsedEntries}\\n`;\n  md += `- Failed lines: ${stats.failedLines}\\n`;\n  md += `- Conversation turns: ${turns.length}\\n\\n`;\n\n  md += `## Token Usage\\n\\n`;\n  md += `- Input tokens: ${tokens.inputTokens.toLocaleString()}\\n`;\n  md += `- Output tokens: ${tokens.outputTokens.toLocaleString()}\\n`;\n  md += `- Cache creation: ${tokens.cacheCreationTokens.toLocaleString()}\\n`;\n  md += `- Cache read: ${tokens.cacheReadTokens.toLocaleString()}\\n`;\n  const totalTokens = tokens.inputTokens + tokens.outputTokens;\n  md += `- Total: ${totalTokens.toLocaleString()}\\n\\n`;\n\n  md += `---\\n\\n`;\n  md += `# Conversation Turns\\n\\n`;\n\n  // Format each turn\n  for (const turn of turns.slice(0, 20)) { // Limit to first 20 turns for readability\n    md += formatTurnToMarkdown(turn);\n  }\n\n  if (turns.length > 20) {\n    md += `\\n_... ${turns.length - 20} more turns omitted for brevity_\\n`;\n  }\n\n  return md;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}