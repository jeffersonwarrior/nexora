{
  "file_path": "/work/internal/agent/tools/write_test.go",
  "file_hash": "b67cca56b30983b3d29c25f63849cd299ee8dcb2",
  "updated_at": "2025-12-26T17:34:22.590246",
  "symbols": {
    "function_TestWriteTool_18": {
      "name": "TestWriteTool",
      "type": "function",
      "start_line": 18,
      "end_line": 28,
      "content_hash": "d98bb0530dd5709320d6633dc6ac6ef0a61f4003",
      "content": "func TestWriteTool(t *testing.T) {\n\ttmpDir := t.TempDir()\n\tlspClients := csync.NewMap[string, *lsp.Client]()\n\tmockPerms := &mockPermissionService{}\n\tmockFiles := &mockHistoryService{}\n\n\ttool := NewWriteTool(lspClients, mockPerms, mockFiles, tmpDir)\n\tassert.NotNil(t, tool)\n\tassert.Equal(t, WriteToolName, tool.Info().Name)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestWriteTool_CreateNewFile_29": {
      "name": "TestWriteTool_CreateNewFile",
      "type": "function",
      "start_line": 29,
      "end_line": 61,
      "content_hash": "b26d5bb7fd35e4951b71376a5d14898e00311ca6",
      "content": "func TestWriteTool_CreateNewFile(t *testing.T) {\n\ttmpDir := t.TempDir()\n\tlspClients := csync.NewMap[string, *lsp.Client]()\n\tmockPerms := &mockPermissionService{}\n\tmockFiles := &mockHistoryService{}\n\ttool := NewWriteTool(lspClients, mockPerms, mockFiles, tmpDir)\n\n\ttestFile := filepath.Join(tmpDir, \"newfile.txt\")\n\tcontent := \"Hello, World!\"\n\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session\")\n\tparams := WriteParams{\n\t\tFilePath: testFile,\n\t\tContent:  content,\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test\",\n\t\tName:  WriteToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\n\t// Verify file was created\n\tdata, err := os.ReadFile(testFile)\n\trequire.NoError(t, err)\n\tassert.Equal(t, content, string(data))\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestWriteTool_OverwriteFile_62": {
      "name": "TestWriteTool_OverwriteFile",
      "type": "function",
      "start_line": 62,
      "end_line": 102,
      "content_hash": "981675360a2d3737605cbda138774a8b127e7043",
      "content": "func TestWriteTool_OverwriteFile(t *testing.T) {\n\ttmpDir := t.TempDir()\n\ttestFile := filepath.Join(tmpDir, \"existing.txt\")\n\n\t// Create initial file\n\terr := os.WriteFile(testFile, []byte(\"old content\"), 0644)\n\trequire.NoError(t, err)\n\n\t// Record read to pass modification time check\n\trecordFileRead(testFile)\n\ttime.Sleep(10 * time.Millisecond)\n\n\tlspClients := csync.NewMap[string, *lsp.Client]()\n\tmockPerms := &mockPermissionService{}\n\tmockFiles := &mockHistoryService{}\n\ttool := NewWriteTool(lspClients, mockPerms, mockFiles, tmpDir)\n\n\tnewContent := \"new content\"\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session\")\n\tparams := WriteParams{\n\t\tFilePath: testFile,\n\t\tContent:  newContent,\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test\",\n\t\tName:  WriteToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\n\t// Verify file was updated\n\tdata, err := os.ReadFile(testFile)\n\trequire.NoError(t, err)\n\tassert.Equal(t, newContent, string(data))\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestWriteTool_DirectoryCreation_103": {
      "name": "TestWriteTool_DirectoryCreation",
      "type": "function",
      "start_line": 103,
      "end_line": 135,
      "content_hash": "9de4fed5f8753e41be2f4b6cfd35cde7ee14562b",
      "content": "func TestWriteTool_DirectoryCreation(t *testing.T) {\n\ttmpDir := t.TempDir()\n\tlspClients := csync.NewMap[string, *lsp.Client]()\n\tmockPerms := &mockPermissionService{}\n\tmockFiles := &mockHistoryService{}\n\ttool := NewWriteTool(lspClients, mockPerms, mockFiles, tmpDir)\n\n\ttestFile := filepath.Join(tmpDir, \"subdir\", \"nested\", \"file.txt\")\n\tcontent := \"nested file\"\n\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session\")\n\tparams := WriteParams{\n\t\tFilePath: testFile,\n\t\tContent:  content,\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test\",\n\t\tName:  WriteToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.False(t, resp.IsError)\n\n\t// Verify file and directories were created\n\tdata, err := os.ReadFile(testFile)\n\trequire.NoError(t, err)\n\tassert.Equal(t, content, string(data))\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestWriteTool_FileIsDirectory_136": {
      "name": "TestWriteTool_FileIsDirectory",
      "type": "function",
      "start_line": 136,
      "end_line": 164,
      "content_hash": "cd48c5a4aed1afd204cc7653843ec83bfd6064a2",
      "content": "func TestWriteTool_FileIsDirectory(t *testing.T) {\n\ttmpDir := t.TempDir()\n\tdirPath := filepath.Join(tmpDir, \"testdir\")\n\terr := os.Mkdir(dirPath, 0755)\n\trequire.NoError(t, err)\n\n\tlspClients := csync.NewMap[string, *lsp.Client]()\n\tmockPerms := &mockPermissionService{}\n\tmockFiles := &mockHistoryService{}\n\ttool := NewWriteTool(lspClients, mockPerms, mockFiles, tmpDir)\n\n\tctx := context.WithValue(context.Background(), SessionIDContextKey, \"test-session\")\n\tparams := WriteParams{\n\t\tFilePath: dirPath,\n\t\tContent:  \"test\",\n\t}\n\tparamsJSON, _ := json.Marshal(params)\n\ttoolCall := fantasy.ToolCall{\n\t\tID:    \"test\",\n\t\tName:  WriteToolName,\n\t\tInput: string(paramsJSON),\n\t}\n\n\tresp, err := tool.Run(ctx, toolCall)\n\n\trequire.NoError(t, err)\n\tassert.True(t, resp.IsError)\n\tassert.Contains(t, resp.Content, \"directory\")\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}