{
  "file_path": "/work/internal/tui/components/image/load.go",
  "file_hash": "e8280e3ec0aad03ebadbf9ead0c945261e8e5885",
  "updated_at": "2025-12-26T17:34:21.594782",
  "symbols": {
    "struct_loadMsg_25": {
      "name": "loadMsg",
      "type": "struct",
      "start_line": 25,
      "end_line": 28,
      "content_hash": "735f146538c1edc5ad27ae4a01ee25aef2fb84d8",
      "content": "type loadMsg struct {\n\tio.ReadCloser\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_loadURL_29": {
      "name": "loadURL",
      "type": "function",
      "start_line": 29,
      "end_line": 49,
      "content_hash": "2a60225c1237c8acded5640055d2641124bd1768",
      "content": "func loadURL(url string) tea.Cmd {\n\tvar r io.ReadCloser\n\tvar err error\n\n\tif strings.HasPrefix(url, \"http\") {\n\t\tvar resp *http.Request\n\t\tresp, err = http.NewRequestWithContext(context.Background(), http.MethodGet, url, nil)\n\t\tr = resp.Body\n\t} else {\n\t\tr, err = os.Open(url)\n\t}\n\n\tif err != nil {\n\t\treturn func() tea.Msg {\n\t\t\treturn errMsg{err}\n\t\t}\n\t}\n\n\treturn load(r)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_load_50": {
      "name": "load",
      "type": "function",
      "start_line": 50,
      "end_line": 55,
      "content_hash": "f6c7b30d06163866c82afb66a4111b73a7897f58",
      "content": "func load(r io.ReadCloser) tea.Cmd {\n\treturn func() tea.Msg {\n\t\treturn loadMsg{r}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_handleLoadMsg_56": {
      "name": "handleLoadMsg",
      "type": "function",
      "start_line": 56,
      "end_line": 66,
      "content_hash": "8031f1c8529d5cb4b2e9c12cd0ecf4b3e50a76d3",
      "content": "func handleLoadMsg(m Model, msg loadMsg) (Model, tea.Cmd) {\n\tdefer msg.Close()\n\n\timg, err := readerToImage(m.width, m.height, m.url, msg)\n\tif err != nil {\n\t\treturn m, func() tea.Msg { return errMsg{err} }\n\t}\n\tm.image = img\n\treturn m, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_imageToString_67": {
      "name": "imageToString",
      "type": "function",
      "start_line": 67,
      "end_line": 92,
      "content_hash": "997e64df2346db69449d1ee96cc2105464df21aa",
      "content": "func imageToString(width, height uint, img image.Image) (string, error) {\n\timg = resize.Thumbnail(width, height*2-4, img, resize.Lanczos3)\n\tb := img.Bounds()\n\tw := b.Max.X\n\th := b.Max.Y\n\tp := termenv.ColorProfile()\n\tstr := strings.Builder{}\n\tfor y := 0; y < h; y += 2 {\n\t\tfor x := w; x < int(width); x = x + 2 {\n\t\t\tstr.WriteString(\" \")\n\t\t}\n\t\tfor x := range w {\n\t\t\tc1, _ := colorful.MakeColor(img.At(x, y))\n\t\t\tcolor1 := p.Color(c1.Hex())\n\t\t\tc2, _ := colorful.MakeColor(img.At(x, y+1))\n\t\t\tcolor2 := p.Color(c2.Hex())\n\t\t\tstr.WriteString(termenv.String(\"\u2580\").\n\t\t\t\tForeground(color1).\n\t\t\t\tBackground(color2).\n\t\t\t\tString())\n\t\t}\n\t\tstr.WriteString(\"\\n\")\n\t}\n\treturn str.String(), nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_readerToImage_93": {
      "name": "readerToImage",
      "type": "function",
      "start_line": 93,
      "end_line": 105,
      "content_hash": "d50e9528acafbb22cda27ae3d6597f4289966e5f",
      "content": "func readerToImage(width uint, height uint, url string, r io.Reader) (string, error) {\n\tif strings.HasSuffix(strings.ToLower(url), \".svg\") {\n\t\treturn svgToImage(width, height, r)\n\t}\n\n\timg, _, err := imageorient.Decode(r)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn imageToString(width, height, img)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_svgToImage_106": {
      "name": "svgToImage",
      "type": "function",
      "start_line": 106,
      "end_line": 150,
      "content_hash": "df08a62431606f71bf253221ad01119837b65988",
      "content": "func svgToImage(width uint, height uint, r io.Reader) (string, error) {\n\t// Original author: https://stackoverflow.com/users/10826783/usual-human\n\t// https://stackoverflow.com/questions/42993407/how-to-create-and-export-svg-to-png-jpeg-in-golang\n\t// Adapted to use size from SVG, and to use temp file.\n\n\ttmpPngFile, err := os.CreateTemp(\"\", \"img.*.png\")\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\ttmpPngPath := tmpPngFile.Name()\n\tdefer os.Remove(tmpPngPath)\n\tdefer tmpPngFile.Close()\n\n\t// Rasterize the SVG:\n\ticon, err := oksvg.ReadIconStream(r)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\tw := int(icon.ViewBox.W)\n\th := int(icon.ViewBox.H)\n\ticon.SetTarget(0, 0, float64(w), float64(h))\n\trgba := image.NewRGBA(image.Rect(0, 0, w, h))\n\ticon.Draw(rasterx.NewDasher(w, h, rasterx.NewScannerGV(w, h, rgba, rgba.Bounds())), 1)\n\t// Write rasterized image as PNG:\n\terr = png.Encode(tmpPngFile, rgba)\n\tif err != nil {\n\t\ttmpPngFile.Close()\n\t\treturn \"\", err\n\t}\n\ttmpPngFile.Close()\n\n\trPng, err := os.Open(tmpPngPath)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\tdefer rPng.Close()\n\n\timg, _, err := imageorient.Decode(rPng)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\treturn imageToString(width, height, img)\n}\n\n// ImageFromBase64 renders an image from base64-encoded data.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_ImageFromBase64_151": {
      "name": "ImageFromBase64",
      "type": "function",
      "start_line": 151,
      "end_line": 169,
      "content_hash": "cbeb17d469cffdc995bdec8d9f92e578b08f5258",
      "content": "func ImageFromBase64(width, height uint, data, mediaType string) (string, error) {\n\tdecoded, err := base64.StdEncoding.DecodeString(data)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\tr := bytes.NewReader(decoded)\n\n\tif strings.Contains(mediaType, \"svg\") {\n\t\treturn svgToImage(width, height, r)\n\t}\n\n\timg, _, err := imageorient.Decode(r)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\n\treturn imageToString(width, height, img)\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}