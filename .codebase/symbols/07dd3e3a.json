{
  "file_path": "/work/external-deps/claude-mem/scripts/extraction/filter-actual-xml.py",
  "file_hash": "abdffb4d2698f4c17c80fe3e4d727d060dd685a0",
  "updated_at": "2025-12-26T17:34:20.602491",
  "symbols": {
    "function_extract_xml_blocks_7": {
      "name": "extract_xml_blocks",
      "type": "function",
      "start_line": 7,
      "end_line": 45,
      "content_hash": "cce367834ca4fdbd6811c2f8a8b82ae40505a113",
      "content": "def extract_xml_blocks(text):\n    \"\"\"Extract complete XML blocks from text\"\"\"\n    xml_patterns = [\n        r'<observation>.*?</observation>',\n        r'<session_summary>.*?</session_summary>',\n        r'<request>.*?</request>',\n        r'<summary>.*?</summary>',\n        r'<facts>.*?</facts>',\n        r'<fact>.*?</fact>',\n        r'<concepts>.*?</concepts>',\n        r'<concept>.*?</concept>',\n        r'<files>.*?</files>',\n        r'<file>.*?</file>',\n        r'<files_read>.*?</files_read>',\n        r'<files_edited>.*?</files_edited>',\n        r'<files_modified>.*?</files_modified>',\n        r'<narrative>.*?</narrative>',\n        r'<learned>.*?</learned>',\n        r'<investigated>.*?</investigated>',\n        r'<completed>.*?</completed>',\n        r'<next_steps>.*?</next_steps>',\n        r'<notes>.*?</notes>',\n        r'<title>.*?</title>',\n        r'<subtitle>.*?</subtitle>',\n        r'<text>.*?</text>',\n        r'<type>.*?</type>',\n        r'<tool_used>.*?</tool_used>',\n        r'<tool_name>.*?</tool_name>',\n        r'<tool_input>.*?</tool_input>',\n        r'<tool_output>.*?</tool_output>',\n        r'<tool_time>.*?</tool_time>',\n    ]\n\n    blocks = []\n    for pattern in xml_patterns:\n        matches = re.findall(pattern, text, re.DOTALL)\n        blocks.extend(matches)\n\n    return blocks",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_is_example_xml_47": {
      "name": "is_example_xml",
      "type": "function",
      "start_line": 47,
      "end_line": 75,
      "content_hash": "d7959539defccd234e582a11c5ee476037197aa4",
      "content": "def is_example_xml(xml_block):\n    \"\"\"Check if XML block is an example/template\"\"\"\n    # Patterns that indicate this is example/template XML\n    example_indicators = [\n        r'\\[.*?\\]',  # Square brackets with placeholders\n        r'\\*\\*\\w+\\*\\*:',  # Bold markdown like **title**:\n        r'\\.\\.\\..*?\\.\\.\\.',  # Ellipsis indicating placeholder\n        r'feature\\|bugfix\\|refactor',  # Multiple options separated by |\n        r'change \\| discovery \\| decision',  # Example types\n        r'\\{.*?\\}',  # Curly braces (template variables)\n        r'Concise, self-contained statement',  # Literal example text\n        r'Short title capturing',\n        r'One sentence explanation',\n        r'What was the user trying',\n        r'What code/systems did you explore',\n        r'What did you learn',\n        r'What was done',\n        r'What should happen next',\n        r'file1\\.ts',  # Example filenames\n        r'file2\\.ts',\n        r'file3\\.ts',\n        r'Any additional context',\n    ]\n\n    for pattern in example_indicators:\n        if re.search(pattern, xml_block):\n            return True\n\n    return False",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_process_transcript_file_77": {
      "name": "process_transcript_file",
      "type": "function",
      "start_line": 77,
      "end_line": 118,
      "content_hash": "cb51f53c6b660c8779ff460e81551a42e671baf7",
      "content": "def process_transcript_file(filepath):\n    \"\"\"Process a single transcript file and extract only real XML from assistant responses\"\"\"\n    results = []\n\n    with open(filepath, 'r', encoding='utf-8', errors='ignore') as f:\n        for line in f:\n            try:\n                data = json.loads(line)\n\n                # Get timestamp\n                timestamp = data.get('timestamp', 'unknown')\n\n                # Only process assistant messages\n                message = data.get('message', {})\n                role = message.get('role')\n\n                if role != 'assistant':\n                    continue\n\n                content = message.get('content', [])\n\n                if isinstance(content, list):\n                    for item in content:\n                        if isinstance(item, dict) and item.get('type') == 'text':\n                            # This is text in an assistant response, not tool_use\n                            text = item.get('text', '')\n\n                            # Extract XML blocks\n                            xml_blocks = extract_xml_blocks(text)\n\n                            for block in xml_blocks:\n                                # Filter out example/template XML\n                                if not is_example_xml(block):\n                                    results.append({\n                                        'timestamp': timestamp,\n                                        'xml': block\n                                    })\n\n            except json.JSONDecodeError:\n                continue\n\n    return results",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}