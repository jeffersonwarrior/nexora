{
  "file_path": "/work/external-deps/Context-Engine/scripts/mcp_impl/toon.py",
  "file_hash": "497f063fd5c3e42d790509080e0e7af3900c1802",
  "updated_at": "2025-12-26T17:34:23.834450",
  "symbols": {
    "function__is_toon_output_enabled_30": {
      "name": "_is_toon_output_enabled",
      "type": "function",
      "start_line": 30,
      "end_line": 32,
      "content_hash": "2b1d264c2376be403f237450abc6ba9f2213c6f4",
      "content": "def _is_toon_output_enabled() -> bool:\n    \"\"\"Check if TOON output format is enabled globally via TOON_ENABLED env var.\"\"\"\n    return os.environ.get(\"TOON_ENABLED\", \"0\").lower() in (\"1\", \"true\", \"yes\")",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function__should_use_toon_35": {
      "name": "_should_use_toon",
      "type": "function",
      "start_line": 35,
      "end_line": 47,
      "content_hash": "15a8b132259ab8ae11a8f3e8e35e8a59ce683b62",
      "content": "def _should_use_toon(output_format: Any) -> bool:\n    \"\"\"Determine if TOON format should be used based on explicit param or env flag.\n    \n    Args:\n        output_format: Explicit format request (e.g., \"toon\", \"json\", None)\n        \n    Returns:\n        True if TOON format should be used\n    \"\"\"\n    if output_format is not None:\n        fmt = str(output_format).strip().lower()\n        return fmt == \"toon\"\n    return _is_toon_output_enabled()",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function__format_results_as_toon_53": {
      "name": "_format_results_as_toon",
      "type": "function",
      "start_line": 53,
      "end_line": 82,
      "content_hash": "1830f7957898380074a3def31c1a0b2d57b2f87b",
      "content": "def _format_results_as_toon(response: Dict[str, Any], compact: bool = False) -> Dict[str, Any]:\n    \"\"\"Convert response to use TOON-formatted results string instead of JSON array.\n\n    Replaces 'results' array with 'results' string in TOON format to save tokens.\n    Always adds output_format marker when TOON is requested, even for empty results.\n    \n    Args:\n        response: Search response dict with 'results' key\n        compact: If True, use more compact TOON encoding\n        \n    Returns:\n        Modified response with TOON-encoded results\n    \"\"\"\n    try:\n        from scripts.toon_encoder import encode_search_results\n\n        results = response.get(\"results\", [])\n        if isinstance(results, list):\n            # Replace JSON array with TOON string (handles empty arrays too)\n            toon_results = encode_search_results(results, compact=compact)\n            response[\"results\"] = toon_results\n        response[\"output_format\"] = \"toon\"\n\n        return response\n    except ImportError:\n        logger.warning(\"TOON encoder not available, returning JSON format\")\n        return response\n    except Exception as e:\n        logger.debug(f\"TOON encoding failed: {e}\")\n        return response",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function__format_context_results_as_toon_85": {
      "name": "_format_context_results_as_toon",
      "type": "function",
      "start_line": 85,
      "end_line": 113,
      "content_hash": "377c57a9f06ca68e9f6f4910e9e827b9dfbab788",
      "content": "def _format_context_results_as_toon(response: Dict[str, Any], compact: bool = False) -> Dict[str, Any]:\n    \"\"\"Convert context_search response to TOON format, handling mixed code/memory results.\n\n    Uses encode_context_results which properly handles memory entries (content/score)\n    vs code entries (path/line), avoiding blank rows or dropped content.\n    \n    Args:\n        response: Context search response dict with 'results' key\n        compact: If True, use more compact TOON encoding\n        \n    Returns:\n        Modified response with TOON-encoded results\n    \"\"\"\n    try:\n        from scripts.toon_encoder import encode_context_results\n\n        results = response.get(\"results\", [])\n        if isinstance(results, list):\n            toon_results = encode_context_results(results, compact=compact)\n            response[\"results\"] = toon_results\n        response[\"output_format\"] = \"toon\"\n\n        return response\n    except ImportError:\n        logger.warning(\"TOON encoder not available, returning JSON format\")\n        return response\n    except Exception as e:\n        logger.debug(f\"TOON encoding failed: {e}\")\n        return response",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}