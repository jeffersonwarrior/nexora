{
  "file_path": "/work/internal/agent/native/bash.go",
  "file_hash": "1f70cbf003c44f1dfbf7a3a252a18c30f575ce77",
  "updated_at": "2025-12-26T17:34:21.204250",
  "symbols": {
    "struct_BashParams_14": {
      "name": "BashParams",
      "type": "struct",
      "start_line": 14,
      "end_line": 21,
      "content_hash": "f4c2ad69343cb18f2c5b5647164b36e7033080b8",
      "content": "type BashParams struct {\n\tDescription     string `json:\"description\" description:\"A brief description of what the command does, try to keep it under 30 characters or so\"`\n\tCommand         string `json:\"command\" description:\"The command to execute\"`\n\tWorkingDir      string `json:\"working_dir,omitempty\" description:\"The working directory to execute the command in (defaults to current directory)\"`\n\tRunInBackground bool   `json:\"run_in_background,omitempty\" description:\"Set to true (boolean) to run this command in the background. Use job_output to read the output later.\"`\n}\n\n// BashResponseMetadata contains metadata for bash tool responses",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_BashResponseMetadata_22": {
      "name": "BashResponseMetadata",
      "type": "struct",
      "start_line": 22,
      "end_line": 33,
      "content_hash": "5f993d657aa08c9b3f6feaa3fb8341487e525265",
      "content": "type BashResponseMetadata struct {\n\tStartTime        int64  `json:\"start_time\"`\n\tEndTime          int64  `json:\"end_time\"`\n\tOutput           string `json:\"output\"`\n\tDescription      string `json:\"description\"`\n\tWorkingDirectory string `json:\"working_directory\"`\n\tBackground       bool   `json:\"background,omitempty\"`\n\tShellID          string `json:\"shell_id,omitempty\"`\n}\n\n// GetSessionFromContext extracts session ID from context\n// This function needs to be implemented based on how session IDs are stored in context",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_GetSessionFromContext_34": {
      "name": "GetSessionFromContext",
      "type": "function",
      "start_line": 34,
      "end_line": 48,
      "content_hash": "15f75f7d88f185193b23995a9190ba8b96a97c09",
      "content": "func GetSessionFromContext(ctx context.Context) string {\n\t// TODO: Implement based on actual context structure\n\tif sessionID, ok := ctx.Value(\"session_id\").(string); ok {\n\t\treturn sessionID\n\t}\n\treturn \"\"\n}\n\n// Safe commands that don't require permission prompting\nvar safeCommands = []string{\n\t\"ls\", \"pwd\", \"echo\", \"cat\", \"head\", \"tail\", \"grep\", \"find\", \"which\",\n\t\"whereis\", \"date\", \"whoami\", \"id\", \"uptime\", \"df\", \"du\", \"ps\", \"top\",\n}\n\n// NewBashTool creates a new bash tool using the native framework",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewBashTool_49": {
      "name": "NewBashTool",
      "type": "function",
      "start_line": 49,
      "end_line": 131,
      "content_hash": "c939c57ab6af2f6bb145a503c089416f4cd5777b",
      "content": "func NewBashTool(permissions permission.Service, workingDir string, description string) AgentTool {\n\tinfo := ToolInfo{\n\t\tName:        \"bash\",\n\t\tDescription: description,\n\t\tParameters:  BashParams{},\n\t}\n\n\thandler := func(ctx context.Context, params any, call ToolCall) (ToolResponse, error) {\n\t\tbashParams, ok := params.(BashParams)\n\t\tif !ok {\n\t\t\treturn NewTextErrorResponse(\"invalid parameters for bash tool\"), nil\n\t\t}\n\n\t\tif bashParams.Command == \"\" {\n\t\t\treturn NewTextErrorResponse(\"missing command\"), nil\n\t\t}\n\n\t\t// Determine working directory\n\t\texecWorkingDir := cmp.Or(bashParams.WorkingDir, workingDir)\n\n\t\tisSafeReadOnly := false\n\t\tcmdLower := strings.ToLower(bashParams.Command)\n\n\t\tfor _, safe := range safeCommands {\n\t\t\tif strings.HasPrefix(cmdLower, safe) {\n\t\t\t\tif len(cmdLower) == len(safe) || cmdLower[len(safe)] == ' ' || cmdLower[len(safe)] == '-' {\n\t\t\t\t\tisSafeReadOnly = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tsessionID := GetSessionFromContext(ctx)\n\t\tif sessionID == \"\" {\n\t\t\treturn ToolResponse{}, fmt.Errorf(\"session ID is required for executing shell command\")\n\t\t}\n\n\t\t// Check permissions for unsafe commands\n\t\tif !isSafeReadOnly {\n\t\t\tp := permissions.Request(\n\t\t\t\tpermission.CreatePermissionRequest{\n\t\t\t\t\tSessionID:   sessionID,\n\t\t\t\t\tPath:        execWorkingDir,\n\t\t\t\t\tToolCallID:  call.ID,\n\t\t\t\t\tToolName:    \"bash\",\n\t\t\t\t\tAction:      \"execute\",\n\t\t\t\t\tDescription: fmt.Sprintf(\"Execute command: %s\", bashParams.Command),\n\t\t\t\t\tParams:      bashParams,\n\t\t\t\t},\n\t\t\t)\n\t\t\tif !p {\n\t\t\t\treturn ToolResponse{}, fmt.Errorf(\"permission denied\")\n\t\t\t}\n\t\t}\n\n\t\t// Execute the command (simplified implementation)\n\t\tstartTime := time.Now()\n\n\t\t// TODO: Replace with actual shell execution using mvdan/sh\n\t\toutput := fmt.Sprintf(\"Command executed: %s\\nWorking dir: %s\\nBackground: %v\",\n\t\t\tbashParams.Command, execWorkingDir, bashParams.RunInBackground)\n\n\t\tendTime := time.Now()\n\n\t\tmetadata := BashResponseMetadata{\n\t\t\tStartTime:        startTime.Unix(),\n\t\t\tEndTime:          endTime.Unix(),\n\t\t\tOutput:           output,\n\t\t\tDescription:      bashParams.Description,\n\t\t\tWorkingDirectory: execWorkingDir,\n\t\t\tBackground:       bashParams.RunInBackground,\n\t\t}\n\n\t\treturn WithResponseMetadata(NewTextResponse(output), map[string]any{\n\t\t\t\"bash_metadata\": metadata,\n\t\t}), nil\n\t}\n\n\treturn &BasicTool{\n\t\tinfo:    info,\n\t\thandler: handler,\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}