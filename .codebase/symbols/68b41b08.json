{
  "file_path": "/work/internal/task/integration.go",
  "file_hash": "c4e6928b1892beb63832002862bde37ac1a8a433",
  "updated_at": "2025-12-26T17:34:20.386512",
  "symbols": {
    "struct_Config_10": {
      "name": "Config",
      "type": "struct",
      "start_line": 10,
      "end_line": 17,
      "content_hash": "c2cf5472bc918ee971ca93096a4d4b308ae683dc",
      "content": "type Config struct {\n\tEnableAutoTaskCreation   bool    `yaml:\"enable_auto_task_creation\"`\n\tEnableDriftDetection     bool    `yaml:\"enable_drift_detection\"`\n\tDriftThreshold           float64 `yaml:\"drift_threshold\"` // confidence level to trigger correction\n\tMaxActiveTasksPerSession int     `yaml:\"max_active_tasks_per_session\"`\n}\n\n// DefaultConfig returns default task management settings",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_DefaultConfig_18": {
      "name": "DefaultConfig",
      "type": "function",
      "start_line": 18,
      "end_line": 27,
      "content_hash": "3b83a1b9b4ea1954804ac7076d375038ee47c94b",
      "content": "func DefaultConfig() Config {\n\treturn Config{\n\t\tEnableAutoTaskCreation:   true,\n\t\tEnableDriftDetection:     true,\n\t\tDriftThreshold:           0.7,\n\t\tMaxActiveTasksPerSession: 1,\n\t}\n}\n\n// TaskAwareCoordinator adds task management to coordinator",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_TaskAwareCoordinator_28": {
      "name": "TaskAwareCoordinator",
      "type": "struct",
      "start_line": 28,
      "end_line": 34,
      "content_hash": "e2b4aa53a69471ddd141296651e6e5b266c31675",
      "content": "type TaskAwareCoordinator struct {\n\tbase        Coordinator\n\ttaskService Service\n\tconfig      Config\n}\n\n// NewTaskAwareCoordinator creates a coordinator with task management capabilities",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewTaskAwareCoordinator_35": {
      "name": "NewTaskAwareCoordinator",
      "type": "function",
      "start_line": 35,
      "end_line": 47,
      "content_hash": "18f0dd9fc7493908eb1b3a18a6eec2a0874517be",
      "content": "func NewTaskAwareCoordinator(\n\tbaseCoordinator Coordinator,\n\ttaskService Service,\n\tconfig Config,\n) *TaskAwareCoordinator {\n\treturn &TaskAwareCoordinator{\n\t\tbase:        baseCoordinator,\n\t\ttaskService: taskService,\n\t\tconfig:      config,\n\t}\n}\n\n// Run implements Coordinator with task context injection",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Run_48": {
      "name": "Run",
      "type": "method",
      "start_line": 48,
      "end_line": 85,
      "content_hash": "7e4aa68dc4de0e30e0c3b453ddcde69b0fa5e9a0",
      "content": "func (tac *TaskAwareCoordinator) Run(ctx context.Context, sessionID, prompt string, attachments ...any) (interface{}, error) {\n\t// Auto-create task if enabled and no active task exists\n\tif tac.config.EnableAutoTaskCreation {\n\t\t_, exists := tac.taskService.GetActiveTask(ctx, sessionID)\n\t\tif !exists {\n\t\t\t// Create automatic task from prompt\n\t\t\ttaskTitle := summarizePrompt(prompt)\n\t\t\ttaskDescription := prompt\n\t\t\ttac.taskService.CreateTask(ctx, sessionID, taskTitle, taskDescription, prompt, []string{\"Complete the requested work\"})\n\t\t}\n\t}\n\n\t// Inject task context\n\tenhancedPrompt := tac.enhancePromptWithContext(ctx, sessionID, prompt)\n\n\t// Run the agent with enhanced prompt\n\tresult, err := tac.base.Run(ctx, sessionID, enhancedPrompt, attachments...)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Check for drift if enabled\n\tif tac.config.EnableDriftDetection {\n\t\tresponse := extractResponseContent(result)\n\t\tanalysis := tac.taskService.AnalyzeDrift(ctx, sessionID, response)\n\n\t\tif analysis.Drifted && analysis.Confidence >= tac.config.DriftThreshold {\n\t\t\t// Get correction prompt and re-run\n\t\t\tcorrectionPrompt := tac.taskService.GetCorrectionPrompt(ctx, sessionID)\n\t\t\tenhancedPrompt = correctionPrompt + \"\\n\\n\" + enhancedPrompt\n\t\t\treturn tac.base.Run(ctx, sessionID, enhancedPrompt, attachments...)\n\t\t}\n\t}\n\n\treturn result, nil\n}\n\n// enhancePromptWithContext adds task information to user prompts",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_enhancePromptWithContext_86": {
      "name": "enhancePromptWithContext",
      "type": "method",
      "start_line": 86,
      "end_line": 119,
      "content_hash": "5d7fac1f03a72cd1883d7a34c402a409d149ffc5",
      "content": "func (tac *TaskAwareCoordinator) enhancePromptWithContext(ctx context.Context, sessionID, prompt string) string {\n\ttask, exists := tac.taskService.GetActiveTask(ctx, sessionID)\n\tif !exists {\n\t\treturn prompt\n\t}\n\n\tvar enhanced strings.Builder\n\n\tenhanced.WriteString(\"## CURRENT TASK CONTEXT\\n\\n\")\n\tenhanced.WriteString(fmt.Sprintf(\"**Task:** %s\\n\", task.Title))\n\tenhanced.WriteString(fmt.Sprintf(\"**Description:** %s\\n\", task.Description))\n\n\tif task.Context != \"\" {\n\t\tenhanced.WriteString(fmt.Sprintf(\"**Working Context:** %s\\n\", task.Context))\n\t}\n\n\t// Show current milestone\n\tif len(task.Milestones) > 0 {\n\t\tfor _, milestone := range task.Milestones {\n\t\t\tif milestone.Status == StatusActive || milestone.Status == StatusBlocked {\n\t\t\t\tenhanced.WriteString(fmt.Sprintf(\"**Current Milestone:** %s - %s\\n\", milestone.Title, milestone.Description))\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\tenhanced.WriteString(\"\\n**Reminder:** Stay focused on this task. Address the user request but maintain alignment with the current task objectives.\\n\\n\")\n\tenhanced.WriteString(\"## USER REQUEST\\n\\n\")\n\tenhanced.WriteString(prompt)\n\n\treturn enhanced.String()\n}\n\n// Helper functions",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_summarizePrompt_120": {
      "name": "summarizePrompt",
      "type": "function",
      "start_line": 120,
      "end_line": 146,
      "content_hash": "4150e0b8474c4e6855ac4123c421014014f90f15",
      "content": "func summarizePrompt(prompt string) string {\n\tprompt = strings.TrimSpace(prompt)\n\n\t// Find first sentence\n\tif idx := strings.Index(prompt, \".\"); idx > 0 && idx < 60 {\n\t\treturn strings.TrimSpace(prompt[:idx])\n\t}\n\n\t// If short enough, use directly\n\tif len(prompt) < 60 {\n\t\treturn prompt\n\t}\n\n\t// Truncate with ellipsis\n\twords := strings.Fields(prompt)\n\tvar result []string\n\n\tfor _, word := range words {\n\t\tif len(strings.Join(result, \" \")) > 50 {\n\t\t\tbreak\n\t\t}\n\t\tresult = append(result, word)\n\t}\n\n\treturn strings.Join(result, \" \") + \"...\"\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_extractResponseContent_147": {
      "name": "extractResponseContent",
      "type": "function",
      "start_line": 147,
      "end_line": 154,
      "content_hash": "a8e3a2c3f54012077805343f31851e724ddffd52",
      "content": "func extractResponseContent(result interface{}) string {\n\t// Since we can't see the actual result structure,\n\t// this is a placeholder that needs to be implemented\n\t// based on the actual return type\n\treturn \"\"\n}\n\n// TaskCommandFactory creates CLI commands for task management",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_TaskCommandFactory_155": {
      "name": "TaskCommandFactory",
      "type": "struct",
      "start_line": 155,
      "end_line": 158,
      "content_hash": "acf15fa4375b87b866adaf88a5701d817803e2e1",
      "content": "type TaskCommandFactory struct {\n\ttaskService Service\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewTaskCommandFactory_159": {
      "name": "NewTaskCommandFactory",
      "type": "function",
      "start_line": 159,
      "end_line": 163,
      "content_hash": "4de53610ecfa6adf22cca54d4ea90ddcd3dc04a8",
      "content": "func NewTaskCommandFactory(service Service) *TaskCommandFactory {\n\treturn &TaskCommandFactory{taskService: service}\n}\n\n// CreateTaskCommands returns CLI commands for task management",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CreateTaskCommands_164": {
      "name": "CreateTaskCommands",
      "type": "method",
      "start_line": 164,
      "end_line": 169,
      "content_hash": "764b0dd0b50fe75c9413ff1c269f93eacb0d2d04",
      "content": "func (tcf *TaskCommandFactory) CreateTaskCommands(sessionID string) map[string]interface{} {\n\ttool := NewTaskTool(tcf.taskService, sessionID)\n\treturn map[string]interface{}{\n\t\t\"task\": tool.GetTaskCommand(),\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}