{
  "file_path": "/work/qa/view_tool_recovery_test.go",
  "file_hash": "3beafe7752cbe95714226f25f30afc43dd9de765",
  "updated_at": "2025-12-26T17:34:21.742829",
  "symbols": {
    "function_TestViewToolRecovery_15": {
      "name": "TestViewToolRecovery",
      "type": "function",
      "start_line": 15,
      "end_line": 75,
      "content_hash": "c7d91ef8c177b9ca52fef2573bd26839f78b399c",
      "content": "func TestViewToolRecovery(t *testing.T) {\n\tt.Parallel()\n\n\t// Create a temporary directory structure\n\ttmpDir := t.TempDir()\n\n\t// Create test files\n\ttestFiles := []string{\"db.go\", \"models.go\", \"migrations/\"}\n\tfor _, file := range testFiles {\n\t\tif file == \"migrations/\" {\n\t\t\t// Create subdirectory\n\t\t\terr := os.Mkdir(filepath.Join(tmpDir, file), 0o755)\n\t\t\trequire.NoError(t, err)\n\t\t} else {\n\t\t\t// Create file with some content\n\t\t\tcontent := []byte(\"// Database \" + file + \"\\npackage db\\n\\ntype \" + file[:len(file)-3] + \" struct{}\\n\")\n\t\t\terr := os.WriteFile(filepath.Join(tmpDir, file), content, 0o644)\n\t\t\trequire.NoError(t, err)\n\t\t}\n\t}\n\n\t// Test the error parsing and recovery logic\n\tmockError := fmt.Errorf(\"Path is a directory, not a file: %s\", tmpDir)\n\n\t// Test the error parsing logic\n\tparts := strings.Split(mockError.Error(), \": \")\n\trequire.Len(t, parts, 2)\n\tdirPath := strings.TrimSpace(parts[1])\n\trequire.Equal(t, tmpDir, dirPath)\n\n\t// Test that we can read the directory\n\tdirEntries, err := os.ReadDir(dirPath)\n\trequire.NoError(t, err)\n\trequire.Len(t, dirEntries, 3)\n\n\t// Verify we can build the recovery response\n\tvar fileList []string\n\tfor _, entry := range dirEntries {\n\t\tfileList = append(fileList, entry.Name())\n\t}\n\n\trecoveryResponse := fmt.Sprintf(\"Path is a directory: %s\\n\\nDirectory contents:\\n\", dirPath)\n\tfor i, file := range fileList {\n\t\trecoveryResponse += strconv.Itoa(i+1) + \". \" + file + \"\\n\"\n\t}\n\n\trecoveryResponse += \"\\n\ud83d\udca1 Suggestions:\\n\"\n\trecoveryResponse += \"- Use 'view' with a specific file path (e.g., 'view \" + dirPath + \"/filename')\\n\"\n\trecoveryResponse += \"- Use 'ls' command to explore directory structure\\n\"\n\trecoveryResponse += \"- Try 'find' to search for specific files\\n\"\n\n\t// Verify the recovery response is helpful\n\trequire.Contains(t, recoveryResponse, \"Path is a directory\")\n\trequire.Contains(t, recoveryResponse, \"Directory contents\")\n\trequire.Contains(t, recoveryResponse, \"db.go\")\n\trequire.Contains(t, recoveryResponse, \"models.go\")\n\trequire.Contains(t, recoveryResponse, \"\ud83d\udca1 Suggestions\")\n\trequire.Contains(t, recoveryResponse, \"Use 'view' with a specific file path\")\n\trequire.Contains(t, recoveryResponse, \"Use 'ls' command\")\n\trequire.Contains(t, recoveryResponse, \"Try 'find'\")\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}