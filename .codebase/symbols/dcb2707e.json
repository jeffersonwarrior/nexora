{
  "file_path": "/work/context-engine/vscode-extension/context-engine-uploader/profiles.js",
  "file_hash": "5d0d8b6a8ae992010fe2973caea3d72458a94677",
  "updated_at": "2025-12-26T17:34:22.462937",
  "symbols": {
    "function_init_15": {
      "name": "init",
      "type": "function",
      "start_line": 15,
      "end_line": 27,
      "content_hash": "471ec062cc32c788c6f81a7a754f56c2467afda7",
      "content": "function init({ vscode, context, log, onProfileChanged }) {\n  _vscode = vscode;\n  _context = context;\n  _log = typeof log === 'function' ? log : () => {};\n  _onProfileChanged = typeof onProfileChanged === 'function' ? onProfileChanged : () => {};\n  try {\n    if (_context && _context.globalState && typeof _context.globalState.setKeysForSync === 'function') {\n      _context.globalState.setKeysForSync([PROFILES_DB_KEY, ACTIVE_PROFILE_KEY]);\n    }\n  } catch (_) {\n  }\n  ensureGlobalStorageDir();\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_loadProfilesDbFromGlobalState_29": {
      "name": "loadProfilesDbFromGlobalState",
      "type": "function",
      "start_line": 29,
      "end_line": 41,
      "content_hash": "9cde437422532f7796e31c0d6b59e15d8b0ab5c3",
      "content": "function loadProfilesDbFromGlobalState() {\n  try {\n    if (!_context || !_context.globalState) {\n      return undefined;\n    }\n    const raw = _context.globalState.get(PROFILES_DB_KEY);\n    if (raw && typeof raw === 'object' && Array.isArray(raw.profiles)) {\n      return { version: 1, ...raw };\n    }\n  } catch (_) {\n  }\n  return undefined;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_loadProfilesDbFromSettings_43": {
      "name": "loadProfilesDbFromSettings",
      "type": "function",
      "start_line": 43,
      "end_line": 71,
      "content_hash": "1a76b66e1adae8bb07f371aac515c9b3cce202b8",
      "content": "function loadProfilesDbFromSettings() {\n  try {\n    if (!_vscode || !_vscode.workspace || typeof _vscode.workspace.getConfiguration !== 'function') {\n      return undefined;\n    }\n    const cfg = _vscode.workspace.getConfiguration('contextEngineUploader');\n    let raw;\n    try {\n      if (cfg && typeof cfg.inspect === 'function') {\n        const inspected = cfg.inspect(PROFILES_DB_SETTING_KEY);\n        if (inspected) {\n          if (inspected.workspaceFolderValue !== undefined) {\n            raw = inspected.workspaceFolderValue;\n          } else if (inspected.workspaceValue !== undefined) {\n            raw = inspected.workspaceValue;\n          } else if (inspected.globalValue !== undefined) {\n            raw = inspected.globalValue;\n          }\n        }\n      }\n    } catch (_) {\n    }\n    if (raw && typeof raw === 'object' && Array.isArray(raw.profiles)) {\n      return { version: 1, ...raw };\n    }\n  } catch (_) {\n  }\n  return undefined;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_saveProfilesDbToGlobalState_73": {
      "name": "saveProfilesDbToGlobalState",
      "type": "function",
      "start_line": 73,
      "end_line": 83,
      "content_hash": "9616bffff2ab053d81aaab9b264366cb14c88261",
      "content": "async function saveProfilesDbToGlobalState(db) {\n  try {\n    if (!_context || !_context.globalState || typeof _context.globalState.update !== 'function') {\n      return false;\n    }\n    await _context.globalState.update(PROFILES_DB_KEY, db || { version: 1, profiles: [] });\n    return true;\n  } catch (_) {\n    return false;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_saveProfilesDbToSettings_85": {
      "name": "saveProfilesDbToSettings",
      "type": "function",
      "start_line": 85,
      "end_line": 102,
      "content_hash": "52431df836430b8857dac53cad8fc0905f98e26c",
      "content": "async function saveProfilesDbToSettings(db) {\n  try {\n    if (!_vscode || !_vscode.workspace || typeof _vscode.workspace.getConfiguration !== 'function') {\n      return false;\n    }\n    const cfg = _vscode.workspace.getConfiguration('contextEngineUploader');\n    if (!cfg || typeof cfg.update !== 'function') {\n      return false;\n    }\n    const target = (_vscode.ConfigurationTarget && _vscode.ConfigurationTarget.Global !== undefined)\n      ? _vscode.ConfigurationTarget.Global\n      : true;\n    await cfg.update(PROFILES_DB_SETTING_KEY, db || { version: 1, profiles: [] }, target);\n    return true;\n  } catch (_) {\n    return false;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_ensureGlobalStorageDir_104": {
      "name": "ensureGlobalStorageDir",
      "type": "function",
      "start_line": 104,
      "end_line": 114,
      "content_hash": "f3aa2e2fc2995a0fde45812028a2e69cb32fa988",
      "content": "function ensureGlobalStorageDir() {\n  try {\n    if (!_context || !_context.globalStorageUri || !_context.globalStorageUri.fsPath) {\n      return false;\n    }\n    fs.mkdirSync(_context.globalStorageUri.fsPath, { recursive: true });\n    return true;\n  } catch (_) {\n    return false;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getProfilesDbPath_116": {
      "name": "getProfilesDbPath",
      "type": "function",
      "start_line": 116,
      "end_line": 121,
      "content_hash": "a2020deccbeb3bffe4e43a802c6da94907c3474c",
      "content": "function getProfilesDbPath() {\n  if (!_context || !_context.globalStorageUri || !_context.globalStorageUri.fsPath) {\n    return undefined;\n  }\n  return path.join(_context.globalStorageUri.fsPath, PROFILES_DB_FILENAME);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_loadProfilesDb_123": {
      "name": "loadProfilesDb",
      "type": "function",
      "start_line": 123,
      "end_line": 161,
      "content_hash": "b43bb2c77a3787e9785bb4d3b15989261bbf92f8",
      "content": "function loadProfilesDb() {\n  const fromSettings = loadProfilesDbFromSettings();\n  if (fromSettings) {\n    return fromSettings;\n  }\n  const mem = loadProfilesDbFromGlobalState();\n  if (mem) {\n    try {\n      saveProfilesDbToSettings(mem).catch(() => {});\n    } catch (_) {\n    }\n    return mem;\n  }\n  const dbPath = getProfilesDbPath();\n  if (!dbPath) {\n    return { version: 1, profiles: [] };\n  }\n  if (!fs.existsSync(dbPath)) {\n    return { version: 1, profiles: [] };\n  }\n  try {\n    const raw = fs.readFileSync(dbPath, 'utf8');\n    const parsed = JSON.parse(raw);\n    if (parsed && typeof parsed === 'object' && Array.isArray(parsed.profiles)) {\n      const db = { version: 1, ...parsed };\n      try {\n        saveProfilesDbToGlobalState(db);\n      } catch (_) {\n      }\n      try {\n        saveProfilesDbToSettings(db).catch(() => {});\n      } catch (_) {\n      }\n      return db;\n    }\n  } catch (_) {\n  }\n  return { version: 1, profiles: [] };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_saveProfilesDb_163": {
      "name": "saveProfilesDb",
      "type": "function",
      "start_line": 163,
      "end_line": 183,
      "content_hash": "d09316ae8b602acd98c1c0203efd2e157484c290",
      "content": "async function saveProfilesDb(db) {\n  let saved = false;\n  try {\n    saved = (await saveProfilesDbToSettings(db)) || saved;\n  } catch (_) {\n  }\n  try {\n    saved = (await saveProfilesDbToGlobalState(db)) || saved;\n  } catch (_) {\n  }\n  const dbPath = getProfilesDbPath();\n  if (dbPath) {\n    try {\n      const payload = JSON.stringify(db || { version: 1, profiles: [] }, null, 2) + '\\n';\n      fs.writeFileSync(dbPath, payload, 'utf8');\n      saved = true;\n    } catch (_) {\n    }\n  }\n  return saved;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_generateProfileId_185": {
      "name": "generateProfileId",
      "type": "function",
      "start_line": 185,
      "end_line": 187,
      "content_hash": "0668883e79016d0597b9c0fd70f7938eaeb28013",
      "content": "function generateProfileId() {\n  return `p_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 10)}`;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getActiveProfileId_189": {
      "name": "getActiveProfileId",
      "type": "function",
      "start_line": 189,
      "end_line": 205,
      "content_hash": "5c3b8d74dec147692452f56f774bb1cbe2deedeb",
      "content": "function getActiveProfileId() {\n  try {\n    if (_context && _context.workspaceState) {\n      const raw = _context.workspaceState.get(ACTIVE_PROFILE_KEY);\n      return typeof raw === 'string' ? raw : undefined;\n    }\n  } catch (_) {\n  }\n  try {\n    if (_context && _context.globalState) {\n      const raw = _context.globalState.get(ACTIVE_PROFILE_KEY);\n      return typeof raw === 'string' ? raw : undefined;\n    }\n  } catch (_) {\n  }\n  return undefined;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_setActiveProfileId_207": {
      "name": "setActiveProfileId",
      "type": "function",
      "start_line": 207,
      "end_line": 224,
      "content_hash": "bec12299b020930e72f4d71e5f7f0bf3a43a919f",
      "content": "async function setActiveProfileId(profileId) {\n  try {\n    if (_context && _context.workspaceState) {\n      await _context.workspaceState.update(ACTIVE_PROFILE_KEY, profileId || undefined);\n    }\n  } catch (_) {\n  }\n  try {\n    if (_context && _context.globalState && typeof _context.globalState.update === 'function') {\n      await _context.globalState.update(ACTIVE_PROFILE_KEY, profileId || undefined);\n    }\n  } catch (_) {\n  }\n  try {\n    _onProfileChanged();\n  } catch (_) {\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getActiveProfile_226": {
      "name": "getActiveProfile",
      "type": "function",
      "start_line": 226,
      "end_line": 234,
      "content_hash": "032d360167398cb61697e2fc68a89bf31e5e3daf",
      "content": "function getActiveProfile() {\n  const id = getActiveProfileId();\n  if (!id) {\n    return undefined;\n  }\n  const db = loadProfilesDb();\n  const profiles = Array.isArray(db.profiles) ? db.profiles : [];\n  return profiles.find(p => p && typeof p === 'object' && p.id === id);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getActiveProfileSummary_236": {
      "name": "getActiveProfileSummary",
      "type": "function",
      "start_line": 236,
      "end_line": 245,
      "content_hash": "b025aef244097af7a6eee1d8dbb9d2c767ea0e9c",
      "content": "function getActiveProfileSummary() {\n  const p = getActiveProfile();\n  if (!p) {\n    return { id: undefined, name: undefined };\n  }\n  return {\n    id: typeof p.id === 'string' ? p.id : undefined,\n    name: typeof p.name === 'string' ? p.name : undefined,\n  };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_listProfiles_247": {
      "name": "listProfiles",
      "type": "function",
      "start_line": 247,
      "end_line": 264,
      "content_hash": "506d1859866148b5f2d74c7312279bdd07086412",
      "content": "function listProfiles() {\n  const db = loadProfilesDb();\n  const profiles = Array.isArray(db.profiles) ? db.profiles : [];\n  return profiles\n    .filter(p => p && typeof p === 'object')\n    .map(p => ({\n      id: typeof p.id === 'string' ? p.id : '',\n      name: typeof p.name === 'string' ? p.name : '',\n    }))\n    .filter(p => !!p.id)\n    .sort((a, b) => {\n      const an = (a.name || a.id).toLowerCase();\n      const bn = (b.name || b.id).toLowerCase();\n      if (an < bn) return -1;\n      if (an > bn) return 1;\n      return 0;\n    });\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getActiveProfileOverrides_266": {
      "name": "getActiveProfileOverrides",
      "type": "function",
      "start_line": 266,
      "end_line": 276,
      "content_hash": "61bc5af7a037312dd06865427e32b7061209847f",
      "content": "function getActiveProfileOverrides() {\n  const profile = getActiveProfile();\n  if (!profile || typeof profile !== 'object') {\n    return {};\n  }\n  const overrides = profile.overrides;\n  if (!overrides || typeof overrides !== 'object') {\n    return {};\n  }\n  return overrides;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_getUploaderConfig_278": {
      "name": "getUploaderConfig",
      "type": "function",
      "start_line": 278,
      "end_line": 299,
      "content_hash": "7447ccf6c17956c167908cb9fd4a94b44a13de9f",
      "content": "function getUploaderConfig() {\n  if (!_vscode) {\n    throw new Error('profiles.getUploaderConfig called before profiles.init');\n  }\n  const cfg = _vscode.workspace.getConfiguration('contextEngineUploader');\n  const overrides = getActiveProfileOverrides();\n  return {\n    get: (key, defaultValue) => {\n      if (Object.prototype.hasOwnProperty.call(overrides, key)) {\n        return overrides[key];\n      }\n      return cfg.get(key, defaultValue);\n    },\n    inspect: (key) => {\n      try {\n        return typeof cfg.inspect === 'function' ? cfg.inspect(key) : undefined;\n      } catch (_) {\n        return undefined;\n      }\n    },\n  };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_deepEqual_301": {
      "name": "deepEqual",
      "type": "function",
      "start_line": 301,
      "end_line": 307,
      "content_hash": "54d565e904f3f42ff306223f8746cef465068626",
      "content": "function deepEqual(a, b) {\n  try {\n    return JSON.stringify(a) === JSON.stringify(b);\n  } catch (_) {\n    return a === b;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_pickNonDefaultSetting_309": {
      "name": "pickNonDefaultSetting",
      "type": "function",
      "start_line": 309,
      "end_line": 331,
      "content_hash": "4424cc5d183d6d66ab413d7e3392a66030f8775e",
      "content": "function pickNonDefaultSetting(cfg, key) {\n  if (!cfg || typeof cfg.get !== 'function') {\n    return undefined;\n  }\n  const current = cfg.get(key);\n  let inspected;\n  try {\n    inspected = typeof cfg.inspect === 'function' ? cfg.inspect(key) : undefined;\n  } catch (_) {\n    inspected = undefined;\n  }\n  const defaultValue = inspected && Object.prototype.hasOwnProperty.call(inspected, 'defaultValue') ? inspected.defaultValue : undefined;\n  if (defaultValue !== undefined && deepEqual(current, defaultValue)) {\n    return undefined;\n  }\n  if (current === undefined) {\n    return undefined;\n  }\n  if (typeof current === 'string' && !current.trim()) {\n    return undefined;\n  }\n  return current;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_normalizeProfileName_333": {
      "name": "normalizeProfileName",
      "type": "function",
      "start_line": 333,
      "end_line": 335,
      "content_hash": "753955ab761addf7acda24ac72aa53c197e27805",
      "content": "function normalizeProfileName(name) {\n  return (name || '').trim();\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_setupWorkspaceWizard_337": {
      "name": "setupWorkspaceWizard",
      "type": "function",
      "start_line": 337,
      "end_line": 490,
      "content_hash": "aa4d5e52ee49fae2a880345cac6437a956ee8e64",
      "content": "async function setupWorkspaceWizard(deps) {\n  if (!_vscode) {\n    return;\n  }\n  try {\n    ensureGlobalStorageDir();\n  } catch (_) {\n  }\n  const rawCfg = _vscode.workspace.getConfiguration('contextEngineUploader');\n\n  let inferredTarget = '';\n  try {\n    const res = deps && typeof deps.resolveTargetPathFromConfig === 'function' ? deps.resolveTargetPathFromConfig(rawCfg) : undefined;\n    if (res && res.path) {\n      inferredTarget = String(res.path);\n    }\n  } catch (_) {\n  }\n\n  try {\n    if (!inferredTarget && deps && typeof deps.getWorkspaceFolderPath === 'function' && typeof deps.detectDefaultTargetPath === 'function') {\n      const ws = deps.getWorkspaceFolderPath();\n      if (ws) {\n        inferredTarget = String(deps.detectDefaultTargetPath(ws) || '');\n      }\n    }\n  } catch (_) {\n  }\n\n  const profileName = normalizeProfileName(await _vscode.window.showInputBox({\n    prompt: 'Profile name (stored in VS Code extension storage; syncable via Settings Sync)',\n    value: 'default',\n    ignoreFocusOut: true,\n  }));\n  if (!profileName) {\n    return;\n  }\n\n  const endpointDefault = (rawCfg.get('endpoint') || 'http://localhost:8004').trim();\n  const endpoint = normalizeProfileName(await _vscode.window.showInputBox({\n    prompt: 'Upload service endpoint (e.g. http://localhost:8004)',\n    value: endpointDefault,\n    ignoreFocusOut: true,\n  }));\n  if (!endpoint) {\n    return;\n  }\n\n  const normalizeWorkspace = deps && typeof deps.normalizeWorkspaceForBridge === 'function'\n    ? deps.normalizeWorkspaceForBridge\n    : (p) => (p || '');\n\n  const targetPath = normalizeProfileName(normalizeWorkspace(await _vscode.window.showInputBox({\n    prompt: 'Target path to index/watch',\n    value: inferredTarget,\n    ignoreFocusOut: true,\n  })));\n  if (!targetPath) {\n    return;\n  }\n\n  let healthOk = true;\n  try {\n    const fetchFn = deps && typeof deps.fetch === 'function' ? deps.fetch : (typeof fetch === 'function' ? fetch : undefined);\n    if (fetchFn) {\n      const base = endpoint.replace(/\\/+$/, '');\n      const res = await fetchFn(`${base}/health`, { method: 'GET' });\n      healthOk = !!(res && res.ok);\n    }\n  } catch (_) {\n    healthOk = false;\n  }\n\n  if (!healthOk) {\n    const choice = await _vscode.window.showWarningMessage(\n      'Context Engine Uploader: upload endpoint did not respond to /health. Save profile anyway?',\n      'Save anyway',\n      'Cancel',\n    );\n    if (choice !== 'Save anyway') {\n      return;\n    }\n  }\n\n  const serverMode = await _vscode.window.showQuickPick(\n    ['bridge', 'direct'],\n    { placeHolder: 'MCP server mode (optional)' },\n  );\n  const transportMode = await _vscode.window.showQuickPick(\n    ['http', 'sse-remote'],\n    { placeHolder: 'MCP transport mode (optional)' },\n  );\n\n  const overrides = {\n    endpoint,\n    targetPath,\n  };\n  if (serverMode) {\n    overrides.mcpServerMode = serverMode;\n  }\n  if (transportMode) {\n    overrides.mcpTransportMode = transportMode;\n  }\n\n  const db = loadProfilesDb();\n  const profiles = Array.isArray(db.profiles) ? db.profiles : [];\n  const existing = profiles.find(p => p && typeof p === 'object' && (p.name || '').trim() === profileName);\n  const now = new Date().toISOString();\n\n  let activeId;\n  if (existing) {\n    existing.overrides = { ...(existing.overrides || {}), ...overrides };\n    existing.updatedAt = now;\n    activeId = existing.id;\n  } else {\n    activeId = generateProfileId();\n    profiles.push({\n      id: activeId,\n      name: profileName,\n      createdAt: now,\n      updatedAt: now,\n      overrides,\n    });\n  }\n\n  db.profiles = profiles;\n  if (!await saveProfilesDb(db)) {\n    _vscode.window.showErrorMessage('Context Engine Uploader: failed to save profiles database.');\n    return;\n  }\n\n  await setActiveProfileId(activeId);\n  _vscode.window.showInformationMessage(`Context Engine Uploader: active profile set to \"${profileName}\".`);\n\n  const next = await _vscode.window.showQuickPick(\n    ['Write MCP Config now', 'Write CTX Config now', 'Write MCP + CTX Config now', 'Index Codebase now', 'Done'],\n    { placeHolder: 'Next step' },\n  );\n  if (!next) {\n    return;\n  }\n\n  if ((next === 'Write MCP Config now' || next === 'Write MCP + CTX Config now') && deps && typeof deps.writeMcpConfig === 'function') {\n    await deps.writeMcpConfig();\n  }\n\n  if ((next === 'Write CTX Config now' || next === 'Write MCP + CTX Config now') && deps && typeof deps.writeCtxConfig === 'function') {\n    await deps.writeCtxConfig();\n  }\n\n  if (next === 'Index Codebase now' && deps && typeof deps.runSequence === 'function') {\n    await deps.runSequence('force');\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_switchProfileWizard_492": {
      "name": "switchProfileWizard",
      "type": "function",
      "start_line": 492,
      "end_line": 512,
      "content_hash": "d8795da96facdae52cddfcd8e7dfc7033eb5c652",
      "content": "async function switchProfileWizard() {\n  if (!_vscode) {\n    return;\n  }\n  const db = loadProfilesDb();\n  const profiles = Array.isArray(db.profiles) ? db.profiles : [];\n  const items = [{ label: 'None (use VS Code settings)', id: '' }]\n    .concat(profiles\n      .filter(p => p && typeof p === 'object')\n      .map(p => ({ label: `${(p.name || p.id || '').trim() || 'Unnamed profile'}`, description: p.id, id: p.id })));\n  const picked = await _vscode.window.showQuickPick(items, { placeHolder: 'Select active profile' });\n  if (!picked) {\n    return;\n  }\n  await setActiveProfileId(picked.id || undefined);\n  if (!picked.id) {\n    _vscode.window.showInformationMessage('Context Engine Uploader: using VS Code settings (no active profile).');\n  } else {\n    _vscode.window.showInformationMessage(`Context Engine Uploader: switched active profile to \"${picked.label}\".`);\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_createProfileFromCurrentSettingsWizard_514": {
      "name": "createProfileFromCurrentSettingsWizard",
      "type": "function",
      "start_line": 514,
      "end_line": 590,
      "content_hash": "94fcd7761d38b28b6e006e7fbcb4847703354e3b",
      "content": "async function createProfileFromCurrentSettingsWizard() {\n  if (!_vscode) {\n    return;\n  }\n  try {\n    ensureGlobalStorageDir();\n  } catch (_) {\n  }\n  const cfg = _vscode.workspace.getConfiguration('contextEngineUploader');\n  const name = normalizeProfileName(await _vscode.window.showInputBox({\n    prompt: 'Profile name',\n    ignoreFocusOut: true,\n  }));\n  if (!name) {\n    return;\n  }\n\n  const keys = [\n    'endpoint',\n    'targetPath',\n    'hostRoot',\n    'containerRoot',\n    'pythonPath',\n    'intervalSeconds',\n    'extraForceArgs',\n    'extraWatchArgs',\n    'startWatchAfterForce',\n    'mcpClaudeEnabled',\n    'mcpWindsurfEnabled',\n    'autoWriteMcpConfigOnStartup',\n    'mcpTransportMode',\n    'mcpServerMode',\n    'mcpIndexerUrl',\n    'mcpMemoryUrl',\n    'autoStartMcpBridge',\n    'mcpBridgePort',\n    'mcpBridgeBinPath',\n    'mcpBridgeLocalOnly',\n    'claudeHookEnabled',\n    'surfaceQdrantCollectionHint',\n    'devRemoteMode',\n    'scaffoldCtxConfig',\n    'decoderRuntime',\n    'decoderUrl',\n    'useGpuDecoder',\n    'ctxIndexerUrl',\n    'gitMaxCommits',\n    'gitSince',\n  ];\n\n  const overrides = {};\n  for (const key of keys) {\n    const value = pickNonDefaultSetting(cfg, key);\n    if (value !== undefined) {\n      overrides[key] = value;\n    }\n  }\n\n  const now = new Date().toISOString();\n  const db = loadProfilesDb();\n  const profiles = Array.isArray(db.profiles) ? db.profiles : [];\n  const id = generateProfileId();\n  profiles.push({\n    id,\n    name,\n    createdAt: now,\n    updatedAt: now,\n    overrides,\n  });\n  db.profiles = profiles;\n  if (!await saveProfilesDb(db)) {\n    _vscode.window.showErrorMessage('Context Engine Uploader: failed to save profiles database.');\n    return;\n  }\n  await setActiveProfileId(id);\n  _vscode.window.showInformationMessage(`Context Engine Uploader: created and activated profile \"${name}\".`);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_exportProfilesWizard_592": {
      "name": "exportProfilesWizard",
      "type": "function",
      "start_line": 592,
      "end_line": 613,
      "content_hash": "afd3a913894afbaaa765901082c0920bb604e601",
      "content": "async function exportProfilesWizard() {\n  if (!_vscode) {\n    return;\n  }\n  const db = loadProfilesDb();\n  const uri = await _vscode.window.showSaveDialog({\n    title: 'Export Context Engine Uploader profiles',\n    filters: { JSON: ['json'] },\n    saveLabel: 'Export',\n  });\n  if (!uri) {\n    return;\n  }\n  try {\n    const payload = JSON.stringify(db || { version: 1, profiles: [] }, null, 2) + '\\n';\n    await _vscode.workspace.fs.writeFile(uri, Buffer.from(payload, 'utf8'));\n    _vscode.window.showInformationMessage('Context Engine Uploader: profiles exported.');\n  } catch (error) {\n    _vscode.window.showErrorMessage('Context Engine Uploader: failed to export profiles.');\n    _log(`Export profiles failed: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_importProfilesWizard_615": {
      "name": "importProfilesWizard",
      "type": "function",
      "start_line": 615,
      "end_line": 686,
      "content_hash": "98f800e26727bb24c0cfda22f6878bc2f910e1dc",
      "content": "async function importProfilesWizard() {\n  if (!_vscode) {\n    return;\n  }\n  try {\n    ensureGlobalStorageDir();\n  } catch (_) {\n  }\n  const uris = await _vscode.window.showOpenDialog({\n    title: 'Import Context Engine Uploader profiles',\n    canSelectMany: false,\n    filters: { JSON: ['json'] },\n  });\n  if (!uris || !uris.length) {\n    return;\n  }\n\n  let parsed;\n  try {\n    const bytes = await _vscode.workspace.fs.readFile(uris[0]);\n    parsed = JSON.parse(Buffer.from(bytes).toString('utf8'));\n  } catch (error) {\n    _vscode.window.showErrorMessage('Context Engine Uploader: invalid profiles JSON.');\n    _log(`Import profiles parse failed: ${error instanceof Error ? error.message : String(error)}`);\n    return;\n  }\n\n  const incoming = parsed && typeof parsed === 'object' && Array.isArray(parsed.profiles) ? parsed.profiles : [];\n  if (!incoming.length) {\n    _vscode.window.showWarningMessage('Context Engine Uploader: no profiles found in import file.');\n    return;\n  }\n\n  const db = loadProfilesDb();\n  const profiles = Array.isArray(db.profiles) ? db.profiles : [];\n\n  for (const p of incoming) {\n    if (!p || typeof p !== 'object') {\n      continue;\n    }\n    const pid = typeof p.id === 'string' ? p.id : '';\n    const pname = typeof p.name === 'string' ? p.name.trim() : '';\n    if (!pid && !pname) {\n      continue;\n    }\n    const existing = pid\n      ? profiles.find(x => x && typeof x === 'object' && x.id === pid)\n      : profiles.find(x => x && typeof x === 'object' && (x.name || '').trim() === pname);\n\n    if (existing) {\n      existing.name = pname || existing.name;\n      existing.overrides = { ...(existing.overrides || {}), ...(p.overrides || {}) };\n      existing.updatedAt = new Date().toISOString();\n    } else {\n      profiles.push({\n        id: pid || generateProfileId(),\n        name: pname || 'Imported Profile',\n        createdAt: p.createdAt || new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n        overrides: (p.overrides && typeof p.overrides === 'object') ? p.overrides : {},\n      });\n    }\n  }\n\n  db.profiles = profiles;\n  if (!await saveProfilesDb(db)) {\n    _vscode.window.showErrorMessage('Context Engine Uploader: failed to save profiles database after import.');\n    return;\n  }\n\n  _vscode.window.showInformationMessage(`Context Engine Uploader: imported ${incoming.length} profile(s).`);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_registerCommands_688": {
      "name": "registerCommands",
      "type": "function",
      "start_line": 688,
      "end_line": 699,
      "content_hash": "ec900a3266b658b3370ed83aa5a83443f2554b8c",
      "content": "function registerCommands(deps) {\n  if (!_vscode || !_context) {\n    throw new Error('profiles.registerCommands called before profiles.init');\n  }\n  return [\n    _vscode.commands.registerCommand('contextEngineUploader.setupWorkspace', () => setupWorkspaceWizard(deps)),\n    _vscode.commands.registerCommand('contextEngineUploader.switchProfile', () => switchProfileWizard()),\n    _vscode.commands.registerCommand('contextEngineUploader.createProfileFromCurrentSettings', () => createProfileFromCurrentSettingsWizard()),\n    _vscode.commands.registerCommand('contextEngineUploader.exportProfiles', () => exportProfilesWizard()),\n    _vscode.commands.registerCommand('contextEngineUploader.importProfiles', () => importProfilesWizard()),\n  ];\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}