{
  "file_path": "/work/internal/tui/exp/diffview/diffview.go",
  "file_hash": "6ec269bfbde3f2728f9d0759f2d0896e6035fa4e",
  "updated_at": "2025-12-26T17:34:22.443127",
  "symbols": {
    "struct_file_22": {
      "name": "file",
      "type": "struct",
      "start_line": 22,
      "end_line": 34,
      "content_hash": "f09aa61819ee89d6bddabce669310d085fbd3e98",
      "content": "type file struct {\n\tpath    string\n\tcontent string\n}\n\ntype layout int\n\nconst (\n\tlayoutUnified layout = iota + 1\n\tlayoutSplit\n)\n\n// DiffView represents a view for displaying differences between two files.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_DiffView_35": {
      "name": "DiffView",
      "type": "struct",
      "start_line": 35,
      "end_line": 72,
      "content_hash": "5b08c17c260ddaeb26b43b3a04396ede4244a8cb",
      "content": "type DiffView struct {\n\tlayout          layout\n\tbefore          file\n\tafter           file\n\tcontextLines    int\n\tlineNumbers     bool\n\theight          int\n\twidth           int\n\txOffset         int\n\tyOffset         int\n\tinfiniteYScroll bool\n\tstyle           Style\n\ttabWidth        int\n\tchromaStyle     *chroma.Style\n\n\tisComputed bool\n\terr        error\n\tunified    udiff.UnifiedDiff\n\tedits      []udiff.Edit\n\n\tsplitHunks []splitHunk\n\n\ttotalLines      int\n\tcodeWidth       int\n\tfullCodeWidth   int  // with leading symbols\n\textraColOnAfter bool // add extra column on after panel\n\tbeforeNumDigits int\n\tafterNumDigits  int\n\n\t// Cache lexer to avoid expensive file pattern matching on every line\n\tcachedLexer chroma.Lexer\n\n\t// Cache highlighted lines to avoid re-highlighting the same content\n\t// Key: hash of (content + background color), Value: highlighted string\n\tsyntaxCache map[string]string\n}\n\n// New creates a new DiffView with default settings.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_New_73": {
      "name": "New",
      "type": "function",
      "start_line": 73,
      "end_line": 85,
      "content_hash": "f219618659a73b7d63667a8c3b2ba6a3056e8af6",
      "content": "func New() *DiffView {\n\tdv := &DiffView{\n\t\tlayout:       layoutUnified,\n\t\tcontextLines: udiff.DefaultContextLines,\n\t\tlineNumbers:  true,\n\t\ttabWidth:     8,\n\t\tsyntaxCache:  make(map[string]string),\n\t}\n\tdv.style = DefaultDarkStyle()\n\treturn dv\n}\n\n// Unified sets the layout of the DiffView to unified.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Unified_86": {
      "name": "Unified",
      "type": "method",
      "start_line": 86,
      "end_line": 91,
      "content_hash": "0a4b9be9fb882b82d835b39cfaffa1f2b811be6f",
      "content": "func (dv *DiffView) Unified() *DiffView {\n\tdv.layout = layoutUnified\n\treturn dv\n}\n\n// Split sets the layout of the DiffView to split (side-by-side).",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Split_92": {
      "name": "Split",
      "type": "method",
      "start_line": 92,
      "end_line": 97,
      "content_hash": "b1a5e097945d6e03457e1fd1f3e57d7a616c9e1f",
      "content": "func (dv *DiffView) Split() *DiffView {\n\tdv.layout = layoutSplit\n\treturn dv\n}\n\n// Before sets the \"before\" file for the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Before_98": {
      "name": "Before",
      "type": "method",
      "start_line": 98,
      "end_line": 105,
      "content_hash": "b3e3dcfb6c614615f74c8db780771d2f6cb0256b",
      "content": "func (dv *DiffView) Before(path, content string) *DiffView {\n\tdv.before = file{path: path, content: content}\n\t// Clear caches when content changes\n\tdv.clearCaches()\n\treturn dv\n}\n\n// After sets the \"after\" file for the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_After_106": {
      "name": "After",
      "type": "method",
      "start_line": 106,
      "end_line": 113,
      "content_hash": "4d77e8851ac2d0100f201a72bef43cc99812cf3a",
      "content": "func (dv *DiffView) After(path, content string) *DiffView {\n\tdv.after = file{path: path, content: content}\n\t// Clear caches when content changes\n\tdv.clearCaches()\n\treturn dv\n}\n\n// clearCaches clears all caches when content or major settings change.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_clearCaches_114": {
      "name": "clearCaches",
      "type": "method",
      "start_line": 114,
      "end_line": 120,
      "content_hash": "025e2a7d4074911787b8c81cf3d3b6421c11835f",
      "content": "func (dv *DiffView) clearCaches() {\n\tdv.cachedLexer = nil\n\tdv.clearSyntaxCache()\n\tdv.isComputed = false\n}\n\n// ContextLines sets the number of context lines for the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ContextLines_121": {
      "name": "ContextLines",
      "type": "method",
      "start_line": 121,
      "end_line": 126,
      "content_hash": "4eaf72d3ebdb43dd1b39acfea37aa3460e6abc2c",
      "content": "func (dv *DiffView) ContextLines(contextLines int) *DiffView {\n\tdv.contextLines = contextLines\n\treturn dv\n}\n\n// Style sets the style for the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Style_127": {
      "name": "Style",
      "type": "method",
      "start_line": 127,
      "end_line": 132,
      "content_hash": "fca1072be8405337ff145b12fb67b9d52653950c",
      "content": "func (dv *DiffView) Style(style Style) *DiffView {\n\tdv.style = style\n\treturn dv\n}\n\n// LineNumbers sets whether to display line numbers in the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_LineNumbers_133": {
      "name": "LineNumbers",
      "type": "method",
      "start_line": 133,
      "end_line": 138,
      "content_hash": "4bbbdc25e3337a35c54a79f298f9a82ff163f984",
      "content": "func (dv *DiffView) LineNumbers(lineNumbers bool) *DiffView {\n\tdv.lineNumbers = lineNumbers\n\treturn dv\n}\n\n// Height sets the height of the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Height_139": {
      "name": "Height",
      "type": "method",
      "start_line": 139,
      "end_line": 144,
      "content_hash": "64ff57fb68c71f2b156e6e767308399c3ac0fe5e",
      "content": "func (dv *DiffView) Height(height int) *DiffView {\n\tdv.height = height\n\treturn dv\n}\n\n// Width sets the width of the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Width_145": {
      "name": "Width",
      "type": "method",
      "start_line": 145,
      "end_line": 150,
      "content_hash": "a0583336bbaa5ca1d7fdb597e2c25bc1757667e7",
      "content": "func (dv *DiffView) Width(width int) *DiffView {\n\tdv.width = width\n\treturn dv\n}\n\n// XOffset sets the horizontal offset for the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_XOffset_151": {
      "name": "XOffset",
      "type": "method",
      "start_line": 151,
      "end_line": 156,
      "content_hash": "00af451f2fa01d759f144b333dcd197f5783dd31",
      "content": "func (dv *DiffView) XOffset(xOffset int) *DiffView {\n\tdv.xOffset = xOffset\n\treturn dv\n}\n\n// YOffset sets the vertical offset for the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_YOffset_157": {
      "name": "YOffset",
      "type": "method",
      "start_line": 157,
      "end_line": 162,
      "content_hash": "e6d3c2aa4503afd27e543c8c8329ed94518d4826",
      "content": "func (dv *DiffView) YOffset(yOffset int) *DiffView {\n\tdv.yOffset = yOffset\n\treturn dv\n}\n\n// InfiniteYScroll allows the YOffset to scroll beyond the last line.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_InfiniteYScroll_163": {
      "name": "InfiniteYScroll",
      "type": "method",
      "start_line": 163,
      "end_line": 169,
      "content_hash": "57e15df3d0cb565876679b424383e371d0004fbd",
      "content": "func (dv *DiffView) InfiniteYScroll(infiniteYScroll bool) *DiffView {\n\tdv.infiniteYScroll = infiniteYScroll\n\treturn dv\n}\n\n// TabWidth sets the tab width. Only relevant for code that contains tabs, like\n// Go code.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_TabWidth_170": {
      "name": "TabWidth",
      "type": "method",
      "start_line": 170,
      "end_line": 176,
      "content_hash": "0300812787622833d0e5b44a7f07f139b9e167c5",
      "content": "func (dv *DiffView) TabWidth(tabWidth int) *DiffView {\n\tdv.tabWidth = tabWidth\n\treturn dv\n}\n\n// ChromaStyle sets the chroma style for syntax highlighting.\n// If nil, no syntax highlighting will be applied.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ChromaStyle_177": {
      "name": "ChromaStyle",
      "type": "method",
      "start_line": 177,
      "end_line": 184,
      "content_hash": "06b838380a0a3484a4d39e9366f8177b8bcec8bf",
      "content": "func (dv *DiffView) ChromaStyle(style *chroma.Style) *DiffView {\n\tdv.chromaStyle = style\n\t// Clear syntax cache when style changes since highlighting will be different\n\tdv.clearSyntaxCache()\n\treturn dv\n}\n\n// clearSyntaxCache clears the syntax highlighting cache.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_clearSyntaxCache_185": {
      "name": "clearSyntaxCache",
      "type": "method",
      "start_line": 185,
      "end_line": 194,
      "content_hash": "533f37d0b1898f07134607eea8fda01118823b0b",
      "content": "func (dv *DiffView) clearSyntaxCache() {\n\tif dv.syntaxCache != nil {\n\t\t// Clear the map but keep it allocated\n\t\tfor k := range dv.syntaxCache {\n\t\t\tdelete(dv.syntaxCache, k)\n\t\t}\n\t}\n}\n\n// String returns the string representation of the DiffView.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_String_195": {
      "name": "String",
      "type": "method",
      "start_line": 195,
      "end_line": 231,
      "content_hash": "53fb934cd8159ffcb6b59701d8daad36be10ec0c",
      "content": "func (dv *DiffView) String() string {\n\tdv.normalizeLineEndings()\n\tdv.replaceTabs()\n\tif err := dv.computeDiff(); err != nil {\n\t\treturn err.Error()\n\t}\n\tdv.convertDiffToSplit()\n\tdv.adjustStyles()\n\tdv.detectNumDigits()\n\tdv.detectTotalLines()\n\tdv.preventInfiniteYScroll()\n\n\tif dv.width <= 0 {\n\t\tdv.detectCodeWidth()\n\t} else {\n\t\tdv.resizeCodeWidth()\n\t}\n\n\tstyle := lipgloss.NewStyle()\n\tif dv.width > 0 {\n\t\tstyle = style.MaxWidth(dv.width)\n\t}\n\tif dv.height > 0 {\n\t\tstyle = style.MaxHeight(dv.height)\n\t}\n\n\tswitch dv.layout {\n\tcase layoutUnified:\n\t\treturn style.Render(strings.TrimSuffix(dv.renderUnified(), \"\\n\"))\n\tcase layoutSplit:\n\t\treturn style.Render(strings.TrimSuffix(dv.renderSplit(), \"\\n\"))\n\tdefault:\n\t\tpanic(\"unknown diffview layout\")\n\t}\n}\n\n// normalizeLineEndings ensures the file contents use Unix-style line endings.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_normalizeLineEndings_232": {
      "name": "normalizeLineEndings",
      "type": "method",
      "start_line": 232,
      "end_line": 238,
      "content_hash": "110eddbb3a0afc353401ba5108e65daea50708c3",
      "content": "func (dv *DiffView) normalizeLineEndings() {\n\tdv.before.content = strings.ReplaceAll(dv.before.content, \"\\r\\n\", \"\\n\")\n\tdv.after.content = strings.ReplaceAll(dv.after.content, \"\\r\\n\", \"\\n\")\n}\n\n// replaceTabs replaces tabs in the before and after file contents with spaces\n// according to the specified tab width.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_replaceTabs_239": {
      "name": "replaceTabs",
      "type": "method",
      "start_line": 239,
      "end_line": 245,
      "content_hash": "f09f4c8c0c8959b688dc416765112389a52ec0b5",
      "content": "func (dv *DiffView) replaceTabs() {\n\tspaces := strings.Repeat(\" \", dv.tabWidth)\n\tdv.before.content = strings.ReplaceAll(dv.before.content, \"\\t\", spaces)\n\tdv.after.content = strings.ReplaceAll(dv.after.content, \"\\t\", spaces)\n}\n\n// computeDiff computes the differences between the \"before\" and \"after\" files.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_computeDiff_246": {
      "name": "computeDiff",
      "type": "method",
      "start_line": 246,
      "end_line": 266,
      "content_hash": "ffe46524ce375709550172842646da6bc187879a",
      "content": "func (dv *DiffView) computeDiff() error {\n\tif dv.isComputed {\n\t\treturn dv.err\n\t}\n\tdv.isComputed = true\n\tdv.edits = udiff.Strings(\n\t\tdv.before.content,\n\t\tdv.after.content,\n\t)\n\tdv.unified, dv.err = udiff.ToUnifiedDiff(\n\t\tdv.before.path,\n\t\tdv.after.path,\n\t\tdv.before.content,\n\t\tdv.edits,\n\t\tdv.contextLines,\n\t)\n\treturn dv.err\n}\n\n// convertDiffToSplit converts the unified diff to a split diff if the layout is\n// set to split.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_convertDiffToSplit_267": {
      "name": "convertDiffToSplit",
      "type": "method",
      "start_line": 267,
      "end_line": 278,
      "content_hash": "0f9e8d98c5a25c7615a7100b79c155675a1851ef",
      "content": "func (dv *DiffView) convertDiffToSplit() {\n\tif dv.layout != layoutSplit {\n\t\treturn\n\t}\n\n\tdv.splitHunks = make([]splitHunk, len(dv.unified.Hunks))\n\tfor i, h := range dv.unified.Hunks {\n\t\tdv.splitHunks[i] = hunkToSplit(h)\n\t}\n}\n\n// adjustStyles adjusts adds padding and alignment to the styles.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_adjustStyles_279": {
      "name": "adjustStyles",
      "type": "method",
      "start_line": 279,
      "end_line": 291,
      "content_hash": "3a249e8d474124bf317bffa2ec51c94b2b992548",
      "content": "func (dv *DiffView) adjustStyles() {\n\tsetPadding := func(s lipgloss.Style) lipgloss.Style {\n\t\treturn s.Padding(0, lineNumPadding).Align(lipgloss.Right)\n\t}\n\tdv.style.MissingLine.LineNumber = setPadding(dv.style.MissingLine.LineNumber)\n\tdv.style.DividerLine.LineNumber = setPadding(dv.style.DividerLine.LineNumber)\n\tdv.style.EqualLine.LineNumber = setPadding(dv.style.EqualLine.LineNumber)\n\tdv.style.InsertLine.LineNumber = setPadding(dv.style.InsertLine.LineNumber)\n\tdv.style.DeleteLine.LineNumber = setPadding(dv.style.DeleteLine.LineNumber)\n}\n\n// detectNumDigits calculates the maximum number of digits needed for before and\n// after line numbers.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_detectNumDigits_292": {
      "name": "detectNumDigits",
      "type": "method",
      "start_line": 292,
      "end_line": 301,
      "content_hash": "32cf61c3149ee1c3e01f4f09be6ca73b567cc9b3",
      "content": "func (dv *DiffView) detectNumDigits() {\n\tdv.beforeNumDigits = 0\n\tdv.afterNumDigits = 0\n\n\tfor _, h := range dv.unified.Hunks {\n\t\tdv.beforeNumDigits = max(dv.beforeNumDigits, len(strconv.Itoa(h.FromLine+len(h.Lines))))\n\t\tdv.afterNumDigits = max(dv.afterNumDigits, len(strconv.Itoa(h.ToLine+len(h.Lines))))\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_detectTotalLines_302": {
      "name": "detectTotalLines",
      "type": "method",
      "start_line": 302,
      "end_line": 316,
      "content_hash": "bbc7afe0bfbb1fc35524e33499eb42b676b45c21",
      "content": "func (dv *DiffView) detectTotalLines() {\n\tdv.totalLines = 0\n\n\tswitch dv.layout {\n\tcase layoutUnified:\n\t\tfor _, h := range dv.unified.Hunks {\n\t\t\tdv.totalLines += 1 + len(h.Lines)\n\t\t}\n\tcase layoutSplit:\n\t\tfor _, h := range dv.splitHunks {\n\t\t\tdv.totalLines += 1 + len(h.lines)\n\t\t}\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_preventInfiniteYScroll_317": {
      "name": "preventInfiniteYScroll",
      "type": "method",
      "start_line": 317,
      "end_line": 333,
      "content_hash": "ace9c12b72ffd89cd78264c62c97a22488052a37",
      "content": "func (dv *DiffView) preventInfiniteYScroll() {\n\tif dv.infiniteYScroll {\n\t\treturn\n\t}\n\n\t// clamp yOffset to prevent scrolling beyond the last line\n\tif dv.height > 0 {\n\t\tmaxYOffset := max(0, dv.totalLines-dv.height)\n\t\tdv.yOffset = min(dv.yOffset, maxYOffset)\n\t} else {\n\t\t// if no height limit, ensure yOffset doesn't exceed total lines\n\t\tdv.yOffset = min(dv.yOffset, max(0, dv.totalLines-1))\n\t}\n\tdv.yOffset = max(0, dv.yOffset) // ensure yOffset is not negative\n}\n\n// detectCodeWidth calculates the maximum width of code lines in the diff view.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_detectCodeWidth_334": {
      "name": "detectCodeWidth",
      "type": "method",
      "start_line": 334,
      "end_line": 345,
      "content_hash": "95d2a7183e70998bc30b1fc32d21c95f8b1b81f6",
      "content": "func (dv *DiffView) detectCodeWidth() {\n\tswitch dv.layout {\n\tcase layoutUnified:\n\t\tdv.detectUnifiedCodeWidth()\n\tcase layoutSplit:\n\t\tdv.detectSplitCodeWidth()\n\t}\n\tdv.fullCodeWidth = dv.codeWidth + leadingSymbolsSize\n}\n\n// detectUnifiedCodeWidth calculates the maximum width of code lines in a\n// unified diff.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_detectUnifiedCodeWidth_346": {
      "name": "detectUnifiedCodeWidth",
      "type": "method",
      "start_line": 346,
      "end_line": 360,
      "content_hash": "c92584da41684a9ef3e834daf8b4794cd1184a0f",
      "content": "func (dv *DiffView) detectUnifiedCodeWidth() {\n\tdv.codeWidth = 0\n\n\tfor _, h := range dv.unified.Hunks {\n\t\tshownLines := ansi.StringWidth(dv.hunkLineFor(h))\n\n\t\tfor _, l := range h.Lines {\n\t\t\tlineWidth := ansi.StringWidth(strings.TrimSuffix(l.Content, \"\\n\")) + 1\n\t\t\tdv.codeWidth = max(dv.codeWidth, lineWidth, shownLines)\n\t\t}\n\t}\n}\n\n// detectSplitCodeWidth calculates the maximum width of code lines in a\n// split diff.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_detectSplitCodeWidth_361": {
      "name": "detectSplitCodeWidth",
      "type": "method",
      "start_line": 361,
      "end_line": 380,
      "content_hash": "717763181bf4a52dfe0485be581804fccca4bd8a",
      "content": "func (dv *DiffView) detectSplitCodeWidth() {\n\tdv.codeWidth = 0\n\n\tfor i, h := range dv.splitHunks {\n\t\tshownLines := ansi.StringWidth(dv.hunkLineFor(dv.unified.Hunks[i]))\n\n\t\tfor _, l := range h.lines {\n\t\t\tif l.before != nil {\n\t\t\t\tcodeWidth := ansi.StringWidth(strings.TrimSuffix(l.before.Content, \"\\n\")) + 1\n\t\t\t\tdv.codeWidth = max(dv.codeWidth, codeWidth, shownLines)\n\t\t\t}\n\t\t\tif l.after != nil {\n\t\t\t\tcodeWidth := ansi.StringWidth(strings.TrimSuffix(l.after.Content, \"\\n\")) + 1\n\t\t\t\tdv.codeWidth = max(dv.codeWidth, codeWidth, shownLines)\n\t\t\t}\n\t\t}\n\t}\n}\n\n// resizeCodeWidth resizes the code width to fit within the specified width.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_resizeCodeWidth_381": {
      "name": "resizeCodeWidth",
      "type": "method",
      "start_line": 381,
      "end_line": 397,
      "content_hash": "d130cb9c4eac91c47cdfedca66b7c1f664410a8e",
      "content": "func (dv *DiffView) resizeCodeWidth() {\n\tfullNumWidth := dv.beforeNumDigits + dv.afterNumDigits\n\tfullNumWidth += lineNumPadding * 4 // left and right padding for both line numbers\n\n\tswitch dv.layout {\n\tcase layoutUnified:\n\t\tdv.codeWidth = dv.width - fullNumWidth - leadingSymbolsSize\n\tcase layoutSplit:\n\t\tremainingWidth := dv.width - fullNumWidth - leadingSymbolsSize*2\n\t\tdv.codeWidth = remainingWidth / 2\n\t\tdv.extraColOnAfter = isOdd(remainingWidth)\n\t}\n\n\tdv.fullCodeWidth = dv.codeWidth + leadingSymbolsSize\n}\n\n// renderUnified renders the unified diff view as a string.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_renderUnified_398": {
      "name": "renderUnified",
      "type": "method",
      "start_line": 398,
      "end_line": 506,
      "content_hash": "d7c067f249d5cd452d651811d31ab691464907ac",
      "content": "func (dv *DiffView) renderUnified() string {\n\tvar b strings.Builder\n\n\tfullContentStyle := lipgloss.NewStyle().MaxWidth(dv.fullCodeWidth)\n\tprintedLines := -dv.yOffset\n\tshouldWrite := func() bool { return printedLines >= 0 }\n\n\tgetContent := func(in string, ls LineStyle) (content string, leadingEllipsis bool) {\n\t\tcontent = strings.TrimSuffix(in, \"\\n\")\n\t\tcontent = dv.hightlightCode(content, ls.Code.GetBackground())\n\t\tcontent = ansi.GraphemeWidth.Cut(content, dv.xOffset, len(content))\n\t\tcontent = ansi.Truncate(content, dv.codeWidth, \"\u2026\")\n\t\tleadingEllipsis = dv.xOffset > 0 && strings.TrimSpace(content) != \"\"\n\t\treturn content, leadingEllipsis\n\t}\n\nouter:\n\tfor i, h := range dv.unified.Hunks {\n\t\tif shouldWrite() {\n\t\t\tls := dv.style.DividerLine\n\t\t\tif dv.lineNumbers {\n\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.beforeNumDigits)))\n\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.afterNumDigits)))\n\t\t\t}\n\t\t\tcontent := ansi.Truncate(dv.hunkLineFor(h), dv.fullCodeWidth, \"\u2026\")\n\t\t\tb.WriteString(ls.Code.Width(dv.fullCodeWidth).Render(content))\n\t\t\tb.WriteString(\"\\n\")\n\t\t}\n\t\tprintedLines++\n\n\t\tbeforeLine := h.FromLine\n\t\tafterLine := h.ToLine\n\n\t\tfor j, l := range h.Lines {\n\t\t\t// print ellipis if we don't have enough space to print the rest of the diff\n\t\t\thasReachedHeight := dv.height > 0 && printedLines+1 == dv.height\n\t\t\tisLastHunk := i+1 == len(dv.unified.Hunks)\n\t\t\tisLastLine := j+1 == len(h.Lines)\n\t\t\tif hasReachedHeight && (!isLastHunk || !isLastLine) {\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.lineStyleForType(l.Kind)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.beforeNumDigits)))\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(fullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth).Render(\"  \u2026\"),\n\t\t\t\t\t))\n\t\t\t\t\tb.WriteRune('\\n')\n\t\t\t\t}\n\t\t\t\tbreak outer\n\t\t\t}\n\n\t\t\tswitch l.Kind {\n\t\t\tcase udiff.Equal:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.EqualLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(beforeLine, dv.beforeNumDigits)))\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(afterLine, dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(fullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth).Render(ternary(leadingEllipsis, \" \u2026\", \"  \") + content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tbeforeLine++\n\t\t\t\tafterLine++\n\t\t\tcase udiff.Insert:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.InsertLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\" \", dv.beforeNumDigits)))\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(afterLine, dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(fullContentStyle.Render(\n\t\t\t\t\t\tls.Symbol.Render(ternary(leadingEllipsis, \"+\u2026\", \"+ \")) +\n\t\t\t\t\t\t\tls.Code.Width(dv.codeWidth).Render(content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tafterLine++\n\t\t\tcase udiff.Delete:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.DeleteLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(beforeLine, dv.beforeNumDigits)))\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\" \", dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(fullContentStyle.Render(\n\t\t\t\t\t\tls.Symbol.Render(ternary(leadingEllipsis, \"-\u2026\", \"- \")) +\n\t\t\t\t\t\t\tls.Code.Width(dv.codeWidth).Render(content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tbeforeLine++\n\t\t\t}\n\t\t\tif shouldWrite() {\n\t\t\t\tb.WriteRune('\\n')\n\t\t\t}\n\n\t\t\tprintedLines++\n\t\t}\n\t}\n\n\treturn b.String()\n}\n\n// renderSplit renders the split (side-by-side) diff view as a string.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_renderSplit_507": {
      "name": "renderSplit",
      "type": "method",
      "start_line": 507,
      "end_line": 663,
      "content_hash": "ae46cc7b8e6b2664923f6709b7c3baa535a6e679",
      "content": "func (dv *DiffView) renderSplit() string {\n\tvar b strings.Builder\n\n\tbeforeFullContentStyle := lipgloss.NewStyle().MaxWidth(dv.fullCodeWidth)\n\tafterFullContentStyle := lipgloss.NewStyle().MaxWidth(dv.fullCodeWidth + btoi(dv.extraColOnAfter))\n\tprintedLines := -dv.yOffset\n\tshouldWrite := func() bool { return printedLines >= 0 }\n\n\tgetContent := func(in string, ls LineStyle) (content string, leadingEllipsis bool) {\n\t\tcontent = strings.TrimSuffix(in, \"\\n\")\n\t\tcontent = dv.hightlightCode(content, ls.Code.GetBackground())\n\t\tcontent = ansi.GraphemeWidth.Cut(content, dv.xOffset, len(content))\n\t\tcontent = ansi.Truncate(content, dv.codeWidth, \"\u2026\")\n\t\tleadingEllipsis = dv.xOffset > 0 && strings.TrimSpace(content) != \"\"\n\t\treturn content, leadingEllipsis\n\t}\n\nouter:\n\tfor i, h := range dv.splitHunks {\n\t\tif shouldWrite() {\n\t\t\tls := dv.style.DividerLine\n\t\t\tif dv.lineNumbers {\n\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.beforeNumDigits)))\n\t\t\t}\n\t\t\tcontent := ansi.Truncate(dv.hunkLineFor(dv.unified.Hunks[i]), dv.fullCodeWidth, \"\u2026\")\n\t\t\tb.WriteString(ls.Code.Width(dv.fullCodeWidth).Render(content))\n\t\t\tif dv.lineNumbers {\n\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.afterNumDigits)))\n\t\t\t}\n\t\t\tb.WriteString(ls.Code.Width(dv.fullCodeWidth + btoi(dv.extraColOnAfter)).Render(\" \"))\n\t\t\tb.WriteRune('\\n')\n\t\t}\n\t\tprintedLines++\n\n\t\tbeforeLine := h.fromLine\n\t\tafterLine := h.toLine\n\n\t\tfor j, l := range h.lines {\n\t\t\t// print ellipis if we don't have enough space to print the rest of the diff\n\t\t\thasReachedHeight := dv.height > 0 && printedLines+1 == dv.height\n\t\t\tisLastHunk := i+1 == len(dv.unified.Hunks)\n\t\t\tisLastLine := j+1 == len(h.lines)\n\t\t\tif hasReachedHeight && (!isLastHunk || !isLastLine) {\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.MissingLine\n\t\t\t\t\tif l.before != nil {\n\t\t\t\t\t\tls = dv.lineStyleForType(l.before.Kind)\n\t\t\t\t\t}\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.beforeNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(beforeFullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth).Render(\"  \u2026\"),\n\t\t\t\t\t))\n\t\t\t\t\tls = dv.style.MissingLine\n\t\t\t\t\tif l.after != nil {\n\t\t\t\t\t\tls = dv.lineStyleForType(l.after.Kind)\n\t\t\t\t\t}\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\"\u2026\", dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(afterFullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth).Render(\"  \u2026\"),\n\t\t\t\t\t))\n\t\t\t\t\tb.WriteRune('\\n')\n\t\t\t\t}\n\t\t\t\tbreak outer\n\t\t\t}\n\n\t\t\tswitch {\n\t\t\tcase l.before == nil:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.MissingLine\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\" \", dv.beforeNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(beforeFullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth).Render(\"  \"),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\tcase l.before.Kind == udiff.Equal:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.EqualLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.before.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(beforeLine, dv.beforeNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(beforeFullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth).Render(ternary(leadingEllipsis, \" \u2026\", \"  \") + content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tbeforeLine++\n\t\t\tcase l.before.Kind == udiff.Delete:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.DeleteLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.before.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(beforeLine, dv.beforeNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(beforeFullContentStyle.Render(\n\t\t\t\t\t\tls.Symbol.Render(ternary(leadingEllipsis, \"-\u2026\", \"- \")) +\n\t\t\t\t\t\t\tls.Code.Width(dv.codeWidth).Render(content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tbeforeLine++\n\t\t\t}\n\n\t\t\tswitch {\n\t\t\tcase l.after == nil:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.MissingLine\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(\" \", dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(afterFullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth + btoi(dv.extraColOnAfter)).Render(\"  \"),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\tcase l.after.Kind == udiff.Equal:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.EqualLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.after.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(afterLine, dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(afterFullContentStyle.Render(\n\t\t\t\t\t\tls.Code.Width(dv.fullCodeWidth + btoi(dv.extraColOnAfter)).Render(ternary(leadingEllipsis, \" \u2026\", \"  \") + content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tafterLine++\n\t\t\tcase l.after.Kind == udiff.Insert:\n\t\t\t\tif shouldWrite() {\n\t\t\t\t\tls := dv.style.InsertLine\n\t\t\t\t\tcontent, leadingEllipsis := getContent(l.after.Content, ls)\n\t\t\t\t\tif dv.lineNumbers {\n\t\t\t\t\t\tb.WriteString(ls.LineNumber.Render(pad(afterLine, dv.afterNumDigits)))\n\t\t\t\t\t}\n\t\t\t\t\tb.WriteString(afterFullContentStyle.Render(\n\t\t\t\t\t\tls.Symbol.Render(ternary(leadingEllipsis, \"+\u2026\", \"+ \")) +\n\t\t\t\t\t\t\tls.Code.Width(dv.codeWidth+btoi(dv.extraColOnAfter)).Render(content),\n\t\t\t\t\t))\n\t\t\t\t}\n\t\t\t\tafterLine++\n\t\t\t}\n\n\t\t\tif shouldWrite() {\n\t\t\t\tb.WriteRune('\\n')\n\t\t\t}\n\n\t\t\tprintedLines++\n\t\t}\n\t}\n\n\treturn b.String()\n}\n\n// hunkLineFor formats the header line for a hunk in the unified diff view.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_hunkLineFor_664": {
      "name": "hunkLineFor",
      "type": "method",
      "start_line": 664,
      "end_line": 677,
      "content_hash": "ee582aa10110a2bcf558885cb9737149abb3ca2f",
      "content": "func (dv *DiffView) hunkLineFor(h *udiff.Hunk) string {\n\tbeforeShownLines, afterShownLines := dv.hunkShownLines(h)\n\n\treturn fmt.Sprintf(\n\t\t\"  @@ -%d,%d +%d,%d @@ \",\n\t\th.FromLine,\n\t\tbeforeShownLines,\n\t\th.ToLine,\n\t\tafterShownLines,\n\t)\n}\n\n// hunkShownLines calculates the number of lines shown in a hunk for both before\n// and after versions.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_hunkShownLines_678": {
      "name": "hunkShownLines",
      "type": "method",
      "start_line": 678,
      "end_line": 692,
      "content_hash": "7f24c850be8c1a11137c6ee78dce33fab2df4f0f",
      "content": "func (dv *DiffView) hunkShownLines(h *udiff.Hunk) (before, after int) {\n\tfor _, l := range h.Lines {\n\t\tswitch l.Kind {\n\t\tcase udiff.Equal:\n\t\t\tbefore++\n\t\t\tafter++\n\t\tcase udiff.Insert:\n\t\t\tafter++\n\t\tcase udiff.Delete:\n\t\t\tbefore++\n\t\t}\n\t}\n\treturn before, after\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_lineStyleForType_693": {
      "name": "lineStyleForType",
      "type": "method",
      "start_line": 693,
      "end_line": 705,
      "content_hash": "b98abeee6458eb4f40c1f81a0ae6537714b85583",
      "content": "func (dv *DiffView) lineStyleForType(t udiff.OpKind) LineStyle {\n\tswitch t {\n\tcase udiff.Equal:\n\t\treturn dv.style.EqualLine\n\tcase udiff.Insert:\n\t\treturn dv.style.InsertLine\n\tcase udiff.Delete:\n\t\treturn dv.style.DeleteLine\n\tdefault:\n\t\treturn dv.style.MissingLine\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_hightlightCode_706": {
      "name": "hightlightCode",
      "type": "method",
      "start_line": 706,
      "end_line": 741,
      "content_hash": "686370c03af3405516cc7d0dd7b3e8c3751792c3",
      "content": "func (dv *DiffView) hightlightCode(source string, bgColor color.Color) string {\n\tif dv.chromaStyle == nil {\n\t\treturn source\n\t}\n\n\t// Create cache key from content and background color\n\tcacheKey := dv.createSyntaxCacheKey(source, bgColor)\n\n\t// Check if we already have this highlighted\n\tif cached, exists := dv.syntaxCache[cacheKey]; exists {\n\t\treturn cached\n\t}\n\n\tl := dv.getChromaLexer()\n\tf := dv.getChromaFormatter(bgColor)\n\n\tit, err := l.Tokenise(nil, source)\n\tif err != nil {\n\t\treturn source\n\t}\n\n\tvar b strings.Builder\n\tif err := f.Format(&b, dv.chromaStyle, it); err != nil {\n\t\treturn source\n\t}\n\n\tresult := b.String()\n\n\t// Cache the result for future use\n\tdv.syntaxCache[cacheKey] = result\n\n\treturn result\n}\n\n// createSyntaxCacheKey creates a cache key from source content and background color.\n// We use a simple hash to keep memory usage reasonable.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_createSyntaxCacheKey_742": {
      "name": "createSyntaxCacheKey",
      "type": "method",
      "start_line": 742,
      "end_line": 753,
      "content_hash": "ab22a20b43f91814bff2f99a181f5e5aba0da2d5",
      "content": "func (dv *DiffView) createSyntaxCacheKey(source string, bgColor color.Color) string {\n\t// Convert color to string representation\n\tr, g, b, a := bgColor.RGBA()\n\tcolorStr := fmt.Sprintf(\"%d,%d,%d,%d\", r, g, b, a)\n\n\t// Create a hash of the content + color to use as cache key\n\th := xxh3.New()\n\th.Write([]byte(source))\n\th.Write([]byte(colorStr))\n\treturn fmt.Sprintf(\"%x\", h.Sum(nil))\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_getChromaLexer_754": {
      "name": "getChromaLexer",
      "type": "method",
      "start_line": 754,
      "end_line": 769,
      "content_hash": "91438e8e732d457d0a110fe9d56459b3863f99f7",
      "content": "func (dv *DiffView) getChromaLexer() chroma.Lexer {\n\tif dv.cachedLexer != nil {\n\t\treturn dv.cachedLexer\n\t}\n\n\tl := lexers.Match(dv.before.path)\n\tif l == nil {\n\t\tl = lexers.Analyse(dv.before.content)\n\t}\n\tif l == nil {\n\t\tl = lexers.Fallback\n\t}\n\tdv.cachedLexer = chroma.Coalesce(l)\n\treturn dv.cachedLexer\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_getChromaFormatter_770": {
      "name": "getChromaFormatter",
      "type": "method",
      "start_line": 770,
      "end_line": 774,
      "content_hash": "e9847cb66d2569c8efa257c98e4f2a42809fe09b",
      "content": "func (dv *DiffView) getChromaFormatter(bgColor color.Color) chroma.Formatter {\n\treturn chromaFormatter{\n\t\tbgColor: bgColor,\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}