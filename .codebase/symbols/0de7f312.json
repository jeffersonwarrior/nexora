{
  "file_path": "/work/external-deps/claude-mem/src/shared/SettingsDefaultsManager.ts",
  "file_hash": "49a16681faa277f6a0d2ff9f40763cdb54d282c2",
  "updated_at": "2025-12-26T17:34:21.254331",
  "symbols": {
    "class_SettingsDefaultsManager_43": {
      "name": "SettingsDefaultsManager",
      "type": "class",
      "start_line": 43,
      "end_line": 150,
      "content_hash": "20b3d2abad71a3797e4d215aa8b1768fd4cdb2dd",
      "content": "export class SettingsDefaultsManager {\n  /**\n   * Default values for all settings\n   */\n  private static readonly DEFAULTS: SettingsDefaults = {\n    CLAUDE_MEM_MODEL: 'claude-sonnet-4-5',\n    CLAUDE_MEM_CONTEXT_OBSERVATIONS: '50',\n    CLAUDE_MEM_WORKER_PORT: '37777',\n    CLAUDE_MEM_WORKER_HOST: '127.0.0.1',\n    CLAUDE_MEM_SKIP_TOOLS: 'ListMcpResourcesTool,SlashCommand,Skill,TodoWrite,AskUserQuestion',\n    // System Configuration\n    CLAUDE_MEM_DATA_DIR: join(homedir(), '.claude-mem'),\n    CLAUDE_MEM_LOG_LEVEL: 'INFO',\n    CLAUDE_MEM_PYTHON_VERSION: '3.13',\n    CLAUDE_CODE_PATH: '', // Empty means auto-detect via 'which claude'\n    CLAUDE_MEM_MODE: 'code', // Default mode profile\n    // Token Economics\n    CLAUDE_MEM_CONTEXT_SHOW_READ_TOKENS: 'true',\n    CLAUDE_MEM_CONTEXT_SHOW_WORK_TOKENS: 'true',\n    CLAUDE_MEM_CONTEXT_SHOW_SAVINGS_AMOUNT: 'true',\n    CLAUDE_MEM_CONTEXT_SHOW_SAVINGS_PERCENT: 'true',\n    // Observation Filtering\n    CLAUDE_MEM_CONTEXT_OBSERVATION_TYPES: DEFAULT_OBSERVATION_TYPES_STRING,\n    CLAUDE_MEM_CONTEXT_OBSERVATION_CONCEPTS: DEFAULT_OBSERVATION_CONCEPTS_STRING,\n    // Display Configuration\n    CLAUDE_MEM_CONTEXT_FULL_COUNT: '5',\n    CLAUDE_MEM_CONTEXT_FULL_FIELD: 'narrative',\n    CLAUDE_MEM_CONTEXT_SESSION_COUNT: '10',\n    // Feature Toggles\n    CLAUDE_MEM_CONTEXT_SHOW_LAST_SUMMARY: 'true',\n    CLAUDE_MEM_CONTEXT_SHOW_LAST_MESSAGE: 'false',\n  };\n\n  /**\n   * Get all defaults as an object\n   */\n  static getAllDefaults(): SettingsDefaults {\n    return { ...this.DEFAULTS };\n  }\n\n  /**\n   * Get a default value from defaults (no environment variable override)\n   */\n  static get(key: keyof SettingsDefaults): string {\n    return this.DEFAULTS[key];\n  }\n\n  /**\n   * Get an integer default value\n   */\n  static getInt(key: keyof SettingsDefaults): number {\n    const value = this.get(key);\n    return parseInt(value, 10);\n  }\n\n  /**\n   * Get a boolean default value\n   */\n  static getBool(key: keyof SettingsDefaults): boolean {\n    const value = this.get(key);\n    return value === 'true';\n  }\n\n  /**\n   * Load settings from file with fallback to defaults\n   * Returns merged settings with defaults as fallback\n   * Handles all errors (missing file, corrupted JSON, permissions) by returning defaults\n   */\n  static loadFromFile(settingsPath: string): SettingsDefaults {\n    try {\n      if (!existsSync(settingsPath)) {\n        return this.getAllDefaults();\n      }\n\n      const settingsData = readFileSync(settingsPath, 'utf-8');\n      const settings = JSON.parse(settingsData);\n\n      // MIGRATION: Handle old nested schema { env: {...} }\n      let flatSettings = settings;\n      if (settings.env && typeof settings.env === 'object') {\n        // Migrate from nested to flat schema\n        flatSettings = settings.env;\n\n        // Auto-migrate the file to flat schema\n        try {\n          writeFileSync(settingsPath, JSON.stringify(flatSettings, null, 2), 'utf-8');\n          logger.info('SETTINGS', 'Migrated settings file from nested to flat schema', { settingsPath });\n        } catch (error) {\n          logger.warn('SETTINGS', 'Failed to auto-migrate settings file', { settingsPath }, error);\n          // Continue with in-memory migration even if write fails\n        }\n      }\n\n      // Merge file settings with defaults (flat schema)\n      const result: SettingsDefaults = { ...this.DEFAULTS };\n      for (const key of Object.keys(this.DEFAULTS) as Array<keyof SettingsDefaults>) {\n        if (flatSettings[key] !== undefined) {\n          result[key] = flatSettings[key];\n        }\n      }\n\n      return result;\n    } catch (error) {\n      logger.warn('SETTINGS', 'Failed to load settings, using defaults', { settingsPath }, error);\n      return this.getAllDefaults();\n    }\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_getAllDefaults_79": {
      "name": "getAllDefaults",
      "type": "method",
      "start_line": 79,
      "end_line": 81,
      "content_hash": "5c3bb01f8647ddd8b2ebac9be08bb3f4244efc1f",
      "content": "  static getAllDefaults(): SettingsDefaults {\n    return { ...this.DEFAULTS };\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_get_86": {
      "name": "get",
      "type": "method",
      "start_line": 86,
      "end_line": 88,
      "content_hash": "46c74d93b0f08b464fe6923223b0ef049e16add8",
      "content": "  static get(key: keyof SettingsDefaults): string {\n    return this.DEFAULTS[key];\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_getInt_93": {
      "name": "getInt",
      "type": "method",
      "start_line": 93,
      "end_line": 96,
      "content_hash": "710a79eb040cce032711bf79e9755414d33fa9e0",
      "content": "  static getInt(key: keyof SettingsDefaults): number {\n    const value = this.get(key);\n    return parseInt(value, 10);\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_getBool_101": {
      "name": "getBool",
      "type": "method",
      "start_line": 101,
      "end_line": 104,
      "content_hash": "0b3d9754c910a300e619b3a5dbde7164ccd4031b",
      "content": "  static getBool(key: keyof SettingsDefaults): boolean {\n    const value = this.get(key);\n    return value === 'true';\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_loadFromFile_111": {
      "name": "loadFromFile",
      "type": "method",
      "start_line": 111,
      "end_line": 149,
      "content_hash": "a49803867cea9a8a9cb87651722933ed268a1621",
      "content": "  static loadFromFile(settingsPath: string): SettingsDefaults {\n    try {\n      if (!existsSync(settingsPath)) {\n        return this.getAllDefaults();\n      }\n\n      const settingsData = readFileSync(settingsPath, 'utf-8');\n      const settings = JSON.parse(settingsData);\n\n      // MIGRATION: Handle old nested schema { env: {...} }\n      let flatSettings = settings;\n      if (settings.env && typeof settings.env === 'object') {\n        // Migrate from nested to flat schema\n        flatSettings = settings.env;\n\n        // Auto-migrate the file to flat schema\n        try {\n          writeFileSync(settingsPath, JSON.stringify(flatSettings, null, 2), 'utf-8');\n          logger.info('SETTINGS', 'Migrated settings file from nested to flat schema', { settingsPath });\n        } catch (error) {\n          logger.warn('SETTINGS', 'Failed to auto-migrate settings file', { settingsPath }, error);\n          // Continue with in-memory migration even if write fails\n        }\n      }\n\n      // Merge file settings with defaults (flat schema)\n      const result: SettingsDefaults = { ...this.DEFAULTS };\n      for (const key of Object.keys(this.DEFAULTS) as Array<keyof SettingsDefaults>) {\n        if (flatSettings[key] !== undefined) {\n          result[key] = flatSettings[key];\n        }\n      }\n\n      return result;\n    } catch (error) {\n      logger.warn('SETTINGS', 'Failed to load settings, using defaults', { settingsPath }, error);\n      return this.getAllDefaults();\n    }\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}