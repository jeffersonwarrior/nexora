{
  "file_path": "/work/internal/agent/tools/mcp-tools.go",
  "file_hash": "98812e98a21dc3a5fd8abbfa6250088d6dc16846",
  "updated_at": "2025-12-26T17:34:22.635232",
  "symbols": {
    "function_GetMCPTools_13": {
      "name": "GetMCPTools",
      "type": "function",
      "start_line": 13,
      "end_line": 28,
      "content_hash": "92ba46b74141123c07031177d2013ceca9301a2b",
      "content": "func GetMCPTools(permissions permission.Service, wd string) []*Tool {\n\tvar result []*Tool\n\tfor mcpName, tools := range mcp.Tools() {\n\t\tfor _, tool := range tools {\n\t\t\tresult = append(result, &Tool{\n\t\t\t\tmcpName:     mcpName,\n\t\t\t\ttool:        tool,\n\t\t\t\tpermissions: permissions,\n\t\t\t\tworkingDir:  wd,\n\t\t\t})\n\t\t}\n\t}\n\treturn result\n}\n\n// Tool is a tool from a MCP.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_Tool_29": {
      "name": "Tool",
      "type": "struct",
      "start_line": 29,
      "end_line": 36,
      "content_hash": "f350f2e5cd6a9179bec6ee74e2a61a6da1a8802c",
      "content": "type Tool struct {\n\tmcpName         string\n\ttool            *mcp.Tool\n\tpermissions     permission.Service\n\tworkingDir      string\n\tproviderOptions fantasy.ProviderOptions\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_SetProviderOptions_37": {
      "name": "SetProviderOptions",
      "type": "method",
      "start_line": 37,
      "end_line": 40,
      "content_hash": "830acb4750b14ad442801a9be5d228cc1e934df8",
      "content": "func (m *Tool) SetProviderOptions(opts fantasy.ProviderOptions) {\n\tm.providerOptions = opts\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_ProviderOptions_41": {
      "name": "ProviderOptions",
      "type": "method",
      "start_line": 41,
      "end_line": 44,
      "content_hash": "329e40888bf6f595f07d4fa9307c142f9d69eafe",
      "content": "func (m *Tool) ProviderOptions() fantasy.ProviderOptions {\n\treturn m.providerOptions\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Name_45": {
      "name": "Name",
      "type": "method",
      "start_line": 45,
      "end_line": 48,
      "content_hash": "cc52faa0b19aeb321d8ac5972b24b38423006fc1",
      "content": "func (m *Tool) Name() string {\n\treturn fmt.Sprintf(\"mcp_%s_%s\", m.mcpName, m.tool.Name)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_MCP_49": {
      "name": "MCP",
      "type": "method",
      "start_line": 49,
      "end_line": 52,
      "content_hash": "37526c953822be552d4be00aa0bef729e9b10e91",
      "content": "func (m *Tool) MCP() string {\n\treturn m.mcpName\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_MCPToolName_53": {
      "name": "MCPToolName",
      "type": "method",
      "start_line": 53,
      "end_line": 56,
      "content_hash": "5e7119886ed8a0d1081351252ad206a074f65515",
      "content": "func (m *Tool) MCPToolName() string {\n\treturn m.tool.Name\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Info_57": {
      "name": "Info",
      "type": "method",
      "start_line": 57,
      "end_line": 85,
      "content_hash": "c2a0e4560dd2e330fd06e34977718e59d1878c88",
      "content": "func (m *Tool) Info() fantasy.ToolInfo {\n\tparameters := make(map[string]any)\n\trequired := make([]string, 0)\n\n\tif input, ok := m.tool.InputSchema.(map[string]any); ok {\n\t\tif props, ok := input[\"properties\"].(map[string]any); ok {\n\t\t\tparameters = props\n\t\t}\n\t\tif req, ok := input[\"required\"].([]any); ok {\n\t\t\t// Convert []any -> []string when elements are strings\n\t\t\tfor _, v := range req {\n\t\t\t\tif s, ok := v.(string); ok {\n\t\t\t\t\trequired = append(required, s)\n\t\t\t\t}\n\t\t\t}\n\t\t} else if reqStr, ok := input[\"required\"].([]string); ok {\n\t\t\t// Handle case where it's already []string\n\t\t\trequired = reqStr\n\t\t}\n\t}\n\n\treturn fantasy.ToolInfo{\n\t\tName:        m.Name(),\n\t\tDescription: m.tool.Description,\n\t\tParameters:  parameters,\n\t\tRequired:    required,\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Run_86": {
      "name": "Run",
      "type": "method",
      "start_line": 86,
      "end_line": 130,
      "content_hash": "69ec74978541408ed57ff2bfa93dddf8d688c134",
      "content": "func (m *Tool) Run(ctx context.Context, params fantasy.ToolCall) (fantasy.ToolResponse, error) {\n\tsessionID := GetSessionFromContext(ctx)\n\tif sessionID == \"\" {\n\t\treturn fantasy.ToolResponse{}, fmt.Errorf(\"session ID is required for creating a new file\")\n\t}\n\tpermissionDescription := fmt.Sprintf(\"execute %s with the following parameters:\", m.Info().Name)\n\tp := m.permissions.Request(\n\t\tpermission.CreatePermissionRequest{\n\t\t\tSessionID:   sessionID,\n\t\t\tToolCallID:  params.ID,\n\t\t\tPath:        m.workingDir,\n\t\t\tToolName:    m.Info().Name,\n\t\t\tAction:      \"execute\",\n\t\t\tDescription: permissionDescription,\n\t\t\tParams:      params.Input,\n\t\t},\n\t)\n\tif !p {\n\t\treturn fantasy.ToolResponse{}, permission.ErrorPermissionDenied\n\t}\n\n\tresult, err := mcp.RunTool(ctx, m.mcpName, m.tool.Name, params.Input)\n\tif err != nil {\n\t\treturn fantasy.NewTextErrorResponse(err.Error()), nil\n\t}\n\n\tswitch result.Type {\n\tcase \"image\", \"media\":\n\t\tif !GetSupportsImagesFromContext(ctx) {\n\t\t\tmodelName := GetModelNameFromContext(ctx)\n\t\t\treturn fantasy.NewTextErrorResponse(fmt.Sprintf(\"This model (%s) does not support image data.\", modelName)), nil\n\t\t}\n\n\t\tvar response fantasy.ToolResponse\n\t\tif result.Type == \"image\" {\n\t\t\tresponse = fantasy.NewImageResponse(result.Data, result.MediaType)\n\t\t} else {\n\t\t\tresponse = fantasy.NewMediaResponse(result.Data, result.MediaType)\n\t\t}\n\t\tresponse.Content = result.Content\n\t\treturn response, nil\n\tdefault:\n\t\treturn fantasy.NewTextResponse(result.Content), nil\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}