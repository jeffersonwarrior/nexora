{
  "file_path": "/work/external-deps/claude-mem/src/ui/viewer/hooks/useContextPreview.ts",
  "file_hash": "c85fca5d8b813557e49f0bfd374633a94a59803a",
  "updated_at": "2025-12-26T17:34:23.586886",
  "symbols": {
    "function_useContextPreview_14": {
      "name": "useContextPreview",
      "type": "function",
      "start_line": 14,
      "end_line": 76,
      "content_hash": "bcf6b6c8c90cf05723a38b0b7fed8eee941b5927",
      "content": "export function useContextPreview(settings: Settings): UseContextPreviewResult {\n  const [preview, setPreview] = useState<string>('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [projects, setProjects] = useState<string[]>([]);\n  const [selectedProject, setSelectedProject] = useState<string | null>(null);\n\n  // Fetch projects on mount\n  useEffect(() => {\n    async function fetchProjects() {\n      try {\n        const response = await fetch('/api/projects');\n        const data = await response.json();\n        if (data.projects && data.projects.length > 0) {\n          setProjects(data.projects);\n          setSelectedProject(data.projects[0]); // Default to first project\n        }\n      } catch (err) {\n        console.error('Failed to fetch projects:', err);\n      }\n    }\n    fetchProjects();\n  }, []);\n\n  const refresh = useCallback(async () => {\n    if (!selectedProject) {\n      setPreview('No project selected');\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const params = new URLSearchParams({\n        project: selectedProject\n      });\n\n      const response = await fetch(`/api/context/preview?${params}`);\n      const text = await response.text();\n\n      if (response.ok) {\n        setPreview(text);\n      } else {\n        setError('Failed to load preview');\n      }\n    } catch (err) {\n      setError((err as Error).message);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [selectedProject]);\n\n  // Debounced refresh when settings or selectedProject change\n  useEffect(() => {\n    const timeout = setTimeout(() => {\n      refresh();\n    }, 300);\n    return () => clearTimeout(timeout);\n  }, [settings, refresh]);\n\n  return { preview, isLoading, error, refresh, projects, selectedProject, setSelectedProject };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_fetchProjects_23": {
      "name": "fetchProjects",
      "type": "function",
      "start_line": 23,
      "end_line": 34,
      "content_hash": "98ecb281ed3400975e92d29ef4ddf63479a71370",
      "content": "    async function fetchProjects() {\n      try {\n        const response = await fetch('/api/projects');\n        const data = await response.json();\n        if (data.projects && data.projects.length > 0) {\n          setProjects(data.projects);\n          setSelectedProject(data.projects[0]); // Default to first project\n        }\n      } catch (err) {\n        console.error('Failed to fetch projects:', err);\n      }\n    }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}