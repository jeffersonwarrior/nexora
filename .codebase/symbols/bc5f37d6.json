{
  "file_path": "/work/internal/agent/tools/install_manager.go",
  "file_hash": "13dccca646e06224a14a08690ed433b6e2481bf4",
  "updated_at": "2025-12-26T17:34:22.016870",
  "symbols": {
    "struct_ExternalTool_14": {
      "name": "ExternalTool",
      "type": "struct",
      "start_line": 14,
      "end_line": 186,
      "content_hash": "775e0bc3be78a9b624a40e8bd042a1fd522d0962",
      "content": "type ExternalTool struct {\n\tName        string\n\tDescription string\n\tInstallCmd  map[string][]string // OS -> command to install\n\tCheckCmd    []string            // Command to check if tool is installed\n\tPriority    int                 // Higher = more important\n\tAIRelevant  bool                // Whether this tool is particularly useful for AI operations\n}\n\nvar essentialTools = []ExternalTool{\n\t{\n\t\tName:        \"ripgrep\",\n\t\tDescription: \"Fast file search tool, much faster than grep\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"ripgrep\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"ripgrep\"}, // Deb/Ubuntu\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"ripgrep\"}, // Deb/Ubuntu variant\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"ripgrep\"}, // RHEL/CentOS\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"ripgrep\"}, // Fedora\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"ripgrep\"},   // Arch Linux\n\t\t\t\"windows\":    {\"winget\", \"install\", \"BurntSushi.ripgrep\"},\n\t\t},\n\t\tCheckCmd:   []string{\"rg\", \"--version\"},\n\t\tPriority:   100,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"fd\",\n\t\tDescription: \"Fast find replacement for finding files and directories\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"fd\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"fd-find\"}, // Deb/Ubuntu, provides 'fdfind'\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"fd-find\"}, // Deb/Ubuntu variant\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"fd\"},      // RHEL/CentOS\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"fd\"},      // Fedora\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"fd\"},        // Arch Linux\n\t\t\t\"windows\":    {\"winget\", \"install\", \"sharkdp.fd\"},\n\t\t},\n\t\tCheckCmd:   []string{\"fd\", \"--version\"},\n\t\tPriority:   95,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"delta\",\n\t\tDescription: \"Better diff viewer with syntax highlighting\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"git-delta\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"git-delta\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"git-delta\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"git-delta\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"git-delta\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"git-delta\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"dandavison.delta\"},\n\t\t},\n\t\tCheckCmd:   []string{\"delta\", \"--version\"},\n\t\tPriority:   80,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"bat\",\n\t\tDescription: \"Cat with wings - syntax highlighting and git integration\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"bat\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"bat\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"bat\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"bat\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"bat\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"bat\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"sharkdp.bat\"},\n\t\t},\n\t\tCheckCmd:   []string{\"bat\", \"--version\"},\n\t\tPriority:   75,\n\t\tAIRelevant: false,\n\t},\n\t{\n\t\tName:        \"exa\",\n\t\tDescription: \"Modern replacement for ls\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"exa\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"exa\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"exa\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"exa\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"exa\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"exa\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"eza.eza\"}, // eza is the maintained fork\n\t\t},\n\t\tCheckCmd:   []string{\"exa\", \"--version\"},\n\t\tPriority:   70,\n\t\tAIRelevant: false,\n\t},\n\t{\n\t\tName:        \"jq\",\n\t\tDescription: \"Command-line JSON processor\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"jq\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"jq\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"jq\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"jq\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"jq\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"jq\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"jqlang.jq\"},\n\t\t},\n\t\tCheckCmd:   []string{\"jq\", \"--version\"},\n\t\tPriority:   90,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"fzf\",\n\t\tDescription: \"Command-line fuzzy finder\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"fzf\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"fzf\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"fzf\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"fzf\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"fzf\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"fzf\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"junegunn.fzf\"},\n\t\t},\n\t\tCheckCmd:   []string{\"fzf\", \"--version\"},\n\t\tPriority:   85,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"sd\",\n\t\tDescription: \"Intuitive find & replace CLI (sed alternative)\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"sd\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"sd\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"sd\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"sd\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"sd\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"sd\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"chmln.sd\"},\n\t\t},\n\t\tCheckCmd:   []string{\"sd\", \"--version\"},\n\t\tPriority:   60,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"tokei\",\n\t\tDescription: \"Code statistics tool - great for understanding codebases\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"tokei\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"tokei\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"tokei\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"tokei\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"tokei\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"tokei\"},\n\t\t\t\"windows\":    {\"cargo\", \"install\", \"tokei\"}, // Via cargo\n\t\t},\n\t\tCheckCmd:   []string{\"tokei\", \"--version\"},\n\t\tPriority:   50,\n\t\tAIRelevant: true,\n\t},\n\t{\n\t\tName:        \"hexyl\",\n\t\tDescription: \"Hex viewer - useful for binary file inspection\",\n\t\tInstallCmd: map[string][]string{\n\t\t\t\"darwin\":     {\"brew\", \"install\", \"hexyl\"},\n\t\t\t\"linux\":      {\"apt\", \"install\", \"hexyl\"},\n\t\t\t\"linux-apt\":  {\"apt\", \"install\", \"hexyl\"},\n\t\t\t\"linux-yum\":  {\"yum\", \"install\", \"hexyl\"},\n\t\t\t\"linux-dnf\":  {\"dnf\", \"install\", \"hexyl\"},\n\t\t\t\"linux-arch\": {\"pacman\", \"-S\", \"hexyl\"},\n\t\t\t\"windows\":    {\"winget\", \"install\", \"sharkdp.hexyl\"},\n\t\t},\n\t\tCheckCmd:   []string{\"hexyl\", \"--version\"},\n\t\tPriority:   40,\n\t\tAIRelevant: false,\n\t},\n}\n\n// InstallManager handles the checking and installation of essential tools",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_InstallManager_187": {
      "name": "InstallManager",
      "type": "struct",
      "start_line": 187,
      "end_line": 191,
      "content_hash": "cab8216e03cbf727bef903513154b2436a59e976",
      "content": "type InstallManager struct {\n\ttools []ExternalTool\n}\n\n// NewInstallManager creates a new installation manager",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewInstallManager_192": {
      "name": "NewInstallManager",
      "type": "function",
      "start_line": 192,
      "end_line": 198,
      "content_hash": "5e8918a77ed789e4f734f769f0e1bd8f243bca5e",
      "content": "func NewInstallManager() *InstallManager {\n\treturn &InstallManager{\n\t\ttools: essentialTools,\n\t}\n}\n\n// GetOSType returns the OS type with package manager detection",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_GetOSType_199": {
      "name": "GetOSType",
      "type": "function",
      "start_line": 199,
      "end_line": 220,
      "content_hash": "0f04798dcba6eea1ba983e23a2622577277d91ac",
      "content": "func GetOSType() string {\n\tosType := runtime.GOOS\n\tif osType == \"linux\" {\n\t\t// Try to detect the package manager\n\t\tif _, err := exec.LookPath(\"apt\"); err == nil {\n\t\t\treturn \"linux-apt\"\n\t\t}\n\t\tif _, err := exec.LookPath(\"yum\"); err == nil {\n\t\t\treturn \"linux-yum\"\n\t\t}\n\t\tif _, err := exec.LookPath(\"dnf\"); err == nil {\n\t\t\treturn \"linux-dnf\"\n\t\t}\n\t\tif _, err := exec.LookPath(\"pacman\"); err == nil {\n\t\t\treturn \"linux-arch\"\n\t\t}\n\t\treturn \"linux\" // fallback\n\t}\n\treturn osType\n}\n\n// IsToolInstalled checks if a tool is installed",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_IsToolInstalled_221": {
      "name": "IsToolInstalled",
      "type": "method",
      "start_line": 221,
      "end_line": 230,
      "content_hash": "be90479881b048eb00612c1377be2ed897df9165",
      "content": "func (im *InstallManager) IsToolInstalled(ctx context.Context, tool ExternalTool) bool {\n\tctx, cancel := context.WithTimeout(ctx, 5*time.Second)\n\tdefer cancel()\n\n\tcmd := exec.CommandContext(ctx, tool.CheckCmd[0], tool.CheckCmd[1:]...)\n\terr := cmd.Run()\n\treturn err == nil\n}\n\n// InstallTool installs a tool if not already installed",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_InstallTool_231": {
      "name": "InstallTool",
      "type": "method",
      "start_line": 231,
      "end_line": 263,
      "content_hash": "236d11eee626b75e4f48e78876fb14cc7ba9ac6f",
      "content": "func (im *InstallManager) InstallTool(ctx context.Context, tool ExternalTool) error {\n\tif im.IsToolInstalled(ctx, tool) {\n\t\treturn nil // Already installed\n\t}\n\n\tosType := GetOSType()\n\tinstallCmd, exists := tool.InstallCmd[osType]\n\tif !exists {\n\t\t// Try generic OS type\n\t\tinstallCmd, exists = tool.InstallCmd[runtime.GOOS]\n\t\tif !exists {\n\t\t\treturn fmt.Errorf(\"no installation command available for %s on %s\", tool.Name, osType)\n\t\t}\n\t}\n\n\tslog.Info(\"Installing tool\", \"tool\", tool.Name, \"os\", osType)\n\n\t// Create a subprocess with timeout\n\tcmdCtx, cancel := context.WithTimeout(ctx, 300*time.Second) // 5 minute timeout\n\tdefer cancel()\n\n\tcmd := exec.CommandContext(cmdCtx, installCmd[0], installCmd[1:]...)\n\n\t// Run without showing output to user unless in debug mode\n\tif err := cmd.Run(); err != nil {\n\t\treturn fmt.Errorf(\"failed to install %s: %w\", tool.Name, err)\n\t}\n\n\tslog.Info(\"Successfully installed tool\", \"tool\", tool.Name)\n\treturn nil\n}\n\n// CheckAndInstallAIRelevantTools checks and installs the most important tools for AI operations",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_CheckAndInstallAIRelevantTools_264": {
      "name": "CheckAndInstallAIRelevantTools",
      "type": "method",
      "start_line": 264,
      "end_line": 287,
      "content_hash": "88c81c69ea5cd988fed2590213873f72a2e4ff4a",
      "content": "func (im *InstallManager) CheckAndInstallAIRelevantTools(ctx context.Context) error {\n\tslog.Info(\"Checking for AI-relevant tools\")\n\n\taiTools := make([]ExternalTool, 0)\n\tfor _, tool := range im.tools {\n\t\tif tool.AIRelevant && tool.Priority >= 80 {\n\t\t\taiTools = append(aiTools, tool)\n\t\t}\n\t}\n\n\tfor _, tool := range aiTools {\n\t\tif !im.IsToolInstalled(ctx, tool) {\n\t\t\tslog.Info(\"AI-relevant tool not found, attempting to install\", \"tool\", tool.Name, \"description\", tool.Description)\n\t\t\tif err := im.InstallTool(ctx, tool); err != nil {\n\t\t\t\tslog.Warn(\"Failed to install AI-relevant tool\", \"tool\", tool.Name, \"error\", err)\n\t\t\t\t// Continue with other tools even if one fails\n\t\t\t}\n\t\t}\n\t}\n\n\treturn nil\n}\n\n// GetUnavailableAIRelevantTools returns a list of AI-relevant tools that are not installed",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetUnavailableAIRelevantTools_288": {
      "name": "GetUnavailableAIRelevantTools",
      "type": "method",
      "start_line": 288,
      "end_line": 298,
      "content_hash": "11bcd69b909088c74573a5991248412ec18a2eaa",
      "content": "func (im *InstallManager) GetUnavailableAIRelevantTools(ctx context.Context) []ExternalTool {\n\tvar unavailable []ExternalTool\n\tfor _, tool := range im.tools {\n\t\tif tool.AIRelevant && !im.IsToolInstalled(ctx, tool) {\n\t\t\tunavailable = append(unavailable, tool)\n\t\t}\n\t}\n\treturn unavailable\n}\n\n// GenerateSuggestions returns a formatted list of suggested tools",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GenerateSuggestions_299": {
      "name": "GenerateSuggestions",
      "type": "method",
      "start_line": 299,
      "end_line": 356,
      "content_hash": "378e79f80d97a18d306bd37fde7d766806d14143",
      "content": "func (im *InstallManager) GenerateSuggestions(ctx context.Context) string {\n\tvar suggestions strings.Builder\n\tsuggestions.WriteString(\"\\n# Essential Tools for Enhanced AI-Assisted Development\\n\\n\")\n\n\t// Group by priority\n\thighPriority := make([]ExternalTool, 0)\n\tmediumPriority := make([]ExternalTool, 0)\n\tlowPriority := make([]ExternalTool, 0)\n\n\tfor _, tool := range im.tools {\n\t\tif tool.AIRelevant {\n\t\t\tif tool.Priority >= 90 {\n\t\t\t\thighPriority = append(highPriority, tool)\n\t\t\t} else if tool.Priority >= 70 {\n\t\t\t\tmediumPriority = append(mediumPriority, tool)\n\t\t\t} else {\n\t\t\t\tlowPriority = append(lowPriority, tool)\n\t\t\t}\n\t\t}\n\t}\n\n\taddToolList := func(title string, tools []ExternalTool) {\n\t\tif len(tools) == 0 {\n\t\t\treturn\n\t\t}\n\t\tsuggestions.WriteString(fmt.Sprintf(\"## %s\\n\\n\", title))\n\t\tfor _, tool := range tools {\n\t\t\tinstalled := im.IsToolInstalled(ctx, tool)\n\t\t\tstatus := \"\u2705 Installed\"\n\t\t\tif !installed {\n\t\t\t\tstatus = \"\u274c Missing\"\n\t\t\t}\n\t\t\tsuggestions.WriteString(fmt.Sprintf(\"- **%s** - %s %s\\n\", tool.Name, tool.Description, status))\n\t\t}\n\t\tsuggestions.WriteString(\"\\n\")\n\t}\n\n\taddToolList(\"\ud83d\udd25 High Priority (Essential for AI Operations)\", highPriority)\n\taddToolList(\"\u26a1 Medium Priority (Significant Enhancement)\", mediumPriority)\n\taddToolList(\"\ud83d\udca1 Lower Priority (Nice to Have)\", lowPriority)\n\n\tsuggestions.WriteString(\"## Installation Commands\\n\\n\")\n\n\tosType := GetOSType()\n\tsuggestions.WriteString(fmt.Sprintf(\"For your OS (%s):\\n\\n\", osType))\n\n\tfor _, tool := range im.tools {\n\t\tif tool.AIRelevant {\n\t\t\tif installCmd, exists := tool.InstallCmd[osType]; exists {\n\t\t\t\tsuggestions.WriteString(fmt.Sprintf(\"- **%s**: `%s`\\n\", tool.Name, strings.Join(installCmd, \" \")))\n\t\t\t} else if genericCmd, exists := tool.InstallCmd[runtime.GOOS]; exists {\n\t\t\t\tsuggestions.WriteString(fmt.Sprintf(\"- **%s**: `%s`\\n\", tool.Name, strings.Join(genericCmd, \" \")))\n\t\t\t}\n\t\t}\n\t}\n\n\treturn suggestions.String()\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}