{
  "file_path": "/work/.local/tools/modelscan/sdk/storage/team.go",
  "file_hash": "90ad2f04410c3636208dba358ff4fea2db8fbff5",
  "updated_at": "2025-12-26T17:34:23.901756",
  "symbols": {
    "struct_Team_12": {
      "name": "Team",
      "type": "struct",
      "start_line": 12,
      "end_line": 22,
      "content_hash": "db75a00bfb7da37fd3468dc3022bb4cf09ebd47c",
      "content": "type Team struct {\n\tID          string                 `json:\"id\"`\n\tName        string                 `json:\"name\"`\n\tDescription string                 `json:\"description\"`\n\tConfig      string                 `json:\"config\"`\n\tMetadata    map[string]interface{} `json:\"metadata\"`\n\tCreatedAt   time.Time              `json:\"created_at\"`\n\tUpdatedAt   time.Time              `json:\"updated_at\"`\n}\n\n// TeamMember represents a team member relationship",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_TeamMember_23": {
      "name": "TeamMember",
      "type": "struct",
      "start_line": 23,
      "end_line": 31,
      "content_hash": "ecc959d0a555336dfb003d21115c51aed0c8c3f4",
      "content": "type TeamMember struct {\n\tTeamID    string    `json:\"team_id\"`\n\tAgentID   string    `json:\"agent_id\"`\n\tRole      string    `json:\"role\"`\n\tJoinedAt  time.Time `json:\"joined_at\"`\n\tUpdatedAt time.Time `json:\"updated_at\"`\n}\n\n// TeamRepository handles team database operations",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_TeamRepository_32": {
      "name": "TeamRepository",
      "type": "struct",
      "start_line": 32,
      "end_line": 36,
      "content_hash": "f60690237ebab9e62f1a3ff16dd1b8d6ebb02436",
      "content": "type TeamRepository struct {\n\tdb *sql.DB\n}\n\n// NewTeamRepository creates a new team repository",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_NewTeamRepository_37": {
      "name": "NewTeamRepository",
      "type": "function",
      "start_line": 37,
      "end_line": 41,
      "content_hash": "5d4ae923e0738b7d98673627e8a1b1cd6bb25b68",
      "content": "func NewTeamRepository(db *sql.DB) *TeamRepository {\n\treturn &TeamRepository{db: db}\n}\n\n// Create creates a new team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Create_42": {
      "name": "Create",
      "type": "method",
      "start_line": 42,
      "end_line": 59,
      "content_hash": "a6c422fad9fe4c112a099394d2d5a662018e0a29",
      "content": "func (r *TeamRepository) Create(ctx context.Context, team *Team) error {\n\tmetadataJSON, _ := json.Marshal(team.Metadata)\n\n\tquery := `\n\t\tINSERT INTO teams (id, name, description, config, metadata)\n\t\tVALUES (?, ?, ?, ?, ?)\n\t`\n\n\t_, err := r.db.ExecContext(ctx, query,\n\t\tteam.ID, team.Name, team.Description, team.Config, metadataJSON)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to create team: %w\", err)\n\t}\n\n\treturn nil\n}\n\n// Get retrieves a team by ID",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Get_60": {
      "name": "Get",
      "type": "method",
      "start_line": 60,
      "end_line": 88,
      "content_hash": "c020595cbaafa43fcb5a948797ae00d277a265c3",
      "content": "func (r *TeamRepository) Get(ctx context.Context, id string) (*Team, error) {\n\tquery := `\n\t\tSELECT id, name, description, config, metadata, created_at, updated_at\n\t\tFROM teams WHERE id = ?\n\t`\n\n\tteam := &Team{}\n\tvar metadataJSON []byte\n\n\terr := r.db.QueryRowContext(ctx, query, id).Scan(\n\t\t&team.ID, &team.Name, &team.Description, &team.Config,\n\t\t&metadataJSON, &team.CreatedAt, &team.UpdatedAt)\n\tif err != nil {\n\t\tif err == sql.ErrNoRows {\n\t\t\treturn nil, fmt.Errorf(\"team not found: %s\", id)\n\t\t}\n\t\treturn nil, fmt.Errorf(\"failed to get team: %w\", err)\n\t}\n\n\tif len(metadataJSON) > 0 {\n\t\tif err := json.Unmarshal(metadataJSON, &team.Metadata); err != nil {\n\t\t\treturn nil, fmt.Errorf(\"failed to unmarshal metadata: %w\", err)\n\t\t}\n\t}\n\n\treturn team, nil\n}\n\n// Update updates a team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Update_89": {
      "name": "Update",
      "type": "method",
      "start_line": 89,
      "end_line": 116,
      "content_hash": "678a53d7945b17f2c71e5a4ad721831a553d0fa9",
      "content": "func (r *TeamRepository) Update(ctx context.Context, team *Team) error {\n\tmetadataJSON, _ := json.Marshal(team.Metadata)\n\n\tquery := `\n\t\tUPDATE teams \n\t\tSET name = ?, description = ?, config = ?, metadata = ?, updated_at = CURRENT_TIMESTAMP\n\t\tWHERE id = ?\n\t`\n\n\tresult, err := r.db.ExecContext(ctx, query,\n\t\tteam.Name, team.Description, team.Config, metadataJSON, team.ID)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to update team: %w\", err)\n\t}\n\n\trowsAffected, err := result.RowsAffected()\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to get rows affected: %w\", err)\n\t}\n\n\tif rowsAffected == 0 {\n\t\treturn fmt.Errorf(\"team not found: %s\", team.ID)\n\t}\n\n\treturn nil\n}\n\n// Delete deletes a team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Delete_117": {
      "name": "Delete",
      "type": "method",
      "start_line": 117,
      "end_line": 139,
      "content_hash": "7ff270079b33d5b68507721c3011929037cf3fc4",
      "content": "func (r *TeamRepository) Delete(ctx context.Context, id string) error {\n\ttx, err := r.db.BeginTx(ctx, nil)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to begin transaction: %w\", err)\n\t}\n\tdefer tx.Rollback()\n\n\t// Delete team members first\n\t_, err = tx.ExecContext(ctx, \"DELETE FROM team_members WHERE team_id = ?\", id)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to delete team members: %w\", err)\n\t}\n\n\t// Delete team\n\t_, err = tx.ExecContext(ctx, \"DELETE FROM teams WHERE id = ?\", id)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to delete team: %w\", err)\n\t}\n\n\treturn tx.Commit()\n}\n\n// List retrieves all teams",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_List_140": {
      "name": "List",
      "type": "method",
      "start_line": 140,
      "end_line": 178,
      "content_hash": "d12f2f090a99d967c3ed7e78102f7b02bdbeac0e",
      "content": "func (r *TeamRepository) List(ctx context.Context, limit, offset int) ([]*Team, error) {\n\tquery := `\n\t\tSELECT id, name, description, config, metadata, created_at, updated_at\n\t\tFROM teams\n\t\tORDER BY name ASC\n\t\tLIMIT ? OFFSET ?\n\t`\n\n\trows, err := r.db.QueryContext(ctx, query, limit, offset)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to list teams: %w\", err)\n\t}\n\tdefer rows.Close()\n\n\tvar teams []*Team\n\tfor rows.Next() {\n\t\tteam := &Team{}\n\t\tvar metadataJSON []byte\n\n\t\terr := rows.Scan(\n\t\t\t&team.ID, &team.Name, &team.Description, &team.Config,\n\t\t\t&metadataJSON, &team.CreatedAt, &team.UpdatedAt)\n\t\tif err != nil {\n\t\t\treturn nil, fmt.Errorf(\"failed to scan team: %w\", err)\n\t\t}\n\n\t\tif len(metadataJSON) > 0 {\n\t\t\tif err := json.Unmarshal(metadataJSON, &team.Metadata); err != nil {\n\t\t\t\treturn nil, fmt.Errorf(\"failed to unmarshal metadata: %w\", err)\n\t\t\t}\n\t\t}\n\n\t\tteams = append(teams, team)\n\t}\n\n\treturn teams, nil\n}\n\n// AddMember adds an agent to a team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_AddMember_179": {
      "name": "AddMember",
      "type": "method",
      "start_line": 179,
      "end_line": 196,
      "content_hash": "d39125e7d07cff26e2e96c558a2fd2888a205c06",
      "content": "func (r *TeamRepository) AddMember(ctx context.Context, teamID, agentID, role string) error {\n\tquery := `\n\t\tINSERT INTO team_members (team_id, agent_id, role)\n\t\tVALUES (?, ?, ?)\n\t\tON CONFLICT(team_id, agent_id) DO UPDATE SET\n\t\trole = excluded.role,\n\t\tupdated_at = CURRENT_TIMESTAMP\n\t`\n\n\t_, err := r.db.ExecContext(ctx, query, teamID, agentID, role)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to add team member: %w\", err)\n\t}\n\n\treturn nil\n}\n\n// RemoveMember removes an agent from a team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_RemoveMember_197": {
      "name": "RemoveMember",
      "type": "method",
      "start_line": 197,
      "end_line": 217,
      "content_hash": "d29c0363c24abbdfaf1ff9bc8245594c5622bdc7",
      "content": "func (r *TeamRepository) RemoveMember(ctx context.Context, teamID, agentID string) error {\n\tquery := `DELETE FROM team_members WHERE team_id = ? AND agent_id = ?`\n\n\tresult, err := r.db.ExecContext(ctx, query, teamID, agentID)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to remove team member: %w\", err)\n\t}\n\n\trowsAffected, err := result.RowsAffected()\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to get rows affected: %w\", err)\n\t}\n\n\tif rowsAffected == 0 {\n\t\treturn fmt.Errorf(\"team member not found: team_id=%s, agent_id=%s\", teamID, agentID)\n\t}\n\n\treturn nil\n}\n\n// GetMembers retrieves all members of a team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetMembers_218": {
      "name": "GetMembers",
      "type": "method",
      "start_line": 218,
      "end_line": 249,
      "content_hash": "0c138d30ae96d23cf8d646bf99fea55a38d3f517",
      "content": "func (r *TeamRepository) GetMembers(ctx context.Context, teamID string) ([]*TeamMember, error) {\n\tquery := `\n\t\tSELECT team_id, agent_id, role, joined_at, updated_at\n\t\tFROM team_members\n\t\tWHERE team_id = ?\n\t\tORDER BY joined_at ASC\n\t`\n\n\trows, err := r.db.QueryContext(ctx, query, teamID)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get team members: %w\", err)\n\t}\n\tdefer rows.Close()\n\n\tvar members []*TeamMember\n\tfor rows.Next() {\n\t\tmember := &TeamMember{}\n\n\t\terr := rows.Scan(\n\t\t\t&member.TeamID, &member.AgentID, &member.Role,\n\t\t\t&member.JoinedAt, &member.UpdatedAt)\n\t\tif err != nil {\n\t\t\treturn nil, fmt.Errorf(\"failed to scan team member: %w\", err)\n\t\t}\n\n\t\tmembers = append(members, member)\n\t}\n\n\treturn members, nil\n}\n\n// GetAgentTeams retrieves all teams an agent belongs to",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_GetAgentTeams_250": {
      "name": "GetAgentTeams",
      "type": "method",
      "start_line": 250,
      "end_line": 289,
      "content_hash": "1237bf800d82cf644c52bb52274d1a509607fd13",
      "content": "func (r *TeamRepository) GetAgentTeams(ctx context.Context, agentID string) ([]*Team, error) {\n\tquery := `\n\t\tSELECT t.id, t.name, t.description, t.config, t.metadata, t.created_at, t.updated_at\n\t\tFROM teams t\n\t\tJOIN team_members tm ON t.id = tm.team_id\n\t\tWHERE tm.agent_id = ?\n\t\tORDER BY t.name ASC\n\t`\n\n\trows, err := r.db.QueryContext(ctx, query, agentID)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"failed to get agent teams: %w\", err)\n\t}\n\tdefer rows.Close()\n\n\tvar teams []*Team\n\tfor rows.Next() {\n\t\tteam := &Team{}\n\t\tvar metadataJSON []byte\n\n\t\terr := rows.Scan(\n\t\t\t&team.ID, &team.Name, &team.Description, &team.Config,\n\t\t\t&metadataJSON, &team.CreatedAt, &team.UpdatedAt)\n\t\tif err != nil {\n\t\t\treturn nil, fmt.Errorf(\"failed to scan team: %w\", err)\n\t\t}\n\n\t\tif len(metadataJSON) > 0 {\n\t\t\tif err := json.Unmarshal(metadataJSON, &team.Metadata); err != nil {\n\t\t\t\treturn nil, fmt.Errorf(\"failed to unmarshal metadata: %w\", err)\n\t\t\t}\n\t\t}\n\n\t\tteams = append(teams, team)\n\t}\n\n\treturn teams, nil\n}\n\n// UpdateMemberRole updates an agent's role in a team",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_UpdateMemberRole_290": {
      "name": "UpdateMemberRole",
      "type": "method",
      "start_line": 290,
      "end_line": 312,
      "content_hash": "835e572d42ff87e20aa46f8a15f43a444e4e65e4",
      "content": "func (r *TeamRepository) UpdateMemberRole(ctx context.Context, teamID, agentID, role string) error {\n\tquery := `\n\t\tUPDATE team_members\n\t\tSET role = ?, updated_at = CURRENT_TIMESTAMP\n\t\tWHERE team_id = ? AND agent_id = ?\n\t`\n\n\tresult, err := r.db.ExecContext(ctx, query, role, teamID, agentID)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to update member role: %w\", err)\n\t}\n\n\trowsAffected, err := result.RowsAffected()\n\tif err != nil {\n\t\treturn fmt.Errorf(\"failed to get rows affected: %w\", err)\n\t}\n\n\tif rowsAffected == 0 {\n\t\treturn fmt.Errorf(\"team member not found: team_id=%s, agent_id=%s\", teamID, agentID)\n\t}\n\n\treturn nil\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}