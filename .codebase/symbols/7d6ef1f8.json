{
  "file_path": "/work/external-deps/helix-db/helix-db/src/helixc/generator/migrations.rs",
  "file_hash": "013e5bfd14ad881cd40559dc477b5737baa504c2",
  "updated_at": "2025-12-26T17:34:20.360558",
  "symbols": {
    "struct_GeneratedMigration_10": {
      "name": "GeneratedMigration",
      "type": "struct",
      "start_line": 10,
      "end_line": 15,
      "content_hash": "0368c9c8645b57542045db4d5edef0f19942fe18",
      "content": "pub struct GeneratedMigration {\n    pub from_version: String,\n    pub to_version: String,\n    pub body: Vec<GeneratedMigrationItemMapping>,\n}\n#[derive(Debug)]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_GeneratedMigrationItemMapping_16": {
      "name": "GeneratedMigrationItemMapping",
      "type": "struct",
      "start_line": 16,
      "end_line": 23,
      "content_hash": "96c63304e41cac8a5e25b485a421fcfd71581012",
      "content": "pub struct GeneratedMigrationItemMapping {\n    pub from_item: String,\n    pub to_item: String,\n    pub remappings: Vec<Separator<GeneratedMigrationPropertyMapping>>,\n    pub should_spread: bool,\n}\n\n#[derive(Debug)]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "enum_GeneratedMigrationPropertyMapping_24": {
      "name": "GeneratedMigrationPropertyMapping",
      "type": "enum",
      "start_line": 24,
      "end_line": 39,
      "content_hash": "e4e39d05355b4702abdd759a7768d52a82970d2c",
      "content": "pub enum GeneratedMigrationPropertyMapping {\n    FieldAdditionFromOldField {\n        old_field: GeneratedValue,\n        new_field: GeneratedValue,\n    },\n    FieldAdditionFromValue {\n        new_field_name: GeneratedValue,\n        new_field_type: FieldType,\n        value: GeneratedValue,\n    },\n    FieldTypeCast {\n        field: GeneratedValue,\n        cast: CastType,\n    },\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "impl_std::fmt::Display_40": {
      "name": "std::fmt::Display",
      "type": "impl",
      "start_line": 40,
      "end_line": 40,
      "content_hash": "36f808a036cc8ebd16625fd8ca9cd24d895d5099",
      "content": "impl std::fmt::Display for GeneratedMigration {",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_fmt_41": {
      "name": "fmt",
      "type": "method",
      "start_line": 41,
      "end_line": 65,
      "content_hash": "da808039f0e001a39cfb4eb9f6d262a3aef22d28",
      "content": "    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n        for item in self.body.iter() {\n            writeln!(\n                f,\n                \"#[migration({}, {} -> {})]\",\n                item.from_item, self.from_version, self.to_version\n            )?;\n            writeln!(\n                f,\n                \"pub fn migration_{}_{}_{}(mut props: HashMap<String, Value>) -> HashMap<String, Value> {{\",\n                item.from_item.to_ascii_lowercase(),\n                self.from_version,\n                self.to_version\n            )?;\n            writeln!(f, \"let mut new_props = HashMap::new();\")?;\n            for remapping in item.remappings.iter() {\n                writeln!(f, \"{remapping}\")?;\n            }\n            writeln!(f, \"new_props\")?;\n            writeln!(f, \"}}\")?;\n        }\n        Ok(())\n    }\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "impl_std::fmt::Display_66": {
      "name": "std::fmt::Display",
      "type": "impl",
      "start_line": 66,
      "end_line": 66,
      "content_hash": "ab6338c4fd1c38b97e9269dfb21e4360e14a5dd0",
      "content": "impl std::fmt::Display for GeneratedMigrationPropertyMapping {",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_fmt_67": {
      "name": "fmt",
      "type": "method",
      "start_line": 67,
      "end_line": 105,
      "content_hash": "680fc4f3b975d7d72877da921ab1264eaaaf78fc",
      "content": "    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {\n        match self {\n            GeneratedMigrationPropertyMapping::FieldAdditionFromOldField {\n                old_field,\n                new_field,\n            } => write!(\n                f,\n                \"field_addition_from_old_field!(&mut props, &mut new_props, {new_field}, {old_field})\"\n            ),\n            GeneratedMigrationPropertyMapping::FieldAdditionFromValue {\n                new_field_name,\n                new_field_type,\n                value,\n            } => {\n                write!(\n                    f,\n                    \"field_addition_from_value!(&mut new_props, {new_field_name}, {new_field_type}, {value})\"\n                )\n            }\n            GeneratedMigrationPropertyMapping::FieldTypeCast { field, cast } => {\n                write!(\n                    f,\n                    \"field_type_cast!(&mut props, &mut new_props, {field}, {cast})\"\n                )\n            }\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::helixc::generator::utils::GenRef;\n\n    // ============================================================================\n    // GeneratedMigrationPropertyMapping Tests\n    // ============================================================================\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_field_addition_from_old_field_106": {
      "name": "test_field_addition_from_old_field",
      "type": "method",
      "start_line": 106,
      "end_line": 117,
      "content_hash": "b5dd9044d2ab45d974988ab6c5df3ee38ed183d8",
      "content": "    fn test_field_addition_from_old_field() {\n        let mapping = GeneratedMigrationPropertyMapping::FieldAdditionFromOldField {\n            old_field: GeneratedValue::Literal(GenRef::Literal(\"old_name\".to_string())),\n            new_field: GeneratedValue::Literal(GenRef::Literal(\"new_name\".to_string())),\n        };\n        let output = format!(\"{}\", mapping);\n        assert!(output.contains(\"field_addition_from_old_field!\"));\n        assert!(output.contains(\"\\\"new_name\\\"\"));\n        assert!(output.contains(\"\\\"old_name\\\"\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_field_addition_from_value_118": {
      "name": "test_field_addition_from_value",
      "type": "method",
      "start_line": 118,
      "end_line": 130,
      "content_hash": "274d68fdae270ae0fee1e1e38dee9de57f78756e",
      "content": "    fn test_field_addition_from_value() {\n        let mapping = GeneratedMigrationPropertyMapping::FieldAdditionFromValue {\n            new_field_name: GeneratedValue::Literal(GenRef::Literal(\"status\".to_string())),\n            new_field_type: FieldType::String,\n            value: GeneratedValue::Literal(GenRef::Literal(\"active\".to_string())),\n        };\n        let output = format!(\"{}\", mapping);\n        assert!(output.contains(\"field_addition_from_value!\"));\n        assert!(output.contains(\"\\\"status\\\"\"));\n        assert!(output.contains(\"\\\"active\\\"\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_field_type_cast_131": {
      "name": "test_field_type_cast",
      "type": "method",
      "start_line": 131,
      "end_line": 145,
      "content_hash": "b102adfa99ba7354a781e8be5db03170d898dccf",
      "content": "    fn test_field_type_cast() {\n        let mapping = GeneratedMigrationPropertyMapping::FieldTypeCast {\n            field: GeneratedValue::Literal(GenRef::Literal(\"count\".to_string())),\n            cast: CastType::U32,\n        };\n        let output = format!(\"{}\", mapping);\n        assert!(output.contains(\"field_type_cast!\"));\n        assert!(output.contains(\"\\\"count\\\"\"));\n    }\n\n    // ============================================================================\n    // GeneratedMigration Tests\n    // ============================================================================\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_display_basic_146": {
      "name": "test_migration_display_basic",
      "type": "method",
      "start_line": 146,
      "end_line": 169,
      "content_hash": "757bc9825c3c0a501ce044a76e256f0b872050cd",
      "content": "    fn test_migration_display_basic() {\n        let migration = GeneratedMigration {\n            from_version: \"v1\".to_string(),\n            to_version: \"v2\".to_string(),\n            body: vec![GeneratedMigrationItemMapping {\n                from_item: \"User\".to_string(),\n                to_item: \"User\".to_string(),\n                remappings: vec![Separator::Semicolon(\n                    GeneratedMigrationPropertyMapping::FieldAdditionFromOldField {\n                        old_field: GeneratedValue::Literal(GenRef::Literal(\"name\".to_string())),\n                        new_field: GeneratedValue::Literal(GenRef::Literal(\"full_name\".to_string())),\n                    },\n                )],\n                should_spread: false,\n            }],\n        };\n\n        let output = format!(\"{}\", migration);\n        assert!(output.contains(\"#[migration(User, v1 -> v2)]\"));\n        assert!(output.contains(\"pub fn migration_user_v1_v2\"));\n        assert!(output.contains(\"HashMap<String, Value>\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_function_signature_170": {
      "name": "test_migration_function_signature",
      "type": "method",
      "start_line": 170,
      "end_line": 189,
      "content_hash": "a54f3d63ae3be9f5347776015d505f7099ea6260",
      "content": "    fn test_migration_function_signature() {\n        let migration = GeneratedMigration {\n            from_version: \"v1\".to_string(),\n            to_version: \"v2\".to_string(),\n            body: vec![GeneratedMigrationItemMapping {\n                from_item: \"Product\".to_string(),\n                to_item: \"Product\".to_string(),\n                remappings: vec![],\n                should_spread: false,\n            }],\n        };\n\n        let output = format!(\"{}\", migration);\n        assert!(output.contains(\"migration_product_v1_v2\"));\n        assert!(output.contains(\"mut props: HashMap<String, Value>\"));\n        assert!(output.contains(\"let mut new_props = HashMap::new();\"));\n        assert!(output.contains(\"new_props\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_with_multiple_remappings_190": {
      "name": "test_migration_with_multiple_remappings",
      "type": "method",
      "start_line": 190,
      "end_line": 221,
      "content_hash": "827536120e42e0b967f1db139ab188adcbea2edf",
      "content": "    fn test_migration_with_multiple_remappings() {\n        let migration = GeneratedMigration {\n            from_version: \"1\".to_string(),\n            to_version: \"2\".to_string(),\n            body: vec![GeneratedMigrationItemMapping {\n                from_item: \"Node\".to_string(),\n                to_item: \"Node\".to_string(),\n                remappings: vec![\n                    Separator::Semicolon(\n                        GeneratedMigrationPropertyMapping::FieldAdditionFromOldField {\n                            old_field: GeneratedValue::Literal(GenRef::Literal(\"a\".to_string())),\n                            new_field: GeneratedValue::Literal(GenRef::Literal(\"b\".to_string())),\n                        },\n                    ),\n                    Separator::Semicolon(\n                        GeneratedMigrationPropertyMapping::FieldAdditionFromValue {\n                            new_field_name: GeneratedValue::Literal(GenRef::Literal(\"c\".to_string())),\n                            new_field_type: FieldType::Boolean,\n                            value: GeneratedValue::Primitive(GenRef::Std(\"true\".to_string())),\n                        },\n                    ),\n                ],\n                should_spread: false,\n            }],\n        };\n\n        let output = format!(\"{}\", migration);\n        assert!(output.contains(\"field_addition_from_old_field!\"));\n        assert!(output.contains(\"field_addition_from_value!\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_empty_remappings_222": {
      "name": "test_migration_empty_remappings",
      "type": "method",
      "start_line": 222,
      "end_line": 239,
      "content_hash": "fb81944063a581587e0c7fea9fb93e098936715d",
      "content": "    fn test_migration_empty_remappings() {\n        let migration = GeneratedMigration {\n            from_version: \"v1\".to_string(),\n            to_version: \"v2\".to_string(),\n            body: vec![GeneratedMigrationItemMapping {\n                from_item: \"Empty\".to_string(),\n                to_item: \"Empty\".to_string(),\n                remappings: vec![],\n                should_spread: false,\n            }],\n        };\n\n        let output = format!(\"{}\", migration);\n        assert!(output.contains(\"#[migration(Empty, v1 -> v2)]\"));\n        assert!(output.contains(\"migration_empty_v1_v2\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_item_name_lowercase_240": {
      "name": "test_migration_item_name_lowercase",
      "type": "method",
      "start_line": 240,
      "end_line": 257,
      "content_hash": "88e8f5d0428565a82679ec85c048c1ece1173b69",
      "content": "    fn test_migration_item_name_lowercase() {\n        let migration = GeneratedMigration {\n            from_version: \"v1\".to_string(),\n            to_version: \"v2\".to_string(),\n            body: vec![GeneratedMigrationItemMapping {\n                from_item: \"MyEntity\".to_string(),\n                to_item: \"MyEntity\".to_string(),\n                remappings: vec![],\n                should_spread: false,\n            }],\n        };\n\n        let output = format!(\"{}\", migration);\n        // Function name should be lowercase\n        assert!(output.contains(\"migration_myentity_v1_v2\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_version_format_258": {
      "name": "test_migration_version_format",
      "type": "method",
      "start_line": 258,
      "end_line": 275,
      "content_hash": "60e3cb85a2493874b963dc47a8da0c0af5607341",
      "content": "    fn test_migration_version_format() {\n        let migration = GeneratedMigration {\n            from_version: \"2024_01\".to_string(),\n            to_version: \"2024_02\".to_string(),\n            body: vec![GeneratedMigrationItemMapping {\n                from_item: \"Schema\".to_string(),\n                to_item: \"Schema\".to_string(),\n                remappings: vec![],\n                should_spread: false,\n            }],\n        };\n\n        let output = format!(\"{}\", migration);\n        assert!(output.contains(\"2024_01 -> 2024_02\"));\n        assert!(output.contains(\"migration_schema_2024_01_2024_02\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_with_type_cast_276": {
      "name": "test_migration_with_type_cast",
      "type": "method",
      "start_line": 276,
      "end_line": 287,
      "content_hash": "15801cfe7027c4a408a358b9b85c88e35950b7db",
      "content": "    fn test_migration_with_type_cast() {\n        let mapping = GeneratedMigrationPropertyMapping::FieldTypeCast {\n            field: GeneratedValue::Literal(GenRef::Literal(\"age\".to_string())),\n            cast: CastType::I64,\n        };\n        let output = format!(\"{}\", mapping);\n        assert!(output.contains(\"field_type_cast!\"));\n        assert!(output.contains(\"&mut props\"));\n        assert!(output.contains(\"&mut new_props\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_migration_multiple_items_288": {
      "name": "test_migration_multiple_items",
      "type": "method",
      "start_line": 288,
      "end_line": 313,
      "content_hash": "6edb5f04bed2d6cebbfc133228021c14d2fd812f",
      "content": "    fn test_migration_multiple_items() {\n        let migration = GeneratedMigration {\n            from_version: \"v1\".to_string(),\n            to_version: \"v2\".to_string(),\n            body: vec![\n                GeneratedMigrationItemMapping {\n                    from_item: \"User\".to_string(),\n                    to_item: \"User\".to_string(),\n                    remappings: vec![],\n                    should_spread: false,\n                },\n                GeneratedMigrationItemMapping {\n                    from_item: \"Post\".to_string(),\n                    to_item: \"Post\".to_string(),\n                    remappings: vec![],\n                    should_spread: false,\n                },\n            ],\n        };\n\n        let output = format!(\"{}\", migration);\n        assert!(output.contains(\"migration_user_v1_v2\"));\n        assert!(output.contains(\"migration_post_v1_v2\"));\n    }\n\n    #[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_test_field_addition_format_314": {
      "name": "test_field_addition_format",
      "type": "method",
      "start_line": 314,
      "end_line": 324,
      "content_hash": "9cbfdc5df79f8b1e83a307be170ae6f53e429870",
      "content": "    fn test_field_addition_format() {\n        let mapping = GeneratedMigrationPropertyMapping::FieldAdditionFromOldField {\n            old_field: GeneratedValue::Primitive(GenRef::Std(\"old_id\".to_string())),\n            new_field: GeneratedValue::Primitive(GenRef::Std(\"id\".to_string())),\n        };\n        let output = format!(\"{}\", mapping);\n        assert!(output.contains(\"&mut props\"));\n        assert!(output.contains(\"&mut new_props\"));\n        assert!(output.contains(\"old_id\"));\n    }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}