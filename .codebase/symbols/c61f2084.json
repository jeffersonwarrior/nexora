{
  "file_path": "/work/external-deps/Context-Engine/tests/test_ingest_excluder.py",
  "file_hash": "b88d79af5150854ac174384c63ca479a962ce85a",
  "updated_at": "2025-12-26T17:34:24.236907",
  "symbols": {
    "function_test_excluder_defaults_and_ignore_7": {
      "name": "test_excluder_defaults_and_ignore",
      "type": "function",
      "start_line": 7,
      "end_line": 27,
      "content_hash": "0f8e5cbc777bf5bf005821658d3e8108e088eca4",
      "content": "def test_excluder_defaults_and_ignore(tmp_path, monkeypatch):\n    root = tmp_path\n    # Create files and dirs\n    (root / \".git\").mkdir()\n    (root / \"node_modules\").mkdir()\n    (root / \".remote-git\").mkdir()\n    (root / \"keep.py\").write_text(\"print('ok')\\n\")\n    (root / \"skip.log\").write_text(\"log\\n\")\n\n    # .qdrantignore excludes *.log and folder tmp/\n    (root / \".qdrantignore\").write_text(\"\"\"\\n*.log\\ntmp/\\n\"\"\")\n\n    excl = ing._Excluder(root)\n    # Defaults should exclude .git and node_modules directories\n    assert excl.exclude_dir(\"/.git\")\n    assert excl.exclude_dir(\"/node_modules\")\n    assert excl.exclude_dir(\"/.remote-git\")\n    # .qdrantignore should exclude .log files\n    assert excl.exclude_file(\"skip.log\")\n    # keep.py should be allowed\n    assert not excl.exclude_file(\"keep.py\")",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_excluder_env_overrides_30": {
      "name": "test_excluder_env_overrides",
      "type": "function",
      "start_line": 30,
      "end_line": 41,
      "content_hash": "35e4067491c9835edf1c17e29e9e48991c4e7a80",
      "content": "def test_excluder_env_overrides(tmp_path, monkeypatch):\n    root = tmp_path\n    (root / \"a\").mkdir()\n    (root / \"a\" / \"file.tmp\").write_text(\"x\\n\")\n\n    # Disable defaults and add custom patterns via QDRANT_EXCLUDES (comma-separated)\n    monkeypatch.setenv(\"QDRANT_DEFAULT_EXCLUDES\", \"0\")\n    monkeypatch.setenv(\"QDRANT_EXCLUDES\", \"build,dist,*.tmp,*.bak\")\n\n    excl = ing._Excluder(root)\n    assert not excl.exclude_dir(\"/.git\")  # defaults off\n    assert excl.exclude_file(\"a/file.tmp\")",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_remote_git_history_manifest_detection_44": {
      "name": "test_remote_git_history_manifest_detection",
      "type": "function",
      "start_line": 44,
      "end_line": 46,
      "content_hash": "bf1d99c5001ad32dce538108ae90bf8de1760143",
      "content": "def test_remote_git_history_manifest_detection(tmp_path):\n    p = tmp_path / \".remote-git\" / \"git_history_test.json\"\n    assert ing._should_skip_explicit_file_by_excluder(p)",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_iter_files_single_file_skips_excluded_remote_git_manifest_49": {
      "name": "test_iter_files_single_file_skips_excluded_remote_git_manifest",
      "type": "function",
      "start_line": 49,
      "end_line": 55,
      "content_hash": "e2e5929a7bb6edf72638a6ca54ddf07cb36441ad",
      "content": "def test_iter_files_single_file_skips_excluded_remote_git_manifest(tmp_path):\n    p = tmp_path / \".remote-git\" / \"git_history_test.json\"\n    p.parent.mkdir(parents=True, exist_ok=True)\n    p.write_text(\"{}\\n\")\n\n    assert ing._should_skip_explicit_file_by_excluder(p)\n    assert list(ing.iter_files(p)) == []",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_excluder_default_excludes_remote_git_nested_58": {
      "name": "test_excluder_default_excludes_remote_git_nested",
      "type": "function",
      "start_line": 58,
      "end_line": 64,
      "content_hash": "03f7980e3a02ad3505c062351d26a5819e162786",
      "content": "def test_excluder_default_excludes_remote_git_nested(tmp_path):\n    root = tmp_path\n    repo = root / \"repo\"\n    (repo / \".remote-git\").mkdir(parents=True, exist_ok=True)\n\n    excl = ing._Excluder(root)\n    assert excl.exclude_dir(\"/repo/.remote-git\")",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}