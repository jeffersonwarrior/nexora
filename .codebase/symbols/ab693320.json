{
  "file_path": "/work/external-deps/claude-mem/src/hooks/summary-hook.ts",
  "file_hash": "fc16710cdec8cc7ed80c20da69db8b463328fad4",
  "updated_at": "2025-12-26T17:34:24.046978",
  "symbols": {
    "function_summaryHook_28": {
      "name": "summaryHook",
      "type": "function",
      "start_line": 28,
      "end_line": 74,
      "content_hash": "8dd30973d0704f11c16b8dad7cbab1bd3ff49360",
      "content": "async function summaryHook(input?: StopInput): Promise<void> {\n  // Ensure worker is running before any other logic\n  await ensureWorkerRunning();\n\n  if (!input) {\n    throw new Error('summaryHook requires input');\n  }\n\n  const { session_id } = input;\n\n  const port = getWorkerPort();\n\n  // Validate required fields before processing\n  if (!input.transcript_path) {\n    throw new Error(`Missing transcript_path in Stop hook input for session ${session_id}`);\n  }\n\n  // Extract last user AND assistant messages from transcript\n  const lastUserMessage = extractLastMessage(input.transcript_path, 'user');\n  const lastAssistantMessage = extractLastMessage(input.transcript_path, 'assistant', true);\n\n  logger.dataIn('HOOK', 'Stop: Requesting summary', {\n    workerPort: port,\n    hasLastUserMessage: !!lastUserMessage,\n    hasLastAssistantMessage: !!lastAssistantMessage\n  });\n\n  // Send to worker - worker handles privacy check and database operations\n  const response = await fetch(`http://127.0.0.1:${port}/api/sessions/summarize`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      claudeSessionId: session_id,\n      last_user_message: lastUserMessage,\n      last_assistant_message: lastAssistantMessage\n    }),\n    signal: AbortSignal.timeout(HOOK_TIMEOUTS.DEFAULT)\n  });\n\n  if (!response.ok) {\n    throw new Error(`Summary generation failed: ${response.status}`);\n  }\n\n  logger.debug('HOOK', 'Summary request sent successfully');\n\n  console.log(STANDARD_HOOK_RESPONSE);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}