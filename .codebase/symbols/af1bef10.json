{
  "file_path": "/work/external-deps/claude-mem/src/services/worker/session/SessionCompletionHandler.ts",
  "file_hash": "092fd00bc76de05c28631671ac18d66146ae6c11",
  "updated_at": "2025-12-26T17:34:23.927994",
  "symbols": {
    "class_SessionCompletionHandler_17": {
      "name": "SessionCompletionHandler",
      "type": "class",
      "start_line": 17,
      "end_line": 62,
      "content_hash": "d7567b8f35ba4c4aa137647c1dcc95ecbaa617b0",
      "content": "export class SessionCompletionHandler {\n  constructor(\n    private sessionManager: SessionManager,\n    private dbManager: DatabaseManager,\n    private eventBroadcaster: SessionEventBroadcaster\n  ) {}\n\n  /**\n   * Complete session by database ID\n   * Used by DELETE /api/sessions/:id and POST /api/sessions/:id/complete\n   */\n  async completeByDbId(sessionDbId: number): Promise<void> {\n    // Delete from session manager (aborts SDK agent)\n    await this.sessionManager.deleteSession(sessionDbId);\n\n    // Mark session complete in database\n    this.dbManager.markSessionComplete(sessionDbId);\n\n    // Broadcast session completed event\n    this.eventBroadcaster.broadcastSessionCompleted(sessionDbId);\n  }\n\n  /**\n   * Complete session by Claude session ID\n   * Used by POST /api/sessions/complete (cleanup-hook endpoint)\n   *\n   * @returns true if session was found and completed, false if no active session found\n   */\n  async completeByClaudeId(claudeSessionId: string): Promise<boolean> {\n    const store = this.dbManager.getSessionStore();\n\n    // Find session by claudeSessionId\n    const session = store.findActiveSDKSession(claudeSessionId);\n    if (!session) {\n      // No active session - nothing to clean up (may have already been completed)\n      return false;\n    }\n\n    const sessionDbId = session.id;\n\n    // Complete using standard flow\n    await this.completeByDbId(sessionDbId);\n\n    return true;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_constructor_18": {
      "name": "constructor",
      "type": "method",
      "start_line": 18,
      "end_line": 22,
      "content_hash": "24dd08b7d1e93985e26d244fd2620b917387b30e",
      "content": "  constructor(\n    private sessionManager: SessionManager,\n    private dbManager: DatabaseManager,\n    private eventBroadcaster: SessionEventBroadcaster\n  ) {}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_completeByDbId_28": {
      "name": "completeByDbId",
      "type": "method",
      "start_line": 28,
      "end_line": 37,
      "content_hash": "a5974dc49855781c2dc51e0a796eb2a88dfbdd8f",
      "content": "  async completeByDbId(sessionDbId: number): Promise<void> {\n    // Delete from session manager (aborts SDK agent)\n    await this.sessionManager.deleteSession(sessionDbId);\n\n    // Mark session complete in database\n    this.dbManager.markSessionComplete(sessionDbId);\n\n    // Broadcast session completed event\n    this.eventBroadcaster.broadcastSessionCompleted(sessionDbId);\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_completeByClaudeId_45": {
      "name": "completeByClaudeId",
      "type": "method",
      "start_line": 45,
      "end_line": 61,
      "content_hash": "ce372470ec5eaaee42e6d3b47c0f47ca42f44e6f",
      "content": "  async completeByClaudeId(claudeSessionId: string): Promise<boolean> {\n    const store = this.dbManager.getSessionStore();\n\n    // Find session by claudeSessionId\n    const session = store.findActiveSDKSession(claudeSessionId);\n    if (!session) {\n      // No active session - nothing to clean up (may have already been completed)\n      return false;\n    }\n\n    const sessionDbId = session.id;\n\n    // Complete using standard flow\n    await this.completeByDbId(sessionDbId);\n\n    return true;\n  }",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}