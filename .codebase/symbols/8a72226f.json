{
  "file_path": "/work/internal/indexer/ast_parser_test.go",
  "file_hash": "9f3004b6517dfe060a3995806feefc534a326d64",
  "updated_at": "2025-12-26T17:34:20.002530",
  "symbols": {
    "function_TestParseDirectory_10": {
      "name": "TestParseDirectory",
      "type": "function",
      "start_line": 10,
      "end_line": 19,
      "content_hash": "76678736e6a2d3087c307df2dbc84c9278abd63b",
      "content": "func TestParseDirectory(t *testing.T) {\n\tt.Parallel()\n\tctx := context.Background()\n\ttmpdir := t.TempDir()\n\n\t// Create a test Go file\n\ttestFile := `package main\n\nimport \"fmt\"\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_main_20": {
      "name": "main",
      "type": "function",
      "start_line": 20,
      "end_line": 23,
      "content_hash": "d4e3007ddf1f1105bbbf441c1eff76240aee1f9e",
      "content": "func main() {\n\tfmt.Println(\"hello\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_TestStruct_24": {
      "name": "TestStruct",
      "type": "struct",
      "start_line": 24,
      "end_line": 27,
      "content_hash": "339b60e72e3df03095c7a0edc6023559aaa621e5",
      "content": "type TestStruct struct {\n\tField string\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "method_Method_28": {
      "name": "Method",
      "type": "method",
      "start_line": 28,
      "end_line": 74,
      "content_hash": "33acbc06244113150a180b7a5948f3e36718a668",
      "content": "func (t *TestStruct) Method() string {\n\treturn t.Field\n}\n`\n\n\t// Write the test file\n\terr := os.WriteFile(filepath.Join(tmpdir, \"test.go\"), []byte(testFile), 0o644)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to write test file: %v\", err)\n\t}\n\n\t// Test current implementation\n\tp := NewASTParser()\n\tsymbols, err := p.ParseDirectory(ctx, tmpdir)\n\tif err != nil {\n\t\tt.Fatalf(\"ParseDirectory failed: %v\", err)\n\t}\n\n\t// Verify symbols were extracted\n\tif len(symbols) == 0 {\n\t\tt.Fatal(\"No symbols found\")\n\t}\n\n\t// Check for expected symbols\n\tvar foundMain, foundStruct, foundMethod bool\n\tfor _, symbol := range symbols {\n\t\tswitch symbol.Name {\n\t\tcase \"main\":\n\t\t\tfoundMain = true\n\t\tcase \"TestStruct\":\n\t\t\tfoundStruct = true\n\t\tcase \"TestStruct.Method\":\n\t\t\tfoundMethod = true\n\t\t}\n\t}\n\n\tif !foundMain {\n\t\tt.Error(\"Expected to find main function\")\n\t}\n\tif !foundStruct {\n\t\tt.Error(\"Expected to find TestStruct\")\n\t}\n\tif !foundMethod {\n\t\tt.Error(\"Expected to find Method\")\n\t}\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestParseDirectoryWithGoMod_75": {
      "name": "TestParseDirectoryWithGoMod",
      "type": "function",
      "start_line": 75,
      "end_line": 97,
      "content_hash": "8644aa899823a9f4faad24c4d85cf540e7c4e105",
      "content": "func TestParseDirectoryWithGoMod(t *testing.T) {\n\tt.Parallel()\n\tctx := context.Background()\n\ttmpdir := t.TempDir()\n\n\t// Create a go.mod file\n\tgoModContent := `module test.com/example\n\ngo 1.21\n`\n\terr := os.WriteFile(filepath.Join(tmpdir, \"go.mod\"), []byte(goModContent), 0o644)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to write go.mod: %v\", err)\n\t}\n\n\t// Create a test Go file with build tags\n\ttestFile := `//go:build testtag\n\npackage main\n\nimport \"fmt\"\n\n// This function should only be included when testtag is set",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_taggedFunction_98": {
      "name": "taggedFunction",
      "type": "function",
      "start_line": 98,
      "end_line": 101,
      "content_hash": "81fcbd8a5d6bca09244dc9e5380ee9cb30550f90",
      "content": "func taggedFunction() {\n\tfmt.Println(\"tagged\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_TestStruct_102": {
      "name": "TestStruct",
      "type": "struct",
      "start_line": 102,
      "end_line": 139,
      "content_hash": "8b1c8ad950e4ef17bb42f28a83f0aad904c8dbe2",
      "content": "type TestStruct struct {\n\tField string\n}\n`\n\n\t// Write the test file\n\terr = os.WriteFile(filepath.Join(tmpdir, \"test.go\"), []byte(testFile), 0o644)\n\tif err != nil {\n\t\tt.Fatalf(\"Failed to write test file: %v\", err)\n\t}\n\n\t// Test implementation with go.mod present\n\tp := NewASTParser()\n\tsymbols, err := p.ParseDirectory(ctx, tmpdir)\n\tif err != nil {\n\t\tt.Fatalf(\"ParseDirectory with go.mod failed: %v\", err)\n\t}\n\n\t// Should still parse the file even with build tag\n\tif len(symbols) == 0 {\n\t\tt.Fatal(\"No symbols found with go.mod\")\n\t}\n\n\t// Look for expected symbols\n\tvar foundStruct bool\n\tfor _, symbol := range symbols {\n\t\tswitch symbol.Name {\n\t\tcase \"taggedFunction\":\n\t\t\t// Found tagged function (may not be included due to build tag)\n\t\tcase \"TestStruct\":\n\t\t\tfoundStruct = true\n\t\t}\n\t}\n\n\tif !foundStruct {\n\t\tt.Error(\"Expected to find TestStruct even with build tags\")\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}