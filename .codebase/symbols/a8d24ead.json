{
  "file_path": "/work/context-engine/ctx-mcp-bridge/src/cli.js",
  "file_hash": "bbfd05e30031190125c63a48ef648f3ba54f0bb1",
  "updated_at": "2025-12-26T17:34:22.056034",
  "symbols": {
    "function_runCli_9": {
      "name": "runCli",
      "type": "function",
      "start_line": 9,
      "end_line": 123,
      "content_hash": "2dfec743cd45a1ed111d900142f861d512c9854e",
      "content": "export async function runCli() {\n  const argv = process.argv.slice(2);\n  const cmd = argv[0];\n\n  if (cmd === \"auth\") {\n    const sub = argv[1] || \"\";\n    const args = argv.slice(2);\n    await runAuthCommand(sub, args);\n    return;\n  }\n\n  if (cmd === \"mcp-http-serve\") {\n    const args = argv.slice(1);\n    let workspace = process.cwd();\n    let indexerUrl = process.env.CTXCE_INDEXER_URL || \"http://localhost:8003/mcp\";\n    let memoryUrl = process.env.CTXCE_MEMORY_URL || null;\n    let port = Number.parseInt(process.env.CTXCE_HTTP_PORT || \"30810\", 10) || 30810;\n\n    for (let i = 0; i < args.length; i += 1) {\n      const a = args[i];\n      if (a === \"--workspace\" || a === \"--path\") {\n        if (i + 1 < args.length) {\n          workspace = args[i + 1];\n          i += 1;\n          continue;\n        }\n      }\n      if (a === \"--indexer-url\") {\n        if (i + 1 < args.length) {\n          indexerUrl = args[i + 1];\n          i += 1;\n          continue;\n        }\n      }\n      if (a === \"--memory-url\") {\n        if (i + 1 < args.length) {\n          memoryUrl = args[i + 1];\n          i += 1;\n          continue;\n        }\n      }\n      if (a === \"--port\") {\n        if (i + 1 < args.length) {\n          const parsed = Number.parseInt(args[i + 1], 10);\n          if (!Number.isNaN(parsed) && parsed > 0) {\n            port = parsed;\n          }\n          i += 1;\n          continue;\n        }\n      }\n    }\n\n    // eslint-disable-next-line no-console\n    console.error(\n      `[ctxce] Starting HTTP MCP bridge: workspace=${workspace}, port=${port}, indexerUrl=${indexerUrl}, memoryUrl=${memoryUrl || \"disabled\"}`,\n    );\n    await runHttpMcpServer({ workspace, indexerUrl, memoryUrl, port });\n    return;\n  }\n\n  if (cmd === \"mcp-serve\") {\n    // Minimal flag parsing for PoC: allow passing workspace/root and indexer URL.\n    // Supported flags:\n    //   --workspace / --path   : workspace root (default: cwd)\n    //   --indexer-url          : override MCP indexer URL (default env CTXCE_INDEXER_URL or http://localhost:8003/mcp)\n    const args = argv.slice(1);\n    let workspace = process.cwd();\n    let indexerUrl = process.env.CTXCE_INDEXER_URL || \"http://localhost:8003/mcp\";\n    let memoryUrl = process.env.CTXCE_MEMORY_URL || null;\n\n    for (let i = 0; i < args.length; i += 1) {\n      const a = args[i];\n      if (a === \"--workspace\" || a === \"--path\") {\n        if (i + 1 < args.length) {\n          workspace = args[i + 1];\n          i += 1;\n          continue;\n        }\n      }\n      if (a === \"--indexer-url\") {\n        if (i + 1 < args.length) {\n          indexerUrl = args[i + 1];\n          i += 1;\n          continue;\n        }\n      }\n      if (a === \"--memory-url\") {\n        if (i + 1 < args.length) {\n          memoryUrl = args[i + 1];\n          i += 1;\n          continue;\n        }\n      }\n    }\n\n    // eslint-disable-next-line no-console\n    console.error(\n      `[ctxce] Starting MCP bridge: workspace=${workspace}, indexerUrl=${indexerUrl}, memoryUrl=${memoryUrl || \"disabled\"}`,\n    );\n    await runMcpServer({ workspace, indexerUrl, memoryUrl });\n    return;\n  }\n\n  // Default help\n  const __filename = fileURLToPath(import.meta.url);\n  const __dirname = path.dirname(__filename);\n  const binName = \"ctxce\";\n\n  // eslint-disable-next-line no-console\n  console.error(\n    `Usage: ${binName} mcp-serve [--workspace <path>] [--indexer-url <url>] [--memory-url <url>] | ${binName} mcp-http-serve [--workspace <path>] [--indexer-url <url>] [--memory-url <url>] [--port <port>] | ${binName} auth <login|status|logout> [--backend-url <url>] [--token <token>] [--username <name> --password <pass>]`,\n  );\n  process.exit(1);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}