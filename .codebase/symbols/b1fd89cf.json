{
  "file_path": "/work/internal/agent/tools/edit_diagnostics.go",
  "file_hash": "9b6fe8c8a3efaf4f23eb456305a47c54776d7a61",
  "updated_at": "2025-12-26T17:34:24.954955",
  "symbols": {
    "struct_EditDiagnosticsInfo_10": {
      "name": "EditDiagnosticsInfo",
      "type": "struct",
      "start_line": 10,
      "end_line": 21,
      "content_hash": "3ea92d0b47a96f582147f36085d050d814b5dd50",
      "content": "type EditDiagnosticsInfo struct {\n\tFilePath      string\n\tOldString     string\n\tNewString     string\n\tFileContent   string\n\tFileSizeBytes int\n\tLineCount     int\n\tFailureReason string\n\tContext       map[string]interface{}\n}\n\n// ViewDiagnosticsInfo captures diagnostic information about view operations",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_ViewDiagnosticsInfo_22": {
      "name": "ViewDiagnosticsInfo",
      "type": "struct",
      "start_line": 22,
      "end_line": 31,
      "content_hash": "3b2bf9b45ca57e387de44ec317b0671ead64bdd3",
      "content": "type ViewDiagnosticsInfo struct {\n\tFilePath  string\n\tOffset    int\n\tLimit     int\n\tFileSize  int64\n\tLineCount int\n\tContext   map[string]interface{}\n}\n\n// WhitespaceAnalysis provides detailed whitespace analysis for debugging",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "struct_WhitespaceAnalysis_32": {
      "name": "WhitespaceAnalysis",
      "type": "struct",
      "start_line": 32,
      "end_line": 43,
      "content_hash": "b7519758af5db25ff2b1e915df17da3743811c83",
      "content": "type WhitespaceAnalysis struct {\n\tContainsTab        bool\n\tContainsSpace      bool\n\tLeadingSpaces      int\n\tTrailingSpaces     int\n\tBlankLines         int\n\tHasMixedIndent     bool\n\tLineEndings        string // \"LF\" or \"CRLF\" or \"Mixed\"\n\tByteRepresentation string\n}\n\n// AnalyzeWhitespace performs detailed whitespace analysis on a string",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_AnalyzeWhitespace_44": {
      "name": "AnalyzeWhitespace",
      "type": "function",
      "start_line": 44,
      "end_line": 89,
      "content_hash": "2c40aa15aaf181b8c589ef1decd472bd64e10d6d",
      "content": "func AnalyzeWhitespace(s string) WhitespaceAnalysis {\n\tanalysis := WhitespaceAnalysis{\n\t\tByteRepresentation: formatBytesForDebug(s),\n\t}\n\n\tlines := strings.Split(s, \"\\n\")\n\tindentationStyles := make(map[string]int)\n\n\tfor _, line := range lines {\n\t\tif line == \"\" {\n\t\t\tanalysis.BlankLines++\n\t\t\tcontinue\n\t\t}\n\n\t\tif strings.Contains(line, \"\\t\") {\n\t\t\tanalysis.ContainsTab = true\n\t\t}\n\t\tif strings.Contains(line, \" \") {\n\t\t\tanalysis.ContainsSpace = true\n\t\t}\n\n\t\tfor i, ch := range line {\n\t\t\tif ch == '\\t' {\n\t\t\t\tindentationStyles[\"tab\"]++\n\t\t\t} else if ch == ' ' {\n\t\t\t\tindentationStyles[\"space\"]++\n\t\t\t} else {\n\t\t\t\tanalysis.LeadingSpaces = i\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\ttrimmed := strings.TrimRight(line, \" \\t\")\n\t\tif len(trimmed) < len(line) {\n\t\t\tanalysis.TrailingSpaces += len(line) - len(trimmed)\n\t\t}\n\t}\n\n\tif len(indentationStyles) > 1 {\n\t\tanalysis.HasMixedIndent = true\n\t}\n\n\tanalysis.LineEndings = detectLineEndings(s)\n\treturn analysis\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_detectLineEndings_90": {
      "name": "detectLineEndings",
      "type": "function",
      "start_line": 90,
      "end_line": 103,
      "content_hash": "a19c817e4bd71b4cf816bfc495aacd4f935daa83",
      "content": "func detectLineEndings(s string) string {\n\tcrlfCount := strings.Count(s, \"\\r\\n\")\n\tlfCount := strings.Count(s, \"\\n\") - crlfCount\n\n\tif crlfCount > 0 && lfCount == 0 {\n\t\treturn \"CRLF\"\n\t} else if lfCount > 0 && crlfCount == 0 {\n\t\treturn \"LF\"\n\t} else if crlfCount > 0 && lfCount > 0 {\n\t\treturn \"Mixed\"\n\t}\n\treturn \"Unknown\"\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_formatBytesForDebug_104": {
      "name": "formatBytesForDebug",
      "type": "function",
      "start_line": 104,
      "end_line": 131,
      "content_hash": "5042d4d92102e8cee228699af1ad0b50272f5b05",
      "content": "func formatBytesForDebug(s string) string {\n\tvar result strings.Builder\n\tfor i, ch := range s {\n\t\tif i > 100 {\n\t\t\tresult.WriteString(fmt.Sprintf(\"... (%d more chars)\", len(s)-i))\n\t\t\tbreak\n\t\t}\n\t\tswitch ch {\n\t\tcase '\\n':\n\t\t\tresult.WriteString(\"\\\\n\")\n\t\tcase '\\r':\n\t\t\tresult.WriteString(\"\\\\r\")\n\t\tcase '\\t':\n\t\t\tresult.WriteString(\"\\\\t\")\n\t\tcase ' ':\n\t\t\tresult.WriteString(\"\u00b7\")\n\t\tdefault:\n\t\t\tif ch >= 32 && ch < 127 {\n\t\t\t\tresult.WriteRune(ch)\n\t\t\t} else {\n\t\t\t\tresult.WriteString(fmt.Sprintf(\"\\\\x%02x\", ch))\n\t\t\t}\n\t\t}\n\t}\n\treturn result.String()\n}\n\n// LogEditFailure captures comprehensive diagnostic data when an edit fails",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_LogEditFailure_132": {
      "name": "LogEditFailure",
      "type": "function",
      "start_line": 132,
      "end_line": 163,
      "content_hash": "4c287527cd87db9b799c8134b259166b73ecedd4",
      "content": "func LogEditFailure(diag EditDiagnosticsInfo) {\n\toldAnalysis := AnalyzeWhitespace(diag.OldString)\n\tnewAnalysis := AnalyzeWhitespace(diag.NewString)\n\tfileAnalysis := AnalyzeWhitespace(diag.FileContent)\n\n\tslog.Error(\"Edit operation failed\",\n\t\t\"file\", diag.FilePath,\n\t\t\"failure_reason\", diag.FailureReason,\n\t\t\"old_string_length\", len(diag.OldString),\n\t\t\"new_string_length\", len(diag.NewString),\n\t\t\"file_content_length\", len(diag.FileContent),\n\t\t\"old_string_lines\", strings.Count(diag.OldString, \"\\n\")+1,\n\t\t\"new_string_lines\", strings.Count(diag.NewString, \"\\n\")+1,\n\t\t\"old_has_tabs\", oldAnalysis.ContainsTab,\n\t\t\"old_has_mixed_indent\", oldAnalysis.HasMixedIndent,\n\t\t\"old_line_endings\", oldAnalysis.LineEndings,\n\t\t\"new_has_tabs\", newAnalysis.ContainsTab,\n\t\t\"file_has_tabs\", fileAnalysis.ContainsTab,\n\t\t\"file_has_mixed_indent\", fileAnalysis.HasMixedIndent,\n\t\t\"file_line_endings\", fileAnalysis.LineEndings,\n\t\t\"old_string_preview\", truncatePreview(diag.OldString, 80),\n\t\t\"file_size\", len(diag.FileContent),\n\t)\n\n\tslog.Debug(\"Edit failure detailed diagnostics\",\n\t\t\"old_string_bytes\", oldAnalysis.ByteRepresentation,\n\t\t\"new_string_bytes\", newAnalysis.ByteRepresentation,\n\t\t\"additional_context\", diag.Context,\n\t)\n}\n\n// LogEditSuccess captures successful edit metrics",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_LogEditSuccess_164": {
      "name": "LogEditSuccess",
      "type": "function",
      "start_line": 164,
      "end_line": 174,
      "content_hash": "a1051a5e7ff9f021673b1f2d427c71109e8d73bc",
      "content": "func LogEditSuccess(filePath string, oldLen, newLen int, replacementCount int, attemptCount int) {\n\tslog.Info(\"Edit operation succeeded\",\n\t\t\"file\", filePath,\n\t\t\"old_string_length\", oldLen,\n\t\t\"new_string_length\", newLen,\n\t\t\"replacement_count\", replacementCount,\n\t\t\"attempt_count\", attemptCount,\n\t)\n}\n\n// LogViewOperation logs view tool operations",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_LogViewOperation_175": {
      "name": "LogViewOperation",
      "type": "function",
      "start_line": 175,
      "end_line": 186,
      "content_hash": "31efc042afd3846d9265096791abf153870e74ae",
      "content": "func LogViewOperation(diag ViewDiagnosticsInfo, duration float64) {\n\tslog.Info(\"View operation completed\",\n\t\t\"file\", diag.FilePath,\n\t\t\"offset\", diag.Offset,\n\t\t\"limit\", diag.Limit,\n\t\t\"file_size\", diag.FileSize,\n\t\t\"total_lines\", diag.LineCount,\n\t\t\"duration_ms\", duration,\n\t)\n}\n\n// LogViewError logs view tool errors",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_LogViewError_187": {
      "name": "LogViewError",
      "type": "function",
      "start_line": 187,
      "end_line": 196,
      "content_hash": "9add23ce1cb6ceb909a42d8aa3fc395c5aa8f86c",
      "content": "func LogViewError(diag ViewDiagnosticsInfo, errReason string) {\n\tslog.Error(\"View operation failed\",\n\t\t\"file\", diag.FilePath,\n\t\t\"offset\", diag.Offset,\n\t\t\"limit\", diag.Limit,\n\t\t\"file_size\", diag.FileSize,\n\t\t\"error_reason\", errReason,\n\t)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_truncatePreview_197": {
      "name": "truncatePreview",
      "type": "function",
      "start_line": 197,
      "end_line": 204,
      "content_hash": "70b5e52be2738bfe1f14828c3b8e0c0253b77aa3",
      "content": "func truncatePreview(s string, maxLen int) string {\n\tif len(s) <= maxLen {\n\t\treturn formatBytesForDebug(s)\n\t}\n\treturn formatBytesForDebug(s[:maxLen]) + \"...\"\n}\n\n// LogSelfHealingAttempt logs self-healing retry attempts",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_LogSelfHealingAttempt_205": {
      "name": "LogSelfHealingAttempt",
      "type": "function",
      "start_line": 205,
      "end_line": 220,
      "content_hash": "7676f3d788c9ef9ce6c736b37a68888fc7aa2bf1",
      "content": "func LogSelfHealingAttempt(filePath, reason string, success bool, originalLen, improvedLen int) {\n\tlevel := slog.LevelInfo\n\tif !success {\n\t\tlevel = slog.LevelWarn\n\t}\n\tslog.Log(nil, level,\n\t\t\"Self-healing edit retry\",\n\t\t\"file\", filePath,\n\t\t\"reason\", reason,\n\t\t\"success\", success,\n\t\t\"original_length\", originalLen,\n\t\t\"improved_length\", improvedLen,\n\t)\n}\n\n// PatternMatchAnalysis provides insight into why pattern matching failed",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_PatternMatchAnalysis_221": {
      "name": "PatternMatchAnalysis",
      "type": "function",
      "start_line": 221,
      "end_line": 231,
      "content_hash": "0f0711a2da174b94a25447c3273341f735a0fca0",
      "content": "func PatternMatchAnalysis(fileContent, pattern string) map[string]interface{} {\n\treturn map[string]interface{}{\n\t\t\"file_length\":        len(fileContent),\n\t\t\"pattern_length\":     len(pattern),\n\t\t\"pattern_line_count\": strings.Count(pattern, \"\\n\") + 1,\n\t\t\"file_line_count\":    strings.Count(fileContent, \"\\n\") + 1,\n\t\t\"pattern_in_file\":    strings.Contains(fileContent, pattern),\n\t}\n}\n\n// AnalyzeWhitespaceDifference compares whitespace between file content and pattern",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_AnalyzeWhitespaceDifference_232": {
      "name": "AnalyzeWhitespaceDifference",
      "type": "function",
      "start_line": 232,
      "end_line": 253,
      "content_hash": "e3d972d659d732020864c0c30bc441f60ac79a3c",
      "content": "func AnalyzeWhitespaceDifference(fileContent, pattern string) map[string]interface{} {\n\tfileTabs := strings.Count(fileContent, \"\\t\")\n\tpatternTabs := strings.Count(pattern, \"\\t\")\n\tdisplayTabs := strings.Count(pattern, \"\u2192\\t\")\n\n\tfileSpaces := countLeadingSpaces(fileContent)\n\tpatternSpaces := countLeadingSpaces(pattern)\n\n\treturn map[string]interface{}{\n\t\t\"has_tab_mismatch\":            displayTabs > 0,\n\t\t\"expected_tabs\":               fileTabs,\n\t\t\"found_tabs\":                  patternTabs,\n\t\t\"display_tabs\":                displayTabs,\n\t\t\"has_space_mismatch\":          patternSpaces != fileSpaces,\n\t\t\"expected_spaces\":             fileSpaces,\n\t\t\"found_spaces\":                patternSpaces,\n\t\t\"pattern_in_file\":             strings.Contains(fileContent, pattern),\n\t\t\"pattern_after_normalization\": strings.Contains(fileContent, normalizeTabIndicators(pattern)),\n\t}\n}\n\n// Helper function for space counting",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_countLeadingSpaces_254": {
      "name": "countLeadingSpaces",
      "type": "function",
      "start_line": 254,
      "end_line": 270,
      "content_hash": "0a4dfa7fa1c2b9a15e1b707cd2fc0281dfb0cac5",
      "content": "func countLeadingSpaces(content string) int {\n\tlines := strings.Split(content, \"\\n\")\n\tif len(lines) == 0 {\n\t\treturn 0\n\t}\n\n\t// Count leading spaces on first non-empty line\n\tfor _, line := range lines {\n\t\ttrimmed := strings.TrimLeft(line, \" \")\n\t\tif len(trimmed) < len(line) {\n\t\t\treturn len(line) - len(trimmed)\n\t\t}\n\t}\n\treturn 0\n}\n\n// createAIErrorMessage generates AI-friendly error messages with actionable guidance",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_createAIErrorMessage_271": {
      "name": "createAIErrorMessage",
      "type": "function",
      "start_line": 271,
      "end_line": 307,
      "content_hash": "a2dcc1497bca66febab4357c27b703d1bcf97847",
      "content": "func createAIErrorMessage(err error, fileContent, oldString string) string {\n\tanalysis := AnalyzeWhitespaceDifference(fileContent, oldString)\n\n\t// Tab mismatch - most common issue\n\tif analysis[\"has_tab_mismatch\"].(bool) {\n\t\treturn fmt.Sprintf(\"TAB_MISMATCH: The VIEW tool shows tabs as '\u2192\\t' but EDIT needs raw tabs. \"+\n\t\t\t\"Found %d display tabs in your pattern. Try: \"+\n\t\t\t\"1) Use AI mode (ai_mode=true) for automatic normalization, or \"+\n\t\t\t\"2) Replace '\u2192\\t' with actual tab characters in your pattern.\",\n\t\t\tanalysis[\"display_tabs\"].(int))\n\t}\n\n\t// Space mismatch\n\tif analysis[\"has_space_mismatch\"].(bool) {\n\t\treturn fmt.Sprintf(\"SPACE_MISMATCH: Expected %d leading spaces but found %d. \"+\n\t\t\t\"Count spaces carefully. AI mode (ai_mode=true) can help with this.\",\n\t\t\tanalysis[\"expected_spaces\"].(int), analysis[\"found_spaces\"].(int))\n\t}\n\n\t// Pattern not found at all\n\tif !analysis[\"pattern_in_file\"].(bool) {\n\t\t// Check if it would match after normalization\n\t\tif analysis[\"pattern_after_normalization\"].(bool) {\n\t\t\treturn fmt.Sprintf(\"PATTERN_FORMAT_MISMATCH: Your pattern would match after tab normalization. \" +\n\t\t\t\t\"Use AI mode (ai_mode=true) or normalize tabs manually.\")\n\t\t}\n\n\t\treturn fmt.Sprintf(\"PATTERN_NOT_FOUND: The text was not found in the file. \" +\n\t\t\t\"Common fixes: 1) Use AI mode (ai_mode=true), \" +\n\t\t\t\"2) Include more surrounding context (3-5 lines), \" +\n\t\t\t\"3) Check for tab/space differences, \" +\n\t\t\t\"4) Verify the file hasn't changed since you viewed it.\")\n\t}\n\n\t// Fallback to original error\n\treturn err.Error()\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}