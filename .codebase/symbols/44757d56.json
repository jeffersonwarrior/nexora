{
  "file_path": "/work/internal/oauth/claude/oauth.go",
  "file_hash": "f84e46111e1793dd9ada45bbf0f668ee8800b836",
  "updated_at": "2025-12-26T17:34:19.949896",
  "symbols": {
    "function_AuthorizeURL_20": {
      "name": "AuthorizeURL",
      "type": "function",
      "start_line": 20,
      "end_line": 37,
      "content_hash": "ff4156c0cbcee7fda9e4b54b6bdd96e5d0742ce8",
      "content": "func AuthorizeURL(verifier, challenge string) (string, error) {\n\tu, err := url.Parse(\"https://claude.ai/oauth/authorize\")\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\tq := u.Query()\n\tq.Set(\"response_type\", \"code\")\n\tq.Set(\"client_id\", clientId)\n\tq.Set(\"redirect_uri\", \"https://console.anthropic.com/oauth/code/callback\")\n\tq.Set(\"scope\", \"org:create_api_key user:profile user:inference\")\n\tq.Set(\"code_challenge\", challenge)\n\tq.Set(\"code_challenge_method\", \"S256\")\n\tq.Set(\"state\", verifier)\n\tu.RawQuery = q.Encode()\n\treturn u.String(), nil\n}\n\n// ExchangeToken exchanges the authorization code for an OAuth2 token.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_ExchangeToken_38": {
      "name": "ExchangeToken",
      "type": "function",
      "start_line": 38,
      "end_line": 79,
      "content_hash": "add083ff86ceec6b7dd964f3c54ac2aa4ab0080a",
      "content": "func ExchangeToken(ctx context.Context, code, verifier string) (*oauth.Token, error) {\n\tcode = strings.TrimSpace(code)\n\tparts := strings.SplitN(code, \"#\", 2)\n\tpure := parts[0]\n\tstate := \"\"\n\tif len(parts) > 1 {\n\t\tstate = parts[1]\n\t}\n\n\treqBody := map[string]string{\n\t\t\"code\":          pure,\n\t\t\"state\":         state,\n\t\t\"grant_type\":    \"authorization_code\",\n\t\t\"client_id\":     clientId,\n\t\t\"redirect_uri\":  \"https://console.anthropic.com/oauth/code/callback\",\n\t\t\"code_verifier\": verifier,\n\t}\n\n\tresp, err := request(ctx, \"POST\", \"https://console.anthropic.com/v1/oauth/token\", reqBody)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tbody, err := io.ReadAll(resp.Body)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tif resp.StatusCode != http.StatusOK {\n\t\treturn nil, fmt.Errorf(\"claude code max: failed to exchange token: status %d body %q\", resp.StatusCode, string(body))\n\t}\n\n\tvar token oauth.Token\n\tif err := json.Unmarshal(body, &token); err != nil {\n\t\treturn nil, err\n\t}\n\ttoken.SetExpiresAt()\n\treturn &token, nil\n}\n\n// RefreshToken refreshes the OAuth2 token using the provided refresh token.",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_RefreshToken_80": {
      "name": "RefreshToken",
      "type": "function",
      "start_line": 80,
      "end_line": 109,
      "content_hash": "b7ac95622888e119e2be2b8542e7733183a0165f",
      "content": "func RefreshToken(ctx context.Context, refreshToken string) (*oauth.Token, error) {\n\treqBody := map[string]string{\n\t\t\"grant_type\":    \"refresh_token\",\n\t\t\"refresh_token\": refreshToken,\n\t\t\"client_id\":     clientId,\n\t}\n\n\tresp, err := request(ctx, \"POST\", \"https://console.anthropic.com/v1/oauth/token\", reqBody)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer resp.Body.Close()\n\n\tbody, err := io.ReadAll(resp.Body)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tif resp.StatusCode != http.StatusOK {\n\t\treturn nil, fmt.Errorf(\"claude code max: failed to refresh token: status %d body %q\", resp.StatusCode, string(body))\n\t}\n\n\tvar token oauth.Token\n\tif err := json.Unmarshal(body, &token); err != nil {\n\t\treturn nil, err\n\t}\n\ttoken.SetExpiresAt()\n\treturn &token, nil\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_request_110": {
      "name": "request",
      "type": "function",
      "start_line": 110,
      "end_line": 126,
      "content_hash": "2eccb6ece3caf68fdbf7fdea5f5046d06d9299e7",
      "content": "func request(ctx context.Context, method, url string, body any) (*http.Response, error) {\n\tdate, err := json.Marshal(body)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\treq, err := http.NewRequestWithContext(ctx, method, url, bytes.NewReader(date))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\treq.Header.Set(\"Content-Type\", \"application/json\")\n\treq.Header.Set(\"User-Agent\", \"anthropic\")\n\n\tclient := &http.Client{Timeout: 30 * time.Second}\n\treturn client.Do(req)\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}