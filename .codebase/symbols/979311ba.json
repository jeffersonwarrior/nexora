{
  "file_path": "/work/internal/diff/diff_test.go",
  "file_hash": "9b28030d3c42883f8ed3c11e38365cf05c7eba40",
  "updated_at": "2025-12-26T17:34:20.929762",
  "symbols": {
    "function_TestGenerateDiff_8": {
      "name": "TestGenerateDiff",
      "type": "function",
      "start_line": 8,
      "end_line": 216,
      "content_hash": "1ae83c69c4a7560bf86e2926d1f48e073cba9ac7",
      "content": "func TestGenerateDiff(t *testing.T) {\n\ttests := []struct {\n\t\tname            string\n\t\tbeforeContent   string\n\t\tafterContent    string\n\t\tfileName        string\n\t\texpectAdditions int\n\t\texpectRemovals  int\n\t\tcheckDiff       func(t *testing.T, diff string)\n\t}{\n\t\t{\n\t\t\tname:            \"no changes\",\n\t\t\tbeforeContent:   \"line1\\nline2\\nline3\\n\",\n\t\t\tafterContent:    \"line1\\nline2\\nline3\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 0,\n\t\t\texpectRemovals:  0,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif diff != \"\" {\n\t\t\t\t\tt.Errorf(\"Expected empty diff for identical content, got: %s\", diff)\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"add one line\",\n\t\t\tbeforeContent:   \"line1\\nline2\\n\",\n\t\t\tafterContent:    \"line1\\nline2\\nline3\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 1,\n\t\t\texpectRemovals:  0,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"+line3\") {\n\t\t\t\t\tt.Errorf(\"Expected diff to contain '+line3', got: %s\", diff)\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"a/test.txt\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain 'a/test.txt'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"b/test.txt\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain 'b/test.txt'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"remove one line\",\n\t\t\tbeforeContent:   \"line1\\nline2\\nline3\\n\",\n\t\t\tafterContent:    \"line1\\nline3\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 1, // line1 is shown as context\n\t\t\texpectRemovals:  2, // line1 and line2\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"-line2\") {\n\t\t\t\t\tt.Errorf(\"Expected diff to contain '-line2', got: %s\", diff)\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"modify line\",\n\t\t\tbeforeContent:   \"line1\\nold line\\nline3\\n\",\n\t\t\tafterContent:    \"line1\\nnew line\\nline3\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 1,\n\t\t\texpectRemovals:  1,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"-old line\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '-old line'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"+new line\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '+new line'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"multiple additions\",\n\t\t\tbeforeContent:   \"line1\\n\",\n\t\t\tafterContent:    \"line1\\nline2\\nline3\\nline4\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 3,\n\t\t\texpectRemovals:  0,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"+line2\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '+line2'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"+line3\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '+line3'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"+line4\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '+line4'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"multiple removals\",\n\t\t\tbeforeContent:   \"line1\\nline2\\nline3\\nline4\\n\",\n\t\t\tafterContent:    \"line1\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 0,\n\t\t\texpectRemovals:  3,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"-line2\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '-line2'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"-line3\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '-line3'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"-line4\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '-line4'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"empty to content\",\n\t\t\tbeforeContent:   \"\",\n\t\t\tafterContent:    \"line1\\nline2\\n\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 2,\n\t\t\texpectRemovals:  0,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"+line1\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '+line1'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"+line2\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '+line2'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"content to empty\",\n\t\t\tbeforeContent:   \"line1\\nline2\\n\",\n\t\t\tafterContent:    \"\",\n\t\t\tfileName:        \"test.txt\",\n\t\t\texpectAdditions: 0,\n\t\t\texpectRemovals:  2,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"-line1\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '-line1'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"-line2\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain '-line2'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"filename with leading slash\",\n\t\t\tbeforeContent:   \"old\\n\",\n\t\t\tafterContent:    \"new\\n\",\n\t\t\tfileName:        \"/path/to/file.txt\",\n\t\t\texpectAdditions: 1,\n\t\t\texpectRemovals:  1,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\t// Should strip leading slash\n\t\t\t\tif !strings.Contains(diff, \"a/path/to/file.txt\") {\n\t\t\t\t\tt.Errorf(\"Expected 'a/path/to/file.txt', got: %s\", diff)\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"b/path/to/file.txt\") {\n\t\t\t\t\tt.Errorf(\"Expected 'b/path/to/file.txt', got: %s\", diff)\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"filename without leading slash\",\n\t\t\tbeforeContent:   \"old\\n\",\n\t\t\tafterContent:    \"new\\n\",\n\t\t\tfileName:        \"path/to/file.txt\",\n\t\t\texpectAdditions: 1,\n\t\t\texpectRemovals:  1,\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"a/path/to/file.txt\") {\n\t\t\t\t\tt.Error(\"Expected 'a/path/to/file.txt'\")\n\t\t\t\t}\n\t\t\t\tif !strings.Contains(diff, \"b/path/to/file.txt\") {\n\t\t\t\t\tt.Error(\"Expected 'b/path/to/file.txt'\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tname:            \"complex code diff\",\n\t\t\tbeforeContent:   \"func main() {\\n\\tfmt.Println(\\\"Hello\\\")\\n}\\n\",\n\t\t\tafterContent:    \"func main() {\\n\\tfmt.Println(\\\"Hello\\\")\\n\\tfmt.Println(\\\"World\\\")\\n}\\n\",\n\t\t\tfileName:        \"main.go\",\n\t\t\texpectAdditions: 2, // Hello line shown as context + World line\n\t\t\texpectRemovals:  1, // Original Hello line\n\t\t\tcheckDiff: func(t *testing.T, diff string) {\n\t\t\t\tif !strings.Contains(diff, \"+\\tfmt.Println(\\\"World\\\")\") {\n\t\t\t\t\tt.Error(\"Expected diff to contain new println statement\")\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t}\n\n\tfor _, tt := range tests {\n\t\tt.Run(tt.name, func(t *testing.T) {\n\t\t\tdiff, additions, removals := GenerateDiff(tt.beforeContent, tt.afterContent, tt.fileName)\n\n\t\t\tif additions != tt.expectAdditions {\n\t\t\t\tt.Errorf(\"Expected %d additions, got %d\", tt.expectAdditions, additions)\n\t\t\t}\n\n\t\t\tif removals != tt.expectRemovals {\n\t\t\t\tt.Errorf(\"Expected %d removals, got %d\", tt.expectRemovals, removals)\n\t\t\t}\n\n\t\t\tif tt.checkDiff != nil {\n\t\t\t\ttt.checkDiff(t, diff)\n\t\t\t}\n\t\t})\n\t}\n}\n\n// TestGenerateDiffEdgeCases tests edge cases and special scenarios",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestGenerateDiffEdgeCases_217": {
      "name": "TestGenerateDiffEdgeCases",
      "type": "function",
      "start_line": 217,
      "end_line": 279,
      "content_hash": "7dff475b80966e7ca6e7bbf4df36fa1b62d8b105",
      "content": "func TestGenerateDiffEdgeCases(t *testing.T) {\n\tt.Run(\"very long lines\", func(t *testing.T) {\n\t\tlongLine := strings.Repeat(\"a\", 10000)\n\t\tbefore := longLine + \"\\n\"\n\t\tafter := strings.Repeat(\"b\", 10000) + \"\\n\"\n\n\t\tdiff, additions, removals := GenerateDiff(before, after, \"long.txt\")\n\n\t\tif additions != 1 {\n\t\t\tt.Errorf(\"Expected 1 addition, got %d\", additions)\n\t\t}\n\t\tif removals != 1 {\n\t\t\tt.Errorf(\"Expected 1 removal, got %d\", removals)\n\t\t}\n\t\tif diff == \"\" {\n\t\t\tt.Error(\"Expected non-empty diff\")\n\t\t}\n\t})\n\n\tt.Run(\"special characters in filename\", func(t *testing.T) {\n\t\tdiff, _, _ := GenerateDiff(\"old\\n\", \"new\\n\", \"file with spaces.txt\")\n\t\tif !strings.Contains(diff, \"file with spaces.txt\") {\n\t\t\tt.Error(\"Expected filename with spaces to be preserved\")\n\t\t}\n\t})\n\n\tt.Run(\"unicode content\", func(t *testing.T) {\n\t\tbefore := \"Hello \u4e16\u754c\\n\"\n\t\tafter := \"Hello World\\n\"\n\n\t\tdiff, additions, removals := GenerateDiff(before, after, \"unicode.txt\")\n\n\t\tif additions != 1 {\n\t\t\tt.Errorf(\"Expected 1 addition, got %d\", additions)\n\t\t}\n\t\tif removals != 1 {\n\t\t\tt.Errorf(\"Expected 1 removal, got %d\", removals)\n\t\t}\n\t\tif !strings.Contains(diff, \"Hello World\") {\n\t\t\tt.Error(\"Expected diff to contain new content\")\n\t\t}\n\t})\n\n\tt.Run(\"lines with plus and minus but not diff markers\", func(t *testing.T) {\n\t\tbefore := \"normal line\\n\"\n\t\tafter := \"normal line\\n+ this is content, not diff\\n- also content\\n\"\n\n\t\tdiff, additions, removals := GenerateDiff(before, after, \"test.txt\")\n\n\t\t// Should count actual additions (the two new lines)\n\t\tif additions != 2 {\n\t\t\tt.Errorf(\"Expected 2 additions, got %d\", additions)\n\t\t}\n\t\tif removals != 0 {\n\t\t\tt.Errorf(\"Expected 0 removals, got %d\", removals)\n\t\t}\n\t\tif diff == \"\" {\n\t\t\tt.Error(\"Expected non-empty diff\")\n\t\t}\n\t})\n}\n\n// TestGenerateDiffCountAccuracy verifies that +++ and --- headers are not counted",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestGenerateDiffCountAccuracy_280": {
      "name": "TestGenerateDiffCountAccuracy",
      "type": "function",
      "start_line": 280,
      "end_line": 301,
      "content_hash": "52c6a34c329e2923f9c430da0ea7f5f9753adb96",
      "content": "func TestGenerateDiffCountAccuracy(t *testing.T) {\n\tbefore := \"line1\\nline2\\nline3\\n\"\n\tafter := \"line1\\nmodified\\nline3\\n\"\n\n\tdiff, additions, removals := GenerateDiff(before, after, \"test.txt\")\n\n\t// Should have exactly 1 addition and 1 removal\n\tif additions != 1 {\n\t\tt.Errorf(\"Expected 1 addition, got %d\", additions)\n\t}\n\tif removals != 1 {\n\t\tt.Errorf(\"Expected 1 removal, got %d\", removals)\n\t}\n\n\t// Verify the diff contains the header markers but they're not counted\n\tif !strings.Contains(diff, \"+++\") {\n\t\tt.Error(\"Expected diff to contain +++ header\")\n\t}\n\tif !strings.Contains(diff, \"---\") {\n\t\tt.Error(\"Expected diff to contain --- header\")\n\t}\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}