{
  "file_path": "/work/external-deps/claude-mem/src/servers/mcp-server.ts",
  "file_hash": "0be398462cfd3102880c11f5a6aa8f8641050696",
  "updated_at": "2025-12-26T17:34:22.144661",
  "symbols": {
    "function_callWorkerAPI_111": {
      "name": "callWorkerAPI",
      "type": "function",
      "start_line": 111,
      "end_line": 151,
      "content_hash": "c07a98ea93fbb9c65e7d639c46751e3ce9cc6b77",
      "content": "async function callWorkerAPI(\n  endpoint: string,\n  params: Record<string, any>\n): Promise<{ content: Array<{ type: 'text'; text: string }>; isError?: boolean }> {\n  logger.debug('SYSTEM', '\u2192 Worker API', undefined, { endpoint, params });\n\n  try {\n    const searchParams = new URLSearchParams();\n\n    // Convert params to query string\n    for (const [key, value] of Object.entries(params)) {\n      if (value !== undefined && value !== null) {\n        searchParams.append(key, String(value));\n      }\n    }\n\n    const url = `${WORKER_BASE_URL}${endpoint}?${searchParams}`;\n    const response = await fetch(url);\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Worker API error (${response.status}): ${errorText}`);\n    }\n\n    const data = await response.json() as { content: Array<{ type: 'text'; text: string }>; isError?: boolean };\n\n    logger.debug('SYSTEM', '\u2190 Worker API success', undefined, { endpoint });\n\n    // Worker returns { content: [...] } format directly\n    return data;\n  } catch (error: any) {\n    logger.error('SYSTEM', '\u2190 Worker API error', undefined, { endpoint, error: error.message });\n    return {\n      content: [{\n        type: 'text' as const,\n        text: `Error calling Worker API: ${error.message}`\n      }],\n      isError: true\n    };\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_callWorkerAPIWithPath_156": {
      "name": "callWorkerAPIWithPath",
      "type": "function",
      "start_line": 156,
      "end_line": 192,
      "content_hash": "c9ced471964a26c7eb13ba8af63bc1ce6f4c4d37",
      "content": "async function callWorkerAPIWithPath(\n  endpoint: string,\n  id: number\n): Promise<{ content: Array<{ type: 'text'; text: string }>; isError?: boolean }> {\n  logger.debug('HTTP', 'Worker API request (path)', undefined, { endpoint, id });\n\n  try {\n    const url = `${WORKER_BASE_URL}${endpoint}/${id}`;\n    const response = await fetch(url);\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Worker API error (${response.status}): ${errorText}`);\n    }\n\n    const data = await response.json();\n\n    logger.debug('HTTP', 'Worker API success (path)', undefined, { endpoint, id });\n\n    // Wrap raw data in MCP format\n    return {\n      content: [{\n        type: 'text' as const,\n        text: JSON.stringify(data, null, 2)\n      }]\n    };\n  } catch (error: any) {\n    logger.error('HTTP', 'Worker API error (path)', undefined, { endpoint, id, error: error.message });\n    return {\n      content: [{\n        type: 'text' as const,\n        text: `Error calling Worker API: ${error.message}`\n      }],\n      isError: true\n    };\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_callWorkerAPIPost_197": {
      "name": "callWorkerAPIPost",
      "type": "function",
      "start_line": 197,
      "end_line": 239,
      "content_hash": "4ce32161627438cf971b3acc71b27f3d5d84b4d9",
      "content": "async function callWorkerAPIPost(\n  endpoint: string,\n  body: Record<string, any>\n): Promise<{ content: Array<{ type: 'text'; text: string }>; isError?: boolean }> {\n  logger.debug('HTTP', 'Worker API request (POST)', undefined, { endpoint });\n\n  try {\n    const url = `${WORKER_BASE_URL}${endpoint}`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(body)\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Worker API error (${response.status}): ${errorText}`);\n    }\n\n    const data = await response.json();\n\n    logger.debug('HTTP', 'Worker API success (POST)', undefined, { endpoint });\n\n    // Wrap raw data in MCP format\n    return {\n      content: [{\n        type: 'text' as const,\n        text: JSON.stringify(data, null, 2)\n      }]\n    };\n  } catch (error: any) {\n    logger.error('HTTP', 'Worker API error (POST)', undefined, { endpoint, error: error.message });\n    return {\n      content: [{\n        type: 'text' as const,\n        text: `Error calling Worker API: ${error.message}`\n      }],\n      isError: true\n    };\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_verifyWorkerConnection_244": {
      "name": "verifyWorkerConnection",
      "type": "function",
      "start_line": 244,
      "end_line": 251,
      "content_hash": "baa114a0385e1688b9d375599db70e29ffc5edfb",
      "content": "async function verifyWorkerConnection(): Promise<boolean> {\n  try {\n    const response = await fetch(`${WORKER_BASE_URL}/api/health`);\n    return response.ok;\n  } catch (error) {\n    return false;\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_cleanup_477": {
      "name": "cleanup",
      "type": "function",
      "start_line": 477,
      "end_line": 480,
      "content_hash": "d5f69ef00bc2d3d3dfb0a18e8b8042eaf18a5367",
      "content": "async function cleanup() {\n  logger.info('SYSTEM', 'MCP server shutting down');\n  process.exit(0);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_main_487": {
      "name": "main",
      "type": "function",
      "start_line": 487,
      "end_line": 504,
      "content_hash": "aa8ddaf95ea884e0e925015164d7712594bf2f14",
      "content": "async function main() {\n  // Start the MCP server\n  const transport = new StdioServerTransport();\n  await server.connect(transport);\n  logger.info('SYSTEM', 'Claude-mem search server started');\n\n  // Check Worker availability in background\n  setTimeout(async () => {\n    const workerAvailable = await verifyWorkerConnection();\n    if (!workerAvailable) {\n      logger.warn('SYSTEM', 'Worker not available', undefined, { workerUrl: WORKER_BASE_URL });\n      logger.warn('SYSTEM', 'Tools will fail until Worker is started');\n      logger.warn('SYSTEM', 'Start Worker with: claude-mem restart');\n    } else {\n      logger.info('SYSTEM', 'Worker available', undefined, { workerUrl: WORKER_BASE_URL });\n    }\n  }, 0);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}