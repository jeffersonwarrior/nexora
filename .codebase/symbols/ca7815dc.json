{
  "file_path": "/work/external-deps/claude-mem/src/hooks/save-hook.ts",
  "file_hash": "378e4883799ad524b934a769d0a2644c277287d4",
  "updated_at": "2025-12-26T17:34:21.004410",
  "symbols": {
    "function_saveHook_26": {
      "name": "saveHook",
      "type": "function",
      "start_line": 26,
      "end_line": 70,
      "content_hash": "57c62191041b3de1bd5fcce9e151e1d017aff341",
      "content": "async function saveHook(input?: PostToolUseInput): Promise<void> {\n  // Ensure worker is running before any other logic\n  await ensureWorkerRunning();\n\n  if (!input) {\n    throw new Error('saveHook requires input');\n  }\n\n  const { session_id, cwd, tool_name, tool_input, tool_response } = input;\n\n  const port = getWorkerPort();\n\n  const toolStr = logger.formatTool(tool_name, tool_input);\n\n  logger.dataIn('HOOK', `PostToolUse: ${toolStr}`, {\n    workerPort: port\n  });\n\n  // Validate required fields before sending to worker\n  if (!cwd) {\n    throw new Error(`Missing cwd in PostToolUse hook input for session ${session_id}, tool ${tool_name}`);\n  }\n\n  // Send to worker - worker handles privacy check and database operations\n  const response = await fetch(`http://127.0.0.1:${port}/api/sessions/observations`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      claudeSessionId: session_id,\n      tool_name,\n      tool_input,\n      tool_response,\n      cwd\n    }),\n    signal: AbortSignal.timeout(HOOK_TIMEOUTS.DEFAULT)\n  });\n\n  if (!response.ok) {\n    throw new Error(`Observation storage failed: ${response.status}`);\n  }\n\n  logger.debug('HOOK', 'Observation sent successfully', { toolName: tool_name });\n\n  console.log(STANDARD_HOOK_RESPONSE);\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}