{
  "file_path": "/work/internal/resources/monitor_test.go",
  "file_hash": "e0204dd3c0f349f0124b9d58259b8810a9c0faed",
  "updated_at": "2025-12-26T17:34:20.467701",
  "symbols": {
    "function_TestDefaultConfig_11": {
      "name": "TestDefaultConfig",
      "type": "function",
      "start_line": 11,
      "end_line": 23,
      "content_hash": "20a900d5e34c74efe9b2c5d803799aaa43b2bd4e",
      "content": "func TestDefaultConfig(t *testing.T) {\n\tt.Parallel()\n\n\tcfg := DefaultConfig()\n\n\trequire.Equal(t, 80.0, cfg.CPUThreshold)\n\trequire.Equal(t, 85.0, cfg.MemThreshold)\n\trequire.Equal(t, uint64(5*1024*1024*1024), cfg.DiskMinFree)\n\trequire.Equal(t, 5*time.Second, cfg.CheckInterval)\n\trequire.True(t, cfg.EnableAutoPause)\n\trequire.Equal(t, 3, cfg.MaxViolations)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestNewMonitor_24": {
      "name": "TestNewMonitor",
      "type": "function",
      "start_line": 24,
      "end_line": 52,
      "content_hash": "515356d5d917dd0000c23460f779090a1fa3c2be",
      "content": "func TestNewMonitor(t *testing.T) {\n\tt.Parallel()\n\n\tt.Run(\"with default config\", func(t *testing.T) {\n\t\tm := NewMonitor(DefaultConfig())\n\t\trequire.NotNil(t, m)\n\t\trequire.False(t, m.IsRunning())\n\t})\n\n\tt.Run(\"with custom config\", func(t *testing.T) {\n\t\tcfg := Config{\n\t\t\tCPUThreshold:  90.0,\n\t\t\tMemThreshold:  95.0,\n\t\t\tCheckInterval: 10 * time.Second,\n\t\t}\n\t\tm := NewMonitor(cfg)\n\t\trequire.Equal(t, 90.0, m.config.CPUThreshold)\n\t\trequire.Equal(t, 95.0, m.config.MemThreshold)\n\t})\n\n\tt.Run(\"applies defaults for zero values\", func(t *testing.T) {\n\t\tm := NewMonitor(Config{})\n\t\trequire.Equal(t, 80.0, m.config.CPUThreshold)\n\t\trequire.Equal(t, 85.0, m.config.MemThreshold)\n\t\trequire.Equal(t, uint64(5*1024*1024*1024), m.config.DiskMinFree)\n\t\trequire.Equal(t, 5*time.Second, m.config.CheckInterval)\n\t})\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMonitorStartStop_53": {
      "name": "TestMonitorStartStop",
      "type": "function",
      "start_line": 53,
      "end_line": 77,
      "content_hash": "0fb65e39091b6abbad337545352134ad864075f6",
      "content": "func TestMonitorStartStop(t *testing.T) {\n\tt.Parallel()\n\n\tm := NewMonitor(DefaultConfig())\n\tctx := context.Background()\n\n\t// Start\n\terr := m.Start(ctx)\n\trequire.NoError(t, err)\n\trequire.True(t, m.IsRunning())\n\n\t// Start again (should be no-op)\n\terr = m.Start(ctx)\n\trequire.NoError(t, err)\n\trequire.True(t, m.IsRunning())\n\n\t// Stop\n\tm.Stop()\n\trequire.False(t, m.IsRunning())\n\n\t// Stop again (should be no-op)\n\tm.Stop()\n\trequire.False(t, m.IsRunning())\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMonitorCollectSnapshot_78": {
      "name": "TestMonitorCollectSnapshot",
      "type": "function",
      "start_line": 78,
      "end_line": 104,
      "content_hash": "8dd04d41a59097c1049a95d6e96e4e29785ffff3",
      "content": "func TestMonitorCollectSnapshot(t *testing.T) {\n\tt.Parallel()\n\n\tm := NewMonitor(DefaultConfig())\n\tsnapshot := m.collectSnapshot()\n\n\t// Should have collected something\n\trequire.NotZero(t, snapshot.Timestamp)\n\n\t// CPU should be 0-100\n\trequire.GreaterOrEqual(t, snapshot.CPUPercent, 0.0)\n\trequire.LessOrEqual(t, snapshot.CPUPercent, 100.0)\n\n\t// Memory should be reasonable\n\trequire.Greater(t, snapshot.MemTotal, uint64(0))\n\trequire.LessOrEqual(t, snapshot.MemUsed, snapshot.MemTotal)\n\trequire.GreaterOrEqual(t, snapshot.MemPercent, 0.0)\n\trequire.LessOrEqual(t, snapshot.MemPercent, 100.0)\n\n\t// Disk should be reasonable\n\trequire.Greater(t, snapshot.DiskTotal, uint64(0))\n\trequire.Greater(t, snapshot.DiskFree, uint64(0))\n\trequire.LessOrEqual(t, snapshot.DiskUsed, snapshot.DiskTotal)\n\n\tt.Logf(\"Snapshot: %s\", snapshot.Summary())\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMonitorCallbacks_105": {
      "name": "TestMonitorCallbacks",
      "type": "function",
      "start_line": 105,
      "end_line": 155,
      "content_hash": "649be90c9544f0724527387a863c49eada245f5d",
      "content": "func TestMonitorCallbacks(t *testing.T) {\n\tt.Parallel()\n\n\tcpuCalled := false\n\tmemCalled := false\n\tdiskCalled := false\n\tviolationCalled := false\n\n\tm := NewMonitor(Config{\n\t\tCPUThreshold:  0.1, // Very low to trigger\n\t\tMemThreshold:  0.1,\n\t\tDiskMinFree:   1024 * 1024 * 1024 * 1024 * 1024, // 1PB to trigger\n\t\tCheckInterval: 100 * time.Millisecond,\n\t})\n\n\tm.SetCallbacks(\n\t\tfunc(usage float64) {\n\t\t\tcpuCalled = true\n\t\t\tt.Logf(\"CPU callback: %.2f%%\", usage)\n\t\t},\n\t\tfunc(usage uint64) {\n\t\t\tmemCalled = true\n\t\t\tt.Logf(\"Memory callback: %d bytes\", usage)\n\t\t},\n\t\tfunc(free uint64) {\n\t\t\tdiskCalled = true\n\t\t\tt.Logf(\"Disk callback: %d bytes free\", free)\n\t\t},\n\t\tfunc(v Violation) {\n\t\t\tviolationCalled = true\n\t\t\tt.Logf(\"Violation: %s\", v.String())\n\t\t},\n\t)\n\n\tctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)\n\tdefer cancel()\n\n\terr := m.Start(ctx)\n\trequire.NoError(t, err)\n\n\t// Wait for checks\n\ttime.Sleep(300 * time.Millisecond)\n\n\tm.Stop()\n\n\t// At least one callback should have been triggered\n\t// (CPU and memory are very likely to exceed 0.1%, disk might not)\n\trequire.True(t, cpuCalled || memCalled || diskCalled, \"at least one callback should be called\")\n\trequire.True(t, violationCalled, \"violation callback should be called\")\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMonitorViolations_156": {
      "name": "TestMonitorViolations",
      "type": "function",
      "start_line": 156,
      "end_line": 175,
      "content_hash": "b0625880883711b58f5ac15bdf189329b1e98df1",
      "content": "func TestMonitorViolations(t *testing.T) {\n\tt.Parallel()\n\n\tm := NewMonitor(DefaultConfig())\n\n\t// Manually trigger violations\n\tm.handleViolation(Violation{\n\t\tType:      ViolationTypeCPU,\n\t\tTimestamp: time.Now(),\n\t\tValue:     90.0,\n\t\tThreshold: 80.0,\n\t\tMessage:   \"CPU high\",\n\t})\n\n\tviolations := m.GetViolations(10)\n\trequire.Len(t, violations, 1)\n\trequire.Equal(t, ViolationTypeCPU, violations[0].Type)\n\trequire.Equal(t, 90.0, violations[0].Value)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestResourceSnapshotSummary_176": {
      "name": "TestResourceSnapshotSummary",
      "type": "function",
      "start_line": 176,
      "end_line": 198,
      "content_hash": "b7e5538364a5d97b9a981cf7dc18d017fbfb7f51",
      "content": "func TestResourceSnapshotSummary(t *testing.T) {\n\tt.Parallel()\n\n\tsnapshot := ResourceSnapshot{\n\t\tTimestamp:   time.Now(),\n\t\tCPUPercent:  45.5,\n\t\tMemUsed:     8 * 1024 * 1024 * 1024,  // 8GB\n\t\tMemTotal:    16 * 1024 * 1024 * 1024, // 16GB\n\t\tMemPercent:  50.0,\n\t\tDiskUsed:    100 * 1024 * 1024 * 1024, // 100GB\n\t\tDiskTotal:   500 * 1024 * 1024 * 1024, // 500GB\n\t\tDiskFree:    400 * 1024 * 1024 * 1024, // 400GB\n\t\tDiskPercent: 20.0,\n\t}\n\n\tsummary := snapshot.Summary()\n\trequire.Contains(t, summary, \"45.5%\")    // CPU\n\trequire.Contains(t, summary, \"50.0%\")    // Memory\n\trequire.Contains(t, summary, \"400.00GB\") // Disk free\n\n\tt.Logf(\"Summary: %s\", summary)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestViolationString_199": {
      "name": "TestViolationString",
      "type": "function",
      "start_line": 199,
      "end_line": 218,
      "content_hash": "dbcfb3c7981f644ed038ec9950e36e13d398d540",
      "content": "func TestViolationString(t *testing.T) {\n\tt.Parallel()\n\n\tv := Violation{\n\t\tType:      ViolationTypeCPU,\n\t\tTimestamp: time.Now(),\n\t\tValue:     95.5,\n\t\tThreshold: 80.0,\n\t\tMessage:   \"CPU usage too high\",\n\t}\n\n\tstr := v.String()\n\trequire.Contains(t, str, \"cpu\")\n\trequire.Contains(t, str, \"95.50\")\n\trequire.Contains(t, str, \"80.00\")\n\trequire.Contains(t, str, \"CPU usage too high\")\n\n\tt.Logf(\"Violation: %s\", str)\n}\n",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_TestMonitorIntegration_219": {
      "name": "TestMonitorIntegration",
      "type": "function",
      "start_line": 219,
      "end_line": 249,
      "content_hash": "7ed1a58e298f541b2cfa48743dfe9eb0ef5a24a1",
      "content": "func TestMonitorIntegration(t *testing.T) {\n\tt.Parallel()\n\n\t// Create monitor with reasonable thresholds\n\tm := NewMonitor(Config{\n\t\tCPUThreshold:    80.0,\n\t\tMemThreshold:    85.0,\n\t\tDiskMinFree:     5 * 1024 * 1024 * 1024,\n\t\tCheckInterval:   100 * time.Millisecond,\n\t\tEnableAutoPause: false, // Disable auto-pause for test\n\t\tMaxViolations:   3,\n\t})\n\n\tctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)\n\tdefer cancel()\n\n\terr := m.Start(ctx)\n\trequire.NoError(t, err)\n\n\t// Wait for several checks\n\ttime.Sleep(300 * time.Millisecond)\n\n\t// Get current snapshot\n\tsnapshot := m.CurrentSnapshot()\n\trequire.NotZero(t, snapshot.Timestamp)\n\trequire.GreaterOrEqual(t, snapshot.CPUPercent, 0.0)\n\n\tt.Logf(\"Final snapshot: %s\", snapshot.Summary())\n\n\tm.Stop()\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}