{
  "file_path": "/work/external-deps/claude-mem/scripts/test-transcript-parser.ts",
  "file_hash": "959dcec5bcb4f7789974309a3577df814f44c267",
  "updated_at": "2025-12-26T17:34:24.281227",
  "symbols": {
    "function_formatTokens_13": {
      "name": "formatTokens",
      "type": "function",
      "start_line": 13,
      "end_line": 15,
      "content_hash": "21192250268d53abc5bfa90c99c980a621482cc5",
      "content": "function formatTokens(num: number): string {\n  return num.toLocaleString();\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_formatPercentage_17": {
      "name": "formatPercentage",
      "type": "function",
      "start_line": 17,
      "end_line": 19,
      "content_hash": "3147f9337e0a8f464a707dc9d76c6a2e44063c20",
      "content": "function formatPercentage(num: number): string {\n  return `${(num * 100).toFixed(2)}%`;\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_main_21": {
      "name": "main",
      "type": "function",
      "start_line": 21,
      "end_line": 165,
      "content_hash": "e64a17ddb745a4e8b325af8e9ce8b49c5a9b53ec",
      "content": "function main() {\n  const args = process.argv.slice(2);\n\n  if (args.length === 0) {\n    console.error('Usage: npx tsx scripts/test-transcript-parser.ts <path-to-transcript.jsonl>');\n    console.error('\\nExample: npx tsx scripts/test-transcript-parser.ts ~/.cache/claude-code/transcripts/latest.jsonl');\n    process.exit(1);\n  }\n\n  const transcriptPath = resolve(args[0]);\n\n  if (!existsSync(transcriptPath)) {\n    console.error(`Error: Transcript file not found: ${transcriptPath}`);\n    process.exit(1);\n  }\n\n  console.log(`\\n\ud83d\udd0d Parsing transcript: ${transcriptPath}\\n`);\n\n  try {\n    const parser = new TranscriptParser(transcriptPath);\n\n    // Get parse statistics\n    const stats = parser.getParseStats();\n\n    console.log('\ud83d\udcca Parse Statistics:');\n    console.log('\u2500'.repeat(60));\n    console.log(`Total lines:      ${stats.totalLines}`);\n    console.log(`Parsed entries:   ${stats.parsedEntries}`);\n    console.log(`Failed lines:     ${stats.failedLines}`);\n    console.log(`Failure rate:     ${formatPercentage(stats.failureRate)}`);\n    console.log();\n\n    console.log('\ud83d\udccb Entries by Type:');\n    console.log('\u2500'.repeat(60));\n    for (const [type, count] of Object.entries(stats.entriesByType)) {\n      console.log(`  ${type.padEnd(20)} ${count}`);\n    }\n    console.log();\n\n    // Show parse errors if any\n    if (stats.failedLines > 0) {\n      console.log('\u274c Parse Errors:');\n      console.log('\u2500'.repeat(60));\n      const errors = parser.getParseErrors();\n      errors.slice(0, 5).forEach(err => {\n        console.log(`  Line ${err.lineNumber}: ${err.error}`);\n      });\n      if (errors.length > 5) {\n        console.log(`  ... and ${errors.length - 5} more errors`);\n      }\n      console.log();\n    }\n\n    // Test data extraction methods\n    console.log('\ud83d\udcac Message Extraction:');\n    console.log('\u2500'.repeat(60));\n\n    const lastUserMessage = parser.getLastUserMessage();\n    console.log(`Last user message: ${lastUserMessage ? `\"${lastUserMessage.substring(0, 100)}...\"` : '(none)'}`);\n    console.log();\n\n    const lastAssistantMessage = parser.getLastAssistantMessage();\n    console.log(`Last assistant message: ${lastAssistantMessage ? `\"${lastAssistantMessage.substring(0, 100)}...\"` : '(none)'}`);\n    console.log();\n\n    // Token usage\n    const tokenUsage = parser.getTotalTokenUsage();\n    console.log('\ud83d\udcb0 Token Usage:');\n    console.log('\u2500'.repeat(60));\n    console.log(`Input tokens:          ${formatTokens(tokenUsage.inputTokens)}`);\n    console.log(`Output tokens:         ${formatTokens(tokenUsage.outputTokens)}`);\n    console.log(`Cache creation tokens: ${formatTokens(tokenUsage.cacheCreationTokens)}`);\n    console.log(`Cache read tokens:     ${formatTokens(tokenUsage.cacheReadTokens)}`);\n    console.log(`Total tokens:          ${formatTokens(tokenUsage.inputTokens + tokenUsage.outputTokens)}`);\n    console.log();\n\n    // Tool use history\n    const toolUses = parser.getToolUseHistory();\n    console.log('\ud83d\udd27 Tool Use History:');\n    console.log('\u2500'.repeat(60));\n    if (toolUses.length > 0) {\n      console.log(`Total tool uses: ${toolUses.length}\\n`);\n\n      // Group by tool name\n      const toolCounts = toolUses.reduce((acc, tool) => {\n        acc[tool.name] = (acc[tool.name] || 0) + 1;\n        return acc;\n      }, {} as Record<string, number>);\n\n      console.log('Tools used:');\n      for (const [name, count] of Object.entries(toolCounts).sort((a, b) => b[1] - a[1])) {\n        console.log(`  ${name.padEnd(30)} ${count}x`);\n      }\n    } else {\n      console.log('(no tool uses found)');\n    }\n    console.log();\n\n    // System entries\n    const systemEntries = parser.getSystemEntries();\n    if (systemEntries.length > 0) {\n      console.log('\u26a0\ufe0f  System Entries:');\n      console.log('\u2500'.repeat(60));\n      console.log(`Found ${systemEntries.length} system entries`);\n      systemEntries.slice(0, 3).forEach(entry => {\n        console.log(`  [${entry.level || 'info'}] ${entry.content.substring(0, 80)}...`);\n      });\n      if (systemEntries.length > 3) {\n        console.log(`  ... and ${systemEntries.length - 3} more`);\n      }\n      console.log();\n    }\n\n    // Summary entries\n    const summaryEntries = parser.getSummaryEntries();\n    if (summaryEntries.length > 0) {\n      console.log('\ud83d\udcdd Summary Entries:');\n      console.log('\u2500'.repeat(60));\n      console.log(`Found ${summaryEntries.length} summary entries`);\n      summaryEntries.forEach((entry, i) => {\n        console.log(`\\nSummary ${i + 1}:`);\n        console.log(entry.summary.substring(0, 200) + '...');\n      });\n      console.log();\n    }\n\n    // Queue operations\n    const queueOps = parser.getQueueOperationEntries();\n    if (queueOps.length > 0) {\n      console.log('\ud83d\udd04 Queue Operations:');\n      console.log('\u2500'.repeat(60));\n      const enqueues = queueOps.filter(op => op.operation === 'enqueue').length;\n      const dequeues = queueOps.filter(op => op.operation === 'dequeue').length;\n      console.log(`Enqueue operations: ${enqueues}`);\n      console.log(`Dequeue operations: ${dequeues}`);\n      console.log();\n    }\n\n    console.log('\u2705 Validation complete!\\n');\n\n  } catch (error) {\n    console.error('\u274c Error parsing transcript:', error);\n    process.exit(1);\n  }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}