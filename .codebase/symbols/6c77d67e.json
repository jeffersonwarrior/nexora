{
  "file_path": "/work/external-deps/helix-db/helix-db/src/helix_gateway/tests/embedding_providers.rs",
  "file_hash": "33ba4c4264534d8c738de7a45667c7362b44c907",
  "updated_at": "2025-12-26T17:34:20.950739",
  "symbols": {
    "function_test_openai_embedding_success_8": {
      "name": "test_openai_embedding_success",
      "type": "function",
      "start_line": 8,
      "end_line": 17,
      "content_hash": "685b20bdef991415e30cec70ad8add68a868c439",
      "content": "fn test_openai_embedding_success() {\n    let model = get_embedding_model(None, Some(\"text-embedding-ada-002\"), None).unwrap();\n    let result = model.fetch_embedding(\"test text\");\n    assert!(result.is_ok());\n    let embedding = result.unwrap();\n    println!(\"embedding: {embedding:?}\");\n}\n\n#[test]\n#[ignore] // Requires API key and network",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_azure_openai_embedding_success_18": {
      "name": "test_azure_openai_embedding_success",
      "type": "function",
      "start_line": 18,
      "end_line": 28,
      "content_hash": "f58a1cb90e0cd45def49d074e1f1eb0347f0f069",
      "content": "fn test_azure_openai_embedding_success() {\n    // Requires AZURE_OPENAI_API_KEY and AZURE_OPENAI_RESOURCE_NAME env vars\n    let model = get_embedding_model(None, Some(\"azure_openai:text-embedding-3-small\"), None).unwrap();\n    let result = model.fetch_embedding(\"test text\");\n    assert!(result.is_ok());\n    let embedding = result.unwrap();\n    println!(\"embedding: {embedding:?}\");\n}\n\n#[test]\n#[ignore] // Requires API key and network",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_gemini_embedding_success_29": {
      "name": "test_gemini_embedding_success",
      "type": "function",
      "start_line": 29,
      "end_line": 38,
      "content_hash": "b96c39875d6d5b49edf6ccd9310d0a215d023b7a",
      "content": "fn test_gemini_embedding_success() {\n    let model = get_embedding_model(None, Some(\"gemini-embedding-001\"), None).unwrap();\n    let result = model.fetch_embedding(\"test text\");\n    assert!(result.is_ok());\n    let embedding = result.unwrap();\n    println!(\"embedding: {embedding:?}\");\n}\n\n#[test]\n#[ignore] // Requires API key and network",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_gemini_embedding_with_task_type_39": {
      "name": "test_gemini_embedding_with_task_type",
      "type": "function",
      "start_line": 39,
      "end_line": 53,
      "content_hash": "5b44ff04263e763eccbff103bb0d6b5921a732f8",
      "content": "fn test_gemini_embedding_with_task_type() {\n    let model = get_embedding_model(\n        None,\n        Some(\"gemini:gemini-embedding-001:SEMANTIC_SIMILARITY\"),\n        None,\n    )\n    .unwrap();\n    let result = model.fetch_embedding(\"test text\");\n    assert!(result.is_ok());\n    let embedding = result.unwrap();\n    println!(\"embedding: {embedding:?}\");\n}\n\n#[test]\n#[ignore] // Requires local embedding server",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_local_embedding_success_54": {
      "name": "test_local_embedding_success",
      "type": "function",
      "start_line": 54,
      "end_line": 63,
      "content_hash": "d69c824c441235d7f22abf3257dfb473b88bb9c9",
      "content": "fn test_local_embedding_success() {\n    let model =\n        get_embedding_model(None, Some(\"local\"), Some(\"http://localhost:8699/embed\")).unwrap();\n    let result = model.fetch_embedding(\"test text\");\n    assert!(result.is_ok());\n    let embedding = result.unwrap();\n    println!(\"embedding: {:?}\", embedding);\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_local_embedding_invalid_url_64": {
      "name": "test_local_embedding_invalid_url",
      "type": "function",
      "start_line": 64,
      "end_line": 70,
      "content_hash": "082ac4e3283ebdd9990c641545672e3e57e083c6",
      "content": "fn test_local_embedding_invalid_url() {\n    let model = get_embedding_model(None, Some(\"local\"), Some(\"invalid_url\"));\n    assert!(model.is_err());\n}\n\n// Unit tests for parse_provider_and_model\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_openai_provider_with_model_71": {
      "name": "test_parse_openai_provider_with_model",
      "type": "function",
      "start_line": 71,
      "end_line": 80,
      "content_hash": "50c491c273c824129dfd364656a8870502b233a9",
      "content": "fn test_parse_openai_provider_with_model() {\n    let result =\n        EmbeddingModelImpl::parse_provider_and_model(Some(\"openai:text-embedding-3-small\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    assert!(matches!(provider, EmbeddingProvider::OpenAI));\n    assert_eq!(model, \"text-embedding-3-small\");\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_openai_provider_empty_model_81": {
      "name": "test_parse_openai_provider_empty_model",
      "type": "function",
      "start_line": 81,
      "end_line": 89,
      "content_hash": "4ca7212bc7866d0a456298df7d502774c678012a",
      "content": "fn test_parse_openai_provider_empty_model() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"openai:\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    assert!(matches!(provider, EmbeddingProvider::OpenAI));\n    assert_eq!(model, \"\"); // Returns empty string when no model specified after colon\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_azure_openai_provider_with_deployment_90": {
      "name": "test_parse_azure_openai_provider_with_deployment",
      "type": "function",
      "start_line": 90,
      "end_line": 107,
      "content_hash": "935ce26add444c980508e3fc5bd97c45196dcbc7",
      "content": "fn test_parse_azure_openai_provider_with_deployment() {\n    unsafe {\n        std::env::set_var(\"AZURE_OPENAI_RESOURCE_NAME\", \"test-resource\");\n    }\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"azure_openai:text-embedding-3-small\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    match provider {\n        EmbeddingProvider::AzureOpenAI { resource_name, deployment_id } => {\n            assert_eq!(resource_name, \"test-resource\");\n            assert_eq!(deployment_id, \"text-embedding-3-small\");\n        }\n        _ => panic!(\"Expected AzureOpenAI provider\"),\n    }\n    assert_eq!(model, \"text-embedding-3-small\");\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_azure_openai_provider_empty_deployment_108": {
      "name": "test_parse_azure_openai_provider_empty_deployment",
      "type": "function",
      "start_line": 108,
      "end_line": 117,
      "content_hash": "c5806a9cef20643ceafe844d69f7907d282d5c53",
      "content": "fn test_parse_azure_openai_provider_empty_deployment() {\n    unsafe {\n        std::env::set_var(\"AZURE_OPENAI_RESOURCE_NAME\", \"test-resource\");\n    }\n    // Should fail because deployment ID is required\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"azure_openai:\"));\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_gemini_provider_with_model_118": {
      "name": "test_parse_gemini_provider_with_model",
      "type": "function",
      "start_line": 118,
      "end_line": 131,
      "content_hash": "dcff9ee69b7a52d30c3e02916bebde2e4646f7a8",
      "content": "fn test_parse_gemini_provider_with_model() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"gemini:gemini-embedding-002\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    match provider {\n        EmbeddingProvider::Gemini { task_type } => {\n            assert_eq!(task_type, \"RETRIEVAL_DOCUMENT\");\n        }\n        _ => panic!(\"Expected Gemini provider\"),\n    }\n    assert_eq!(model, \"gemini-embedding-002\");\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_gemini_provider_with_task_type_132": {
      "name": "test_parse_gemini_provider_with_task_type",
      "type": "function",
      "start_line": 132,
      "end_line": 147,
      "content_hash": "c2c7024a99d30b89b358c265592dbdab34d6a665",
      "content": "fn test_parse_gemini_provider_with_task_type() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\n        \"gemini:gemini-embedding-001:SEMANTIC_SIMILARITY\",\n    ));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    match provider {\n        EmbeddingProvider::Gemini { task_type } => {\n            assert_eq!(task_type, \"SEMANTIC_SIMILARITY\");\n        }\n        _ => panic!(\"Expected Gemini provider\"),\n    }\n    assert_eq!(model, \"gemini-embedding-001\");\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_gemini_provider_empty_model_148": {
      "name": "test_parse_gemini_provider_empty_model",
      "type": "function",
      "start_line": 148,
      "end_line": 161,
      "content_hash": "44c463fc5ae03dc49e4956a07443df7914c33b57",
      "content": "fn test_parse_gemini_provider_empty_model() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"gemini:\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    match provider {\n        EmbeddingProvider::Gemini { task_type } => {\n            assert_eq!(task_type, \"RETRIEVAL_DOCUMENT\");\n        }\n        _ => panic!(\"Expected Gemini provider\"),\n    }\n    assert_eq!(model, \"\"); // Returns empty string when no model specified after colon\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_local_provider_162": {
      "name": "test_parse_local_provider",
      "type": "function",
      "start_line": 162,
      "end_line": 170,
      "content_hash": "486f44c3167cfa58be14104ebd5f7af3d9b2d380",
      "content": "fn test_parse_local_provider() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"local\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    assert!(matches!(provider, EmbeddingProvider::Local));\n    assert_eq!(model, \"local\");\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_unknown_provider_defaults_to_openai_171": {
      "name": "test_parse_unknown_provider_defaults_to_openai",
      "type": "function",
      "start_line": 171,
      "end_line": 179,
      "content_hash": "c0dcef1a86e933cb24d273b646fc223fb8b944cd",
      "content": "fn test_parse_unknown_provider_defaults_to_openai() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(Some(\"unknown-provider\"));\n    assert!(result.is_ok());\n    let (provider, model) = result.unwrap();\n    assert!(matches!(provider, EmbeddingProvider::OpenAI));\n    assert_eq!(model, \"text-embedding-ada-002\");\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_parse_no_provider_returns_error_180": {
      "name": "test_parse_no_provider_returns_error",
      "type": "function",
      "start_line": 180,
      "end_line": 185,
      "content_hash": "3804f79c200cdc97d80d8ec789b8fec031de5cbd",
      "content": "fn test_parse_no_provider_returns_error() {\n    let result = EmbeddingModelImpl::parse_provider_and_model(None);\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_openai_without_api_key_fails_186": {
      "name": "test_new_openai_without_api_key_fails",
      "type": "function",
      "start_line": 186,
      "end_line": 194,
      "content_hash": "550756b047b13b25fccebd738cbbd256cfed14d9",
      "content": "fn test_new_openai_without_api_key_fails() {\n    unsafe {\n        std::env::remove_var(\"OPENAI_API_KEY\");\n    }\n    let result = EmbeddingModelImpl::new(None, Some(\"openai:text-embedding-ada-002\"), None);\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_gemini_without_api_key_fails_195": {
      "name": "test_new_gemini_without_api_key_fails",
      "type": "function",
      "start_line": 195,
      "end_line": 203,
      "content_hash": "9221a32a00fab50b99e8e9fe255ca116d671c937",
      "content": "fn test_new_gemini_without_api_key_fails() {\n    unsafe {\n        std::env::remove_var(\"GEMINI_API_KEY\");\n    }\n    let result = EmbeddingModelImpl::new(None, Some(\"gemini:gemini-embedding-001\"), None);\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_azure_openai_without_api_key_fails_204": {
      "name": "test_new_azure_openai_without_api_key_fails",
      "type": "function",
      "start_line": 204,
      "end_line": 213,
      "content_hash": "8fec3e8127da01fbafae0e7a64993c8541fe8d99",
      "content": "fn test_new_azure_openai_without_api_key_fails() {\n    unsafe {\n        std::env::remove_var(\"AZURE_OPENAI_API_KEY\");\n        std::env::set_var(\"AZURE_OPENAI_RESOURCE_NAME\", \"test-resource\");\n    }\n    let result = EmbeddingModelImpl::new(None, Some(\"azure_openai:text-embedding-3-small\"), None);\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_azure_openai_without_resource_name_fails_214": {
      "name": "test_new_azure_openai_without_resource_name_fails",
      "type": "function",
      "start_line": 214,
      "end_line": 223,
      "content_hash": "851e36777e4f083a4805429b6509f5634ec3a9fb",
      "content": "fn test_new_azure_openai_without_resource_name_fails() {\n    unsafe {\n        std::env::set_var(\"AZURE_OPENAI_API_KEY\", \"test-key\");\n        std::env::remove_var(\"AZURE_OPENAI_RESOURCE_NAME\");\n    }\n    let result = EmbeddingModelImpl::new(None, Some(\"azure_openai:text-embedding-3-small\"), None);\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_azure_openai_without_deployment_fails_224": {
      "name": "test_new_azure_openai_without_deployment_fails",
      "type": "function",
      "start_line": 224,
      "end_line": 233,
      "content_hash": "5c1a0ff16c9b205a103e3500256e4ae50085c495",
      "content": "fn test_new_azure_openai_without_deployment_fails() {\n    unsafe {\n        std::env::set_var(\"AZURE_OPENAI_API_KEY\", \"test-key\");\n        std::env::set_var(\"AZURE_OPENAI_RESOURCE_NAME\", \"test-resource\");\n    }\n    let result = EmbeddingModelImpl::new(None, Some(\"azure_openai:\"), None);\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_local_with_valid_url_234": {
      "name": "test_new_local_with_valid_url",
      "type": "function",
      "start_line": 234,
      "end_line": 241,
      "content_hash": "bc01ed75ca29d2fc3a93703a5e91c05d9f8dff4d",
      "content": "fn test_new_local_with_valid_url() {\n    let result = EmbeddingModelImpl::new(None, Some(\"local\"), Some(\"http://localhost:8699/embed\"));\n    assert!(result.is_ok());\n    let model = result.unwrap();\n    assert_eq!(model.url, Some(\"http://localhost:8699/embed\".to_string()));\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_local_with_invalid_url_242": {
      "name": "test_new_local_with_invalid_url",
      "type": "function",
      "start_line": 242,
      "end_line": 247,
      "content_hash": "b842b0b59378868829e3b0d656f1be34b6792d93",
      "content": "fn test_new_local_with_invalid_url() {\n    let result = EmbeddingModelImpl::new(None, Some(\"local\"), Some(\"not-a-valid-url\"));\n    assert!(result.is_err());\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_new_local_default_url_248": {
      "name": "test_new_local_default_url",
      "type": "function",
      "start_line": 248,
      "end_line": 255,
      "content_hash": "e4a584e310db40ffbbf815719a69ac9daf249e1b",
      "content": "fn test_new_local_default_url() {\n    let result = EmbeddingModelImpl::new(None, Some(\"local\"), None);\n    assert!(result.is_ok());\n    let model = result.unwrap();\n    assert_eq!(model.url, Some(\"http://localhost:8699/embed\".to_string()));\n}\n\n#[test]",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_test_get_embedding_model_wrapper_256": {
      "name": "test_get_embedding_model_wrapper",
      "type": "function",
      "start_line": 256,
      "end_line": 259,
      "content_hash": "4fa30bca20641bae0630639a5400cb4161b93893",
      "content": "fn test_get_embedding_model_wrapper() {\n    let result = get_embedding_model(None, Some(\"local\"), Some(\"http://localhost:8080\"));\n    assert!(result.is_ok());\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}