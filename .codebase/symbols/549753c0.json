{
  "file_path": "/work/internal/agent/tools/web_fetch.go",
  "file_hash": "31a8b844729cce4da163f2ff5c5b0231f9aa9e09",
  "updated_at": "2025-12-26T17:34:20.100782",
  "symbols": {
    "function_NewWebFetchTool_19": {
      "name": "NewWebFetchTool",
      "type": "function",
      "start_line": 19,
      "end_line": 72,
      "content_hash": "9b0de2d2a88f50f8daeaf1eba0ad53f0c4d2fb20",
      "content": "func NewWebFetchTool(workingDir string, client *http.Client) fantasy.AgentTool {\n\tif client == nil {\n\t\tclient = &http.Client{\n\t\t\tTimeout: 30 * time.Second,\n\t\t\tTransport: &http.Transport{\n\t\t\t\tMaxIdleConns:        100,\n\t\t\t\tMaxIdleConnsPerHost: 10,\n\t\t\t\tIdleConnTimeout:     90 * time.Second,\n\t\t\t},\n\t\t}\n\t}\n\n\treturn fantasy.NewParallelAgentTool(\n\t\tWebFetchToolName,\n\t\tstring(webFetchToolDescription),\n\t\tfunc(ctx context.Context, params WebFetchParams, call fantasy.ToolCall) (fantasy.ToolResponse, error) {\n\t\t\tif params.URL == \"\" {\n\t\t\t\treturn fantasy.NewTextErrorResponse(\"url is required\"), nil\n\t\t\t}\n\n\t\t\tcontent, err := FetchURLAndConvert(ctx, client, params.URL)\n\t\t\tif err != nil {\n\t\t\t\treturn fantasy.NewTextErrorResponse(fmt.Sprintf(\"Failed to fetch URL: %s\", err)), nil\n\t\t\t}\n\n\t\t\thasLargeContent := len(content) > LargeContentThreshold\n\t\t\tvar result strings.Builder\n\n\t\t\tif hasLargeContent {\n\t\t\t\ttempFile, err := os.CreateTemp(workingDir, \"page-*.md\")\n\t\t\t\tif err != nil {\n\t\t\t\t\treturn fantasy.NewTextErrorResponse(fmt.Sprintf(\"Failed to create temporary file: %s\", err)), nil\n\t\t\t\t}\n\t\t\t\ttempFilePath := tempFile.Name()\n\n\t\t\t\tif _, err := tempFile.WriteString(content); err != nil {\n\t\t\t\t\t_ = tempFile.Close() // Best effort close\n\t\t\t\t\treturn fantasy.NewTextErrorResponse(fmt.Sprintf(\"Failed to write content to file: %s\", err)), nil\n\t\t\t\t}\n\t\t\t\tif err := tempFile.Close(); err != nil {\n\t\t\t\t\treturn fantasy.NewTextErrorResponse(fmt.Sprintf(\"Failed to close temporary file: %s\", err)), nil\n\t\t\t\t}\n\n\t\t\t\tresult.WriteString(fmt.Sprintf(\"Fetched content from %s (large page)\\n\\n\", params.URL))\n\t\t\t\tresult.WriteString(fmt.Sprintf(\"Content saved to: %s\\n\\n\", tempFilePath))\n\t\t\t\tresult.WriteString(\"Use the view and grep tools to analyze this file.\")\n\t\t\t} else {\n\t\t\t\tresult.WriteString(fmt.Sprintf(\"Fetched content from %s:\\n\\n\", params.URL))\n\t\t\t\tresult.WriteString(content)\n\t\t\t}\n\n\t\t\treturn fantasy.NewTextResponse(result.String()), nil\n\t\t})\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}