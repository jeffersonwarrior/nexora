{
  "file_path": "/work/external-deps/claude-swarm/dist/utils/plan-evaluator.js",
  "file_hash": "9b183ae17218ec20edcc5e41ba1e0e661d5322bd",
  "updated_at": "2025-12-26T17:34:20.389841",
  "symbols": {
    "function_evaluatePlan_20": {
      "name": "evaluatePlan",
      "type": "function",
      "start_line": 20,
      "end_line": 178,
      "content_hash": "b3256189e9dcc59844a7132a47c43b1b5e740abe",
      "content": "function evaluatePlan(plan, feature, projectDir, planId) {\n    const concerns = [];\n    const strengths = [];\n    // 1. Completeness Score (0-25)\n    let completeness = 15; // Base score\n    // Check if plan has meaningful steps\n    if (plan.steps.length === 0) {\n        completeness -= 10;\n        concerns.push(\"No implementation steps defined\");\n    }\n    else if (plan.steps.length >= 3) {\n        completeness += 5;\n        strengths.push(\"Well-structured multi-step approach\");\n    }\n    // Check if summary addresses the feature\n    const featureKeywords = feature.description\n        .toLowerCase()\n        .split(/\\s+/)\n        .filter((w) => w.length > 4);\n    const summaryLower = plan.summary.toLowerCase();\n    const keywordMatches = featureKeywords.filter((kw) => summaryLower.includes(kw));\n    if (keywordMatches.length >= 2) {\n        completeness += 3;\n        strengths.push(\"Summary directly addresses feature requirements\");\n    }\n    // Check for test strategy\n    if (plan.testStrategy && plan.testStrategy.length > 20) {\n        completeness += 2;\n        strengths.push(\"Includes test strategy\");\n    }\n    else {\n        concerns.push(\"Missing or inadequate test strategy\");\n    }\n    completeness = Math.max(0, Math.min(25, completeness));\n    // 2. Feasibility Score (0-25)\n    let feasibility = 15; // Base score\n    // Check if mentioned files exist (sample check)\n    const allFiles = [...plan.filesToCreate, ...plan.filesToModify];\n    const filesWithExtensions = allFiles.filter((f) => /\\.(ts|js|tsx|jsx|json|md|py|rs|go|css|scss|html)$/i.test(f));\n    if (filesWithExtensions.length > 0) {\n        // Check a sample of files to modify - they should exist\n        const filesToCheck = plan.filesToModify.slice(0, 3);\n        let existingCount = 0;\n        for (const file of filesToCheck) {\n            const fullPath = path.join(projectDir, file);\n            if (fs.existsSync(fullPath)) {\n                existingCount++;\n            }\n        }\n        if (filesToCheck.length > 0 && existingCount === filesToCheck.length) {\n            feasibility += 5;\n            strengths.push(\"Files to modify exist and are valid\");\n        }\n        else if (filesToCheck.length > 0 && existingCount === 0) {\n            feasibility -= 5;\n            concerns.push(\"Some files to modify may not exist\");\n        }\n    }\n    // Check for reasonable step count (not too few, not too many)\n    if (plan.steps.length >= 2 && plan.steps.length <= 10) {\n        feasibility += 3;\n    }\n    else if (plan.steps.length > 15) {\n        feasibility -= 3;\n        concerns.push(\"Plan may be overly complex with too many steps\");\n    }\n    // Penalize if no files are specified\n    if (allFiles.length === 0) {\n        feasibility -= 8;\n        concerns.push(\"No files specified for creation or modification\");\n    }\n    else {\n        feasibility += 2;\n    }\n    feasibility = Math.max(0, Math.min(25, feasibility));\n    // 3. Risk Awareness Score (0-20)\n    let riskAwareness = 10; // Base score\n    if (plan.risks && plan.risks.length > 0) {\n        riskAwareness += Math.min(8, plan.risks.length * 2);\n        strengths.push(`Identifies ${plan.risks.length} potential risks`);\n        // Check if risks mention mitigation\n        const mitigationKeywords = [\n            \"mitigat\",\n            \"prevent\",\n            \"avoid\",\n            \"handle\",\n            \"fallback\",\n            \"rollback\",\n        ];\n        const hasMitigation = plan.risks.some((risk) => mitigationKeywords.some((kw) => risk.toLowerCase().includes(kw)));\n        if (hasMitigation) {\n            riskAwareness += 2;\n            strengths.push(\"Includes risk mitigation strategies\");\n        }\n    }\n    else {\n        riskAwareness -= 5;\n        concerns.push(\"No risks identified - may indicate lack of thoroughness\");\n    }\n    riskAwareness = Math.max(0, Math.min(20, riskAwareness));\n    // 4. Clarity Score (0-15)\n    let clarity = 8; // Base score\n    // Check if steps have descriptions\n    const stepsWithDescriptions = plan.steps.filter((s) => s.description && s.description.length > 10);\n    if (stepsWithDescriptions.length === plan.steps.length && plan.steps.length > 0) {\n        clarity += 4;\n        strengths.push(\"All steps have clear descriptions\");\n    }\n    // Check if steps have validation criteria\n    const stepsWithValidation = plan.steps.filter((s) => s.validation && s.validation.length > 0);\n    if (stepsWithValidation.length >= plan.steps.length / 2) {\n        clarity += 3;\n        strengths.push(\"Steps include validation criteria\");\n    }\n    // Check summary length (not too short, not too long)\n    if (plan.summary.length >= 50 && plan.summary.length <= 500) {\n        clarity += 2;\n    }\n    else if (plan.summary.length < 20) {\n        clarity -= 3;\n        concerns.push(\"Summary is too brief\");\n    }\n    clarity = Math.max(0, Math.min(15, clarity));\n    // 5. Efficiency Score (0-15)\n    let efficiency = 10; // Base score\n    // Fewer steps (when appropriate) indicates efficiency\n    if (plan.steps.length >= 2 && plan.steps.length <= 5) {\n        efficiency += 3;\n        strengths.push(\"Efficient step count\");\n    }\n    else if (plan.steps.length > 10) {\n        efficiency -= 2;\n    }\n    // Fewer files to modify (when appropriate) indicates focused changes\n    const totalFiles = plan.filesToCreate.length + plan.filesToModify.length;\n    if (totalFiles >= 1 && totalFiles <= 5) {\n        efficiency += 2;\n        strengths.push(\"Focused file modifications\");\n    }\n    else if (totalFiles > 10) {\n        efficiency -= 2;\n        concerns.push(\"Large number of files may indicate scope creep\");\n    }\n    efficiency = Math.max(0, Math.min(15, efficiency));\n    const total = completeness + feasibility + riskAwareness + clarity + efficiency;\n    return {\n        planId,\n        scores: {\n            completeness,\n            feasibility,\n            riskAwareness,\n            clarity,\n            efficiency,\n            total,\n        },\n        concerns,\n        strengths,\n    };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_evaluatePlans_182": {
      "name": "evaluatePlans",
      "type": "function",
      "start_line": 182,
      "end_line": 210,
      "content_hash": "33bf13e1336e8c0daaf44bc18a7edbb9860e5f84",
      "content": "export function evaluatePlans(feature, planA, planB, projectDir) {\n    const evalA = evaluatePlan(planA, feature, projectDir, \"A\");\n    const evalB = evaluatePlan(planB, feature, projectDir, \"B\");\n    const winner = evalA.scores.total >= evalB.scores.total ? \"A\" : \"B\";\n    const marginOfVictory = Math.abs(evalA.scores.total - evalB.scores.total);\n    // Generate selection reason\n    let selectionReason;\n    if (marginOfVictory < 5) {\n        selectionReason = `Plans are nearly equal (margin: ${marginOfVictory}). Plan ${winner} selected based on slight advantages.`;\n    }\n    else if (marginOfVictory < 15) {\n        const winnerEval = winner === \"A\" ? evalA : evalB;\n        const topStrength = winnerEval.strengths[0] || \"overall quality\";\n        selectionReason = `Plan ${winner} selected with moderate advantage (margin: ${marginOfVictory}). Key strength: ${topStrength}`;\n    }\n    else {\n        const winnerEval = winner === \"A\" ? evalA : evalB;\n        selectionReason = `Plan ${winner} clearly superior (margin: ${marginOfVictory}). Strengths: ${winnerEval.strengths.slice(0, 2).join(\", \")}`;\n    }\n    return {\n        winner,\n        evaluations: {\n            A: evalA,\n            B: evalB,\n        },\n        selectionReason,\n        marginOfVictory,\n    };\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_parsePlanFromFile_214": {
      "name": "parsePlanFromFile",
      "type": "function",
      "start_line": 214,
      "end_line": 245,
      "content_hash": "fc2f0efb7ef02fb3c98bfec34f0d8410af6a7012",
      "content": "export function parsePlanFromFile(filePath) {\n    try {\n        if (!fs.existsSync(filePath)) {\n            return null;\n        }\n        const content = fs.readFileSync(filePath, \"utf-8\");\n        const parsed = JSON.parse(content);\n        // Validate required fields\n        if (!parsed.summary || !Array.isArray(parsed.steps)) {\n            return null;\n        }\n        // Normalize the plan structure\n        return {\n            summary: parsed.summary || \"\",\n            steps: (parsed.steps || []).map((step, index) => ({\n                order: step.order ?? index + 1,\n                description: step.description || \"\",\n                files: step.files || [],\n                validation: step.validation,\n            })),\n            filesToCreate: parsed.filesToCreate || [],\n            filesToModify: parsed.filesToModify || [],\n            testStrategy: parsed.testStrategy || \"\",\n            risks: parsed.risks || [],\n            estimatedComplexity: parsed.estimatedComplexity,\n            dependencies: parsed.dependencies,\n        };\n    }\n    catch {\n        return null;\n    }\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    },
    "function_formatEvaluationResult_249": {
      "name": "formatEvaluationResult",
      "type": "function",
      "start_line": 249,
      "end_line": 272,
      "content_hash": "f013a6b99301f2aed56f601873fb731c615cea4c",
      "content": "export function formatEvaluationResult(result) {\n    const lines = [];\n    lines.push(`Winner: Plan ${result.winner}`);\n    lines.push(`Margin: ${result.marginOfVictory} points`);\n    lines.push(`Reason: ${result.selectionReason}`);\n    lines.push(\"\");\n    for (const planId of [\"A\", \"B\"]) {\n        const evaluation = result.evaluations[planId];\n        lines.push(`--- Plan ${planId} (${evaluation.scores.total}/100) ---`);\n        lines.push(`  Completeness: ${evaluation.scores.completeness}/25`);\n        lines.push(`  Feasibility: ${evaluation.scores.feasibility}/25`);\n        lines.push(`  Risk Awareness: ${evaluation.scores.riskAwareness}/20`);\n        lines.push(`  Clarity: ${evaluation.scores.clarity}/15`);\n        lines.push(`  Efficiency: ${evaluation.scores.efficiency}/15`);\n        if (evaluation.strengths.length > 0) {\n            lines.push(`  Strengths: ${evaluation.strengths.join(\"; \")}`);\n        }\n        if (evaluation.concerns.length > 0) {\n            lines.push(`  Concerns: ${evaluation.concerns.join(\"; \")}`);\n        }\n        lines.push(\"\");\n    }\n    return lines.join(\"\\n\");\n}",
      "pseudo": "",
      "tags": [],
      "qdrant_ids": []
    }
  }
}