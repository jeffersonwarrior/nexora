?   	github.com/nexora/nexora	[no test files]
2025/12/28 03:39:17 OK   20250424200609_initial.sql (30.77ms)
2025/12/28 03:39:17 OK   20250515105448_add_summary_message_id.sql (6.17ms)
2025/12/28 03:39:17 OK   20250624000000_add_created_at_indexes.sql (3.9ms)
2025/12/28 03:39:17 OK   20250627000000_add_provider_to_messages.sql (10ms)
2025/12/28 03:39:17 OK   20250810000000_add_is_summary_message.sql (5.72ms)
2025/12/28 03:39:17 OK   20251217221932_add_context_archive.sql (7.5ms)
2025/12/28 03:39:17 OK   20251225000007_create_prompt_library.sql (17.07ms)
2025/12/28 03:39:17 OK   20251226000001_fix_prompt_library_timestamps.sql (24.34ms)
2025/12/28 03:39:17 OK   20251227000001_create_checkpoints.sql (7.48ms)
2025/12/28 03:39:17 goose: successfully migrated database to version: 20251227000001
==================
WARNING: DATA RACE
Read at 0x00c000f82450 by goroutine 106:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c000f82450 by goroutine 21:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.1()
      /home/nexora/internal/agent/agent_test.go:83 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.1()
      /home/nexora/internal/agent/agent_test.go:80 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.1()
      /home/nexora/internal/agent/agent_test.go:78 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 106 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.1()
      /home/nexora/internal/agent/agent_test.go:83 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.1()
      /home/nexora/internal/agent/agent_test.go:80 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.1()
      /home/nexora/internal/agent/agent_test.go:78 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 21 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:77 +0x18c
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c0013b1860 by goroutine 116:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:101 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:99 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:97 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c0013b1860 by goroutine 137:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 116 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:96 +0x245
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 137 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:101 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:99 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:97 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c000d0e540 by goroutine 151:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.3()
      /home/nexora/internal/agent/agent_test.go:142 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.3()
      /home/nexora/internal/agent/agent_test.go:139 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.3()
      /home/nexora/internal/agent/agent_test.go:137 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c000d0e540 by goroutine 168:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 151 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:136 +0x2fa
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 168 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.3()
      /home/nexora/internal/agent/agent_test.go:142 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.3()
      /home/nexora/internal/agent/agent_test.go:139 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.3()
      /home/nexora/internal/agent/agent_test.go:137 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c0004e9020 by goroutine 280:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c0004e9020 by goroutine 264:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.6()
      /home/nexora/internal/agent/agent_test.go:281 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.6()
      /home/nexora/internal/agent/agent_test.go:278 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.6()
      /home/nexora/internal/agent/agent_test.go:276 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 280 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.6()
      /home/nexora/internal/agent/agent_test.go:281 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.6()
      /home/nexora/internal/agent/agent_test.go:278 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.6()
      /home/nexora/internal/agent/agent_test.go:276 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 264 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:275 +0x51a
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c000b70980 by goroutine 311:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c000b70980 by goroutine 295:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:320 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:317 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:315 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 311 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:320 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:317 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:315 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 295 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:314 +0x5ce
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c0012b6b70 by goroutine 311:
  context.(*valueCtx).Err()
      <autogenerated>:1 +0x31
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).requestHandler()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:408 +0xc4
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).executeAndRecord()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:620 +0x311
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).RoundTrip()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:603 +0x35
  net/http.send()
      /usr/lib/go/src/net/http/client.go:259 +0x8ca
  net/http.(*Client).send()
      /usr/lib/go/src/net/http/client.go:180 +0x14c
  net/http.(*Client).do()
      /usr/lib/go/src/net/http/client.go:729 +0x13b8
  net/http.(*Client).Do()
      /usr/lib/go/src/net/http/client.go:587 +0x3d
  net/http.(*Client).Do-fm()
      <autogenerated>:1 +0x17
  github.com/charmbracelet/anthropic-sdk-go/internal/requestconfig.(*RequestConfig).Execute()
      /home/agent/go/pkg/mod/github.com/charmbracelet/anthropic-sdk-go@v0.0.0-20251024181547-21d6f3d9a904/internal/requestconfig/requestconfig.go:446 +0x1223
  github.com/charmbracelet/anthropic-sdk-go/internal/requestconfig.ExecuteNewRequest()
      /home/agent/go/pkg/mod/github.com/charmbracelet/anthropic-sdk-go@v0.0.0-20251024181547-21d6f3d9a904/internal/requestconfig/requestconfig.go:567 +0x11c
  github.com/charmbracelet/anthropic-sdk-go.(*MessageService).NewStreaming()
      /home/agent/go/pkg/mod/github.com/charmbracelet/anthropic-sdk-go@v0.0.0-20251024181547-21d6f3d9a904/message.go:88 +0x684
  charm.land/fantasy/providers/anthropic.languageModel.Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/providers/anthropic/anthropic.go:848 +0x179
  charm.land/fantasy/providers/anthropic.(*languageModel).Stream()
      <autogenerated>:1 +0x10e
  charm.land/fantasy.(*agent).Stream.func1()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:843 +0x15c
  charm.land/fantasy.retryWithExponentialBackoff[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }]()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:92 +0x107
  charm.land/fantasy.(*agent).Stream.RetryWithExponentialBackoffRespectingRetryHeaders[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }].func2()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:64 +0x1038
  charm.land/fantasy.(*agent).Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:841 +0x5fe
  github.com/nexora/nexora/internal/agent.(*sessionAgent).generateTitle()
      /home/nexora/internal/agent/agent.go:1496 +0x776
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0xaa
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c0012b6b70 by goroutine 295:
  context.WithValue()
      /usr/lib/go/src/context/context.go:737 +0x9d
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1d84
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:320 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:317 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:315 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 311 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:320 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:317 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.7()
      /home/nexora/internal/agent/agent_test.go:315 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 295 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:314 +0x5ce
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c0004e9c80 by goroutine 327:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:360 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:357 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:355 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c0004e9c80 by goroutine 343:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 327 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:354 +0x685
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 343 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:360 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:357 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:355 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c0003fb950 by goroutine 377:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c0003fb950 by goroutine 361:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:400 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:397 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:395 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 377 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:400 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:397 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:395 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 361 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:394 +0x73a
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c003a0bd40 by goroutine 424:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c003a0bd40 by goroutine 407:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.10()
      /home/nexora/internal/agent/agent_test.go:441 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.10()
      /home/nexora/internal/agent/agent_test.go:438 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.10()
      /home/nexora/internal/agent/agent_test.go:436 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 424 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.10()
      /home/nexora/internal/agent/agent_test.go:441 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.10()
      /home/nexora/internal/agent/agent_test.go:438 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.10()
      /home/nexora/internal/agent/agent_test.go:436 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 407 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:435 +0x7ee
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c000c237a0 by goroutine 467:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c000c237a0 by goroutine 451:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.11()
      /home/nexora/internal/agent/agent_test.go:485 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.11()
      /home/nexora/internal/agent/agent_test.go:482 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.11()
      /home/nexora/internal/agent/agent_test.go:480 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 467 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.11()
      /home/nexora/internal/agent/agent_test.go:485 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.11()
      /home/nexora/internal/agent/agent_test.go:482 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.11()
      /home/nexora/internal/agent/agent_test.go:480 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 451 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:479 +0x8a5
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c001096990 by goroutine 534:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c001096990 by goroutine 518:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.13()
      /home/nexora/internal/agent/agent_test.go:569 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.13()
      /home/nexora/internal/agent/agent_test.go:566 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.13()
      /home/nexora/internal/agent/agent_test.go:564 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 534 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.13()
      /home/nexora/internal/agent/agent_test.go:569 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.13()
      /home/nexora/internal/agent/agent_test.go:566 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.13()
      /home/nexora/internal/agent/agent_test.go:564 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 518 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:563 +0xa0e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c000a93bc0 by goroutine 608:
  context.(*valueCtx).Err()
      <autogenerated>:1 +0x31
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).requestHandler()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:408 +0xc4
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).executeAndRecord()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:620 +0x311
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).RoundTrip()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:603 +0x35
  net/http.send()
      /usr/lib/go/src/net/http/client.go:259 +0x8ca
  net/http.(*Client).send()
      /usr/lib/go/src/net/http/client.go:180 +0x14c
  net/http.(*Client).do()
      /usr/lib/go/src/net/http/client.go:729 +0x13b8
  net/http.(*Client).Do()
      /usr/lib/go/src/net/http/client.go:587 +0x3d
  net/http.(*Client).Do-fm()
      <autogenerated>:1 +0x17
  github.com/openai/openai-go/v2/internal/requestconfig.(*RequestConfig).Execute()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/internal/requestconfig/requestconfig.go:447 +0x1223
  github.com/openai/openai-go/v2/internal/requestconfig.ExecuteNewRequest()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/internal/requestconfig/requestconfig.go:569 +0x11c
  github.com/openai/openai-go/v2.(*ChatCompletionService).NewStreaming()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/chatcompletion.go:96 +0x684
  charm.land/fantasy/providers/openai.languageModel.Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/providers/openai/language_model.go:317 +0x256
  charm.land/fantasy/providers/openai.(*languageModel).Stream()
      <autogenerated>:1 +0x107
  charm.land/fantasy.(*agent).Stream.func1()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:843 +0x15c
  charm.land/fantasy.retryWithExponentialBackoff[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }]()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:92 +0x107
  charm.land/fantasy.(*agent).Stream.RetryWithExponentialBackoffRespectingRetryHeaders[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }].func2()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:64 +0x1038
  charm.land/fantasy.(*agent).Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:841 +0x5fe
  github.com/nexora/nexora/internal/agent.(*sessionAgent).generateTitle()
      /home/nexora/internal/agent/agent.go:1496 +0x776
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0xaa
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c000a93bc0 by goroutine 592:
  context.WithValue()
      /usr/lib/go/src/context/context.go:737 +0x9d
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1d84
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:101 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:99 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:97 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 608 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:101 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:99 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.2()
      /home/nexora/internal/agent/agent_test.go:97 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 592 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:96 +0x245
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c000f833e0 by goroutine 638:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.4()
      /home/nexora/internal/agent/agent_test.go:194 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.4()
      /home/nexora/internal/agent/agent_test.go:191 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.4()
      /home/nexora/internal/agent/agent_test.go:189 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c000f833e0 by goroutine 654:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 638 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:188 +0x3ae
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 654 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.4()
      /home/nexora/internal/agent/agent_test.go:194 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.4()
      /home/nexora/internal/agent/agent_test.go:191 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.4()
      /home/nexora/internal/agent/agent_test.go:189 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c000a1b220 by goroutine 661:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.5()
      /home/nexora/internal/agent/agent_test.go:238 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.5()
      /home/nexora/internal/agent/agent_test.go:235 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.5()
      /home/nexora/internal/agent/agent_test.go:233 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c000a1b220 by goroutine 677:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 661 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:232 +0x465
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 677 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.5()
      /home/nexora/internal/agent/agent_test.go:238 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.5()
      /home/nexora/internal/agent/agent_test.go:235 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.5()
      /home/nexora/internal/agent/agent_test.go:233 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c000febe60 by goroutine 746:
  context.(*valueCtx).Err()
      <autogenerated>:1 +0x31
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).requestHandler()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:408 +0xc4
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).executeAndRecord()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:620 +0x311
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).RoundTrip()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:603 +0x35
  net/http.send()
      /usr/lib/go/src/net/http/client.go:259 +0x8ca
  net/http.(*Client).send()
      /usr/lib/go/src/net/http/client.go:180 +0x14c
  net/http.(*Client).do()
      /usr/lib/go/src/net/http/client.go:729 +0x13b8
  net/http.(*Client).Do()
      /usr/lib/go/src/net/http/client.go:587 +0x3d
  net/http.(*Client).Do-fm()
      <autogenerated>:1 +0x17
  github.com/openai/openai-go/v2/internal/requestconfig.(*RequestConfig).Execute()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/internal/requestconfig/requestconfig.go:447 +0x1223
  github.com/openai/openai-go/v2/internal/requestconfig.ExecuteNewRequest()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/internal/requestconfig/requestconfig.go:569 +0x11c
  github.com/openai/openai-go/v2.(*ChatCompletionService).NewStreaming()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/chatcompletion.go:96 +0x684
  charm.land/fantasy/providers/openai.languageModel.Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/providers/openai/language_model.go:317 +0x256
  charm.land/fantasy/providers/openai.(*languageModel).Stream()
      <autogenerated>:1 +0x107
  charm.land/fantasy.(*agent).Stream.func1()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:843 +0x15c
  charm.land/fantasy.retryWithExponentialBackoff[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }]()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:92 +0x107
  charm.land/fantasy.(*agent).Stream.RetryWithExponentialBackoffRespectingRetryHeaders[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }].func2()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:64 +0x1038
  charm.land/fantasy.(*agent).Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:841 +0x5fe
  github.com/nexora/nexora/internal/agent.(*sessionAgent).generateTitle()
      /home/nexora/internal/agent/agent.go:1496 +0x776
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0xaa
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c000febe60 by goroutine 730:
  context.WithValue()
      /usr/lib/go/src/context/context.go:737 +0x9d
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1d84
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:360 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:357 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:355 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 746 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:360 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:357 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.8()
      /home/nexora/internal/agent/agent_test.go:355 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 730 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:354 +0x685
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c000bf84b0 by goroutine 769:
  context.(*valueCtx).Err()
      <autogenerated>:1 +0x31
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).requestHandler()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:408 +0xc4
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).executeAndRecord()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:620 +0x311
  gopkg.in/dnaeon/go-vcr.v4/pkg/recorder.(*Recorder).RoundTrip()
      /home/agent/go/pkg/mod/gopkg.in/dnaeon/go-vcr.v4@v4.0.6-0.20251110073552-01de4eb40290/pkg/recorder/recorder.go:603 +0x35
  net/http.send()
      /usr/lib/go/src/net/http/client.go:259 +0x8ca
  net/http.(*Client).send()
      /usr/lib/go/src/net/http/client.go:180 +0x14c
  net/http.(*Client).do()
      /usr/lib/go/src/net/http/client.go:729 +0x13b8
  net/http.(*Client).Do()
      /usr/lib/go/src/net/http/client.go:587 +0x3d
  net/http.(*Client).Do-fm()
      <autogenerated>:1 +0x17
  github.com/openai/openai-go/v2/internal/requestconfig.(*RequestConfig).Execute()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/internal/requestconfig/requestconfig.go:447 +0x1223
  github.com/openai/openai-go/v2/internal/requestconfig.ExecuteNewRequest()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/internal/requestconfig/requestconfig.go:569 +0x11c
  github.com/openai/openai-go/v2.(*ChatCompletionService).NewStreaming()
      /home/agent/go/pkg/mod/github.com/openai/openai-go/v2@v2.7.1/chatcompletion.go:96 +0x684
  charm.land/fantasy/providers/openai.languageModel.Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/providers/openai/language_model.go:317 +0x256
  charm.land/fantasy/providers/openai.(*languageModel).Stream()
      <autogenerated>:1 +0x107
  charm.land/fantasy.(*agent).Stream.func1()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:843 +0x15c
  charm.land/fantasy.retryWithExponentialBackoff[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }]()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:92 +0x107
  charm.land/fantasy.(*agent).Stream.RetryWithExponentialBackoffRespectingRetryHeaders[go.shape.struct { StepResult charm.land/fantasy.StepResult; ShouldContinue bool }].func2()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/retry.go:64 +0x1038
  charm.land/fantasy.(*agent).Stream()
      /home/agent/go/pkg/mod/charm.land/fantasy@v0.5.4/agent.go:841 +0x5fe
  github.com/nexora/nexora/internal/agent.(*sessionAgent).generateTitle()
      /home/nexora/internal/agent/agent.go:1496 +0x776
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0xaa
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Previous write at 0x00c000bf84b0 by goroutine 753:
  context.WithValue()
      /usr/lib/go/src/context/context.go:737 +0x9d
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1d84
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:400 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:397 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:395 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 769 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:400 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:397 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.9()
      /home/nexora/internal/agent/agent_test.go:395 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 753 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:394 +0x73a
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c000f0ea00 by goroutine 822:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.12()
      /home/nexora/internal/agent/agent_test.go:524 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.12()
      /home/nexora/internal/agent/agent_test.go:521 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.12()
      /home/nexora/internal/agent/agent_test.go:519 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c000f0ea00 by goroutine 838:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 822 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1()
      /home/nexora/internal/agent/agent_test.go:518 +0x95a
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 838 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.12()
      /home/nexora/internal/agent/agent_test.go:524 +0x33c
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.12()
      /home/nexora/internal/agent/agent_test.go:521 +0x1f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestCoderAgent.func1.12()
      /home/nexora/internal/agent/agent_test.go:519 +0xc4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
--- FAIL: TestCoderAgent (23.86s)
    --- FAIL: TestCoderAgent/anthropic-sonnet (14.46s)
        --- FAIL: TestCoderAgent/anthropic-sonnet/simple_test (8.27s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/read_a_file (0.46s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/update_a_file (0.31s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/fetch_tool (0.64s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/glob_tool (0.33s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/grep_tool (0.34s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/ls_tool (0.64s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/multiedit_tool (0.77s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/sourcegraph_tool (0.88s)
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/anthropic-sonnet/parallel_tool_calls (0.35s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/anthropic-sonnet/parallel_tool_calls".
                Diff:
                  strings.Join({
                  	`{"max_tokens":`,
                - 	"4",
                + 	"1000",
                  	`0,"messages":[{"content":[{"text":"`,
                - 	`Generate a concise title for the following content:\n\nuse glob `,
                - 	"to find all .go files and use ls to list the current directory, ",
                - 	`it is very important that you run both tool calls in parallel\n `,
                - 	`\u003cthink\u003e\n\n\u003c/think\u003e","type":"text"}],"role":`,
                - 	`"user"}],"model":"claude-3-5-haiku-20241022","system":[{"text":"`,
                - 	"you will generate a short title based on the first message a use",
                - 	`r begins a conversation with\n\n\u003crules\u003e\n- ensure it i`,
                - 	`s not more than 50 characters long\n- the title should be a summ`,
                - 	`ary of the user's message\n- it should be one line long\n- do no`,
                - 	`t use quotes or colons\n- the entire text you return will be use`,
                - 	`d as the title\n- never return anything that is more than one se`,
                - 	`ntence (one line) long\n\u003c/rules\u003e\n\n /no_think","type"`,
                - 	`:"text"`,
                + 	"use glob to find all .go files and use ls to list the current di",
                + 	"rectory, it is very important that you run both tool calls in pa",
                + 	`rallel","cache_control":{"type":"ephemeral"},"type":"text"}],"ro`,
                + 	`le":"user"}],"model":"claude-sonnet-4-5-20250929","system":[{"te`,
                + 	`xt":"## CRITICAL: TOOL CALL FORMAT (READ THIS FIRST)\n**ALWAYS u`,
                + 	`se EXACT OpenAI JSON format for tools. NEVER use \u0026lt;tool_c`,
                + 	"all\\u0026gt; tags:**\\n\\n```\\n{\\n  \\\"tool_calls\\\": [{\\n    \\\"id\\\"",
                + 	`: \"call_abc123\",\n    \"type\": \"function\",\n    \"function\`,
                + 	`": {\n      \"name\": \"view\",\n      \"arguments\": \"{\\\"fil`,
                + 	"e_path\\\\\\\":\\\\\\\"/home/nexora/todo.md\\\\\\\"}\\\"\\n    }\\n  }]\\n}\\n```\\",
                + 	`n\n**Penalty for wrong format: Your response will be ignored!**\`,
                + 	`n\n## Core Rules\n1. **Read before editing** - Always view files`,
                + 	` first, match exact formatting\n2. **Be autonomous** - Search, d`,
                + 	`ecide, act without asking. Break complex tasks into steps.\n3. *`,
                + 	"*Infer intent** - Don't be literal. If a file isn't found, searc",
                + 	"h for similar names (case variations, typos). If a task seems in",
                + 	`complete, complete it fully.\n4. **Test changes** - Run tests im`,
                + 	`mediately after modifications\n5. **Be concise** - Keep response`,
                + 	`s under 4 lines unless explaining complex changes\n6. **Exact ma`,
                + 	"tches** - Whitespace, indentation, line breaks must match perfec",
                + 	`tly for edits\n7. **Never commit** - Unless explicitly asked\n8.`,
                + 	` **Security first** - Only assist with defensive security tasks\`,
                + 	`n\n## Inference Examples\n- User says \"read TODO.md\" but it do`,
                + 	"esn't exist  Search for `todo.md`, `TODO`, `Todo.md`\\n- User ",
                + 	`says \"fix the bug\"  Search for error patterns, recent chang`,
                + 	`es, test failures\n- User says \"add tests\"  Look at existin`,
                + 	"g test patterns, create comprehensive tests\\n- File not found \xe2\x86",
                + 	"\x92 Try case variations, partial matches, ask glob/grep to find it",
                + 	`\n\n## Workflow\n**Before acting**: Search  Read files  Id`,
                + 	`entify changes  Edit  Test\n**While acting**: Read entire `,
                + 	"file first, use exact text, include 3-5 lines context, test afte",
                + 	`r each change\n**Before finishing**: Verify task complete, run t`,
                + 	`ests, keep response concise\n\n## Editing Files\n**Critical Requ`,
                + 	`irements**:\n- Exact character-by-character matching\n- Include `,
                + 	`3-5 surrounding lines for reliable context\n- Verify uniqueness `,
                + 	`(or use replace_all=true)\n\n**Understanding the 100 Line Limita`,
                + 	"tion**:\\n- `view` tool shows 100 lines at a time: \\\"showing line",
                + 	"s 1-100 of 200 total\\\"\\n- Use `view` with `offset` parameter: `v",
                + 	"iew file_path=\\\"/path\\\" offset=100`\\n- Your edits MUST exist in ",
                + 	`the file, not just in visible 100-line chunk\n\n**Common Failure`,
                + 	`s**:\n- Wrong indentation: 2 spaces vs 4 spaces\n- Missing blank`,
                + 	` lines: 1 newline vs 2 newlines\n- Comment spacing: \"// comment`,
                + 	`\" vs \"//comment\"\n\n**Tab/Display Issues**:\n- VIEW shows tab`,
                + 	"s as `\\t\\\\t` but EDIT needs actual `\\\\t`\\n- Always use `ai_mo",
                + 	"de=true` (default) to auto-fix this\\n\\n**Recovery Steps**:\\n1. V",
                + 	"iew file with more context\\n2. Use `offset` if target outside cu",
                + 	"rrent window\\n3. Use `grep -n \\\"pattern\\\" file` to find line num",
                + 	"bers\\n4. Fallback: Use `write` tool for full file replacement\\n\\",
                + 	"n## Tools\\n\\n### Available Tools\\n- `view`: Read files with line",
                + 	" numbers (100 lines at a time - use offset!)\\n- `edit`: Replace ",
                + 	`text exactly (whitespace-sensitive, ai_mode=true by default)\n- `,
                + 	"`bash`: Execute commands\\n- `grep`: Search file contents\\n- `glo",
                + 	"b`: Find files by pattern\\n- `write`: Create/update entire files",
                + 	`\n\n### When to use each\n- **View**: Always first to understand`,
                + 	` file contents\n- **Edit**: For precise, targeted changes\n- **W`,
                + 	`rite**: When exact matching fails or for large changes\n- **Bash`,
                + 	`**: For command execution\n- **Grep**: For finding text in files`,
                + 	`\n- **Glob**: For finding files by name pattern\n\n### When some`,
                + 	"thing fails\\n- **File not found in view**  Use `offset=100`, ",
                + 	"`offset=200` to navigate\\n- **Edit fails**  View file again, ",
                + 	"copy exact text, use `write` as fallback\\n- **Command fails** \xe2\x86",
                + 	"\x92 Read error, try alternative approach\\n- **Pattern not visible*",
                + 	"*  Use `grep` to find line numbers, then view with offset\\n\\n",
                + 	`## Testing\n- Run relevant tests after every change\n- Fix failu`,
                + 	`res immediately\n- Never leave code in broken state\n\n## Decisi`,
                + 	`on Making\n**Be proactive**: Don't just report problems, solve t`,
                + 	`hem.\n**Autonomous decisions**: Search for answers, read pattern`,
                + 	`s, make reasonable assumptions\n**Only ask user if**: Truly ambi`,
                + 	"guous requirements, potential data loss, or actually blocked aft",
                + 	`er trying alternatives\n\n## Error Handling\n1. Read complete er`,
                + 	`ror message\n2. Understand root cause\n3. Try different approach`,
                + 	` (don't repeat same failure)\n4. Search for similar working code`,
                + 	`\n5. Make targeted fix\n6. Test to verify\n\n## Project Specific`,
                + 	`s\n\n\n\n## Environment\nDate/Time: 2025-01-01 00:00:00 UTC\nOS:`,
                + 	` linux (amd64)\nCurrent User: agent\nWorking Directory: /tmp/nex`,
                + 	`ora-test/TestCoderAgent/anthropic-sonnet/parallel_tool_calls\n\n`,
                + 	`Git Repo: no\n\nInstalled Runtimes:\n- Python: Python 3.13.7\n- `,
                + 	`Node.js: v25.2.1\n- Go: go1.25.5\n- Shell: bash (mvdan/sh)\n\nSy`,
                + 	`stem Resources:\n- Memory: 31Gi total, 23Gi available\n- Disk: 1`,
                + 	`6G total, 15G free\n\nTerminal: color, 80x24, interactive\nNetwo`,
                + 	`rk: online\nActive Services: \n\n## Nexora System Settings\nNexo`,
                + 	"ra client system settings are stored in `~/.local/share/nexora`.",
                + 	" This directory contains two important files:\\n\\n1. **`nexora.db",
                + 	"`** - SQLite database containing session history, configuration ",
                + 	"settings, and conversation state\\n2. **`mcp.json`** - JSON confi",
                + 	"guration file for MCP (Model Context Protocol) settings and serv",
                + 	`er configurations\n\nMCP-related files and configurations are st`,
                + 	"ored in the `mcp.json` file, which defines available MCP servers",
                + 	` and their connection parameters.\n\n\n\n","cache_control":{"typ`,
                + 	`e":"ephemeral"},"type":"text"}],"tool_choice":{"disable_parallel`,
                + 	`_tool_use":false,"type":"auto"},"tools":[{"input_schema":{"prope`,
                + 	`rties":{"command":{"description":"The command to execute","type"`,
                + 	`:"string"},"description":{"description":"A brief description of `,
                + 	`what the command does, try to keep it under 30 characters or so"`,
                + 	`,"type":"string"},"run_in_background":{"description":"Set to tru`,
                + 	"e (boolean) to run this command in the background. Use job_outpu",
                + 	`t to read the output later.","type":"boolean"},"shell_id":{"desc`,
                + 	`ription":"ONLY use for continuing existing background jobs. Do N`,
                + 	"OT provide for new commands - sessions are managed automatically",
                + 	`.","type":"string"},"working_dir":{"description":"The working di`,
                + 	"rectory to execute the command in (defaults to current directory",
                + 	`)","type":"string"}},"required":["description","command"],"type"`,
                + 	`:"object"},"name":"bash","description":"Executes bash commands w`,
                + 	`ith automatic background conversion for long-running tasks.\n\n\`,
                + 	`u003ccross_platform\u003e\nUses mvdan/sh interpreter (Bash-compa`,
                + 	`tible on all platforms including Windows).\nUse forward slashes `,
                + 	`for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n\u003c/cr`,
                + 	`oss_platform\u003e\n\n\u003cexecution_steps\u003e\n1. Directory `,
                + 	"Verification: Use LS tool to verify parent exists before creatin",
                + 	`g files\n2. Security Check: No restrictions - explain to user. S`,
                + 	`afe read-only commands execute without prompts\n3. Command Execu`,
                + 	`tion: Execute with proper quoting, capture output\n4. Auto-Backg`,
                + 	`round: Commands \u003e1 minute automatically move to background,`,
                + 	` return shell ID\n5. Output Processing: Truncate if exceeds 3000`,
                + 	`0 characters\n6. Return Result: Include errors, metadata with \u`,
                + 	`003ccwd\u003e\u003c/cwd\u003e tags\n\u003c/execution_steps\u003e`,
                + 	`\n\n\u003cusage_notes\u003e\n- Command required, working_dir opt`,
                + 	`ional (defaults to current directory)\n- IMPORTANT: Use Grep/Glo`,
                + 	"b/Agent tools instead of 'find'/'grep'. Use View/LS instead of '",
                + 	`cat'/'head'/'tail'/'ls'\n- Chain with ';' or '\u0026\u0026', avo`,
                + 	`id newlines except in quoted strings\n- Each command runs in ind`,
                + 	`ependent shell (no state persistence)\n- Prefer absolute paths o`,
                + 	`ver 'cd'\n\u003c/usage_notes\u003e\n\n\u003cbackground_execution`,
                + 	`\u003e\n- Set run_in_background=true for separate background she`,
                + 	`ll\n- Returns shell ID for management\n- Use job_output tool to `,
                + 	"view output, job_kill to terminate\\n- NEVER use `\\u0026` at end ",
                + 	`of commands - use run_in_background parameter\n- Background: Lon`,
                + 	"g servers (npm start, python -m http.server), watch tasks, conti",
                + 	`nuous processes\n- Foreground: Builds, tests, git ops, file ops,`,
                + 	` short scripts\n\u003c/background_execution\u003e\n\n\u003cgit_c`,
                + 	`ommits\u003e\nWhen user asks to create git commit:\n\n1. Run: gi`,
                + 	"t status, git diff, git log (single message, three tool_use bloc",
                + 	`ks)\n2. Add relevant untracked files to staging\n3. Analyze in \`,
                + 	`u003ccommit_analysis\u003e tags:\n   - List changed files, summa`,
                + 	`rize nature (feature/bug fix/refactor/docs)\n   - Draft concise `,
                + 	`(1-2 sentences) focusing on \"why\" not \"what\"\n   - Use accur`,
                + 	`ate verbs: \"add\"=new feature, \"update\"=enhancement, \"fix\"=`,
                + 	"bug\\n4. Create commit with attribution:\\n   ```bash\\n   git comm",
                + 	`it -m \"$(cat \u0026lt;\u0026lt;'EOF'\n   Commit message here.\n`,
                + 	`\n    Generated with Crush\n\n\n   Co-Authored-By: Crush \u0`,
                + 	"03ccrush@charm.land\\u003e\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-c",
                + 	"ommit hook fails, retry ONCE. If succeeds but files modified, MU",
                + 	`ST amend.\n6. Run git status to verify.\n\nNotes: Use \"git comm`,
                + 	`it -am\" when possible, don't stage unrelated files, NEVER updat`,
                + 	`e config, don't push, no empty commits.\n\u003c/git_commits\u003`,
                + 	`e\n\n\u003cpull_requests\u003e\nWhen user asks to create PR:\n\n`,
                + 	"1. Run: git status, git diff, check remote tracking, git log and",
                + 	` 'git diff main...HEAD'\n2. Create branch if needed, commit if n`,
                + 	`eeded, push with -u if needed\n3. Analyze in \u003cpr_analysis\u`,
                + 	`003e tags:\n   - List commits since main divergence\n   - Summar`,
                + 	`ize changes, purpose/motivation\n   - Draft concise (1-2 bullets`,
                + 	") focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr creat",
                + 	`e --title \"title\" --body \"$(cat \u0026lt;\u0026lt;'EOF'\n   #`,
                + 	`# Summary\n   \u0026lt;1-3 bullet points\u003e\n   \n   ## Test `,
                + 	`plan\n   [Checklist...]\n\n    Generated with Crush\n\n   EO`,
                + 	"F\\n   )\\\"\\n   ```\\n\\nImportant: Return empty response, never upd",
                + 	`ate git config\n\u003c/pull_requests\u003e\n\n\u003cexamples\u00`,
                + 	`3e\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar \u0026\u0026 p`,
                + 	`ytest tests\n\u003c/examples\u003e\n"},{"input_schema":{"propert`,
                + 	`ies":{"file_path":{"description":"The local file path where the `,
                + 	`downloaded content should be saved","type":"string"},"timeout":{`,
                + 	`"description":"Optional timeout in seconds (max 600)","type":"in`,
                + 	`teger"},"url":{"description":"The URL to download from","type":"`,
                + 	`string"}},"required":["url","file_path"],"type":"object"},"name"`,
                + 	`:"download","description":"Downloads binary data from URL and sa`,
                + 	`ves to local file.\n\n\u003cusage\u003e\n- Provide URL to downlo`,
                + 	`ad from\n- Specify local file path where content should be saved`,
                + 	`\n- Optional timeout for request\n\u003c/usage\u003e\n\n\u003cfe`,
                + 	`atures\u003e\n- Downloads any file type (binary or text)\n- Auto`,
                + 	`-creates parent directories if missing\n- Handles large files ef`,
                + 	`ficiently with streaming\n- Sets reasonable timeouts to prevent `,
                + 	`hanging\n- Validates input parameters before requests\n\u003c/fe`,
                + 	`atures\u003e\n\n\u003climitations\u003e\n- Max file size: 100MB\`,
                + 	`n- Only supports HTTP and HTTPS protocols\n- Cannot handle authe`,
                + 	`ntication or cookies\n- Some websites may block automated reques`,
                + 	`ts\n- Will overwrite existing files without warning\n\u003c/limi`,
                + 	`tations\u003e\n\n\u003ctips\u003e\n- Use absolute paths or paths`,
                + 	` relative to working directory\n- Set appropriate timeouts for l`,
                + 	`arge files or slow connections\n\u003c/tips\u003e\n"},{"input_sc`,
                + 	`hema":{"properties":{"ai_mode":{"description":"Enable AI-optimiz`,
                + 	"ed editing with automatic context expansion and improved error h",
                + 	`andling (DEFAULT: true)","type":"boolean"},"file_path":{"descrip`,
                + 	`tion":"The absolute path to the file to modify","type":"string"}`,
                + 	`,"new_string":{"description":"The text to replace it with","type`,
                + 	`":"string"},"old_string":{"description":"The text to replace","t`,
                + 	`ype":"string"},"replace_all":{"description":"Replace all occurre`,
                + 	`nces of old_string (default false)","type":"boolean"}},"required`,
                + 	`":["file_path","old_string","new_string"],"type":"object"},"name`,
                + 	`":"edit","description":"Edits files by replacing text, creating `,
                + 	"new files, or deleting content. For moving/renaming use Bash 'mv",
                + 	`'. For large edits use Write tool.\n\n**Quick Decision Tree:**\n`,
                + 	"1. **Know exact line numbers?**  Use `smart_edit` tool (100% ",
                + 	"reliable)\\n2. **Edit failed once?**  Use `write` tool immedia",
                + 	`tely\n3. **First time editing?**  Enable ai_mode=true\n\n\u00`,
                + 	`3cprerequisites\u003e\n1. **NEVER copy from view tool output** -`,
                + 	" has visual tab indicators (\\t) causing failures\\n2. Use `sed",
                + 	" -n 'START,ENDp' file` or `grep -A5 -B5 pattern file` for EXACT ",
                + 	`text\n3. For new files: Use LS tool to verify parent directory e`,
                + 	"xists\\n4. If you can't extract exact text, use `smart_edit` with",
                + 	` line numbers\n\u003c/prerequisites\u003e\n\n\u003cparameters\u0`,
                + 	`03e\n1. file_path: Absolute path to file (required)\n2. old_stri`,
                + 	"ng: Text to replace (exact match including whitespace/indentatio",
                + 	`n)\n3. new_string: Replacement text\n4. replace_all: Replace all`,
                + 	` occurrences (default false)\n\u003c/parameters\u003e\n\n\u003cs`,
                + 	`pecial_cases\u003e\n- Create file: provide file_path + new_strin`,
                + 	`g, leave old_string empty\n- Delete content: provide file_path +`,
                + 	` old_string, leave new_string empty\n\u003c/special_cases\u003e\`,
                + 	`n\n\u003ccritical_requirements\u003e\n**EXACT MATCHING**: Text m`,
                + 	`ust match character-for-character\n- Every space, tab, blank lin`,
                + 	"e, newline, indentation level\\n- Comment spacing (`// comment` v",
                + 	"s `//comment`)\\n- Brace positioning (`func() {` vs `func(){`)\\n\\",
                + 	"n**UNIQUENESS**: old_string MUST uniquely identify target (when ",
                + 	`replace_all=false)\n- Include 3-5 lines context before/after cha`,
                + 	`nge point\n- If text appears multiple times, add more context or`,
                + 	` use replace_all=true\n\n**VERIFICATION BEFORE USING**:\n1. View`,
                + 	` file and locate exact target\n2. Check how many instances exist`,
                + 	`\n3. Copy EXACT text including whitespace\n4. Verify enough cont`,
                + 	`ext for unique identification\n5. Double-check indentation (coun`,
                + 	`t spaces/tabs)\n\u003c/critical_requirements\u003e\n\n\u003cwarn`,
                + 	`ings\u003e\nTool fails if:\n- old_string matches multiple locati`,
                + 	`ons and replace_all=false\n- Whitespace doesn't match exactly\n-`,
                + 	` Indentation off by even one space\n- Missing or extra blank lin`,
                + 	`es\n\u003c/warnings\u003e\n\n\u003crecovery_steps\u003e\nIf \"ol`,
                + 	`d_string not found\":\n\n** DON'T RETRY - Use alternatives:*`,
                + 	"*\\n1. `smart_edit` with line numbers (100% reliable)\\n2. Extract",
                + 	" exact text: `sed -n '10,20p' file`\\n3. Use `write` tool for ful",
                + 	`l file replacement\n\n** DON'T:**\n- Retry with \"adjusted\" `,
                + 	`whitespace\n- Copy from view output (has artifacts)\n- Guess at `,
                + 	"whitespace\\n\\n** DO:**\\n- Use `smart_edit` (line numbers)\\n- ",
                + 	"Use `sed -n 'X,Yp' file` for exact text\\n- Use `write` if edit f",
                + 	`ails once\n\u003c/recovery_steps\u003e\n\n\u003cbest_practices\u`,
                + 	`003e\n- View file first, match exact formatting\n- Use absolute `,
                + 	`paths with forward slashes (/)\n- Multiple edits to same file: s`,
                + 	`end all in single message\n- Include MORE context when uncertain`,
                + 	`\n- Match existing code style exactly\n\u003c/best_practices\u00`,
                + 	`3e\n\n\u003cexamples\u003e\n **Correct**: Exact match with co`,
                + 	"ntext\\n```\\nold_string: \\\"func ProcessData(input string) error {",
                + 	`\\n    if input == \\\"\\\" {\\n        return errors.New(\\\"em`,
                + 	`pty input\\\")\\n    }\\n    return nil\\n}\"\nnew_string: \"fun`,
                + 	`c ProcessData(input string) error {\\n    if input == \\\"\\\" {`,
                + 	`\\n        return errors.New(\\\"empty input\\\")\\n    }\\n    `,
                + 	`if len(input) \u003e 1000 {\\n        return errors.New(\\\"inpu`,
                + 	"t too long\\\\\\\")\\\\n    }\\\\n    return nil\\\\n}\\\"\\n```\\n\\n **Inc",
                + 	"orrect**: Not enough context\\n```\\nold_string: \\\"return nil\\\"  /",
                + 	"/ Appears many times!\\n```\\n\\n **Incorrect**: Wrong indentati",
                + 	"on\\n```\\nold_string: \\\"  if input == \\\\\\\"\\\\\\\" {\\\"  // 2 spaces\\n",
                + 	`// File actually has: \"    if input == \\\"\\\" {\"  // 4 space`,
                + 	"s\\n```\\n\\u003c/examples\\u003e\\n\\n## AI Mode\\nUse `ai_mode=true` ",
                + 	`(default) for automatic fixes:\n- Converts VIEW tool display tab`,
                + 	"s (`\\\\t`) to real tabs (`\\\\t`)\\n- Expands minimal context aut",
                + 	`omatically\n- Enhanced error messages\n- Lower failure rate on w`,
                + 	`hitespace issues\n"},{"input_schema":{"properties":{"edits":{"de`,
                + 	`scription":"Array of edit operations to perform sequentially on `,
                + 	`the file","items":{"properties":{"new_string":{"description":"Th`,
                + 	`e text to replace it with","type":"string"},"old_string":{"descr`,
                + 	`iption":"The text to replace","type":"string"},"replace_all":{"d`,
                + 	`escription":"Replace all occurrences of old_string (default fals`,
                + 	`e).","type":"boolean"}},"required":["old_string","new_string"],"`,
                + 	`type":"object"},"type":"array"},"file_path":{"description":"The `,
                + 	`absolute path to the file to modify","type":"string"}},"required`,
                + 	`":["file_path","edits"],"type":"object"},"name":"multiedit","des`,
                + 	`cription":"Makes multiple edits to a single file in one operatio`,
                + 	"n. Built on Edit tool for efficient multiple find-and-replace. P",
                + 	`refer over Edit tool for multiple edits to same file.\n\n\u003cp`,
                + 	`rerequisites\u003e\n1. Use View tool to understand file contents`,
                + 	`\n2. Verify directory path is correct\n3. CRITICAL: Note exact w`,
                + 	`hitespace, indentation from View output\n\u003c/prerequisites\u0`,
                + 	`03e\n\n\u003cparameters\u003e\n1. file_path: Absolute path to fi`,
                + 	`le (required)\n2. edits: Array of edit objects (MUST be array, n`,
                + 	`ot string!):\n   - old_string: Text to replace (exact match incl`,
                + 	`uding whitespace)\n   - new_string: Replacement text\n   - repla`,
                + 	`ce_all: Replace all occurrences (optional, default false)\n   \n`,
                + 	"    CORRECT: `\\\"edits\\\": [{\\\"old_string\\\": \\\"text1\\\", \\\"new_s",
                + 	"tring\\\": \\\"replace1\\\"}]`\\n    INCORRECT: `\\\"edits\\\": \\\"[{\\\\\\\"",
                + 	"old_string\\\\\\\": \\\\\\\"text1\\\\\\\"}]\\\"` (string, not array)\\n\\u003c/p",
                + 	`arameters\u003e\n\n\u003coperation\u003e\n- Edits applied sequen`,
                + 	`tially in order\n- Each edit operates on result of previous edit`,
                + 	`\n- PARTIAL SUCCESS: Failed edits returned, successful edits kep`,
                + 	`t\n- File modified if at least one edit succeeds\n\u003c/operati`,
                + 	`on\u003e\n\n\u003cinherited_rules\u003e\n**All Edit tool rules a`,
                + 	`pply to each edit:**\n- See edit.md for critical requirements, w`,
                + 	`arnings, recovery steps\n- Exact matching for whitespace, indent`,
                + 	`ation, blank lines\n- Uniqueness requirements (3-5 lines context`,
                + 	`)\n- Verification checklist before using\n- Use ai_mode=true (de`,
                + 	`fault) for tab handling\n\u003c/inherited_rules\u003e\n\n\u003cc`,
                + 	`ritical_requirements\u003e\n1. Apply Edit tool rules to EACH edi`,
                + 	`t (see edit.md)\n2. Edits applied in order; successful edits kep`,
                + 	`t if later edits fail\n3. Plan sequence: earlier edits change co`,
                + 	`ntent that later edits must match\n4. Ensure each old_string uni`,
                + 	`que at application time (after prior edits)\n5. Check response f`,
                + 	`or failed edits, retry with corrections\n\u003c/critical_require`,
                + 	`ments\u003e\n\n\u003cverification_before_using\u003e\n1. View fi`,
                + 	`le, copy exact text (including whitespace) for each target\n2. C`,
                + 	`heck instances of each old_string BEFORE sequence\n3. Dry-run: a`,
                + 	`fter edit #N, will edit #N+1 still match?\n4. Prefer fewer, larg`,
                + 	`er context blocks over many tiny fragments\n5. If edits independ`,
                + 	`ent, consider separate multiedit batches\n\u003c/verification_be`,
                + 	`fore_using\u003e\n\n\u003cwarnings\u003e\n- Check response for f`,
                + 	`ailed edits\n- Earlier edits invalidate later matches (added/rem`,
                + 	`oved spaces, lines)\n- Mixed tabs/spaces, trailing spaces cause `,
                + 	`failures\n- replace_all may affect unintended regions\n\u003c/wa`,
                + 	`rnings\u003e\n\n\u003crecovery_steps\u003e\nIf edits fail:\n1. C`,
                + 	`heck response metadata for failed edits with errors\n2. View fil`,
                + 	`e to see current state after successful edits\n3. Adjust failed `,
                + 	`edits based on new content\n4. Retry with corrected old_string v`,
                + 	`alues\n5. Break complex batches into smaller operations\n\u003c/`,
                + 	`recovery_steps\u003e\n\n\u003cbest_practices\u003e\n- Result in `,
                + 	`correct, idiomatic code\n- Use absolute file paths (/)\n- Use re`,
                + 	`place_all only when certain\n- Match existing style exactly\n- R`,
                + 	`eview failed edits, retry with corrections\n\u003c/best_practice`,
                + 	`s\u003e\n\n\u003cexamples\u003e\n **Correct**: Sequential edi`,
                + 	"ts accounting for changes\\n```\\nedits: [\\n  {\\n    old_string: \\",
                + 	`"func A() {\\n    doOld()\\n}\",\n    new_string: \"func A() {\\`,
                + 	`n    doNew()\\n}\",\n  },\n  {\n    // Context exists AFTER firs`,
                + 	`t replacement\n    old_string: \"func B() {\\n    callA()\\n}\",`,
                + 	`\n    new_string: \"func B() {\\n    callA()\\n    logChange()\\`,
                + 	"n}\\\",\\n  },\\n]\\n```\\n\\n **Incorrect**: Second old_string no l",
                + 	"onger matches\\n```\\nedits: [\\n  {\\n    old_string: \\\"func A() {\\",
                + 	`\n    doOld()\\n}\",\n    new_string: \"func A() {\\n\\n    doNe`,
                + 	`w()\\n}\", // Added blank line\n  },\n  {\n    old_string: \"fun`,
                + 	`c A() {\\n    doNew()\\n}\", // Missing blank line - FAILS\n    `,
                + 	`new_string: \"func A() {\\n    doNew()\\n    logChange()\\n}\",\`,
                + 	"n  },\\n]\\n```\\n\\u003c/examples\\u003e\\n\"},{\"input_schema\":{\"prope",
                + 	`rties":{"format":{"description":"The format to return the conten`,
                + 	`t in (text, markdown, or html)","type":"string"},"timeout":{"des`,
                + 	`cription":"Optional timeout in seconds (max 120)","type":"intege`,
                + 	`r"},"url":{"description":"The URL to fetch content from","type":`,
                + 	`"string"}},"required":["url","format"],"type":"object"},"name":"`,
                + 	`fetch","description":"Fetches raw content from URL and returns i`,
                + 	`t in specified format without any AI processing.\n\n\u003cwhen_t`,
                + 	`o_use\u003e\nUse this tool when you need:\n- Raw, unprocessed co`,
                + 	`ntent from a URL\n- Direct access to API responses or JSON data\`,
                + 	`n- HTML/text/markdown content without interpretation\n- Simple, `,
                + 	`fast content retrieval without analysis\n- To save tokens by avo`,
                + 	`iding AI processing\n\nDO NOT use this tool when you need to:\n-`,
                + 	" Extract specific information from a webpage (use agentic_fetch ",
                + 	`instead)\n- Answer questions about web content (use agentic_fetc`,
                + 	`h instead)\n- Analyze or summarize web pages (use agentic_fetch `,
                + 	`instead)\n\u003c/when_to_use\u003e\n\n\u003cusage\u003e\n- Provi`,
                + 	`de URL to fetch content from\n- Specify desired output format (t`,
                + 	`ext, markdown, or html)\n- Optional timeout for request\n\u003c/`,
                + 	`usage\u003e\n\n\u003cfeatures\u003e\n- Supports three output for`,
                + 	`mats: text, markdown, html\n- Auto-handles HTTP redirects\n- Fas`,
                + 	`t and lightweight - no AI processing\n- Sets reasonable timeouts`,
                + 	` to prevent hanging\n- Validates input parameters before request`,
                + 	`s\n\u003c/features\u003e\n\n\u003climitations\u003e\n- Max respo`,
                + 	`nse size: 5MB\n- Only supports HTTP and HTTPS protocols\n- Canno`,
                + 	`t handle authentication or cookies\n- Some websites may block au`,
                + 	`tomated requests\n- Returns raw content only - no analysis or ex`,
                + 	`traction\n\u003c/limitations\u003e\n\n\u003ctips\u003e\n- Use te`,
                + 	`xt format for plain text content or simple API responses\n- Use `,
                + 	"markdown format for content that should be rendered with formatt",
                + 	`ing\n- Use html format when you need raw HTML structure\n- Set a`,
                + 	`ppropriate timeouts for potentially slow websites\n- If the user`,
                + 	" asks to analyze or extract from a page, use agentic_fetch inste",
                + 	`ad\n\u003c/tips\u003e\n"},{"input_schema":{"properties":{"path":`,
                + 	`{"description":"The directory to search in. Defaults to the curr`,
                + 	`ent working directory.","type":"string"},"pattern":{"description`,
                + 	`":"The glob pattern to match files against","type":"string"}},"r`,
                + 	`equired":["pattern"],"type":"object"},"name":"glob","description`,
                + 	`":"Fast file pattern matching tool that finds files by name/patt`,
                + 	"ern, returning paths sorted by modification time (newest first).",
                + 	`\n\n\u003cusage\u003e\n- Provide glob pattern to match against f`,
                + 	`ile paths\n- Optional starting directory (defaults to current wo`,
                + 	`rking directory)\n- Results sorted with most recently modified f`,
                + 	`iles first\n\u003c/usage\u003e\n\n\u003cpattern_syntax\u003e\n- `,
                + 	`'\\*' matches any sequence of non-separator characters\n- '\\*\\`,
                + 	`*' matches any sequence including separators\n- '?' matches any `,
                + 	`single non-separator character\n- '[...]' matches any character `,
                + 	`in brackets\n- '[!...]' matches any character not in brackets\n\`,
                + 	`u003c/pattern_syntax\u003e\n\n\u003cexamples\u003e\n- '*.js' - J`,
                + 	`avaScript files in current directory\n- '**/*.js' - JavaScript f`,
                + 	`iles in any subdirectory\n- 'src/**/*.{ts,tsx}' - TypeScript fil`,
                + 	`es in src directory\n- '*.{html,css,js}' - HTML, CSS, and JS fil`,
                + 	`es\n\u003c/examples\u003e\n\n\u003climitations\u003e\n- Results `,
                + 	`limited to 100 files (newest first)\n- Does not search file cont`,
                + 	`ents (use Grep for that)\n- Hidden files (starting with '.') ski`,
                + 	`pped\n\u003c/limitations\u003e\n\n\u003ccross_platform\u003e\n- `,
                + 	`Path separators handled automatically (/ and \\ work)\n- Uses ri`,
                + 	`pgrep (rg) if available, otherwise Go implementation\n- Patterns`,
                + 	` should use forward slashes (/) for compatibility\n\u003c/cross_`,
                + 	`platform\u003e\n\n\u003ctips\u003e\n- Combine with Grep: find fi`,
                + 	`les with Glob, search contents with Grep\n- For iterative explor`,
                + 	`ation requiring multiple searches, consider Agent tool\n- Check `,
                + 	`if results truncated and refine pattern if needed\n\u003c/tips\u`,
                + 	`003e\n"},{"input_schema":{"properties":{"include":{"description"`,
                + 	`:"File pattern to include in the search (e.g. \"*.js\", \"*.{ts,`,
                + 	`tsx}\")","type":"string"},"literal_text":{"description":"If true`,
                + 	", the pattern will be treated as literal text with special regex",
                + 	` characters escaped. Default is false.","type":"boolean"},"path"`,
                + 	`:{"description":"The directory to search in. Defaults to the cur`,
                + 	`rent working directory.","type":"string"},"pattern":{"descriptio`,
                + 	`n":"The regex pattern to search for in file contents","type":"st`,
                + 	`ring"}},"required":["pattern"],"type":"object"},"name":"grep","d`,
                + 	`escription":"Fast content search tool that finds files containin`,
                + 	"g specific text/patterns, returning matching paths sorted by mod",
                + 	`ification time (newest first).\n\n\u003cusage\u003e\n- Provide r`,
                + 	`egex pattern to search within file contents\n- Set literal_text=`,
                + 	"true for exact text with special characters (recommended for non",
                + 	`-regex users)\n- Optional starting directory (defaults to curren`,
                + 	`t working directory)\n- Optional include pattern to filter which`,
                + 	` files to search\n- Results sorted with most recently modified f`,
                + 	`iles first\n\u003c/usage\u003e\n\n\u003cregex_syntax\u003e\nWhen`,
                + 	` literal_text=false (supports standard regex):\n\n- 'function' s`,
                + 	`earches for literal text \"function\"\n- 'log\\..\\*Error' finds`,
                + 	` text starting with \"log.\" and ending with \"Error\"\n- 'impor`,
                + 	`t\\s+.\\*\\s+from' finds import statements in JavaScript/TypeScr`,
                + 	`ipt\n\u003c/regex_syntax\u003e\n\n\u003cinclude_patterns\u003e\n`,
                + 	`- '\\*.js' - Only search JavaScript files\n- '\\*.{ts,tsx}' - On`,
                + 	`ly search TypeScript files\n- '\\*.go' - Only search Go files\n\`,
                + 	`u003c/include_patterns\u003e\n\n\u003climitations\u003e\n- Resul`,
                + 	`ts limited to 100 files (newest first)\n- Performance depends on`,
                + 	` number of files searched\n- Very large binary files may be skip`,
                + 	`ped\n- Hidden files (starting with '.') skipped\n\u003c/limitati`,
                + 	`ons\u003e\n\n\u003cignore_support\u003e\n- Respects .gitignore p`,
                + 	`atterns to skip ignored files/directories\n- Respects .nexoraign`,
                + 	`ore patterns for additional ignore rules\n- Both ignore files au`,
                + 	`to-detected in search root directory\n\u003c/ignore_support\u003`,
                + 	`e\n\n\u003ccross_platform\u003e\n- Uses ripgrep (rg) if availabl`,
                + 	`e for better performance\n- Falls back to Go implementation if r`,
                + 	`ipgrep unavailable\n- File paths normalized automatically for co`,
                + 	`mpatibility\n\u003c/cross_platform\u003e\n\n\u003ctips\u003e\n- `,
                + 	"For faster searches: use Glob to find relevant files first, then",
                + 	` Grep\n- For iterative exploration requiring multiple searches, `,
                + 	`consider Agent tool\n- Check if results truncated and refine sea`,
                + 	`rch pattern if needed\n- Use literal_text=true for exact text wi`,
                + 	`th special characters (dots, parentheses, etc.)\n\u003c/tips\u00`,
                + 	`3e\n"},{"input_schema":{"properties":{"depth":{"description":"Th`,
                + 	`e maximum depth to traverse","type":"integer"},"ignore":{"descri`,
                + 	`ption":"List of glob patterns to ignore","items":{"type":"string`,
                + 	`"},"type":"array"},"path":{"description":"The path to the direct`,
                + 	`ory to list (defaults to current working directory)","type":"str`,
                + 	`ing"}},"required":[],"type":"object"},"name":"ls","description":`,
                + 	`"Shows files and subdirectories in tree structure for exploring `,
                + 	`project organization.\n\n\u003cusage\u003e\n- Provide path to li`,
                + 	`st (defaults to current working directory)\n- Optional glob patt`,
                + 	`erns to ignore\n- Results displayed in tree structure\n\u003c/us`,
                + 	`age\u003e\n\n\u003cfeatures\u003e\n- Hierarchical view of files `,
                + 	`and directories\n- Auto-skips hidden files/directories (starting`,
                + 	` with '.')\n- Skips common system directories like __pycache__\n`,
                + 	`- Can filter files matching specific patterns\n\u003c/features\u`,
                + 	`003e\n\n\u003climitations\u003e\n- Results limited to 1000 files`,
                + 	`\n- Large directories truncated\n- No file sizes or permissions `,
                + 	`shown\n- Cannot recursively list all directories in large projec`,
                + 	`ts\n\u003c/limitations\u003e\n\n\u003ccross_platform\u003e\n- Hi`,
                + 	"dden file detection uses Unix convention (files starting with '.",
                + 	`')\n- Windows hidden files (with hidden attribute) not auto-skip`,
                + 	`ped\n- Common Windows directories (System32, Program Files) not `,
                + 	`in default ignore\n- Path separators handled automatically (/ an`,
                + 	`d \\ work)\n\u003c/cross_platform\u003e\n\n\u003ctips\u003e\n- U`,
                + 	`se Glob for finding files by name patterns instead of browsing\n`,
                + 	`- Use Grep for searching file contents\n- Combine with other too`,
                + 	`ls for effective exploration\n\u003c/tips\u003e\n"},{"input_sche`,
                + 	`ma":{"properties":{"context_window":{"description":"The context `,
                + 	`around the match to return (default: 10 lines)","type":"integer"`,
                + 	`},"count":{"description":"Optional number of results to return (`,
                + 	`default: 10, max: 20)","type":"integer"},"query":{"description":`,
                + 	`"The Sourcegraph search query","type":"string"},"timeout":{"desc`,
                + 	`ription":"Optional timeout in seconds (max 120)","type":"integer`,
                + 	`"}},"required":["query"],"type":"object"},"name":"sourcegraph","`,
                + 	`description":"Search code across public repositories using Sourc`,
                + 	`egraph's GraphQL API.\n\n\u003cusage\u003e\n- Provide search que`,
                + 	`ry using Sourcegraph syntax\n- Optional result count (default: 1`,
                + 	`0, max: 20)\n- Optional timeout for request\n\u003c/usage\u003e\`,
                + 	`n\n\u003cbasic_syntax\u003e\n- \"fmt.Println\" - exact matches\n`,
                + 	`- \"file:.go fmt.Println\" - limit to Go files\n- \"repo:^github`,
                + 	`\\.com/golang/go$ fmt.Println\" - specific repos\n- \"lang:go fm`,
                + 	`t.Println\" - limit to Go code\n- \"fmt.Println AND log.Fatal\" `,
                + 	`- combined terms\n- \"fmt\\.(Print|Printf|Println)\" - regex pat`,
                + 	`terns\n- \"\\\"exact phrase\\\"\" - exact phrase matching\n- \"-`,
                + 	`file:test\" or \"-repo:forks\" - exclude matches\n\u003c/basic_s`,
                + 	`yntax\u003e\n\n\u003ckey_filters\u003e\nRepository: repo:name, r`,
                + 	"epo:^exact$, repo:org/repo@branch, -repo:exclude, fork:yes, arch",
                + 	`ived:yes, visibility:public\nFile: file:\\.js$, file:internal/, `,
                + 	`-file:test, file:has.content(text)\nContent: content:\"exact\", `,
                + 	`-content:\"unwanted\", case:yes\nType: type:symbol, type:file, t`,
                + 	`ype:path, type:diff, type:commit\nTime: after:\"1 month ago\", b`,
                + 	`efore:\"2023-01-01\", author:name, message:\"fix\"\nResult: sele`,
                + 	`ct:repo, select:file, select:content, count:100, timeout:30s\n\u`,
                + 	`003c/key_filters\u003e\n\n\u003cexamples\u003e\n- \"file:.go con`,
                + 	`text.WithTimeout\" - Go code using context.WithTimeout\n- \"lang`,
                + 	`:typescript useState type:symbol\" - TypeScript React useState h`,
                + 	`ooks\n- \"repo:^github\\.com/kubernetes/kubernetes$ pod list typ`,
                + 	`e:file\" - Kubernetes pod files\n- \"file:Dockerfile (alpine OR `,
                + 	`ubuntu) -content:alpine:latest\" - Dockerfiles with base images\`,
                + 	`n\u003c/examples\u003e\n\n\u003cboolean_operators\u003e\n- \"ter`,
                + 	`m1 AND term2\" - both terms\n- \"term1 OR term2\" - either term\`,
                + 	`n- \"term1 NOT term2\" - term1 but not term2\n- \"term1 and (ter`,
                + 	`m2 or term3)\" - grouping with parentheses\n\u003c/boolean_opera`,
                + 	`tors\u003e\n\n\u003climitations\u003e\n- Only searches public re`,
                + 	`positories\n- Rate limits may apply\n- Complex queries take long`,
                + 	`er\n- Max 20 results per query\n\u003c/limitations\u003e\n\n\u00`,
                + 	`3ctips\u003e\n- Use specific file extensions to narrow results\n`,
                + 	`- Add repo: filters for targeted searches\n- Use type:symbol for`,
                + 	` function/method definitions\n- Use type:file to find relevant f`,
                + 	`iles\n\u003c/tips\u003e\n"},{"input_schema":{"properties":{"file`,
                + 	`_path":{"description":"The path to the file to read","type":"str`,
                + 	`ing"},"limit":{"description":"The number of lines to read (defau`,
                + 	`lts to 2000)","type":"integer"},"offset":{"description":"The lin`,
                + 	`e number to start reading from (0-based)","type":"integer"}},"re`,
                + 	`quired":["file_path"],"type":"object"},"name":"view","descriptio`,
                + 	`n":"Reads and displays file contents with line numbers for exami`,
                + 	`ning code, logs, or text data.\n\n\u003cusage\u003e\n- Provide f`,
                + 	`ile path to read\n- Optional offset: start reading from specific`,
                + 	` line (0-based)\n- Optional limit: control lines read (default 1`,
                + 	`00)\n- Don't use for directories (use LS tool instead)\n- Suppor`,
                + 	`ts image files (PNG, JPEG, GIF, BMP, SVG, WebP)\n\u003c/usage\u0`,
                + 	`03e\n\n\u003cfeatures\u003e\n- Displays contents with line numbe`,
                + 	`rs\n- Can read from any file position using offset\n- Handles la`,
                + 	`rge files by limiting lines read\n- Auto-truncates very long lin`,
                + 	`es for display\n- Suggests similar filenames when file not found`,
                + 	`\n- Renders image files directly in terminal\n\u003c/features\u0`,
                + 	`03e\n\n\u003climitations\u003e\n- Max file size: 5MB\n- Default `,
                + 	`limit: 100 lines (reduced to prevent context window issues)\n- L`,
                + 	`ines \u003e2000 chars truncated\n- Binary files (except images) `,
                + 	`cannot be displayed\n\u003c/limitations\u003e\n\n\u003ccross_pla`,
                + 	`tform\u003e\n- Handles Windows (CRLF) and Unix (LF) line endings`,
                + 	`\n- Works with forward slashes (/) and backslashes (\\)\n- Auto-`,
                + 	`detects text encoding for common formats\n\u003c/cross_platform\`,
                + 	`u003e\n\n\u003ctips\u003e\n- Use with Glob to find files first\n`,
                + 	"- For code exploration: Grep to find relevant files, then View t",
                + 	`o examine\n- For large files: use offset and limit parameters fo`,
                + 	`r specific sections\n- The tool uses smaller chunks (100 lines d`,
                + 	`efault) to manage context window efficiently\n- For very large f`,
                + 	`iles, consider using 'head' or 'tail' commands via bash tool\n- `,
                + 	`View tool automatically detects and renders image files\n\u003c/`,
                + 	`tips\u003e\n"},{"input_schema":{"properties":{"content":{"descri`,
                + 	`ption":"The content to write to the file","type":"string"},"file`,
                + 	`_path":{"description":"The path to the file to write","type":"st`,
                + 	`ring"}},"required":["file_path","content"],"type":"object"},"nam`,
                + 	`e":"write","description":"Creates or updates files in filesystem`,
                + 	` for saving/modifying text content.\n\n\u003cusage\u003e\n- Prov`,
                + 	`ide file path to write\n- Include content to write to file\n- To`,
                + 	`ol creates necessary parent directories automatically\n\u003c/us`,
                + 	`age\u003e\n\n\u003cfeatures\u003e\n- Creates new files or overwr`,
                + 	`ites existing ones\n- Auto-creates parent directories if missing`,
                + 	`\n- Checks if file modified since last read for safety\n- Avoids`,
                + 	` unnecessary writes when content unchanged\n\u003c/features\u003`,
                + 	`e\n\n\u003climitations\u003e\n- Read file before writing to avoi`,
                + 	`d conflicts\n- Cannot append (rewrites entire file)\n\u003c/limi`,
                + 	`tations\u003e\n\n\u003ccross_platform\u003e\n- Use forward slash`,
                + 	`es (/) for compatibility\n\u003c/cross_platform\u003e\n\n\u003ct`,
                + 	`ips\u003e\n- Use View tool first to examine existing files befor`,
                + 	`e modifying\n- Use LS tool to verify location when creating new `,
                + 	`files\n- Combine with Glob/Grep to find and modify multiple file`,
                + 	`s\n- Include descriptive comments when changing existing code\n\`,
                + 	`u003c/tips\u003e\n","cache_control":{"type":"ephemeral"}`,
                  	... // 17 identical bytes
                  }, "")
            testing.go:1617: race detected during execution of test
    --- FAIL: TestCoderAgent/openrouter-kimi-k2 (9.39s)
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/simple_test (0.63s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/simple_test".
                Diff:
                  strings.Join({
                  	... // 9321 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            agent_test.go:88: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:88
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/simple_test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/read_a_file (1.27s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/read_a_file".
                Diff:
                  strings.Join({
                  	... // 9331 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/read_a_file".
                Diff:
                  strings.Join({
                  	... // 5391 identical bytes
                  	`connection parameters.\n\n\n\n","role":"system","cache_control":`,
                  	`{"type":"ephemeral"}},{"content":"Read the go mod","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you read the Go module file. Let me first `,
                - 	"check what Go module files are available in the current director",
                - 	`y.","tool_calls":[{"id":"functions.glob:0","function":{"argument`,
                - 	`s":"{\"pattern\":\"go.mod\"}","name":"glob"},"type":"function","`,
                - 	`cache_control":{"type":"ephemeral"}}],"role":"assistant"},{"cont`,
                - 	`ent":"/tmp/nexora-test/TestCoderAgent/openrouter-kimi-k2/read_a_`,
                - 	`file/go.mod","tool_call_id":"functions.glob:0","role":"tool"}],"`,
                - 	`model":"moonshotai/kimi-k2-0905","max_tokens":10000,"stream_opti`,
                - 	`ons":{"include_usage":true},"tool_choice":"auto","tools":[{"func`,
                - 	`tion":{"name":"bash","strict":false,"description":"Executes bash`,
                - 	" commands with automatic background conversion for long-running ",
                - 	`tasks.\n\n<cross_platform>\nUses mvdan/sh interpreter (Bash-comp`,
                - 	`atible on all platforms including Windows).\nUse forward slashes`,
                - 	` for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_`,
                - 	`platform>\n\n<execution_steps>\n1. Directory Verification: Use L`,
                - 	`S tool to verify parent exists before creating files\n2. Securit`,
                - 	"y Check: No restrictions - explain to user. Safe read-only comma",
                - 	`nds execute without prompts\n3. Command Execution: Execute with `,
                - 	`proper quoting, capture output\n4. Auto-Background: Commands >1 `,
                - 	`minute automatically move to background, return shell ID\n5. Out`,
                - 	`put Processing: Truncate if exceeds 30000 characters\n6. Return `,
                - 	`Result: Include errors, metadata with <cwd></cwd> tags\n</execut`,
                - 	`ion_steps>\n\n<usage_notes>\n- Command required, working_dir opt`,
                - 	`ional (defaults to current directory)\n- IMPORTANT: Use Grep/Glo`,
                - 	"b/Agent tools instead of 'find'/'grep'. Use View/LS instead of '",
                - 	`cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&', avoid newline`,
                - 	`s except in quoted strings\n- Each command runs in independent s`,
                - 	`hell (no state persistence)\n- Prefer absolute paths over 'cd'\n`,
                - 	`</usage_notes>\n\n<background_execution>\n- Set run_in_backgroun`,
                - 	`d=true for separate background shell\n- Returns shell ID for man`,
                - 	`agement\n- Use job_output tool to view output, job_kill to termi`,
                - 	"nate\\n- NEVER use `&` at end of commands - use run_in_background",
                - 	` parameter\n- Background: Long servers (npm start, python -m htt`,
                - 	`p.server), watch tasks, continuous processes\n- Foreground: Buil`,
                - 	`ds, tests, git ops, file ops, short scripts\n</background_execut`,
                - 	`ion>\n\n<git_commits>\nWhen user asks to create git commit:\n\n1`,
                - 	". Run: git status, git diff, git log (single message, three tool",
                - 	`_use blocks)\n2. Add relevant untracked files to staging\n3. Ana`,
                - 	`lyze in <commit_analysis> tags:\n   - List changed files, summar`,
                - 	`ize nature (feature/bug fix/refactor/docs)\n   - Draft concise (`,
                - 	`1-2 sentences) focusing on \"why\" not \"what\"\n   - Use accura`,
                - 	`te verbs: \"add\"=new feature, \"update\"=enhancement, \"fix\"=b`,
                - 	"ug\\n4. Create commit with attribution:\\n   ```bash\\n   git commi",
                - 	`t -m \"$(cat &lt;&lt;'EOF'\n   Commit message here.\n\n    G`,
                - 	`enerated with Crush\n\n\n   Co-Authored-By: Crush <crush@charm.l`,
                - 	"and>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, ret",
                - 	`ry ONCE. If succeeds but files modified, MUST amend.\n6. Run git`,
                - 	` status to verify.\n\nNotes: Use \"git commit -am\" when possibl`,
                - 	"e, don't stage unrelated files, NEVER update config, don't push,",
                - 	` no empty commits.\n</git_commits>\n\n<pull_requests>\nWhen user`,
                - 	` asks to create PR:\n\n1. Run: git status, git diff, check remot`,
                - 	`e tracking, git log and 'git diff main...HEAD'\n2. Create branch`,
                - 	` if needed, commit if needed, push with -u if needed\n3. Analyze`,
                - 	` in <pr_analysis> tags:\n   - List commits since main divergence`,
                - 	`\n   - Summarize changes, purpose/motivation\n   - Draft concise`,
                - 	" (1-2 bullets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n ",
                - 	`  gh pr create --title \"title\" --body \"$(cat &lt;&lt;'EOF'\n `,
                - 	`  ## Summary\n   &lt;1-3 bullet points>\n   \n   ## Test plan\n `,
                - 	`  [Checklist...]\n\n    Generated with Crush\n\n   EOF\n   )`,
                - 	"\\\"\\n   ```\\n\\nImportant: Return empty response, never update git",
                - 	` config\n</pull_requests>\n\n<examples>\nGood: pytest /foo/bar/t`,
                - 	`ests\nBad: cd /foo/bar && pytest tests\n</examples>\n","paramete`,
                - 	`rs":{"properties":{"command":{"description":"The command to exec`,
                - 	`ute","type":"string"},"description":{"description":"A brief desc`,
                - 	"ription of what the command does, try to keep it under 30 charac",
                - 	`ters or so","type":"string"},"run_in_background":{"description":`,
                - 	`"Set to true (boolean) to run this command in the background. Us`,
                - 	`e job_output to read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/read_a_file".
                Diff:
                  strings.Join({
                  	... // 5391 identical bytes
                  	`connection parameters.\n\n\n\n","role":"system","cache_control":`,
                  	`{"type":"ephemeral"}},{"content":"Read the go mod","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you read the Go module file. Let me first `,
                - 	"check what Go module files are available in the current director",
                - 	`y.","tool_calls":[{"id":"functions.glob:0","function":{"argument`,
                - 	`s":"{\"pattern\":\"go.mod\"}","name":"glob"},"type":"function"}]`,
                - 	`,"role":"assistant"},{"content":"/tmp/nexora-test/TestCoderAgent`,
                - 	`/openrouter-kimi-k2/read_a_file/go.mod","tool_call_id":"function`,
                - 	`s.glob:0","role":"tool"},{"content":"Now let me read the go.mod `,
                - 	`file to show you its contents:","tool_calls":[{"id":"functions.v`,
                - 	`iew:1","function":{"arguments":"{\"file_path\": \"/tmp/nexora-te`,
                - 	`st/TestCoderAgent/openrouter-kimi-k2/read_a_file/go.mod\"}","nam`,
                - 	`e":"view"},"type":"function","cache_control":{"type":"ephemeral"`,
                - 	`}}],"role":"assistant"},{"content":"<file>\n     1|module exampl`,
                - 	`e.com/testproject\n     2|\n     3|go 1.23\n     4|\n</file>\n\n`,
                - 	`\n File: 0 KB  showing lines 1-4 of 4 total (default chun`,
                - 	`ks: 100 lines)","tool_call_id":"functions.view:1","role":"tool"}`,
                - 	`],"model":"moonshotai/kimi-k2-0905","max_tokens":10000,"stream_o`,
                - 	`ptions":{"include_usage":true},"tool_choice":"auto","tools":[{"f`,
                - 	`unction":{"name":"bash","strict":false,"description":"Executes b`,
                - 	"ash commands with automatic background conversion for long-runni",
                - 	`ng tasks.\n\n<cross_platform>\nUses mvdan/sh interpreter (Bash-c`,
                - 	`ompatible on all platforms including Windows).\nUse forward slas`,
                - 	`hes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cro`,
                - 	`ss_platform>\n\n<execution_steps>\n1. Directory Verification: Us`,
                - 	`e LS tool to verify parent exists before creating files\n2. Secu`,
                - 	"rity Check: No restrictions - explain to user. Safe read-only co",
                - 	`mmands execute without prompts\n3. Command Execution: Execute wi`,
                - 	`th proper quoting, capture output\n4. Auto-Background: Commands `,
                - 	`>1 minute automatically move to background, return shell ID\n5. `,
                - 	`Output Processing: Truncate if exceeds 30000 characters\n6. Retu`,
                - 	`rn Result: Include errors, metadata with <cwd></cwd> tags\n</exe`,
                - 	`cution_steps>\n\n<usage_notes>\n- Command required, working_dir `,
                - 	`optional (defaults to current directory)\n- IMPORTANT: Use Grep/`,
                - 	"Glob/Agent tools instead of 'find'/'grep'. Use View/LS instead o",
                - 	`f 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&', avoid newl`,
                - 	`ines except in quoted strings\n- Each command runs in independen`,
                - 	`t shell (no state persistence)\n- Prefer absolute paths over 'cd`,
                - 	`'\n</usage_notes>\n\n<background_execution>\n- Set run_in_backgr`,
                - 	`ound=true for separate background shell\n- Returns shell ID for `,
                - 	`management\n- Use job_output tool to view output, job_kill to te`,
                - 	"rminate\\n- NEVER use `&` at end of commands - use run_in_backgro",
                - 	`und parameter\n- Background: Long servers (npm start, python -m `,
                - 	`http.server), watch tasks, continuous processes\n- Foreground: B`,
                - 	`uilds, tests, git ops, file ops, short scripts\n</background_exe`,
                - 	`cution>\n\n<git_commits>\nWhen user asks to create git commit:\n`,
                - 	`\n1. Run: git status, git diff, git log (single message, three t`,
                - 	`ool_use blocks)\n2. Add relevant untracked files to staging\n3. `,
                - 	`Analyze in <commit_analysis> tags:\n   - List changed files, sum`,
                - 	`marize nature (feature/bug fix/refactor/docs)\n   - Draft concis`,
                - 	`e (1-2 sentences) focusing on \"why\" not \"what\"\n   - Use acc`,
                - 	`urate verbs: \"add\"=new feature, \"update\"=enhancement, \"fix\`,
                - 	"\"=bug\\n4. Create commit with attribution:\\n   ```bash\\n   git co",
                - 	"mmit -m \\\"$(cat &lt;&lt;'EOF'\\n   Commit message here.\\n\\n   \xf0\x9f\x92",
                - 	"\x98 Generated with Crush\\n\\n\\n   Co-Authored-By: Crush <crush@char",
                - 	"m.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, ",
                - 	`retry ONCE. If succeeds but files modified, MUST amend.\n6. Run `,
                - 	`git status to verify.\n\nNotes: Use \"git commit -am\" when poss`,
                - 	"ible, don't stage unrelated files, NEVER update config, don't pu",
                - 	`sh, no empty commits.\n</git_commits>\n\n<pull_requests>\nWhen u`,
                - 	`ser asks to create PR:\n\n1. Run: git status, git diff, check re`,
                - 	`mote tracking, git log and 'git diff main...HEAD'\n2. Create bra`,
                - 	`nch if needed, commit if needed, push with -u if needed\n3. Anal`,
                - 	`yze in <pr_analysis> tags:\n   - List commits since main diverge`,
                - 	`nce\n   - Summarize changes, purpose/motivation\n   - Draft conc`,
                - 	"ise (1-2 bullets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash",
                - 	`\n   gh pr create --title \"title\" --body \"$(cat &lt;&lt;'EOF'`,
                - 	`\n   ## Summary\n   &lt;1-3 bullet points>\n   \n   ## Test plan`,
                - 	`\n   [Checklist...]\n\n    Generated with Crush\n\n   EOF\n `,
                - 	"  )\\\"\\n   ```\\n\\nImportant: Return empty response, never update ",
                - 	`git config\n</pull_requests>\n\n<examples>\nGood: pytest /foo/ba`,
                - 	`r/tests\nBad: cd /foo/bar && pytest tests\n</examples>\n","param`,
                - 	`eters":{"properties":{"command":{"description":"The command to e`,
                - 	`xecute","type":"string"},"description":{"description":"A brief d`,
                - 	"escription of what the command does, try to keep it under 30 cha",
                - 	`racters or so","type":"string"},"run_in_background":{"descriptio`,
                - 	`n":"Set to true (boolean) to run this command in the background.`,
                - 	` Use job_output to read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:107: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:107
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/read_a_file
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/update_a_file (1.49s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/update_a_file".
                Diff:
                  strings.Join({
                  	... // 9388 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/update_a_file".
                Diff:
                  strings.Join({
                  	... // 5448 identical bytes
                  	`control":{"type":"ephemeral"}},{"content":"update the main.go fi`,
                  	`le by changing the print to say hello from nexora","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you update the main.go file to change the `,
                - 	`print statement to say \"hello from nexora\". Let me first view `,
                - 	`the current file to see its contents.","tool_calls":[{"id":"view`,
                - 	`:0","function":{"arguments":"{\"file_path\": \"/tmp/nexora-test/`,
                - 	`TestCoderAgent/openrouter-kimi-k2/update_a_file/main.go\"}","nam`,
                - 	`e":"view"},"type":"function","cache_control":{"type":"ephemeral"`,
                - 	`}}],"role":"assistant"},{"content":"<file>\n     1|package main\`,
                - 	`n     2|\n     3|import \"fmt\"\n     4|\n     5|func main() {\n`,
                - 	`     6|\tfmt.Println(\"Hello, World!\")\n     7|}\n     8|\n<`,
                - 	`/file>\n\n\n File: 0 KB  showing lines 1-8 of 8 total (de`,
                - 	`fault chunks: 100 lines)","tool_call_id":"view:0","role":"tool"}`,
                - 	`],"model":"moonshotai/kimi-k2-0905","max_tokens":10000,"stream_o`,
                - 	`ptions":{"include_usage":true},"tool_choice":"auto","tools":[{"f`,
                - 	`unction":{"name":"bash","strict":false,"description":"Executes b`,
                - 	"ash commands with automatic background conversion for long-runni",
                - 	`ng tasks.\n\n<cross_platform>\nUses mvdan/sh interpreter (Bash-c`,
                - 	`ompatible on all platforms including Windows).\nUse forward slas`,
                - 	`hes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cro`,
                - 	`ss_platform>\n\n<execution_steps>\n1. Directory Verification: Us`,
                - 	`e LS tool to verify parent exists before creating files\n2. Secu`,
                - 	"rity Check: No restrictions - explain to user. Safe read-only co",
                - 	`mmands execute without prompts\n3. Command Execution: Execute wi`,
                - 	`th proper quoting, capture output\n4. Auto-Background: Commands `,
                - 	`>1 minute automatically move to background, return shell ID\n5. `,
                - 	`Output Processing: Truncate if exceeds 30000 characters\n6. Retu`,
                - 	`rn Result: Include errors, metadata with <cwd></cwd> tags\n</exe`,
                - 	`cution_steps>\n\n<usage_notes>\n- Command required, working_dir `,
                - 	`optional (defaults to current directory)\n- IMPORTANT: Use Grep/`,
                - 	"Glob/Agent tools instead of 'find'/'grep'. Use View/LS instead o",
                - 	`f 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&', avoid newl`,
                - 	`ines except in quoted strings\n- Each command runs in independen`,
                - 	`t shell (no state persistence)\n- Prefer absolute paths over 'cd`,
                - 	`'\n</usage_notes>\n\n<background_execution>\n- Set run_in_backgr`,
                - 	`ound=true for separate background shell\n- Returns shell ID for `,
                - 	`management\n- Use job_output tool to view output, job_kill to te`,
                - 	"rminate\\n- NEVER use `&` at end of commands - use run_in_backgro",
                - 	`und parameter\n- Background: Long servers (npm start, python -m `,
                - 	`http.server), watch tasks, continuous processes\n- Foreground: B`,
                - 	`uilds, tests, git ops, file ops, short scripts\n</background_exe`,
                - 	`cution>\n\n<git_commits>\nWhen user asks to create git commit:\n`,
                - 	`\n1. Run: git status, git diff, git log (single message, three t`,
                - 	`ool_use blocks)\n2. Add relevant untracked files to staging\n3. `,
                - 	`Analyze in <commit_analysis> tags:\n   - List changed files, sum`,
                - 	`marize nature (feature/bug fix/refactor/docs)\n   - Draft concis`,
                - 	`e (1-2 sentences) focusing on \"why\" not \"what\"\n   - Use acc`,
                - 	`urate verbs: \"add\"=new feature, \"update\"=enhancement, \"fix\`,
                - 	"\"=bug\\n4. Create commit with attribution:\\n   ```bash\\n   git co",
                - 	"mmit -m \\\"$(cat &lt;&lt;'EOF'\\n   Commit message here.\\n\\n   \xf0\x9f\x92",
                - 	"\x98 Generated with Crush\\n\\n\\n   Co-Authored-By: Crush <crush@char",
                - 	"m.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, ",
                - 	`retry ONCE. If succeeds but files modified, MUST amend.\n6. Run `,
                - 	`git status to verify.\n\nNotes: Use \"git commit -am\" when poss`,
                - 	"ible, don't stage unrelated files, NEVER update config, don't pu",
                - 	`sh, no empty commits.\n</git_commits>\n\n<pull_requests>\nWhen u`,
                - 	`ser asks to create PR:\n\n1. Run: git status, git diff, check re`,
                - 	`mote tracking, git log and 'git diff main...HEAD'\n2. Create bra`,
                - 	`nch if needed, commit if needed, push with -u if needed\n3. Anal`,
                - 	`yze in <pr_analysis> tags:\n   - List commits since main diverge`,
                - 	`nce\n   - Summarize changes, purpose/motivation\n   - Draft conc`,
                - 	"ise (1-2 bullets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash",
                - 	`\n   gh pr create --title \"title\" --body \"$(cat &lt;&lt;'EOF'`,
                - 	`\n   ## Summary\n   &lt;1-3 bullet points>\n   \n   ## Test plan`,
                - 	`\n   [Checklist...]\n\n    Generated with Crush\n\n   EOF\n `,
                - 	"  )\\\"\\n   ```\\n\\nImportant: Return empty response, never update ",
                - 	`git config\n</pull_requests>\n\n<examples>\nGood: pytest /foo/ba`,
                - 	`r/tests\nBad: cd /foo/bar && pytest tests\n</examples>\n","param`,
                - 	`eters":{"properties":{"command":{"description":"The command to e`,
                - 	`xecute","type":"string"},"description":{"description":"A brief d`,
                - 	"escription of what the command does, try to keep it under 30 cha",
                - 	`racters or so","type":"string"},"run_in_background":{"descriptio`,
                - 	`n":"Set to true (boolean) to run this command in the background.`,
                - 	` Use job_output to read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/update_a_file".
                Diff:
                  strings.Join({
                  	... // 5448 identical bytes
                  	`control":{"type":"ephemeral"}},{"content":"update the main.go fi`,
                  	`le by changing the print to say hello from nexora","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you update the main.go file to change the `,
                - 	`print statement to say \"hello from nexora\". Let me first view `,
                - 	`the current file to see its contents.","tool_calls":[{"id":"view`,
                - 	`:0","function":{"arguments":"{\"file_path\": \"/tmp/nexora-test/`,
                - 	`TestCoderAgent/openrouter-kimi-k2/update_a_file/main.go\"}","nam`,
                - 	`e":"view"},"type":"function"}],"role":"assistant"},{"content":"<`,
                - 	`file>\n     1|package main\n     2|\n     3|import \"fmt\"\n    `,
                - 	` 4|\n     5|func main() {\n     6|\tfmt.Println(\"Hello, Worl`,
                - 	`d!\")\n     7|}\n     8|\n</file>\n\n\n File: 0 KB  showi`,
                - 	`ng lines 1-8 of 8 total (default chunks: 100 lines)","tool_call_`,
                - 	`id":"view:0","role":"tool"},{"content":"Now I'll update the prin`,
                - 	`t statement to say \"hello from nexora\" instead of \"Hello, Wor`,
                - 	`ld!\"","tool_calls":[{"id":"functions.edit:1","function":{"argum`,
                - 	`ents":"{\"file_path\": \"/tmp/nexora-test/TestCoderAgent/openrou`,
                - 	`ter-kimi-k2/update_a_file/main.go\", \"old_string\": \"\\tfmt.Pr`,
                - 	`intln(\\\"Hello, World!\\\")\", \"new_string\": \"\\tfmt.Println`,
                - 	`(\\\"hello from nexora\\\")\"}","name":"edit"},"type":"function"`,
                - 	`,"cache_control":{"type":"ephemeral"}}],"role":"assistant"},{"co`,
                - 	`ntent":"<result>\nContent replaced in file: /tmp/nexora-test/Tes`,
                - 	`tCoderAgent/openrouter-kimi-k2/update_a_file/main.go\n</result>\`,
                - 	`n","tool_call_id":"functions.edit:1","role":"tool"}],"model":"mo`,
                - 	`onshotai/kimi-k2-0905","max_tokens":10000,"stream_options":{"inc`,
                - 	`lude_usage":true},"tool_choice":"auto","tools":[{"function":{"na`,
                - 	`me":"bash","strict":false,"description":"Executes bash commands `,
                - 	`with automatic background conversion for long-running tasks.\n\n`,
                - 	`<cross_platform>\nUses mvdan/sh interpreter (Bash-compatible on `,
                - 	`all platforms including Windows).\nUse forward slashes for paths`,
                - 	`: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\`,
                - 	`n\n<execution_steps>\n1. Directory Verification: Use LS tool to `,
                - 	`verify parent exists before creating files\n2. Security Check: N`,
                - 	"o restrictions - explain to user. Safe read-only commands execut",
                - 	`e without prompts\n3. Command Execution: Execute with proper quo`,
                - 	`ting, capture output\n4. Auto-Background: Commands >1 minute aut`,
                - 	`omatically move to background, return shell ID\n5. Output Proces`,
                - 	`sing: Truncate if exceeds 30000 characters\n6. Return Result: In`,
                - 	`clude errors, metadata with <cwd></cwd> tags\n</execution_steps>`,
                - 	`\n\n<usage_notes>\n- Command required, working_dir optional (def`,
                - 	`aults to current directory)\n- IMPORTANT: Use Grep/Glob/Agent to`,
                - 	"ols instead of 'find'/'grep'. Use View/LS instead of 'cat'/'head",
                - 	`'/'tail'/'ls'\n- Chain with ';' or '&&', avoid newlines except i`,
                - 	`n quoted strings\n- Each command runs in independent shell (no s`,
                - 	`tate persistence)\n- Prefer absolute paths over 'cd'\n</usage_no`,
                - 	`tes>\n\n<background_execution>\n- Set run_in_background=true for`,
                - 	` separate background shell\n- Returns shell ID for management\n-`,
                - 	` Use job_output tool to view output, job_kill to terminate\n- NE`,
                - 	"VER use `&` at end of commands - use run_in_background parameter",
                - 	`\n- Background: Long servers (npm start, python -m http.server),`,
                - 	` watch tasks, continuous processes\n- Foreground: Builds, tests,`,
                - 	` git ops, file ops, short scripts\n</background_execution>\n\n<g`,
                - 	`it_commits>\nWhen user asks to create git commit:\n\n1. Run: git`,
                - 	" status, git diff, git log (single message, three tool_use block",
                - 	`s)\n2. Add relevant untracked files to staging\n3. Analyze in <c`,
                - 	`ommit_analysis> tags:\n   - List changed files, summarize nature`,
                - 	` (feature/bug fix/refactor/docs)\n   - Draft concise (1-2 senten`,
                - 	`ces) focusing on \"why\" not \"what\"\n   - Use accurate verbs: `,
                - 	`\"add\"=new feature, \"update\"=enhancement, \"fix\"=bug\n4. Cre`,
                - 	"ate commit with attribution:\\n   ```bash\\n   git commit -m \\\"$(c",
                - 	`at &lt;&lt;'EOF'\n   Commit message here.\n\n    Generated w`,
                - 	`ith Crush\n\n\n   Co-Authored-By: Crush <crush@charm.land>\n\n  `,
                - 	" EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, retry ONCE. I",
                - 	`f succeeds but files modified, MUST amend.\n6. Run git status to`,
                - 	` verify.\n\nNotes: Use \"git commit -am\" when possible, don't s`,
                - 	"tage unrelated files, NEVER update config, don't push, no empty ",
                - 	`commits.\n</git_commits>\n\n<pull_requests>\nWhen user asks to c`,
                - 	`reate PR:\n\n1. Run: git status, git diff, check remote tracking`,
                - 	`, git log and 'git diff main...HEAD'\n2. Create branch if needed`,
                - 	`, commit if needed, push with -u if needed\n3. Analyze in <pr_an`,
                - 	`alysis> tags:\n   - List commits since main divergence\n   - Sum`,
                - 	`marize changes, purpose/motivation\n   - Draft concise (1-2 bull`,
                - 	"ets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr cr",
                - 	`eate --title \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summa`,
                - 	`ry\n   &lt;1-3 bullet points>\n   \n   ## Test plan\n   [Checkli`,
                - 	"st...]\\n\\n    Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```",
                - 	`\n\nImportant: Return empty response, never update git config\n<`,
                - 	`/pull_requests>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad:`,
                - 	` cd /foo/bar && pytest tests\n</examples>\n","parameters":{"prop`,
                - 	`erties":{"command":{"description":"The command to execute","type`,
                - 	`":"string"},"description":{"description":"A brief description of`,
                - 	" what the command does, try to keep it under 30 characters or so",
                - 	`","type":"string"},"run_in_background":{"description":"Set to tr`,
                - 	"ue (boolean) to run this command in the background. Use job_outp",
                - 	`ut to read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/update_a_file".
                Diff:
                  strings.Join({
                  	... // 5448 identical bytes
                  	`control":{"type":"ephemeral"}},{"content":"update the main.go fi`,
                  	`le by changing the print to say hello from nexora","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you update the main.go file to change the `,
                - 	`print statement to say \"hello from nexora\". Let me first view `,
                - 	`the current file to see its contents.","tool_calls":[{"id":"view`,
                - 	`:0","function":{"arguments":"{\"file_path\": \"/tmp/nexora-test/`,
                - 	`TestCoderAgent/openrouter-kimi-k2/update_a_file/main.go\"}","nam`,
                - 	`e":"view"},"type":"function"}],"role":"assistant"},{"content":"<`,
                - 	`file>\n     1|package main\n     2|\n     3|import \"fmt\"\n    `,
                - 	` 4|\n     5|func main() {\n     6|\tfmt.Println(\"Hello, Worl`,
                - 	`d!\")\n     7|}\n     8|\n</file>\n\n\n File: 0 KB  showi`,
                - 	`ng lines 1-8 of 8 total (default chunks: 100 lines)","tool_call_`,
                - 	`id":"view:0","role":"tool"},{"content":"Now I'll update the prin`,
                - 	`t statement to say \"hello from nexora\" instead of \"Hello, Wor`,
                - 	`ld!\"","tool_calls":[{"id":"functions.edit:1","function":{"argum`,
                - 	`ents":"{\"file_path\": \"/tmp/nexora-test/TestCoderAgent/openrou`,
                - 	`ter-kimi-k2/update_a_file/main.go\", \"old_string\": \"\\tfmt.Pr`,
                - 	`intln(\\\"Hello, World!\\\")\", \"new_string\": \"\\tfmt.Println`,
                - 	`(\\\"hello from nexora\\\")\"}","name":"edit"},"type":"function"`,
                - 	`}],"role":"assistant"},{"content":"<result>\nContent replaced in`,
                - 	" file: /tmp/nexora-test/TestCoderAgent/openrouter-kimi-k2/update",
                - 	`_a_file/main.go\n</result>\n","tool_call_id":"functions.edit:1",`,
                - 	`"role":"tool"},{"content":"Perfect! I've successfully updated th`,
                - 	`e main.go file. The print statement now says \"hello from nexora`,
                - 	`\" instead of \"Hello, World!\".\n\nLet me verify the change by `,
                - 	`viewing the updated file:","tool_calls":[{"id":"view:2","functio`,
                - 	`n":{"arguments":"{\"file_path\": \"/tmp/nexora-test/TestCoderAge`,
                - 	`nt/openrouter-kimi-k2/update_a_file/main.go\"}","name":"view"},"`,
                - 	`type":"function","cache_control":{"type":"ephemeral"}}],"role":"`,
                - 	`assistant"},{"content":"<file>\n     1|package main\n     2|\n  `,
                - 	`   3|import \"fmt\"\n     4|\tfmt.Println(\"hello from nexora`,
                - 	`\")\n</file>\n\n\n File: 0 KB  showing lines 1-4 of 4 tot`,
                - 	`al (default chunks: 100 lines)","tool_call_id":"view:2","role":"`,
                - 	`tool"}],"model":"moonshotai/kimi-k2-0905","max_tokens":10000,"st`,
                - 	`ream_options":{"include_usage":true},"tool_choice":"auto","tools`,
                - 	`":[{"function":{"name":"bash","strict":false,"description":"Exec`,
                - 	"utes bash commands with automatic background conversion for long",
                - 	`-running tasks.\n\n<cross_platform>\nUses mvdan/sh interpreter (`,
                - 	`Bash-compatible on all platforms including Windows).\nUse forwar`,
                - 	`d slashes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\`,
                - 	`n</cross_platform>\n\n<execution_steps>\n1. Directory Verificati`,
                - 	`on: Use LS tool to verify parent exists before creating files\n2`,
                - 	". Security Check: No restrictions - explain to user. Safe read-o",
                - 	`nly commands execute without prompts\n3. Command Execution: Exec`,
                - 	`ute with proper quoting, capture output\n4. Auto-Background: Com`,
                - 	"mands >1 minute automatically move to background, return shell I",
                - 	`D\n5. Output Processing: Truncate if exceeds 30000 characters\n6`,
                - 	`. Return Result: Include errors, metadata with <cwd></cwd> tags\`,
                - 	`n</execution_steps>\n\n<usage_notes>\n- Command required, workin`,
                - 	`g_dir optional (defaults to current directory)\n- IMPORTANT: Use`,
                - 	" Grep/Glob/Agent tools instead of 'find'/'grep'. Use View/LS ins",
                - 	`tead of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&', avoi`,
                - 	`d newlines except in quoted strings\n- Each command runs in inde`,
                - 	`pendent shell (no state persistence)\n- Prefer absolute paths ov`,
                - 	`er 'cd'\n</usage_notes>\n\n<background_execution>\n- Set run_in_`,
                - 	`background=true for separate background shell\n- Returns shell I`,
                - 	`D for management\n- Use job_output tool to view output, job_kill`,
                - 	" to terminate\\n- NEVER use `&` at end of commands - use run_in_b",
                - 	`ackground parameter\n- Background: Long servers (npm start, pyth`,
                - 	`on -m http.server), watch tasks, continuous processes\n- Foregro`,
                - 	`und: Builds, tests, git ops, file ops, short scripts\n</backgrou`,
                - 	`nd_execution>\n\n<git_commits>\nWhen user asks to create git com`,
                - 	`mit:\n\n1. Run: git status, git diff, git log (single message, t`,
                - 	`hree tool_use blocks)\n2. Add relevant untracked files to stagin`,
                - 	`g\n3. Analyze in <commit_analysis> tags:\n   - List changed file`,
                - 	`s, summarize nature (feature/bug fix/refactor/docs)\n   - Draft `,
                - 	`concise (1-2 sentences) focusing on \"why\" not \"what\"\n   - U`,
                - 	`se accurate verbs: \"add\"=new feature, \"update\"=enhancement, `,
                - 	"\\\"fix\\\"=bug\\n4. Create commit with attribution:\\n   ```bash\\n   ",
                - 	`git commit -m \"$(cat &lt;&lt;'EOF'\n   Commit message here.\n\n`,
                - 	`    Generated with Crush\n\n\n   Co-Authored-By: Crush <crus`,
                - 	"h@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook f",
                - 	`ails, retry ONCE. If succeeds but files modified, MUST amend.\n6`,
                - 	`. Run git status to verify.\n\nNotes: Use \"git commit -am\" whe`,
                - 	"n possible, don't stage unrelated files, NEVER update config, do",
                - 	`n't push, no empty commits.\n</git_commits>\n\n<pull_requests>\n`,
                - 	`When user asks to create PR:\n\n1. Run: git status, git diff, ch`,
                - 	`eck remote tracking, git log and 'git diff main...HEAD'\n2. Crea`,
                - 	`te branch if needed, commit if needed, push with -u if needed\n3`,
                - 	`. Analyze in <pr_analysis> tags:\n   - List commits since main d`,
                - 	`ivergence\n   - Summarize changes, purpose/motivation\n   - Draf`,
                - 	"t concise (1-2 bullets) focusing on \\\"why\\\"\\n4. Create PR:\\n   `",
                - 	"``bash\\n   gh pr create --title \\\"title\\\" --body \\\"$(cat &lt;&lt",
                - 	`;'EOF'\n   ## Summary\n   &lt;1-3 bullet points>\n   \n   ## Tes`,
                - 	`t plan\n   [Checklist...]\n\n    Generated with Crush\n\n   `,
                - 	"EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return empty response, never u",
                - 	`pdate git config\n</pull_requests>\n\n<examples>\nGood: pytest /`,
                - 	`foo/bar/tests\nBad: cd /foo/bar && pytest tests\n</examples>\n",`,
                - 	`"parameters":{"properties":{"command":{"description":"The comman`,
                - 	`d to execute","type":"string"},"description":{"description":"A b`,
                - 	"rief description of what the command does, try to keep it under ",
                - 	`30 characters or so","type":"string"},"run_in_background":{"desc`,
                - 	`ription":"Set to true (boolean) to run this command in the backg`,
                - 	`round. Use job_output to read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:147: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:147
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/update_a_file
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/bash_tool (1.12s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/bash_tool".
                Diff:
                  strings.Join({
                  	... // 9408 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/bash_tool".
                Diff:
                  strings.Join({
                  	... // 5468 identical bytes
                  	`ral"}},{"content":"use bash to create a file named test.txt with`,
                  	` content 'hello bash'. do not print its timestamp","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"functions.bash:0","function":{"arguments":"{`,
                - 	`\"command\": \"echo 'hello bash' > test.txt\", \"description\": `,
                - 	`\"Create test.txt with hello bash content\"}","name":"bash"},"ty`,
                - 	`pe":"function","cache_control":{"type":"ephemeral"}}],"role":"as`,
                - 	`sistant"},{"content":"no output","tool_call_id":"functions.bash:`,
                - 	`0","role":"tool"}],"model":"moonshotai/kimi-k2-0905","max_tokens`,
                - 	`":10000,"stream_options":{"include_usage":true},"tool_choice":"a`,
                - 	`uto","tools":[{"function":{"name":"bash","strict":false,"descrip`,
                - 	`tion":"Executes bash commands with automatic background conversi`,
                - 	`on for long-running tasks.\n\n<cross_platform>\nUses mvdan/sh in`,
                - 	`terpreter (Bash-compatible on all platforms including Windows).\`,
                - 	`nUse forward slashes for paths: \"ls C:/foo/bar\" not \"ls C:\\f`,
                - 	`oo\\bar\".\n</cross_platform>\n\n<execution_steps>\n1. Directory`,
                - 	" Verification: Use LS tool to verify parent exists before creati",
                - 	`ng files\n2. Security Check: No restrictions - explain to user. `,
                - 	`Safe read-only commands execute without prompts\n3. Command Exec`,
                - 	`ution: Execute with proper quoting, capture output\n4. Auto-Back`,
                - 	"ground: Commands >1 minute automatically move to background, ret",
                - 	`urn shell ID\n5. Output Processing: Truncate if exceeds 30000 ch`,
                - 	`aracters\n6. Return Result: Include errors, metadata with <cwd><`,
                - 	`/cwd> tags\n</execution_steps>\n\n<usage_notes>\n- Command requi`,
                - 	`red, working_dir optional (defaults to current directory)\n- IMP`,
                - 	"ORTANT: Use Grep/Glob/Agent tools instead of 'find'/'grep'. Use ",
                - 	`View/LS instead of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or`,
                - 	` '&&', avoid newlines except in quoted strings\n- Each command r`,
                - 	`uns in independent shell (no state persistence)\n- Prefer absolu`,
                - 	`te paths over 'cd'\n</usage_notes>\n\n<background_execution>\n- `,
                - 	`Set run_in_background=true for separate background shell\n- Retu`,
                - 	`rns shell ID for management\n- Use job_output tool to view outpu`,
                - 	"t, job_kill to terminate\\n- NEVER use `&` at end of commands - u",
                - 	`se run_in_background parameter\n- Background: Long servers (npm `,
                - 	"start, python -m http.server), watch tasks, continuous processes",
                - 	`\n- Foreground: Builds, tests, git ops, file ops, short scripts\`,
                - 	`n</background_execution>\n\n<git_commits>\nWhen user asks to cre`,
                - 	`ate git commit:\n\n1. Run: git status, git diff, git log (single`,
                - 	` message, three tool_use blocks)\n2. Add relevant untracked file`,
                - 	`s to staging\n3. Analyze in <commit_analysis> tags:\n   - List c`,
                - 	`hanged files, summarize nature (feature/bug fix/refactor/docs)\n`,
                - 	`   - Draft concise (1-2 sentences) focusing on \"why\" not \"wha`,
                - 	`t\"\n   - Use accurate verbs: \"add\"=new feature, \"update\"=en`,
                - 	"hancement, \\\"fix\\\"=bug\\n4. Create commit with attribution:\\n   `",
                - 	"``bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF'\\n   Commit messag",
                - 	`e here.\n\n    Generated with Crush\n\n\n   Co-Authored-By: `,
                - 	"Crush <crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-co",
                - 	"mmit hook fails, retry ONCE. If succeeds but files modified, MUS",
                - 	`T amend.\n6. Run git status to verify.\n\nNotes: Use \"git commi`,
                - 	`t -am\" when possible, don't stage unrelated files, NEVER update`,
                - 	` config, don't push, no empty commits.\n</git_commits>\n\n<pull_`,
                - 	`requests>\nWhen user asks to create PR:\n\n1. Run: git status, g`,
                - 	"it diff, check remote tracking, git log and 'git diff main...HEA",
                - 	`D'\n2. Create branch if needed, commit if needed, push with -u i`,
                - 	`f needed\n3. Analyze in <pr_analysis> tags:\n   - List commits s`,
                - 	`ince main divergence\n   - Summarize changes, purpose/motivation`,
                - 	`\n   - Draft concise (1-2 bullets) focusing on \"why\"\n4. Creat`,
                - 	"e PR:\\n   ```bash\\n   gh pr create --title \\\"title\\\" --body \\\"$(",
                - 	`cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bullet points>\n   `,
                - 	`\n   ## Test plan\n   [Checklist...]\n\n    Generated with C`,
                - 	"rush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return empty respon",
                - 	`se, never update git config\n</pull_requests>\n\n<examples>\nGoo`,
                - 	`d: pytest /foo/bar/tests\nBad: cd /foo/bar && pytest tests\n</ex`,
                - 	`amples>\n","parameters":{"properties":{"command":{"description":`,
                - 	`"The command to execute","type":"string"},"description":{"descri`,
                - 	`ption":"A brief description of what the command does, try to kee`,
                - 	`p it under 30 characters or so","type":"string"},"run_in_backgro`,
                - 	`und":{"description":"Set to true (boolean) to run this command i`,
                - 	`n the background. Use job_output to read the output later.","typ`,
                - 	`e":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/bash_tool".
                Diff:
                  strings.Join({
                  	... // 5468 identical bytes
                  	`ral"}},{"content":"use bash to create a file named test.txt with`,
                  	` content 'hello bash'. do not print its timestamp","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"functions.bash:0","function":{"arguments":"{`,
                - 	`\"command\": \"echo 'hello bash' > test.txt\", \"description\": `,
                - 	`\"Create test.txt with hello bash content\"}","name":"bash"},"ty`,
                - 	`pe":"function"}],"role":"assistant"},{"content":"no output","too`,
                - 	`l_call_id":"functions.bash:0","role":"tool"},{"tool_calls":[{"id`,
                - 	`":"view:1","function":{"arguments":"{\"file_path\": \"/tmp/nexor`,
                - 	`a-test/TestCoderAgent/openrouter-kimi-k2/bash_tool/test.txt\"}",`,
                - 	`"name":"view"},"type":"function","cache_control":{"type":"epheme`,
                - 	`ral"}}],"role":"assistant"},{"content":"<file>\n     1|hello bas`,
                - 	`h\n     2|\n</file>\n\n\n File: 0 KB  showing lines 1-2 o`,
                - 	`f 2 total (default chunks: 100 lines)","tool_call_id":"view:1","`,
                - 	`role":"tool"}],"model":"moonshotai/kimi-k2-0905","max_tokens":10`,
                - 	`000,"stream_options":{"include_usage":true},"tool_choice":"auto"`,
                - 	`,"tools":[{"function":{"name":"bash","strict":false,"description`,
                - 	`":"Executes bash commands with automatic background conversion f`,
                - 	`or long-running tasks.\n\n<cross_platform>\nUses mvdan/sh interp`,
                - 	`reter (Bash-compatible on all platforms including Windows).\nUse`,
                - 	` forward slashes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\`,
                - 	`bar\".\n</cross_platform>\n\n<execution_steps>\n1. Directory Ver`,
                - 	"ification: Use LS tool to verify parent exists before creating f",
                - 	`iles\n2. Security Check: No restrictions - explain to user. Safe`,
                - 	` read-only commands execute without prompts\n3. Command Executio`,
                - 	`n: Execute with proper quoting, capture output\n4. Auto-Backgrou`,
                - 	"nd: Commands >1 minute automatically move to background, return ",
                - 	`shell ID\n5. Output Processing: Truncate if exceeds 30000 charac`,
                - 	`ters\n6. Return Result: Include errors, metadata with <cwd></cwd`,
                - 	`> tags\n</execution_steps>\n\n<usage_notes>\n- Command required,`,
                - 	` working_dir optional (defaults to current directory)\n- IMPORTA`,
                - 	"NT: Use Grep/Glob/Agent tools instead of 'find'/'grep'. Use View",
                - 	`/LS instead of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&`,
                - 	`', avoid newlines except in quoted strings\n- Each command runs `,
                - 	`in independent shell (no state persistence)\n- Prefer absolute p`,
                - 	`aths over 'cd'\n</usage_notes>\n\n<`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</`,
                  	... // 24990 identical, 1792 removed, and 1545 inserted bytes
                  }, "")
            agent_test.go:199: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:199
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/bash_tool
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/download_tool (0.41s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/download_tool".
                Diff:
                  strings.Join({
                  	`{"messages":[{"content":"`,
                - 	`## CRITICAL: TOOL CALL FORMAT (READ THIS FIRST)\n**ALWAYS use EX`,
                - 	"ACT OpenAI JSON format for tools. NEVER use &lt;tool_call&gt; ta",
                - 	"gs:**\\n\\n```\\n{\\n  \\\"tool_calls\\\": [{\\n    \\\"id\\\": \\\"call_abc123",
                - 	`\",\n    \"type\": \"function\",\n    \"function\": {\n      \"n`,
                - 	`ame\": \"view\",\n      \"arguments\": \"{\\\"file_path\\\":\\\"`,
                - 	"/home/nexora/todo.md\\\\\\\"}\\\"\\n    }\\n  }]\\n}\\n```\\n\\n**Penalty fo",
                - 	`r wrong format: Your response will be ignored!**\n\n## Core Rule`,
                - 	`s\n1. **Read before editing** - Always view files first, match e`,
                - 	`xact formatting\n2. **Be autonomous** - Search, decide, act with`,
                - 	`out asking. Break complex tasks into steps.\n3. **Infer intent**`,
                - 	" - Don't be literal. If a file isn't found, search for similar n",
                - 	"ames (case variations, typos). If a task seems incomplete, compl",
                - 	`ete it fully.\n4. **Test changes** - Run tests immediately after`,
                - 	` modifications\n5. **Be concise** - Keep responses under 4 lines`,
                - 	` unless explaining complex changes\n6. **Exact matches** - White`,
                - 	`space, indentation, line breaks must match perfectly for edits\n`,
                - 	`7. **Never commit** - Unless explicitly asked\n8. **Security fir`,
                - 	`st** - Only assist with defensive security tasks\n\n## Inference`,
                - 	` Examples\n- User says \"read TODO.md\" but it doesn't exist `,
                - 	" Search for `todo.md`, `TODO`, `Todo.md`\\n- User says \\\"fix the ",
                - 	`bug\"  Search for error patterns, recent changes, test failur`,
                - 	`es\n- User says \"add tests\"  Look at existing test patterns`,
                - 	`, create comprehensive tests\n- File not found  Try case vari`,
                - 	`ations, partial matches, ask glob/grep to find it\n\n## Workflow`,
                - 	`\n**Before acting**: Search  Read files  Identify changes `,
                - 	` Edit  Test\n**While acting**: Read entire file first, use`,
                - 	` exact text, include 3-5 lines context, test after each change\n`,
                - 	"**Before finishing**: Verify task complete, run tests, keep resp",
                - 	`onse concise\n\n## Editing Files\n**Critical Requirements**:\n- `,
                - 	`Exact character-by-character matching\n- Include 3-5 surrounding`,
                - 	` lines for reliable context\n- Verify uniqueness (or use replace`,
                - 	"_all=true)\\n\\n**Understanding the 100 Line Limitation**:\\n- `vie",
                - 	"w` tool shows 100 lines at a time: \\\"showing lines 1-100 of 200 ",
                - 	"total\\\"\\n- Use `view` with `offset` parameter: `view file_path=\\",
                - 	"\"/path\\\" offset=100`\\n- Your edits MUST exist in the file, not j",
                - 	`ust in visible 100-line chunk\n\n**Common Failures**:\n- Wrong i`,
                - 	`ndentation: 2 spaces vs 4 spaces\n- Missing blank lines: 1 newli`,
                - 	`ne vs 2 newlines\n- Comment spacing: \"// comment\" vs \"//comme`,
                - 	"nt\\\"\\n\\n**Tab/Display Issues**:\\n- VIEW shows tabs as `\\t\\\\t`",
                - 	" but EDIT needs actual `\\\\t`\\n- Always use `ai_mode=true` (defau",
                - 	`lt) to auto-fix this\n\n**Recovery Steps**:\n1. View file with m`,
                - 	"ore context\\n2. Use `offset` if target outside current window\\n3",
                - 	". Use `grep -n \\\"pattern\\\" file` to find line numbers\\n4. Fallba",
                - 	"ck: Use `write` tool for full file replacement\\n\\n## Tools\\n\\n##",
                - 	"# Available Tools\\n- `view`: Read files with line numbers (100 l",
                - 	"ines at a time - use offset!)\\n- `edit`: Replace text exactly (w",
                - 	"hitespace-sensitive, ai_mode=true by default)\\n- `bash`: Execute",
                - 	" commands\\n- `grep`: Search file contents\\n- `glob`: Find files ",
                - 	"by pattern\\n- `write`: Create/update entire files\\n\\n### When to",
                - 	` use each\n- **View**: Always first to understand file contents\`,
                - 	`n- **Edit**: For precise, targeted changes\n- **Write**: When ex`,
                - 	`act matching fails or for large changes\n- **Bash**: For command`,
                - 	` execution\n- **Grep**: For finding text in files\n- **Glob**: F`,
                - 	`or finding files by name pattern\n\n### When something fails\n- `,
                - 	"**File not found in view**  Use `offset=100`, `offset=200` to",
                - 	` navigate\n- **Edit fails**  View file again, copy exact text`,
                - 	", use `write` as fallback\\n- **Command fails**  Read error, t",
                - 	"ry alternative approach\\n- **Pattern not visible**  Use `grep",
                - 	"` to find line numbers, then view with offset\\n\\n## Testing\\n- R",
                - 	`un relevant tests after every change\n- Fix failures immediately`,
                - 	`\n- Never leave code in broken state\n\n## Decision Making\n**Be`,
                - 	` proactive**: Don't just report problems, solve them.\n**Autonom`,
                - 	"ous decisions**: Search for answers, read patterns, make reasona",
                - 	`ble assumptions\n**Only ask user if**: Truly ambiguous requireme`,
                - 	"nts, potential data loss, or actually blocked after trying alter",
                - 	`natives\n\n## Error Handling\n1. Read complete error message\n2.`,
                - 	` Understand root cause\n3. Try different approach (don't repeat `,
                - 	`same failure)\n4. Search for similar working code\n5. Make targe`,
                - 	`ted fix\n6. Test to verify\n\n## Project Specifics\n\n\n\n## Env`,
                - 	`ironment\nDate/Time: 2025-01-01 00:00:00 UTC\nOS: linux (amd64)\`,
                - 	`nCurrent User: agent\nWorking Directory: /tmp/nexora-test/TestCo`,
                - 	`derAgent/openrouter-kimi-k2/download_tool\n\nGit Repo: no\n\nIns`,
                - 	`talled Runtimes:\n- Python: Python 3.13.7\n- Node.js: v25.2.1\n-`,
                - 	` Go: go1.25.5\n- Shell: bash (mvdan/sh)\n\nSystem Resources:\n- `,
                - 	`Memory: 31Gi total, 23Gi available\n- Disk: 16G total, 15G free\`,
                - 	`n\nTerminal: color, 80x24, interactive\nNetwork: online\nActive `,
                - 	`Services: \n\n## Nexora System Settings\nNexora client system se`,
                - 	"ttings are stored in `~/.local/share/nexora`. This directory con",
                - 	"tains two important files:\\n\\n1. **`nexora.db`** - SQLite databa",
                - 	"se containing session history, configuration settings, and conve",
                - 	"rsation state\\n2. **`mcp.json`** - JSON configuration file for M",
                - 	`CP (Model Context Protocol) settings and server configurations\n`,
                - 	"\\nMCP-related files and configurations are stored in the `mcp.js",
                - 	"on` file, which defines available MCP servers and their connecti",
                - 	`on parameters.\n\n\n\n","role":"system","cache_control":{"type":`,
                - 	`"ephemeral"}},{"content":"download the file from https://example`,
                - 	"-files.online-convert.com/document/txt/example.txt and save it a",
                - 	`s example.txt","role":"user","cache_control":{"type":"ephemeral"`,
                - 	`}}],"model":"moonshotai/kimi-k2-0905","max_tokens":10000,"stream`,
                - 	`_options":{"include_usage":true},"tool_choice":"auto","tools":[{`,
                - 	`"function":{"name":"bash","strict":false,"description":"Executes`,
                - 	" bash commands with automatic background conversion for long-run",
                - 	`ning tasks.\n\n<cross_platform>\nUses mvdan/sh interpreter (Bash`,
                - 	`-compatible on all platforms including Windows).\nUse forward sl`,
                - 	`ashes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</c`,
                - 	`ross_platform>\n\n<execution_steps>\n1. Directory Verification: `,
                - 	`Use LS tool to verify parent exists before creating files\n2. Se`,
                - 	"curity Check: No restrictions - explain to user. Safe read-only ",
                - 	`commands execute without prompts\n3. Command Execution: Execute `,
                - 	`with proper quoting, capture output\n4. Auto-Background: Command`,
                - 	`s >1 minute automatically move to background, return shell ID\n5`,
                - 	`. Output Processing: Truncate if exceeds 30000 characters\n6. Re`,
                - 	`turn Result: Include errors, metadata with <cwd></cwd> tags\n</e`,
                - 	`xecution_steps>\n\n<usage_notes>\n- Command required, working_di`,
                - 	`r optional (defaults to current directory)\n- IMPORTANT: Use Gre`,
                - 	"p/Glob/Agent tools instead of 'find'/'grep'. Use View/LS instead",
                - 	` of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&', avoid ne`,
                - 	`wlines except in quoted strings\n- Each command runs in independ`,
                - 	`ent shell (no state persistence)\n- Prefer absolute paths over '`,
                - 	`cd'\n</usage_notes>\n\n<background_execution>\n- Set run_in_back`,
                - 	`ground=true for separate background shell\n- Returns shell ID fo`,
                - 	`r management\n- Use job_output tool to view output, job_kill to `,
                - 	"terminate\\n- NEVER use `&` at end of commands - use run_in_backg",
                - 	`round parameter\n- Background: Long servers (npm start, python -`,
                - 	`m http.server), watch tasks, continuous processes\n- Foreground:`,
                - 	` Builds, tests, git ops, file ops, short scripts\n</background_e`,
                - 	`xecution>\n\n<git_commits>\nWhen user asks to create git commit:`,
                - 	`\n\n1. Run: git status, git diff, git log (single message, three`,
                - 	` tool_use blocks)\n2. Add relevant untracked files to staging\n3`,
                - 	`. Analyze in <commit_analysis> tags:\n   - List changed files, s`,
                - 	`ummarize nature (feature/bug fix/refactor/docs)\n   - Draft conc`,
                - 	`ise (1-2 sentences) focusing on \"why\" not \"what\"\n   - Use a`,
                - 	`ccurate verbs: \"add\"=new feature, \"update\"=enhancement, \"fi`,
                - 	"x\\\"=bug\\n4. Create commit with attribution:\\n   ```bash\\n   git ",
                - 	"commit -m \\\"$(cat &lt;&lt;'EOF'\\n   Commit message here.\\n\\n   \xf0",
                - 	"\x9f\x92\x98 Generated with Crush\\n\\n\\n   Co-Authored-By: Crush <crush@ch",
                - 	"arm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails",
                - 	`, retry ONCE. If succeeds but files modified, MUST amend.\n6. Ru`,
                - 	`n git status to verify.\n\nNotes: Use \"git commit -am\" when po`,
                - 	"ssible, don't stage unrelated files, NEVER update config, don't ",
                - 	`push, no empty commits.\n</git_commits>\n\n<pull_requests>\nWhen`,
                - 	` user asks to create PR:\n\n1. Run: git status, git diff, check `,
                - 	`remote tracking, git log and 'git diff main...HEAD'\n2. Create b`,
                - 	`ranch if needed, commit if needed, push with -u if needed\n3. An`,
                - 	`alyze in <pr_analysis> tags:\n   - List commits since main diver`,
                - 	`gence\n   - Summarize changes, purpose/motivation\n   - Draft co`,
                - 	"ncise (1-2 bullets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```ba",
                - 	`sh\n   gh pr create --title \"title\" --body \"$(cat &lt;&lt;'EO`,
                - 	`F'\n   ## Summary\n   &lt;1-3 bullet points>\n   \n   ## Test pl`,
                - 	`an\n   [Checklist...]\n\n    Generated with Crush\n\n   EOF\`,
                - 	"n   )\\\"\\n   ```\\n\\nImportant: Return empty response, never updat",
                - 	`e git config\n</pull_requests>\n\n<examples>\nGood: pytest /foo/`,
                - 	`bar/tests\nBad: cd /foo/bar && pytest tests\n</examples>\n","par`,
                - 	`ameters":{"properties":{"command":{"description":"The command to`,
                - 	` execute","type":"string"},"description":{"description":"A brief`,
                - 	" description of what the command does, try to keep it under 30 c",
                - 	`haracters or so","type":"string"},"run_in_background":{"descript`,
                - 	`ion":"Set to true (boolean) to run this command in the backgroun`,
                - 	`d. Use job_output to read the output later.","type":"boolean"},"`,
                - 	`working_dir":{"description":"The working directory to execute th`,
                - 	`e command in (defaults to current directory)","type":"string"}},`,
                - 	`"required":["description","command"],"type":"object"}},"type":"f`,
                - 	`unction"},{"function":{"name":"download","strict":false,"descrip`,
                - 	`tion":"Downloads binary data from URL and saves to local file.\n`,
                - 	`\n<usage>\n- Provide URL to download from\n- Specify local file `,
                - 	`path where content should be saved\n- Optional timeout for reque`,
                - 	`st\n</usage>\n\n<features>\n- Downloads any file type (binary or`,
                - 	` text)\n- Auto-creates parent directories if missing\n- Handles `,
                - 	`large files efficiently with streaming\n- Sets reasonable timeou`,
                - 	`ts to prevent hanging\n- Validates input parameters before reque`,
                - 	`sts\n</features>\n\n<limitations>\n- Max file size: 100MB\n- Onl`,
                - 	`y supports HTTP and HTTPS protocols\n- Cannot handle authenticat`,
                - 	`ion or cookies\n- Some websites may block automated requests\n- `,
                - 	`Will overwrite existing files without warning\n</limitations>\n\`,
                - 	`n<tips>\n- Use absolute paths or paths relative to working direc`,
                - 	`tory\n- Set appropriate timeouts for large files or slow connect`,
                - 	`ions\n</tips>\n","parameters":{"properties":{"file_path":{"descr`,
                - 	`iption":"The local file path where the downloaded content should`,
                - 	` be saved","type":"string"},"timeout":{"description":"Optional t`,
                - 	`imeout in seconds (max 600)","type":"integer"},"url":{"descripti`,
                - 	`on":"The URL to download from","type":"string"}},"required":["ur`,
                - 	`l","file_path"],"type":"object"}},"type":"function"},{"function"`,
                - 	`:{"name":"edit","strict":false,"description":"Edits files by rep`,
                - 	"lacing text, creating new files, or deleting content. For moving",
                - 	`/renaming use Bash 'mv'. For large edits use Write tool.\n\n**Qu`,
                - 	"ick Decision Tree:**\\n1. **Know exact line numbers?**  Use `s",
                - 	"mart_edit` tool (100% reliable)\\n2. **Edit failed once?**  Us",
                - 	"e `write` tool immediately\\n3. **First time editing?**  Enabl",
                - 	`e ai_mode=true\n\n<prerequisites>\n1. **NEVER copy from view too`,
                - 	`l output** - has visual tab indicators (\t) causing failures\`,
                - 	"n2. Use `sed -n 'START,ENDp' file` or `grep -A5 -B5 pattern file",
                - 	"` for EXACT text\\n3. For new files: Use LS tool to verify parent",
                - 	" directory exists\\n4. If you can't extract exact text, use `smar",
                - 	"t_edit` with line numbers\\n</prerequisites>\\n\\n<parameters>\\n1. ",
                - 	`file_path: Absolute path to file (required)\n2. old_string: Text`,
                - 	` to replace (exact match including whitespace/indentation)\n3. n`,
                - 	`ew_string: Replacement text\n4. replace_all: Replace all occurre`,
                - 	`nces (default false)\n</parameters>\n\n<special_cases>\n- Create`,
                - 	` file: provide file_path + new_string, leave old_string empty\n-`,
                - 	" Delete content: provide file_path + old_string, leave new_strin",
                - 	`g empty\n</special_cases>\n\n<critical_requirements>\n**EXACT MA`,
                - 	`TCHING**: Text must match character-for-character\n- Every space`,
                - 	`, tab, blank line, newline, indentation level\n- Comment spacing`,
                - 	" (`// comment` vs `//comment`)\\n- Brace positioning (`func() {` ",
                - 	"vs `func(){`)\\n\\n**UNIQUENESS**: old_string MUST uniquely identi",
                - 	`fy target (when replace_all=false)\n- Include 3-5 lines context `,
                - 	`before/after change point\n- If text appears multiple times, add`,
                - 	` more context or use replace_all=true\n\n**VERIFICATION BEFORE U`,
                - 	`SING**:\n1. View file and locate exact target\n2. Check how many`,
                - 	` instances exist\n3. Copy EXACT text including whitespace\n4. Ve`,
                - 	`rify enough context for unique identification\n5. Double-check i`,
                - 	`ndentation (count spaces/tabs)\n</critical_requirements>\n\n<war`,
                - 	`nings>\nTool fails if:\n- old_string matches multiple locations `,
                - 	`and replace_all=false\n- Whitespace doesn't match exactly\n- Ind`,
                - 	`entation off by even one space\n- Missing or extra blank lines\n`,
                - 	`</warnings>\n\n<recovery_steps>\nIf \"old_string not found\":\n\`,
                - 	"n** DON'T RETRY - Use alternatives:**\\n1. `smart_edit` with ",
                - 	"line numbers (100% reliable)\\n2. Extract exact text: `sed -n '10",
                - 	",20p' file`\\n3. Use `write` tool for full file replacement\\n\\n**",
                - 	` DON'T:**\n- Retry with \"adjusted\" whitespace\n- Copy from `,
                - 	`view output (has artifacts)\n- Guess at whitespace\n\n** DO:*`,
                - 	"*\\n- Use `smart_edit` (line numbers)\\n- Use `sed -n 'X,Yp' file`",
                - 	" for exact text\\n- Use `write` if edit fails once\\n</recovery_st",
                - 	`eps>\n\n<best_practices>\n- View file first, match exact formatt`,
                - 	`ing\n- Use absolute paths with forward slashes (/)\n- Multiple e`,
                - 	`dits to same file: send all in single message\n- Include MORE co`,
                - 	`ntext when uncertain\n- Match existing code style exactly\n</bes`,
                - 	`t_practices>\n\n<examples>\n **Correct**: Exact match with co`,
                - 	"ntext\\n```\\nold_string: \\\"func ProcessData(input string) error {",
                - 	`\\n    if input == \\\"\\\" {\\n        return errors.New(\\\"em`,
                - 	`pty input\\\")\\n    }\\n    return nil\\n}\"\nnew_string: \"fun`,
                - 	`c ProcessData(input string) error {\\n    if input == \\\"\\\" {`,
                - 	`\\n        return errors.New(\\\"empty input\\\")\\n    }\\n    `,
                - 	`if len(input) > 1000 {\\n        return errors.New(\\\"input too`,
                - 	" long\\\\\\\")\\\\n    }\\\\n    return nil\\\\n}\\\"\\n```\\n\\n **Incorrec",
                - 	"t**: Not enough context\\n```\\nold_string: \\\"return nil\\\"  // App",
                - 	"ears many times!\\n```\\n\\n **Incorrect**: Wrong indentation\\n`",
                - 	"``\\nold_string: \\\"  if input == \\\\\\\"\\\\\\\" {\\\"  // 2 spaces\\n// Fi",
                - 	"le actually has: \\\"    if input == \\\\\\\"\\\\\\\" {\\\"  // 4 spaces\\n``",
                - 	"`\\n</examples>\\n\\n## AI Mode\\nUse `ai_mode=true` (default) for a",
                - 	"utomatic fixes:\\n- Converts VIEW tool display tabs (`\\\\t`) to",
                - 	" real tabs (`\\\\t`)\\n- Expands minimal context automatically\\n- E",
                - 	`nhanced error messages\n- Lower failure rate on whitespace issue`,
                - 	`s\n","parameters":{"properties":{"ai_mode":{"description":"Enabl`,
                - 	"e AI-optimized editing with automatic context expansion and impr",
                - 	`oved error handling (DEFAULT: true)","type":"boolean"},"file_pat`,
                - 	`h":{"description":"The absolute path to the file to modify","typ`,
                - 	`e":"string"},"new_string":{"description":"The text to replace it`,
                - 	` with","type":"string"},"old_string":{"description":"The text to`,
                - 	` replace","type":"string"},"replace_all":{"description":"Replace`,
                - 	` all occurrences of old_string (default false)","type":"boolean"`,
                - 	`}},"required":["file_path","old_string","new_string"],"type":"ob`,
                - 	`ject"}},"type":"function"},{"function":{"name":"multiedit","stri`,
                - 	`ct":false,"description":"Makes multiple edits to a single file i`,
                - 	"n one operation. Built on Edit tool for efficient multiple find-",
                - 	"and-replace. Prefer over Edit tool for multiple edits to same fi",
                - 	`le.\n\n<prerequisites>\n1. Use View tool to understand file cont`,
                - 	`ents\n2. Verify directory path is correct\n3. CRITICAL: Note exa`,
                - 	`ct whitespace, indentation from View output\n</prerequisites>\n\`,
                - 	`n<parameters>\n1. file_path: Absolute path to file (required)\n2`,
                - 	`. edits: Array of edit objects (MUST be array, not string!):\n  `,
                - 	" - old_string: Text to replace (exact match including whitespace",
                - 	`)\n   - new_string: Replacement text\n   - replace_all: Replace `,
                - 	`all occurrences (optional, default false)\n   \n    CORRECT: `,
                - 	"`\\\"edits\\\": [{\\\"old_string\\\": \\\"text1\\\", \\\"new_string\\\": \\\"repla",
                - 	"ce1\\\"}]`\\n    INCORRECT: `\\\"edits\\\": \\\"[{\\\\\\\"old_string\\\\\\\": ",
                - 	"\\\\\\\"text1\\\\\\\"}]\\\"` (string, not array)\\n</parameters>\\n\\n<operat",
                - 	`ion>\n- Edits applied sequentially in order\n- Each edit operate`,
                - 	`s on result of previous edit\n- PARTIAL SUCCESS: Failed edits re`,
                - 	`turned, successful edits kept\n- File modified if at least one e`,
                - 	`dit succeeds\n</operation>\n\n<inherited_rules>\n**All Edit tool`,
                - 	` rules apply to each edit:**\n- See edit.md for critical require`,
                - 	`ments, warnings, recovery steps\n- Exact matching for whitespace`,
                - 	`, indentation, blank lines\n- Uniqueness requirements (3-5 lines`,
                - 	` context)\n- Verification checklist before using\n- Use ai_mode=`,
                - 	`true (default) for tab handling\n</inherited_rules>\n\n<critical`,
                - 	`_requirements>\n1. Apply Edit tool rules to EACH edit (see edit.`,
                - 	`md)\n2. Edits applied in order; successful edits kept if later e`,
                - 	`dits fail\n3. Plan sequence: earlier edits change content that l`,
                - 	`ater edits must match\n4. Ensure each old_string unique at appli`,
                - 	`cation time (after prior edits)\n5. Check response for failed ed`,
                - 	`its, retry with corrections\n</critical_requirements>\n\n<verifi`,
                - 	`cation_before_using>\n1. View file, copy exact text (including w`,
                - 	`hitespace) for each target\n2. Check instances of each old_strin`,
                - 	`g BEFORE sequence\n3. Dry-run: after edit #N, will edit #N+1 sti`,
                - 	`ll match?\n4. Prefer fewer, larger context blocks over many tiny`,
                - 	` fragments\n5. If edits independent, consider separate multiedit`,
                - 	` batches\n</verification_before_using>\n\n<warnings>\n- Check re`,
                - 	`sponse for failed edits\n- Earlier edits invalidate later matche`,
                - 	`s (added/removed spaces, lines)\n- Mixed tabs/spaces, trailing s`,
                - 	`paces cause failures\n- replace_all may affect unintended region`,
                - 	`s\n</warnings>\n\n<recovery_steps>\nIf edits fail:\n1. Check res`,
                - 	`ponse metadata for failed edits with errors\n2. View file to see`,
                - 	` current state after successful edits\n3. Adjust failed edits ba`,
                - 	`sed on new content\n4. Retry with corrected old_string values\n5`,
                - 	`. Break complex batches into smaller operations\n</recovery_step`,
                - 	`s>\n\n<best_practices>\n- Result in correct, idiomatic code\n- U`,
                - 	`se absolute file paths (/)\n- Use replace_all only when certain\`,
                - 	`n- Match existing style exactly\n- Review failed edits, retry wi`,
                - 	`th corrections\n</best_practices>\n\n<examples>\n **Correct**`,
                - 	": Sequential edits accounting for changes\\n```\\nedits: [\\n  {\\n ",
                - 	`   old_string: \"func A() {\\n    doOld()\\n}\",\n    new_string`,
                - 	`: \"func A() {\\n    doNew()\\n}\",\n  },\n  {\n    // Context e`,
                - 	`xists AFTER first replacement\n    old_string: \"func B() {\\n  `,
                - 	`  callA()\\n}\",\n    new_string: \"func B() {\\n    callA()\\n `,
                - 	"   logChange()\\\\n}\\\",\\n  },\\n]\\n```\\n\\n **Incorrect**: Second",
                - 	" old_string no longer matches\\n```\\nedits: [\\n  {\\n    old_strin",
                - 	`g: \"func A() {\\n    doOld()\\n}\",\n    new_string: \"func A()`,
                - 	` {\\n\\n    doNew()\\n}\", // Added blank line\n  },\n  {\n    o`,
                - 	`ld_string: \"func A() {\\n    doNew()\\n}\", // Missing blank li`,
                - 	`ne - FAILS\n    new_string: \"func A() {\\n    doNew()\\n    log`,
                - 	"Change()\\\\n}\\\",\\n  },\\n]\\n```\\n</examples>\\n\",\"parameters\":{\"pro",
                - 	`perties":{"edits":{"description":"Array of edit operations to pe`,
                - 	`rform sequentially on the file","items":{"properties":{"new_stri`,
                - 	`ng":{"description":"The text to replace it with","type":"string"`,
                - 	`},"old_string":{"description":"The text to replace","type":"stri`,
                - 	`ng"},"replace_all":{"description":"Replace all occurrences of ol`,
                - 	`d_string (default false).","type":"boolean"}},"required":["old_s`,
                - 	`tring","new_string"],"type":"object"},"type":"array"},"file_path`,
                - 	`":{"description":"The absolute path to the file to modify","type`,
                - 	`":"string"}},"required":["file_path","edits"],"type":"object"}},`,
                - 	`"type":"function"},{"function":{"name":"fetch","strict":false,"d`,
                - 	`escription":"Fetches raw content from URL and returns it in spec`,
                - 	`ified format without any AI processing.\n\n<when_to_use>\nUse th`,
                - 	`is tool when you need:\n- Raw, unprocessed content from a URL\n-`,
                - 	` Direct access to API responses or JSON data\n- HTML/text/markdo`,
                - 	`wn content without interpretation\n- Simple, fast content retrie`,
                - 	`val without analysis\n- To save tokens by avoiding AI processing`,
                - 	`\n\nDO NOT use this tool when you need to:\n- Extract specific i`,
                - 	`nformation from a webpage (use agentic_fetch instead)\n- Answer `,
                - 	`questions about web content (use agentic_fetch instead)\n- Analy`,
                - 	`ze or summarize web pages (use agentic_fetch instead)\n</when_to`,
                - 	`_use>\n\n<usage>\n- Provide URL to fetch content from\n- Specify`,
                - 	` desired output format (text, markdown, or html)\n- Optional tim`,
                - 	`eout for request\n</usage>\n\n<features>\n- Supports three outpu`,
                - 	`t formats: text, markdown, html\n- Auto-handles HTTP redirects\n`,
                - 	`- Fast and lightweight - no AI processing\n- Sets reasonable tim`,
                - 	`eouts to prevent hanging\n- Validates input parameters before re`,
                - 	`quests\n</features>\n\n<limitations>\n- Max response size: 5MB\n`,
                - 	`- Only supports HTTP and HTTPS protocols\n- Cannot handle authen`,
                - 	`tication or cookies\n- Some websites may block automated request`,
                - 	`s\n- Returns raw content only - no analysis or extraction\n</lim`,
                - 	`itations>\n\n<tips>\n- Use text format for plain text content or`,
                - 	` simple API responses\n- Use markdown format for content that sh`,
                - 	`ould be rendered with formatting\n- Use html format when you nee`,
                - 	`d raw HTML structure\n- Set appropriate timeouts for potentially`,
                - 	` slow websites\n- If the user asks to analyze or extract from a `,
                - 	`page, use agentic_fetch instead\n</tips>\n","parameters":{"prope`,
                - 	`rties":{"format":{"description":"The format to return the conten`,
                - 	`t in (text, markdown, or html)","type":"string"},"timeout":{"des`,
                - 	`cription":"Optional timeout in seconds (max 120)","type":"intege`,
                - 	`r"},"url":{"description":"The URL to fetch content from","type":`,
                - 	`"string"}},"required":["url","format"],"type":"object"}},"type":`,
                - 	`"function"},{"function":{"name":"glob","strict":false,"descripti`,
                - 	`on":"Fast file pattern matching tool that finds files by name/pa`,
                - 	"ttern, returning paths sorted by modification time (newest first",
                - 	`).\n\n<usage>\n- Provide glob pattern to match against file path`,
                - 	`s\n- Optional starting directory (defaults to current working di`,
                - 	`rectory)\n- Results sorted with most recently modified files fir`,
                - 	`st\n</usage>\n\n<pattern_syntax>\n- '\\*' matches any sequence o`,
                - 	`f non-separator characters\n- '\\*\\*' matches any sequence incl`,
                - 	`uding separators\n- '?' matches any single non-separator charact`,
                - 	`er\n- '[...]' matches any character in brackets\n- '[!...]' matc`,
                - 	`hes any character not in brackets\n</pattern_syntax>\n\n<example`,
                - 	`s>\n- '*.js' - JavaScript files in current directory\n- '**/*.js`,
                - 	`' - JavaScript files in any subdirectory\n- 'src/**/*.{ts,tsx}' `,
                - 	`- TypeScript files in src directory\n- '*.{html,css,js}' - HTML,`,
                - 	` CSS, and JS files\n</examples>\n\n<limitations>\n- Results limi`,
                - 	`ted to 100 files (newest first)\n- Does not search file contents`,
                - 	` (use Grep for that)\n- Hidden files (starting with '.') skipped`,
                - 	`\n</limitations>\n\n<cross_platform>\n- Path separators handled `,
                - 	`automatically (/ and \\ work)\n- Uses ripgrep (rg) if available,`,
                - 	` otherwise Go implementation\n- Patterns should use forward slas`,
                - 	`hes (/) for compatibility\n</cross_platform>\n\n<tips>\n- Combin`,
                - 	`e with Grep: find files with Glob, search contents with Grep\n- `,
                - 	"For iterative exploration requiring multiple searches, consider ",
                - 	`Agent tool\n- Check if results truncated and refine pattern if n`,
                - 	`eeded\n</tips>\n","parameters":{"properties":{"path":{"descripti`,
                - 	`on":"The directory to search in. Defaults to the current working`,
                - 	` directory.","type":"string"},"pattern":{"description":"The glob`,
                - 	` pattern to match files against","type":"string"}},"required":["`,
                - 	`pattern"],"type":"object"}},"type":"function"},{"function":{"nam`,
                - 	`e":"grep","strict":false,"description":"Fast content search tool`,
                - 	" that finds files containing specific text/patterns, returning m",
                - 	`atching paths sorted by modification time (newest first).\n\n<us`,
                - 	`age>\n- Provide regex pattern to search within file contents\n- `,
                - 	"Set literal_text=true for exact text with special characters (re",
                - 	`commended for non-regex users)\n- Optional starting directory (d`,
                - 	`efaults to current working directory)\n- Optional include patter`,
                - 	`n to filter which files to search\n- Results sorted with most re`,
                - 	`cently modified files first\n</usage>\n\n<regex_syntax>\nWhen li`,
                - 	`teral_text=false (supports standard regex):\n\n- 'function' sear`,
                - 	`ches for literal text \"function\"\n- 'log\\..\\*Error' finds te`,
                - 	`xt starting with \"log.\" and ending with \"Error\"\n- 'import\\`,
                - 	`s+.\\*\\s+from' finds import statements in JavaScript/TypeScript`,
                - 	`\n</regex_syntax>\n\n<include_patterns>\n- '\\*.js' - Only searc`,
                - 	`h JavaScript files\n- '\\*.{ts,tsx}' - Only search TypeScript fi`,
                - 	`les\n- '\\*.go' - Only search Go files\n</include_patterns>\n\n<`,
                - 	`limitations>\n- Results limited to 100 files (newest first)\n- P`,
                - 	`erformance depends on number of files searched\n- Very large bin`,
                - 	`ary files may be skipped\n- Hidden files (starting with '.') ski`,
                - 	`pped\n</limitations>\n\n<ignore_support>\n- Respects .gitignore `,
                - 	`patterns to skip ignored files/directories\n- Respects .nexoraig`,
                - 	`nore patterns for additional ignore rules\n- Both ignore files a`,
                - 	`uto-detected in search root directory\n</ignore_support>\n\n<cro`,
                - 	`ss_platform>\n- Uses ripgrep (rg) if available for better perfor`,
                - 	`mance\n- Falls back to Go implementation if ripgrep unavailable\`,
                - 	`n- File paths normalized automatically for compatibility\n</cros`,
                - 	`s_platform>\n\n<tips>\n- For faster searches: use Glob to find r`,
                - 	`elevant files first, then Grep\n- For iterative exploration requ`,
                - 	`iring multiple searches, consider Agent tool\n- Check if results`,
                - 	` truncated and refine search pattern if needed\n- Use literal_te`,
                - 	"xt=true for exact text with special characters (dots, parenthese",
                - 	`s, etc.)\n</tips>\n","parameters":{"properties":{"include":{"des`,
                - 	`cription":"File pattern to include in the search (e.g. \"*.js\",`,
                - 	` \"*.{ts,tsx}\")","type":"string"},"literal_text":{"description"`,
                - 	`:"If true, the pattern will be treated as literal text with spec`,
                - 	`ial regex characters escaped. Default is false.","type":"boolean`,
                - 	`"},"path":{"description":"The directory to search in. Defaults t`,
                - 	`o the current working directory.","type":"string"},"pattern":{"d`,
                - 	`escription":"The regex pattern to search for in file contents","`,
                - 	`type":"string"}},"required":["pattern"],"type":"object"}},"type"`,
                - 	`:"function"},{"function":{"name":"ls","strict":false,"descriptio`,
                - 	`n":"Shows files and subdirectories in tree structure for explori`,
                - 	`ng project organization.\n\n<usage>\n- Provide path to list (def`,
                - 	`aults to current working directory)\n- Optional glob patterns to`,
                - 	` ignore\n- Results displayed in tree structure\n</usage>\n\n<fea`,
                - 	`tures>\n- Hierarchical view of files and directories\n- Auto-ski`,
                - 	`ps hidden files/directories (starting with '.')\n- Skips common `,
                - 	`system directories like __pycache__\n- Can filter files matching`,
                - 	` specific patterns\n</features>\n\n<limitations>\n- Results limi`,
                - 	`ted to 1000 files\n- Large directories truncated\n- No file size`,
                - 	`s or permissions shown\n- Cannot recursively list all directorie`,
                - 	`s in large projects\n</limitations>\n\n<cross_platform>\n- Hidde`,
                - 	`n file detection uses Unix convention (files starting with '.')\`,
                - 	"n- Windows hidden files (with hidden attribute) not auto-skipped",
                - 	`\n- Common Windows directories (System32, Program Files) not in `,
                - 	`default ignore\n- Path separators handled automatically (/ and \`,
                - 	`\ work)\n</cross_platform>\n\n<tips>\n- Use Glob for finding fil`,
                - 	`es by name patterns instead of browsing\n- Use Grep for searchin`,
                - 	`g file contents\n- Combine with other tools for effective explor`,
                - 	`ation\n</tips>\n","parameters":{"properties":{"depth":{"descript`,
                - 	`ion":"The maximum depth to traverse","type":"integer"},"ignore":`,
                - 	`{"description":"List of glob patterns to ignore","items":{"type"`,
                - 	`:"string"},"type":"array"},"path":{"description":"The path to th`,
                - 	`e directory to list (defaults to current working directory)","ty`,
                - 	`pe":"string"}},"required":[],"type":"object"}},"type":"function"`,
                - 	`},{"function":{"name":"sourcegraph","strict":false,"description"`,
                - 	`:"Search code across public repositories using Sourcegraph's Gra`,
                - 	`phQL API.\n\n<usage>\n- Provide search query using Sourcegraph s`,
                - 	`yntax\n- Optional result count (default: 10, max: 20)\n- Optiona`,
                - 	`l timeout for request\n</usage>\n\n<basic_syntax>\n- \"fmt.Print`,
                - 	`ln\" - exact matches\n- \"file:.go fmt.Println\" - limit to Go f`,
                - 	`iles\n- \"repo:^github\\.com/golang/go$ fmt.Println\" - specific`,
                - 	` repos\n- \"lang:go fmt.Println\" - limit to Go code\n- \"fmt.Pr`,
                - 	`intln AND log.Fatal\" - combined terms\n- \"fmt\\.(Print|Printf|`,
                - 	`Println)\" - regex patterns\n- \"\\\"exact phrase\\\"\" - exact `,
                - 	`phrase matching\n- \"-file:test\" or \"-repo:forks\" - exclude m`,
                - 	`atches\n</basic_syntax>\n\n<key_filters>\nRepository: repo:name,`,
                - 	" repo:^exact$, repo:org/repo@branch, -repo:exclude, fork:yes, ar",
                - 	`chived:yes, visibility:public\nFile: file:\\.js$, file:internal/`,
                - 	`, -file:test, file:has.content(text)\nContent: content:\"exact\"`,
                - 	`, -content:\"unwanted\", case:yes\nType: type:symbol, type:file,`,
                - 	` type:path, type:diff, type:commit\nTime: after:\"1 month ago\",`,
                - 	` before:\"2023-01-01\", author:name, message:\"fix\"\nResult: se`,
                - 	`lect:repo, select:file, select:content, count:100, timeout:30s\n`,
                - 	`</key_filters>\n\n<examples>\n- \"file:.go context.WithTimeout\"`,
                - 	` - Go code using context.WithTimeout\n- \"lang:typescript useSta`,
                - 	`te type:symbol\" - TypeScript React useState hooks\n- \"repo:^gi`,
                - 	`thub\\.com/kubernetes/kubernetes$ pod list type:file\" - Kuberne`,
                - 	`tes pod files\n- \"file:Dockerfile (alpine OR ubuntu) -content:a`,
                - 	`lpine:latest\" - Dockerfiles with base images\n</examples>\n\n<b`,
                - 	`oolean_operators>\n- \"term1 AND term2\" - both terms\n- \"term1`,
                - 	` OR term2\" - either term\n- \"term1 NOT term2\" - term1 but not`,
                - 	` term2\n- \"term1 and (term2 or term3)\" - grouping with parenth`,
                - 	`eses\n</boolean_operators>\n\n<limitations>\n- Only searches pub`,
                - 	`lic repositories\n- Rate limits may apply\n- Complex queries tak`,
                - 	`e longer\n- Max 20 results per query\n</limitations>\n\n<tips>\n`,
                - 	`- Use specific file extensions to narrow results\n- Add repo: fi`,
                - 	`lters for targeted searches\n- Use type:symbol for function/meth`,
                - 	`od definitions\n- Use type:file to find relevant files\n</tips>\`,
                - 	`n","parameters":{"properties":{"context_window":{"description":"`,
                - 	`The context around the match to return (default: 10 lines)","typ`,
                - 	`e":"integer"},"count":{"description":"Optional number of results`,
                - 	` to return (default: 10, max: 20)","type":"integer"},"query":{"d`,
                - 	`escription":"The Sourcegraph search query","type":"string"},"tim`,
                - 	`eout":{"description":"Optional timeout in seconds (max 120)","ty`,
                - 	`pe":"integer"}},"required":["query"],"type":"object"}},"type":"f`,
                - 	`unction"},{"function":{"name":"view","strict":false,"description`,
                - 	`":"Reads and displays file contents with line numbers for examin`,
                - 	`ing code, logs, or text data.\n\n<usage>\n- Provide file path to`,
                - 	` read\n- Optional offset: start reading from specific line (0-ba`,
                - 	`sed)\n- Optional limit: control lines read (default 100)\n- Don'`,
                - 	`t use for directories (use LS tool instead)\n- Supports image fi`,
                - 	`les (PNG, JPEG, GIF, BMP, SVG, WebP)\n</usage>\n\n<features>\n- `,
                - 	`Displays contents with line numbers\n- Can read from any file po`,
                - 	`sition using offset\n- Handles large files by limiting lines rea`,
                - 	`d\n- Auto-truncates very long lines for display\n- Suggests simi`,
                - 	`lar filenames when file not found\n- Renders image files directl`,
                - 	`y in terminal\n</features>\n\n<limitations>\n- Max file size: 5M`,
                - 	`B\n- Default limit: 100 lines (reduced to prevent context window`,
                - 	` issues)\n- Lines >2000 chars truncated\n- Binary files (except `,
                - 	`images) cannot be displayed\n</limitations>\n\n<cross_platform>\`,
                - 	`n- Handles Windows (CRLF) and Unix (LF) line endings\n- Works wi`,
                - 	`th forward slashes (/) and backslashes (\\)\n- Auto-detects text`,
                - 	` encoding for common formats\n</cross_platform>\n\n<tips>\n- Use`,
                - 	` with Glob to find files first\n- For code exploration: Grep to `,
                - 	`find relevant files, then View to examine\n- For large files: us`,
                - 	`e offset and limit parameters for specific sections\n- The tool `,
                - 	"uses smaller chunks (100 lines default) to manage context window",
                - 	` efficiently\n- For very large files, consider using 'head' or '`,
                - 	`tail' commands via bash tool\n- View tool automatically detects `,
                - 	`and renders image files\n</tips>\n","parameters":{"properties":{`,
                - 	`"file_path":{"description":"The path to the file to read","type"`,
                - 	`:"string"},"limit":{"description":"The number of lines to read (`,
                - 	`defaults to 2000)","type":"integer"},"offset":{"description":"Th`,
                - 	`e line number to start reading from (0-based)","type":"integer"}`,
                - 	`},"required":["file_path"],"type":"object"}},"type":"function"},`,
                - 	`{"function":{"name":"write","strict":false,"description":"Create`,
                - 	"s or updates files in filesystem for saving/modifying text conte",
                - 	`nt.\n\n<usage>\n- Provide file path to write\n- Include content `,
                - 	`to write to file\n- Tool creates necessary parent directories au`,
                - 	`tomatically\n</usage>\n\n<features>\n- Creates new files or over`,
                - 	`writes existing ones\n- Auto-creates parent directories if missi`,
                - 	`ng\n- Checks if file modified since last read for safety\n- Avoi`,
                - 	`ds unnecessary writes when content unchanged\n</features>\n\n<li`,
                - 	`mitations>\n- Read file before writing to avoid conflicts\n- Can`,
                - 	`not append (rewrites entire file)\n</limitations>\n\n<cross_plat`,
                - 	`form>\n- Use forward slashes (/) for compatibility\n</cross_plat`,
                - 	`form>\n\n<tips>\n- Use View tool first to examine existing files`,
                - 	` before modifying\n- Use LS tool to verify location when creatin`,
                - 	`g new files\n- Combine with Glob/Grep to find and modify multipl`,
                - 	`e files\n- Include descriptive comments when changing existing c`,
                - 	`ode\n</tips>\n","parameters":{"properties":{"content":{"descript`,
                - 	`ion":"The content to write to the file","type":"string"},"file_p`,
                - 	`ath":{"description":"The path to the file to write","type":"stri`,
                - 	`ng"}},"required":["file_path","content"],"type":"object"}},"type`,
                - 	`":"function"}]`,
                + 	"you will generate a short title based on the first message a use",
                + 	`r begins a conversation with\n\n<rules>\n- ensure it is not more`,
                + 	` than 50 characters long\n- the title should be a summary of the`,
                + 	` user's message\n- it should be one line long\n- do not use quot`,
                + 	`es or colons\n- the entire text you return will be used as the t`,
                + 	`itle\n- never return anything that is more than one sentence (on`,
                + 	`e line) long\n</rules>\n\n /no_think","role":"system"},{"content`,
                + 	`":"Generate a concise title for the following content:\n\ndownlo`,
                + 	"ad the file from https://example-files.online-convert.com/docume",
                + 	`nt/txt/example.txt and save it as example.txt\n <think>\n\n</thi`,
                + 	`nk>","role":"user"}],"model":"qwen/qwen3-next-80b-a3b-instruct",`,
                + 	`"max_tokens":40,"stream_options":{"include_usage":true}`,
                  	... // 40 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/download_tool".
                Diff:
                  strings.Join({
                  	... // 9433 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/download_tool".
                Diff:
                  strings.Join({
                  	... // 5493 identical bytes
                  	"wnload the file from https://example-files.online-convert.com/do",
                  	`cument/txt/example.txt and save it as example.txt","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll download the file from the specified URL and sa`,
                - 	`ve it as example.txt.","tool_calls":[{"id":"functions.download:0`,
                - 	`","function":{"arguments":"{\"file_path\": \"example.txt\", \"ur`,
                - 	`l\": \"https://example-files.online-convert.com/document/txt/exa`,
                - 	`mple.txt\"}","name":"download"},"type":"function","cache_control`,
                - 	`":{"type":"ephemeral"}}],"role":"assistant"},{"content":"Success`,
                - 	"fully downloaded 2574 bytes to example.txt (Content-Type: text/p",
                - 	`lain; charset=UTF-8)","tool_call_id":"functions.download:0","rol`,
                - 	`e":"tool"}],"model":"moonshotai/kimi-k2-0905","max_tokens":10000`,
                - 	`,"stream_options":{"include_usage":true},"tool_choice":"auto","t`,
                - 	`ools":[{"function":{"name":"bash","strict":false,"description":"`,
                - 	"Executes bash commands with automatic background conversion for ",
                - 	`long-running tasks.\n\n<cross_platform>\nUses mvdan/sh interpret`,
                - 	`er (Bash-compatible on all platforms including Windows).\nUse fo`,
                - 	`rward slashes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar`,
                - 	`\".\n</cross_platform>\n\n<execution_steps>\n1. Directory Verifi`,
                - 	"cation: Use LS tool to verify parent exists before creating file",
                - 	`s\n2. Security Check: No restrictions - explain to user. Safe re`,
                - 	`ad-only commands execute without prompts\n3. Command Execution: `,
                - 	`Execute with proper quoting, capture output\n4. Auto-Background:`,
                - 	" Commands >1 minute automatically move to background, return she",
                - 	`ll ID\n5. Output Processing: Truncate if exceeds 30000 character`,
                - 	`s\n6. Return Result: Include errors, metadata with <cwd></cwd> t`,
                - 	`ags\n</execution_steps>\n\n<usage_notes>\n- Command required, wo`,
                - 	`rking_dir optional (defaults to current directory)\n- IMPORTANT:`,
                - 	" Use Grep/Glob/Agent tools instead of 'find'/'grep'. Use View/LS",
                - 	` instead of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&', `,
                - 	`avoid newlines except in quoted strings\n- Each command runs in `,
                - 	`independent shell (no state persistence)\n- Prefer absolute path`,
                - 	`s over 'cd'\n</usage_notes>\n\n<background_execution>\n- Set run`,
                - 	`_in_background=true for separate background shell\n- Returns she`,
                - 	`ll ID for management\n- Use job_output tool to view output, job_`,
                - 	"kill to terminate\\n- NEVER use `&` at end of commands - use run_",
                - 	`in_background parameter\n- Background: Long servers (npm start, `,
                - 	`python -m http.server), watch tasks, continuous processes\n- For`,
                - 	`eground: Builds, tests, git ops, file ops, short scripts\n</back`,
                - 	`ground_execution>\n\n<git_commits>\nWhen user asks to create git`,
                - 	` commit:\n\n1. Run: git status, git diff, git log (single messag`,
                - 	`e, three tool_use blocks)\n2. Add relevant untracked files to st`,
                - 	`aging\n3. Analyze in <commit_analysis> tags:\n   - List changed `,
                - 	`files, summarize nature (feature/bug fix/refactor/docs)\n   - Dr`,
                - 	`aft concise (1-2 sentences) focusing on \"why\" not \"what\"\n  `,
                - 	` - Use accurate verbs: \"add\"=new feature, \"update\"=enhanceme`,
                - 	"nt, \\\"fix\\\"=bug\\n4. Create commit with attribution:\\n   ```bash\\",
                - 	`n   git commit -m \"$(cat &lt;&lt;'EOF'\n   Commit message here.`,
                - 	`\n\n    Generated with Crush\n\n\n   Co-Authored-By: Crush <`,
                - 	"crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit ho",
                - 	"ok fails, retry ONCE. If succeeds but files modified, MUST amend",
                - 	`.\n6. Run git status to verify.\n\nNotes: Use \"git commit -am\"`,
                - 	" when possible, don't stage unrelated files, NEVER update config",
                - 	`, don't push, no empty commits.\n</git_commits>\n\n<pull_request`,
                - 	`s>\nWhen user asks to create PR:\n\n1. Run: git status, git diff`,
                - 	`, check remote tracking, git log and 'git diff main...HEAD'\n2. `,
                - 	"Create branch if needed, commit if needed, push with -u if neede",
                - 	`d\n3. Analyze in <pr_analysis> tags:\n   - List commits since ma`,
                - 	`in divergence\n   - Summarize changes, purpose/motivation\n   - `,
                - 	`Draft concise (1-2 bullets) focusing on \"why\"\n4. Create PR:\n`,
                - 	"   ```bash\\n   gh pr create --title \\\"title\\\" --body \\\"$(cat &lt",
                - 	`;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bullet points>\n   \n   ##`,
                - 	` Test plan\n   [Checklist...]\n\n    Generated with Crush\n\`,
                - 	"n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return empty response, nev",
                - 	`er update git config\n</pull_requests>\n\n<examples>\nGood: pyte`,
                - 	`st /foo/bar/tests\nBad: cd /foo/bar && pytest tests\n</examples>`,
                - 	`\n","parameters":{"properties":{"command":{"description":"The co`,
                - 	`mmand to execute","type":"string"},"description":{"description":`,
                - 	`"A brief description of what the command does, try to keep it un`,
                - 	`der 30 characters or so","type":"string"},"run_in_background":{"`,
                - 	`description":"Set to true (boolean) to run this command in the b`,
                - 	`ackground. Use job_output to read the output later.","type":"boo`,
                - 	"lean",
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:243: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:243
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/download_tool
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/fetch_tool (0.37s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/fetch_tool".
                Diff:
                  strings.Join({
                  	... // 9451 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/fetch_tool".
                Diff:
                  strings.Join({
                  	... // 5511 identical bytes
                  	"https://example-files.online-convert.com/website/html/example.ht",
                  	`ml and tell me if it contains the word 'John Doe'","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll fetch the content from that URL and check if it`,
                - 	` contains \"John Doe\".","tool_calls":[{"id":"functions.fetch:0"`,
                - 	`,"function":{"arguments":"{\"url\": \"https://example-files.onli`,
                - 	`ne-convert.com/website/html/example.html\", \"format\": \"text\"`,
                - 	`}","name":"fetch"},"type":"function","cache_control":{"type":"ep`,
                - 	`hemeral"}}],"role":"assistant"},{"content":"HTML test file Purpo`,
                - 	"se: Provide example of this file type Document file type: HTML V",
                - 	`ersion: 1.0 Remark: Example content: The names \"John Doe\" for `,
                - 	`males, \"Jane Doe\" or \"Jane Roe\" for females, or \"Jonnie Doe`,
                - 	`\" and \"Janie Doe\" for children, or just \"Doe\" non-gender-sp`,
                - 	"ecifically are used as placeholder names for a party whose true ",
                - 	"identity is unknown or must be withheld in a legal action, case,",
                - 	" or discussion. The names are also used to refer to acorpse or h",
                - 	"ospital patient whose identity is unknown. This practice is wide",
                - 	"ly used in the United States and Canada, but is rarely used in o",
                - 	"ther English-speaking countries including the United Kingdom its",
                - 	`elf, from where the use of \"John Doe\" in a legal context origi`,
                - 	"nates. The names Joe Bloggs or John Smith are used in the UK ins",
                - 	"tead, as well as in Australia and New Zealand. John Doe is somet",
                - 	"imes used to refer to a typical male in other contexts as well, ",
                - 	"in a similar manner to John Q. Public, known in Great Britain as",
                - 	" Joe Public, John Smith or Joe Bloggs. For example, the first na",
                - 	"me listed on a form is often John Doe, along with a fictional ad",
                - 	"dress or other fictional information to provide an example of ho",
                - 	"w to fill in the form. The name is also used frequently in popul",
                - 	"ar culture, for example in the Frank Capra film Meet John Doe. J",
                - 	"ohn Doe was also the name of a 2002 American television series. ",
                - 	"Similarly, a child or baby whose identity is unknown may be refe",
                - 	"rred to as Baby Doe. A notorious murder case in Kansas City, Mis",
                - 	"souri, referred to the baby victim as Precious Doe. Other uniden",
                - 	"tified female murder victims are Cali Doe and Princess Doe. Addi",
                - 	"tional persons may be called James Doe, Judy Doe, etc. However, ",
                - 	"to avoid possible confusion, if two anonymous or unknown parties",
                - 	" are cited in a specific case or action, the surnames Doe and Ro",
                - 	`e may be used simultaneously; for example, \"John Doe v. Jane Ro`,
                - 	`e\". If several anonymous parties are referenced, they may simpl`,
                - 	"y be labelled John Doe #1, John Doe #2, etc. (the U.S. Operation",
                - 	` Delego cited 21 (numbered) \"John Doe\"s) or labelled with othe`,
                - 	"r variants of Doe / Roe / Poe / etc. Other early alternatives su",
                - 	"ch as John Stiles and Richard Miles are now rarely used, and Mar",
                - 	"y Major has been used in some American federal cases. File creat",
                - 	"ed by https://www.online-convert.com More example files: https:/",
                - 	`/www.online-convert.com/file-type Text of \"Example content\": W`,
                - 	"ikipedia License: Attribution-ShareAlike 3.0 Unported Feel free ",
                - 	`to use and share the file according to license above.","tool_cal`,
                - 	`l_id":"functions.fetch:0","role":"tool"}],"model":"moonshotai/ki`,
                - 	`mi-k2-0905","max_tokens":10000,"stream_options":{"include_usage"`,
                - 	`:true},"tool_choice":"auto","tools":[{"function":{"name":"bash",`,
                - 	`"strict":false,"description":"Executes bash commands with automa`,
                - 	`tic background conversion for long-running tasks.\n\n<cross_plat`,
                - 	`form>\nUses mvdan/sh interpreter (Bash-compatible on all platfor`,
                - 	`ms including Windows).\nUse forward slashes for paths: \"ls C:/f`,
                - 	`oo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<executi`,
                - 	`on_steps>\n1. Directory Verification: Use LS tool to verify pare`,
                - 	`nt exists before creating files\n2. Security Check: No restricti`,
                - 	"ons - explain to user. Safe read-only commands execute without p",
                - 	`rompts\n3. Command Execution: Execute with proper quoting, captu`,
                - 	`re output\n4. Auto-Background: Commands >1 minute automatically `,
                - 	`move to background, return shell ID\n5. Output Processing: Trunc`,
                - 	`ate if exceeds 30000 characters\n6. Return Result: Include error`,
                - 	`s, metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_`,
                - 	`notes>\n- Command required, working_dir optional (defaults to cu`,
                - 	`rrent directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead`,
                - 	" of 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'l",
                - 	`s'\n- Chain with ';' or '&&', avoid newlines except in quoted st`,
                - 	`rings\n- Each command runs in independent shell (no state persis`,
                - 	`tence)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<ba`,
                - 	`ckground_execution>\n- Set run_in_background=true for separate b`,
                - 	`ackground shell\n- Returns shell ID for management\n- Use job_ou`,
                - 	"tput tool to view output, job_kill to terminate\\n- NEVER use `&`",
                - 	` at end of commands - use run_in_background parameter\n- Backgro`,
                - 	"und: Long servers (npm start, python -m http.server), watch task",
                - 	`s, continuous processes\n- Foreground: Builds, tests, git ops, f`,
                - 	`ile ops, short scripts\n</background_execution>\n\n<git_commits>`,
                - 	`\nWhen user asks to create git commit:\n\n1. Run: git status, gi`,
                - 	`t diff, git log (single message, three tool_use blocks)\n2. Add `,
                - 	`relevant untracked files to staging\n3. Analyze in <commit_analy`,
                - 	`sis> tags:\n   - List changed files, summarize nature (feature/b`,
                - 	`ug fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusi`,
                - 	`ng on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new`,
                - 	` feature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit `,
                - 	"with attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;",
                - 	`'EOF'\n   Commit message here.\n\n    Generated with Crush\n`,
                - 	`\n\n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\`,
                - 	"\"\\n   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds ",
                - 	`but files modified, MUST amend.\n6. Run git status to verify.\n\`,
                - 	`nNotes: Use \"git commit -am\" when possible, don't stage unrela`,
                - 	`ted files, NEVER update config, don't push, no empty commits.\n<`,
                - 	`/git_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n`,
                - 	`\n1. Run: git status, git diff, check remote tracking, git log a`,
                - 	`nd 'git diff main...HEAD'\n2. Create branch if needed, commit if`,
                - 	` needed, push with -u if needed\n3. Analyze in <pr_analysis> tag`,
                - 	`s:\n   - List commits since main divergence\n   - Summarize chan`,
                - 	`ges, purpose/motivation\n   - Draft concise (1-2 bullets) focusi`,
                - 	"ng on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --titl",
                - 	`e \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;`,
                - 	`1-3 bullet points>\n   \n   ## Test plan\n   [Checklist...]\n\n `,
                - 	"   Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImporta",
                - 	`nt: Return empty response, never update git config\n</pull_reque`,
                - 	`sts>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/ba`,
                - 	`r && pytest tests\n</examples>\n","parameters":{"properties":{"c`,
                - 	`ommand":{"description":"The command to execute","type":"string"}`,
                - 	`,"description":{"description":"A brief description of what the c`,
                - 	`ommand does, try to keep it under 30 characters or so","type":"s`,
                - 	`tring"},"run_in_background":{"description":"Set to true (boolean`,
                - 	") to run this command in the background. Use job_output to read ",
                - 	`the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:286: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:286
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/fetch_tool
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/glob_tool (0.37s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/glob_tool".
                Diff:
                  strings.Join({
                  	... // 9369 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/glob_tool".
                Diff:
                  strings.Join({
                  	... // 5429 identical bytes
                  	`system","cache_control":{"type":"ephemeral"}},{"content":"use gl`,
                  	`ob to find all .go files in the current directory","role":"user"`,
                - 	"}",
                  	",",
                - 	"{\"content\":\"I'll use the glob tool to find all `.go` files in th",
                - 	`e current directory.","tool_calls":[{"id":"functions.glob:0","fu`,
                - 	`nction":{"arguments":"{\"pattern\":\"*.go\"}","name":"glob"},"ty`,
                - 	`pe":"function","cache_control":{"type":"ephemeral"}}],"role":"as`,
                - 	`sistant"},{"content":"/tmp/nexora-test/TestCoderAgent/openrouter`,
                - 	`-kimi-k2/glob_tool/main.go","tool_call_id":"functions.glob:0","r`,
                - 	`ole":"tool"}],"model":"moonshotai/kimi-k2-0905","max_tokens":100`,
                - 	`00,"stream_options":{"include_usage":true},"tool_choice":"auto",`,
                - 	`"tools":[{"function":{"name":"bash","strict":false,"description"`,
                - 	`:"Executes bash commands with automatic background conversion fo`,
                - 	`r long-running tasks.\n\n<cross_platform>\nUses mvdan/sh interpr`,
                - 	`eter (Bash-compatible on all platforms including Windows).\nUse `,
                - 	`forward slashes for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\b`,
                - 	`ar\".\n</cross_platform>\n\n<execution_steps>\n1. Directory Veri`,
                - 	"fication: Use LS tool to verify parent exists before creating fi",
                - 	`les\n2. Security Check: No restrictions - explain to user. Safe `,
                - 	`read-only commands execute without prompts\n3. Command Execution`,
                - 	`: Execute with proper quoting, capture output\n4. Auto-Backgroun`,
                - 	"d: Commands >1 minute automatically move to background, return s",
                - 	`hell ID\n5. Output Processing: Truncate if exceeds 30000 charact`,
                - 	`ers\n6. Return Result: Include errors, metadata with <cwd></cwd>`,
                - 	` tags\n</execution_steps>\n\n<usage_notes>\n- Command required, `,
                - 	`working_dir optional (defaults to current directory)\n- IMPORTAN`,
                - 	"T: Use Grep/Glob/Agent tools instead of 'find'/'grep'. Use View/",
                - 	`LS instead of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '&&'`,
                - 	`, avoid newlines except in quoted strings\n- Each command runs i`,
                - 	`n independent shell (no state persistence)\n- Prefer absolute pa`,
                - 	`ths over 'cd'\n</usage_notes>\n\n<background_execution>\n- Set r`,
                - 	`un_in_background=true for separate background shell\n- Returns s`,
                - 	`hell ID for management\n- Use job_output tool to view output, jo`,
                - 	"b_kill to terminate\\n- NEVER use `&` at end of commands - use ru",
                - 	`n_in_background parameter\n- Background: Long servers (npm start`,
                - 	`, python -m http.server), watch tasks, continuous processes\n- F`,
                - 	`oreground: Builds, tests, git ops, file ops, short scripts\n</ba`,
                - 	`ckground_execution>\n\n<git_commits>\nWhen user asks to create g`,
                - 	`it commit:\n\n1. Run: git status, git diff, git log (single mess`,
                - 	`age, three tool_use blocks)\n2. Add relevant untracked files to `,
                - 	`staging\n3. Analyze in <commit_analysis> tags:\n   - List change`,
                - 	`d files, summarize nature (feature/bug fix/refactor/docs)\n   - `,
                - 	`Draft concise (1-2 sentences) focusing on \"why\" not \"what\"\n`,
                - 	`   - Use accurate verbs: \"add\"=new feature, \"update\"=enhance`,
                - 	"ment, \\\"fix\\\"=bug\\n4. Create commit with attribution:\\n   ```bas",
                - 	`h\n   git commit -m \"$(cat &lt;&lt;'EOF'\n   Commit message her`,
                - 	`e.\n\n    Generated with Crush\n\n\n   Co-Authored-By: Crush`,
                - 	" <crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit ",
                - 	"hook fails, retry ONCE. If succeeds but files modified, MUST ame",
                - 	`nd.\n6. Run git status to verify.\n\nNotes: Use \"git commit -am`,
                - 	`\" when possible, don't stage unrelated files, NEVER update conf`,
                - 	`ig, don't push, no empty commits.\n</git_commits>\n\n<pull_reque`,
                - 	`sts>\nWhen user asks to create PR:\n\n1. Run: git status, git di`,
                - 	`ff, check remote tracking, git log and 'git diff main...HEAD'\n2`,
                - 	". Create branch if needed, commit if needed, push with -u if nee",
                - 	`ded\n3. Analyze in <pr_analysis> tags:\n   - List commits since `,
                - 	`main divergence\n   - Summarize changes, purpose/motivation\n   `,
                - 	`- Draft concise (1-2 bullets) focusing on \"why\"\n4. Create PR:`,
                - 	"\\n   ```bash\\n   gh pr create --title \\\"title\\\" --body \\\"$(cat &",
                - 	`lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bullet points>\n   \n   `,
                - 	`## Test plan\n   [Checklist...]\n\n    Generated with Crush\`,
                - 	"n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return empty response, n",
                - 	`ever update git config\n</pull_requests>\n\n<examples>\nGood: py`,
                - 	`test /foo/bar/tests\nBad: cd /foo/bar && pytest tests\n</example`,
                - 	`s>\n","parameters":{"properties":{"command":{"description":"The `,
                - 	`command to execute","type":"string"},"description":{"description`,
                - 	`":"A brief description of what the command does, try to keep it `,
                - 	`under 30 characters or so","type":"string"},"run_in_background":`,
                - 	`{"description":"Set to true (boolean) to run this command in the`,
                - 	` background. Use job_output to read the output later.","type":"b`,
                - 	"oolean",
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:325: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:325
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/glob_tool
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/grep_tool (0.66s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/grep_tool".
                Diff:
                  strings.Join({
                  	... // 9367 identical bytes
                  	`ion":"Set to true (boolean) to run this command in the backgroun`,
                  	`d. Use job_output to read the output later.","type":"boolean"},"`,
                + 	`shell_id":{"description":"ONLY use for continuing existing backg`,
                + 	"round jobs. Do NOT provide for new commands - sessions are manag",
                + 	`ed automatically.","type":"string"},"`,
                  	`working_dir":{"description":"The working directory to execute th`,
                  	`e command in (defaults to current directory)","type":"string"}},`,
                  	... // 24118 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/grep_tool".
                Diff:
                  strings.Join({
                  	... // 5427 identical bytes
                  	`:"system","cache_control":{"type":"ephemeral"}},{"content":"use `,
                  	`grep to search for the word 'package' in go files","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"functions.grep:0","function":{"arguments":"{`,
                - 	`\"pattern\": \":package:package:package:package:package:package:`,
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"packe package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"cke package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"e package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packe ",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:packe pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:packe pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:packe packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:packe package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:packe package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:packe package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:packe package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:packe package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:packe package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:packe package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:packe package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:packe package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:packe package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:packe package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:packe package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:packe package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:packe package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:packe package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:packe package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:packe package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:packe package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:packe package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:packe package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:packe package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:packe package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:packe package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:packe package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:packe package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"packe package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"cke package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"e package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packe ",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:packe pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:packe pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:acke package",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"e package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packe ",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:packe pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:packe pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:packe packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:packe package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:packe package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:packe package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:packe package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:packe package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:packe package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:packe package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:packe package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:packe package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:packe package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:packe package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:packe package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:packe package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:packageke packageage:package:package:pac",
                - 	"kage:package:package:package:package:package:package:package:pac",
                - 	"kage:package:package:package:package:package:package:package:pac",
                - 	"kage:package:package:package:package:packe package:package:packa",
                - 	"ge:package:package:package:package:package:package:package:packa",
                - 	"ge:package:package:package:package:package:package:package:packa",
                - 	"ge:package:package:package:package:packe package:package:package",
                - 	`:package:package:package:package:package:pattern\"}","name":"gre`,
                - 	`p"},"type":"function","cache_control":{"type":"ephemeral"}}],"ro`,
                - 	`le":"assistant"},{"content":"No files found","tool_call_id":"fun`,
                - 	`ctions.grep:0","role":"tool"}],"model":"moonshotai/kimi-k2-0905"`,
                - 	`,"max_tokens":10000,"stream_options":{"include_usage":true},"too`,
                - 	`l_choice":"auto","tools":[{"function":{"name":"bash","strict":fa`,
                - 	`lse,"description":"Executes bash commands with automatic backgro`,
                - 	`und conversion for long-running tasks.\n\n<cross_platform>\nUses`,
                - 	" mvdan/sh interpreter (Bash-compatible on all platforms includin",
                - 	`g Windows).\nUse forward slashes for paths: \"ls C:/foo/bar\" no`,
                - 	`t \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_steps>\n`,
                - 	"1. Directory Verification: Use LS tool to verify parent exists b",
                - 	`efore creating files\n2. Security Check: No restrictions - expla`,
                - 	`in to user. Safe read-only commands execute without prompts\n3. `,
                - 	`Command Execution: Execute with proper quoting, capture output\n`,
                - 	"4. Auto-Background: Commands >1 minute automatically move to bac",
                - 	`kground, return shell ID\n5. Output Processing: Truncate if exce`,
                - 	`eds 30000 characters\n6. Return Result: Include errors, metadata`,
                - 	` with <cwd></cwd> tags\n</execution_steps>\n\n<usage_notes>\n- C`,
                - 	"ommand required, working_dir optional (defaults to current direc",
                - 	`tory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of 'find'/`,
                - 	`'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n- Chain`,
                - 	` with ';' or '&&', avoid newlines except in quoted strings\n- Ea`,
                - 	`ch command runs in independent shell (no state persistence)\n- P`,
                - 	`refer absolute paths over 'cd'\n</usage_notes>\n\n<background_ex`,
                - 	`ecution>\n- Set run_in_background=true for separate background s`,
                - 	`hell\n- Returns shell ID for management\n- Use job_output tool t`,
                - 	"o view output, job_kill to terminate\\n- NEVER use `&` at end of ",
                - 	`commands - use run_in_background parameter\n- Background: Long s`,
                - 	"ervers (npm start, python -m http.server), watch tasks, continuo",
                - 	`us processes\n- Foreground: Builds, tests, git ops, file ops, sh`,
                - 	`ort scripts\n</background_execution>\n\n<git_commits>\nWhen user`,
                - 	` asks to create git commit:\n\n1. Run: git status, git diff, git`,
                - 	` log (single message, three tool_use blocks)\n2. Add relevant un`,
                - 	`tracked files to staging\n3. Analyze in <commit_analysis> tags:\`,
                - 	"n   - List changed files, summarize nature (feature/bug fix/refa",
                - 	`ctor/docs)\n   - Draft concise (1-2 sentences) focusing on \"why`,
                - 	`\" not \"what\"\n   - Use accurate verbs: \"add\"=new feature, \`,
                - 	`"update\"=enhancement, \"fix\"=bug\n4. Create commit with attrib`,
                - 	"ution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF'\\n   C",
                - 	`ommit message here.\n\n    Generated with Crush\n\n\n   Co-A`,
                - 	"uthored-By: Crush <crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n",
                - 	"5. If pre-commit hook fails, retry ONCE. If succeeds but files m",
                - 	`odified, MUST amend.\n6. Run git status to verify.\n\nNotes: Use`,
                - 	` \"git commit -am\" when possible, don't stage unrelated files, `,
                - 	`NEVER update config, don't push, no empty commits.\n</git_commit`,
                - 	`s>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1. Run: g`,
                - 	"it status, git diff, check remote tracking, git log and 'git dif",
                - 	`f main...HEAD'\n2. Create branch if needed, commit if needed, pu`,
                - 	`sh with -u if needed\n3. Analyze in <pr_analysis> tags:\n   - Li`,
                - 	`st commits since main divergence\n   - Summarize changes, purpos`,
                - 	`e/motivation\n   - Draft concise (1-2 bullets) focusing on \"why`,
                - 	"\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"title\\\"",
                - 	` --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bullet `,
                - 	`points>\n   \n   ## Test plan\n   [Checklist...]\n\n    Gene`,
                - 	"rated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return ",
                - 	`empty response, never update git config\n</pull_requests>\n\n<ex`,
                - 	`amples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar && pytest`,
                - 	` tests\n</examples>\n","parameters":{"properties":{"command":{"d`,
                - 	`escription":"The command to execute","type":"string"},"descripti`,
                - 	`on":{"description":"A brief description of what the command does`,
                - 	`, try to keep it under 30 characters or so","type":"string"},"ru`,
                - 	`n_in_background":{"description":"Set to true (boolean) to run th`,
                - 	"is command in the background. Use job_output to read the output ",
                - 	`later.","type":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/grep_tool".
                Diff:
                  strings.Join({
                  	... // 5427 identical bytes
                  	`:"system","cache_control":{"type":"ephemeral"}},{"content":"use `,
                  	`grep to search for the word 'package' in go files","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"functions.grep:0","function":{"arguments":"{`,
                - 	`\"pattern\": \":package:package:package:package:package:package:`,
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"packe package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"cke package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"e package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packe ",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:packe pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:packe pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:packe packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:packe package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:packe package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:packe package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:packe package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:packe package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:packe package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:packe package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:packe package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:packe package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:packe package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:packe package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:packe package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:packe package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:packe package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:packe package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:packe package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:packe package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:packe package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:packe package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:packe package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:packe package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:packe package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:packe package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:packe package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:packe package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"packe package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"cke package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"e package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packe ",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:packe pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:packe pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:acke package",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"e package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packe ",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:packe pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:packe pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:packe packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:packe package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:packe package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:packe package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:packe package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:packe package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:packe package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:packe package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:packe package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:packe package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:packe package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:package:package:package:package:pa",
                - 	"ckage:package:package:package:packe package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:package:package:package:package:pack",
                - 	"age:package:package:package:packe package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:package:package:package:package:packag",
                - 	"e:package:package:package:packe package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:package:package:package:package:package:",
                - 	"package:package:package:packageke packageage:package:package:pac",
                - 	"kage:package:package:package:package:package:package:package:pac",
                - 	"kage:package:package:package:package:package:package:package:pac",
                - 	"kage:package:package:package:package:packe package:package:packa",
                - 	"ge:package:package:package:package:package:package:package:packa",
                - 	"ge:package:package:package:package:package:package:package:packa",
                - 	"ge:package:package:package:package:packe package:package:package",
                - 	`:package:package:package:package:package:pattern\"}","name":"gre`,
                - 	`p"},"type":"function"}],"role":"assistant"},{"content":"No files`,
                - 	` found","tool_call_id":"functions.grep:0","role":"tool"},{"tool_`,
                - 	`calls":[{"id":"grep:1","function":{"arguments":"{\"pattern\": \"`,
                - 	`package\", \"include\": \"*.go\"}","name":"grep"},"type":"functi`,
                - 	`on","cache_control":{"type":"ephemeral"}}],"role":"assistant"},{`,
                - 	`"content":"Found 1 matches\n/tmp/nexora-test/TestCoderAgent/open`,
                - 	`router-kimi-k2/grep_tool/main.go:\n  Line 1, Char 1: package mai`,
                - 	`n\n","tool_call_id":"grep:1","role":"tool"}],"model":"moonshotai`,
                - 	`/kimi-k2-0905","max_tokens":10000,"stream_options":{"include_usa`,
                - 	`ge":true},"tool_choice":"auto","tools":[{"function":{"name":"bas`,
                - 	`h","strict":false,"description":"Executes bash commands with aut`,
                - 	`omatic background conversion for long-running tasks.\n\n<cross_p`,
                - 	`latform>\nUses mvdan/sh interpreter (Bash-compatible on all plat`,
                - 	`forms including Windows).\nUse forward slashes for paths: \"ls C`,
                - 	`:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<exec`,
                - 	`ution_steps>\n1. Directory Verification: Use LS tool to verify p`,
                - 	`arent exists before creating files\n2. Security Check: No restri`,
                - 	"ctions - explain to user. Safe read-only commands execute withou",
                - 	`t prompts\n3. Command Execution: Execute with proper quoting, ca`,
                - 	`pture output\n4. Auto-Background: Commands >1 minute automatical`,
                - 	`ly move to background, return shell ID\n5. Output Processing: Tr`,
                - 	`uncate if exceeds 30000 characters\n6. Return Result: Include er`,
                - 	`rors, metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usa`,
                - 	`ge_notes>\n- Command required, working_dir optional (defaults to`,
                - 	` current directory)\n- IMPORTANT: Use Grep/Glob/Agent tools inst`,
                - 	"ead of 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'",
                - 	`/'ls'\n- Chain with ';' or '&&', avoid newlines except in quoted`,
                - 	` strings\n- Each command runs in independent shell (no state per`,
                - 	`sistence)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n`,
                - 	`<background_execution>\n- Set run_in_background=true for separat`,
                - 	`e background shell\n- Returns shell ID for management\n- Use job`,
                - 	`_output tool to view output, job_kill to terminate\n- NEVER use `,
                - 	"`&` at end of commands - use run_in_background parameter\\n- Back",
                - 	"ground: Long servers (npm start, python -m http.server), watch t",
                - 	`asks, continuous processes\n- Foreground: Builds, tests, git ops`,
                - 	`, file ops, short scripts\n</background_execution>\n\n<git_commi`,
                - 	`ts>\nWhen user asks to create git commit:\n\n1. Run: git status,`,
                - 	` git diff, git log (single message, three tool_use blocks)\n2. A`,
                - 	`dd relevant untracked files to staging\n3. Analyze in <commit_an`,
                - 	`alysis> tags:\n   - List changed files, summarize nature (featur`,
                - 	`e/bug fix/refactor/docs)\n   - Draft concise (1-2 sentences) foc`,
                - 	`using on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=`,
                - 	`new feature, \"update\"=enhancement, \"fix\"=bug\n4. Create comm`,
                - 	"it with attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&",
                - 	`lt;'EOF'\n   Commit message here.\n\n    Generated with Crus`,
                - 	`h\n\n\n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n  `,
                - 	" )\\\"\\n   ```\\n5. If pre-commit hook fails, retry ONCE. If succee",
                - 	`ds but files modified, MUST amend.\n6. Run git status to verify.`,
                - 	`\n\nNotes: Use \"git commit -am\" when possible, don't stage unr`,
                - 	"elated files, NEVER update config, don't push, no empty commits.",
                - 	`\n</git_commits>\n\n<pull_requests>\nWhen user asks to create PR`,
                - 	`:\n\n1. Run: git status, git diff, check remote tracking, git lo`,
                - 	`g and 'git diff main...HEAD'\n2. Create branch if needed, commit`,
                - 	` if needed, push with -u if needed\n3. Analyze in <pr_analysis> `,
                - 	`tags:\n   - List commits since main divergence\n   - Summarize c`,
                - 	`hanges, purpose/motivation\n   - Draft concise (1-2 bullets) foc`,
                - 	"using on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --t",
                - 	`itle \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &`,
                - 	`lt;1-3 bullet points>\n   \n   ## Test plan\n   [Checklist...]\n`,
                - 	"\\n    Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImpo",
                - 	`rtant: Return empty response, never update git config\n</pull_re`,
                - 	`quests>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo`,
                - 	`/bar && pytest tests\n</examples>\n","parameters":{"properties":`,
                - 	`{"command":{"description":"The command to execute","type":"strin`,
                - 	`g"},"description":{"description":"A brief description of what th`,
                - 	`e command does, try to keep it under 30 characters or so","type"`,
                - 	`:"string"},"run_in_background":{"description":"Set to true (bool`,
                - 	"ean) to run this command in the background. Use job_output to re",
                - 	`ad the output later.","type":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:365: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:365
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/grep_tool
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/ls_tool (0.50s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/ls_tool".
                Diff:
                  strings.Join({
                  	... // 4648 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 4451 identical bytes
                  	`cription":"Set to true (boolean) to run this command in the back`,
                  	`ground. Use job_output to read the output later.","type":"boolea`,
                + 	`n"},"shell_id":{"description":"ONLY use for continuing existing `,
                + 	"background jobs. Do NOT provide for new commands - sessions are ",
                + 	`managed automatically.","type":"stri`,
                  	"n",
                + 	"g",
                  	`"},"working_dir":{"description":"The working directory to execut`,
                  	`e the command in (defaults to current directory)","type":"string`,
                  	... // 24122 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/ls_tool".
                Diff:
                  strings.Join({
                  	... // 4648 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 516 identical bytes
                  	`ole":"system","cache_control":{"type":"ephemeral"}},{"content":"`,
                  	`use ls to list the files in the current directory","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"ls:0","function":{"arguments":"{\"path\": \"`,
                - 	`/tmp/nexora-test/TestCoderAgent/openrouter-kimi-k2/ls_tool\"}","`,
                - 	`name":"ls"},"type":"function","cache_control":{"type":"ephemeral`,
                - 	`"}}],"role":"assistant"},{"content":"\n- /tmp/nexora-test/TestCo`,
                - 	`derAgent/openrouter-kimi-k2/ls_tool/\n  - go.mod\n  - main.go\n"`,
                - 	`,"tool_call_id":"ls:0","role":"tool"}],"model":"moonshotai/kimi-`,
                - 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                - 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                - 	`rict":false,"description":"Executes bash commands with automatic`,
                - 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                - 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                - 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                - 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                - 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                - 	`exists before creating files\n2. Security Check: No restrictions`,
                - 	" - explain to user. Safe read-only commands execute without prom",
                - 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                - 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                - 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                - 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                - 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                - 	`es>\n- Command required, working_dir optional (defaults to curre`,
                - 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                - 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                - 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                - 	`gs\n- Each command runs in independent shell (no state persisten`,
                - 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                - 	`round_execution>\n- Set run_in_background=true for separate back`,
                - 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                - 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                - 	` end of commands - use run_in_background parameter\n- Background`,
                - 	": Long servers (npm start, python -m http.server), watch tasks, ",
                - 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                - 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                - 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                - 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                - 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                - 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                - 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                - 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                - 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                - 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                - 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                - 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                - 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                - 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                - 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                - 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                - 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                - 	". Run: git status, git diff, check remote tracking, git log and ",
                - 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                - 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                - 	`n   - List commits since main divergence\n   - Summarize changes`,
                - 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                - 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                - 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                - 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                - 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                - 	` Return empty response, never update git config\n</pull_requests`,
                - 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                - 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                - 	`and":{"description":"The command to execute","type":"string"},"d`,
                - 	`escription":{"description":"A brief description of what the comm`,
                - 	`and does, try to keep it under 30 characters or so","type":"stri`,
                - 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                - 	"o run this command in the background. Use job_output to read the",
                - 	` output later.","type":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:405: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:405
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/ls_tool
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/multiedit_tool (1.21s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/multiedit_tool".
                Diff:
                  strings.Join({
                  	... // 4655 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 4531 identical bytes
                  	`cription":"Set to true (boolean) to run this command in the back`,
                  	`ground. Use job_output to read the output later.","type":"boolea`,
                + 	`n"},"shell_id":{"description":"ONLY use for continuing existing `,
                + 	"background jobs. Do NOT provide for new commands - sessions are ",
                + 	`managed automatically.","type":"stri`,
                  	"n",
                + 	"g",
                  	`"},"working_dir":{"description":"The working directory to execut`,
                  	`e the command in (defaults to current directory)","type":"string`,
                  	... // 24122 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/multiedit_tool".
                Diff:
                  strings.Join({
                  	... // 4655 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 596 identical bytes
                  	" change 'Hello, World!' to 'Hello, Nexora!' and add a comment '/",
                  	`/ Greeting' above the fmt.Println line in main.go","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you use multiedit to make those changes in`,
                - 	" main.go. First, let me find the main.go file and examine its co",
                - 	`ntents.","tool_calls":[{"id":"glob:0","function":{"arguments":"{`,
                - 	`\"pattern\": \"**/main.go\"}","name":"glob"},"type":"function","`,
                - 	`cache_control":{"type":"ephemeral"}}],"role":"assistant"},{"cont`,
                - 	`ent":"/tmp/nexora-test/TestCoderAgent/openrouter-kimi-k2/multied`,
                - 	`it_tool/main.go","tool_call_id":"glob:0","role":"tool"}],"model"`,
                - 	`:"moonshotai/kimi-k2-0905","max_tokens":10000,"stream_options":{`,
                - 	`"include_usage":true},"tool_choice":"auto","tools":[{"function":`,
                - 	`{"name":"bash","strict":false,"description":"Executes bash comma`,
                - 	"nds with automatic background conversion for long-running tasks.",
                - 	`\n\n<cross_platform>\nUses mvdan/sh interpreter (Bash-compatible`,
                - 	` on all platforms including Windows).\nUse forward slashes for p`,
                - 	`aths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platfo`,
                - 	`rm>\n\n<execution_steps>\n1. Directory Verification: Use LS tool`,
                - 	` to verify parent exists before creating files\n2. Security Chec`,
                - 	"k: No restrictions - explain to user. Safe read-only commands ex",
                - 	`ecute without prompts\n3. Command Execution: Execute with proper`,
                - 	` quoting, capture output\n4. Auto-Background: Commands >1 minute`,
                - 	` automatically move to background, return shell ID\n5. Output Pr`,
                - 	`ocessing: Truncate if exceeds 30000 characters\n6. Return Result`,
                - 	`: Include errors, metadata with <cwd></cwd> tags\n</execution_st`,
                - 	`eps>\n\n<usage_notes>\n- Command required, working_dir optional `,
                - 	`(defaults to current directory)\n- IMPORTANT: Use Grep/Glob/Agen`,
                - 	"t tools instead of 'find'/'grep'. Use View/LS instead of 'cat'/'",
                - 	`head'/'tail'/'ls'\n- Chain with ';' or '&&', avoid newlines exce`,
                - 	`pt in quoted strings\n- Each command runs in independent shell (`,
                - 	`no state persistence)\n- Prefer absolute paths over 'cd'\n</usag`,
                - 	`e_notes>\n\n<background_execution>\n- Set run_in_background=true`,
                - 	` for separate background shell\n- Returns shell ID for managemen`,
                - 	`t\n- Use job_output tool to view output, job_kill to terminate\n`,
                - 	"- NEVER use `&` at end of commands - use run_in_background param",
                - 	`eter\n- Background: Long servers (npm start, python -m http.serv`,
                - 	`er), watch tasks, continuous processes\n- Foreground: Builds, te`,
                - 	`sts, git ops, file ops, short scripts\n</background_execution>\n`,
                - 	`\n<git_commits>\nWhen user asks to create git commit:\n\n1. Run:`,
                - 	" git status, git diff, git log (single message, three tool_use b",
                - 	`locks)\n2. Add relevant untracked files to staging\n3. Analyze i`,
                - 	`n <commit_analysis> tags:\n   - List changed files, summarize na`,
                - 	`ture (feature/bug fix/refactor/docs)\n   - Draft concise (1-2 se`,
                - 	`ntences) focusing on \"why\" not \"what\"\n   - Use accurate ver`,
                - 	`bs: \"add\"=new feature, \"update\"=enhancement, \"fix\"=bug\n4.`,
                - 	" Create commit with attribution:\\n   ```bash\\n   git commit -m \\",
                - 	`"$(cat &lt;&lt;'EOF'\n   Commit message here.\n\n    Generat`,
                - 	`ed with Crush\n\n\n   Co-Authored-By: Crush <crush@charm.land>\n`,
                - 	"\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, retry ONC",
                - 	`E. If succeeds but files modified, MUST amend.\n6. Run git statu`,
                - 	`s to verify.\n\nNotes: Use \"git commit -am\" when possible, don`,
                - 	"'t stage unrelated files, NEVER update config, don't push, no em",
                - 	`pty commits.\n</git_commits>\n\n<pull_requests>\nWhen user asks `,
                - 	`to create PR:\n\n1. Run: git status, git diff, check remote trac`,
                - 	`king, git log and 'git diff main...HEAD'\n2. Create branch if ne`,
                - 	`eded, commit if needed, push with -u if needed\n3. Analyze in <p`,
                - 	`r_analysis> tags:\n   - List commits since main divergence\n   -`,
                - 	` Summarize changes, purpose/motivation\n   - Draft concise (1-2 `,
                - 	"bullets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh p",
                - 	`r create --title \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## S`,
                - 	`ummary\n   &lt;1-3 bullet points>\n   \n   ## Test plan\n   [Che`,
                - 	`cklist...]\n\n    Generated with Crush\n\n   EOF\n   )\"\n  `,
                - 	" ```\\n\\nImportant: Return empty response, never update git confi",
                - 	`g\n</pull_requests>\n\n<examples>\nGood: pytest /foo/bar/tests\n`,
                - 	`Bad: cd /foo/bar && pytest tests\n</examples>\n","parameters":{"`,
                - 	`properties":{"command":{"description":"The command to execute","`,
                - 	`type":"string"},"description":{"description":"A brief descriptio`,
                - 	"n of what the command does, try to keep it under 30 characters o",
                - 	`r so","type":"string"},"run_in_background":{"description":"Set t`,
                - 	"o true (boolean) to run this command in the background. Use job_",
                - 	`output to read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/multiedit_tool".
                Diff:
                  strings.Join({
                  	... // 4655 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 596 identical bytes
                  	" change 'Hello, World!' to 'Hello, Nexora!' and add a comment '/",
                  	`/ Greeting' above the fmt.Println line in main.go","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you use multiedit to make those changes in`,
                - 	" main.go. First, let me find the main.go file and examine its co",
                - 	`ntents.","tool_calls":[{"id":"glob:0","function":{"arguments":"{`,
                - 	`\"pattern\": \"**/main.go\"}","name":"glob"},"type":"function"}]`,
                - 	`,"role":"assistant"},{"content":"/tmp/nexora-test/TestCoderAgent`,
                - 	`/openrouter-kimi-k2/multiedit_tool/main.go","tool_call_id":"glob`,
                - 	`:0","role":"tool"},{"tool_calls":[{"id":"view:1","function":{"ar`,
                - 	`guments":"{\"file_path\": \"/tmp/nexora-test/TestCoderAgent/open`,
                - 	`router-kimi-k2/multiedit_tool/main.go\"}","name":"view"},"type":`,
                - 	`"function","cache_control":{"type":"ephemeral"}}],"role":"assist`,
                - 	`ant"},{"content":"<file>\n     1|package main\n     2|\n     3|i`,
                - 	`mport \"fmt\"\n     4|\n     5|func main() {\n     6|\tfmt.Pr`,
                - 	`intln(\"Hello, World!\")\n     7|}\n     8|\n</file>\n\n\n F`,
                - 	"ile: 0 KB  showing lines 1-8 of 8 total (default chunks: 100 ",
                - 	`lines)","tool_call_id":"view:1","role":"tool"}],"model":"moonsho`,
                - 	`tai/kimi-k2-0905","max_tokens":10000,"stream_options":{"include_`,
                - 	`usage":true},"tool_choice":"auto","tools":[{"function":{"name":"`,
                - 	`bash","strict":false,"description":"Executes bash commands with `,
                - 	`automatic background conversion for long-running tasks.\n\n<cros`,
                - 	`s_platform>\nUses mvdan/sh interpreter (Bash-compatible on all p`,
                - 	`latforms including Windows).\nUse forward slashes for paths: \"l`,
                - 	`s C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<e`,
                - 	`xecution_steps>\n1. Directory Verification: Use LS tool to verif`,
                - 	`y parent exists before creating files\n2. Security Check: No res`,
                - 	"trictions - explain to user. Safe read-only commands execute wit",
                - 	`hout prompts\n3. Command Execution: Execute with proper quoting,`,
                - 	` capture output\n4. Auto-Background: Commands >1 minute automati`,
                - 	`cally move to background, return shell ID\n5. Output Processing:`,
                - 	` Truncate if exceeds 30000 characters\n6. Return Result: Include`,
                - 	` errors, metadata with <cwd></cwd> tags\n</execution_steps>\n\n<`,
                - 	`usage_notes>\n- Command required, working_dir optional (defaults`,
                - 	` to current directory)\n- IMPORTANT: Use Grep/Glob/Agent tools i`,
                - 	"nstead of 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'ta",
                - 	`il'/'ls'\n- Chain with ';' or '&&', avoid newlines except in quo`,
                - 	`ted strings\n- Each command runs in independent shell (no state `,
                - 	`persistence)\n- Prefer absolute paths over 'cd'\n</usage_notes>\`,
                - 	`n\n<background_execution>\n- Set run_in_background=true for sepa`,
                - 	`rate background shell\n- Returns shell ID for management\n- Use `,
                - 	`job_output tool to view output, job_kill to terminate\n- NEVER u`,
                - 	"se `&` at end of commands - use run_in_background parameter\\n- B",
                - 	"ackground: Long servers (npm start, python -m http.server), watc",
                - 	`h tasks, continuous processes\n- Foreground: Builds, tests, git `,
                - 	`ops, file ops, short scripts\n</background_execution>\n\n<git_co`,
                - 	`mmits>\nWhen user asks to create git commit:\n\n1. Run: git stat`,
                - 	`us, git diff, git log (single message, three tool_use blocks)\n2`,
                - 	`. Add relevant untracked files to staging\n3. Analyze in <commit`,
                - 	`_analysis> tags:\n   - List changed files, summarize nature (fea`,
                - 	`ture/bug fix/refactor/docs)\n   - Draft concise (1-2 sentences) `,
                - 	`focusing on \"why\" not \"what\"\n   - Use accurate verbs: \"add`,
                - 	`\"=new feature, \"update\"=enhancement, \"fix\"=bug\n4. Create c`,
                - 	"ommit with attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &l",
                - 	`t;&lt;'EOF'\n   Commit message here.\n\n    Generated with C`,
                - 	`rush\n\n\n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\`,
                - 	"n   )\\\"\\n   ```\\n5. If pre-commit hook fails, retry ONCE. If suc",
                - 	`ceeds but files modified, MUST amend.\n6. Run git status to veri`,
                - 	`fy.\n\nNotes: Use \"git commit -am\" when possible, don't stage `,
                - 	"unrelated files, NEVER update config, don't push, no empty commi",
                - 	`ts.\n</git_commits>\n\n<pull_requests>\nWhen user asks to create`,
                - 	` PR:\n\n1. Run: git status, git diff, check remote tracking, git`,
                - 	` log and 'git diff main...HEAD'\n2. Create branch if needed, com`,
                - 	`mit if needed, push with -u if needed\n3. Analyze in <pr_analysi`,
                - 	`s> tags:\n   - List commits since main divergence\n   - Summariz`,
                - 	`e changes, purpose/motivation\n   - Draft concise (1-2 bullets) `,
                - 	"focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create ",
                - 	`--title \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n `,
                - 	`  &lt;1-3 bullet points>\n   \n   ## Test plan\n   [Checklist...`,
                - 	"]\\n\\n    Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nI",
                - 	`mportant: Return empty response, never update git config\n</pull`,
                - 	`_requests>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /`,
                - 	`foo/bar && pytest tests\n</examples>\n","parameters":{"propertie`,
                - 	`s":{"command":{"description":"The command to execute","type":"st`,
                - 	`ring"},"description":{"description":"A brief description of what`,
                - 	` the command does, try to keep it under 30 characters or so","ty`,
                - 	`pe":"string"},"run_in_background":{"description":"Set to true (b`,
                - 	"oolean) to run this command in the background. Use job_output to",
                - 	` read the output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/multiedit_tool".
                Diff:
                  strings.Join({
                  	... // 4655 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 596 identical bytes
                  	" change 'Hello, World!' to 'Hello, Nexora!' and add a comment '/",
                  	`/ Greeting' above the fmt.Println line in main.go","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you use multiedit to make those changes in`,
                - 	" main.go. First, let me find the main.go file and examine its co",
                - 	`ntents.","tool_calls":[{"id":"glob:0","function":{"arguments":"{`,
                - 	`\"pattern\": \"**/main.go\"}","name":"glob"},"type":"function"}]`,
                - 	`,"role":"assistant"},{"content":"/tmp/nexora-test/TestCoderAgent`,
                - 	`/openrouter-kimi-k2/multiedit_tool/main.go","tool_call_id":"glob`,
                - 	`:0","role":"tool"},{"tool_calls":[{"id":"view:1","function":{"ar`,
                - 	`guments":"{\"file_path\": \"/tmp/nexora-test/TestCoderAgent/open`,
                - 	`router-kimi-k2/multiedit_tool/main.go\"}","name":"view"},"type":`,
                - 	`"function"}],"role":"assistant"},{"content":"<file>\n     1|pack`,
                - 	`age main\n     2|\n     3|import \"fmt\"\n     4|\n     5|func m`,
                - 	`ain() {\n     6|\tfmt.Println(\"Hello, World!\")\n     7|}\n `,
                - 	`    8|\n</file>\n\n\n File: 0 KB  showing lines 1-8 of 8 `,
                - 	`total (default chunks: 100 lines)","tool_call_id":"view:1","role`,
                - 	`":"tool"},{"content":"Now I'll use multiedit to make both change`,
                - 	`s:\n1. Change 'Hello, World!' to 'Hello, Nexora!'\n2. Add '// Gr`,
                - 	`eeting' comment above the fmt.Println line","tool_calls":[{"id":`,
                - 	`"multiedit:2","function":{"arguments":"{\"file_path\": \"/tmp/ne`,
                - 	"xora-test/TestCoderAgent/openrouter-kimi-k2/multiedit_tool/main.",
                - 	`go\", \"edits\": [{\"old_string\": \"func main() {\\n\\tfmt.Prin`,
                - 	`tln(\\\"Hello, World!\\\")\", \"new_string\": \"func main() {\\n`,
                - 	`\\t// Greeting\\n\\tfmt.Println(\\\"Hello, Nexora!\\\")\"}]}","n`,
                - 	`ame":"multiedit"},"type":"function","cache_control":{"type":"eph`,
                - 	`emeral"}}],"role":"assistant"},{"content":"<result>\nApplied 1 e`,
                - 	"dits to file: /tmp/nexora-test/TestCoderAgent/openrouter-kimi-k2",
                - 	`/multiedit_tool/main.go\n</result>\n","tool_call_id":"multiedit:`,
                - 	`2","role":"tool"}],"model":"moonshotai/kimi-k2-0905","max_tokens`,
                - 	`":10000,"stream_options":{"include_usage":true},"tool_choice":"a`,
                - 	`uto","tools":[{"function":{"name":"bash","strict":false,"descrip`,
                - 	`tion":"Executes bash commands with automatic background conversi`,
                - 	`on for long-running tasks.\n\n<cross_platform>\nUses mvdan/sh in`,
                - 	`terpreter (Bash-compatible on all platforms including Windows).\`,
                - 	`nUse forward slashes for paths: \"ls C:/foo/bar\" not \"ls C:\\f`,
                - 	`oo\\bar\".\n</cross_platform>\n\n<execution_steps>\n1. Directory`,
                - 	" Verification: Use LS tool to verify parent exists before creati",
                - 	`ng files\n2. Security Check: No restrictions - explain to user. `,
                - 	`Safe read-only commands execute without prompts\n3. Command Exec`,
                - 	`ution: Execute with proper quoting, capture output\n4. Auto-Back`,
                - 	"ground: Commands >1 minute automatically move to background, ret",
                - 	`urn shell ID\n5. Output Processing: Truncate if exceeds 30000 ch`,
                - 	`aracters\n6. Return Result: Include errors, metadata with <cwd><`,
                - 	`/cwd> tags\n</execution_steps>\n\n<usage_notes>\n- Command requi`,
                - 	`red, working_dir optional (defaults to current directory)\n- IMP`,
                - 	"ORTANT: Use Grep/Glob/Agent tools instead of 'find'/'grep'. Use ",
                - 	`View/LS instead of 'cat'/'head'/'tail'/'ls'\n- Chain with ';' or`,
                - 	` '&&', avoid newlines except in quoted strings\n- Each command r`,
                - 	`uns in independent shell (no state persistence)\n- Prefer absolu`,
                - 	`te paths over 'cd'\n</usage_notes>\n\n<background_execution>\n- `,
                - 	`Set run_in_background=true for separate background shell\n- Retu`,
                - 	`rns shell ID for management\n- Use job_output tool to view outpu`,
                - 	"t, job_kill to terminate\\n- NEVER use `&` at end of commands - u",
                - 	`se run_in_background parameter\n- Background: Long servers (npm `,
                - 	"start, python -m http.server), watch tasks, continuous processes",
                - 	`\n- Foreground: Builds, tests, git ops, file ops, short scripts\`,
                - 	`n</background_execution>\n\n<git_commits>\nWhen user asks to cre`,
                - 	`ate git commit:\n\n1. Run: git status, git diff, git log (single`,
                - 	` message, three tool_use blocks)\n2. Add relevant untracked file`,
                - 	`s to staging\n3. Analyze in <commit_analysis> tags:\n   - List c`,
                - 	`hanged files, summarize nature (feature/bug fix/refactor/docs)\n`,
                - 	`   - Draft concise (1-2 sentences) focusing on \"why\" not \"wha`,
                - 	`t\"\n   - Use accurate verbs: \"add\"=new feature, \"update\"=en`,
                - 	"hancement, \\\"fix\\\"=bug\\n4. Create commit with attribution:\\n   `",
                - 	"``bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF'\\n   Commit messag",
                - 	`e here.\n\n    Generated with Crush\n\n\n   Co-Authored-By: `,
                - 	"Crush <crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-co",
                - 	"mmit hook fails, retry ONCE. If succeeds but files modified, MUS",
                - 	`T amend.\n6. Run git status to verify.\n\nNotes: Use \"git commi`,
                - 	`t -am\" when possible, don't stage unrelated files, NEVER update`,
                - 	` config, don't push, no empty commits.\n</git_commits>\n\n<pull_`,
                - 	`requests>\nWhen user asks to create PR:\n\n1. Run: git status, g`,
                - 	"it diff, check remote tracking, git log and 'git diff main...HEA",
                - 	`D'\n2. Create branch if needed, commit if needed, push with -u i`,
                - 	`f needed\n3. Analyze in <pr_analysis> tags:\n   - List commits s`,
                - 	`ince main divergence\n   - Summarize changes, purpose/motivation`,
                - 	`\n   - Draft concise (1-2 bullets) focusing on \"why\"\n4. Creat`,
                - 	"e PR:\\n   ```bash\\n   gh pr create --title \\\"title\\\" --body \\\"$(",
                - 	`cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bullet points>\n   `,
                - 	`\n   ## Test plan\n   [Checklist...]\n\n    Generated with C`,
                - 	"rush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return empty respon",
                - 	`se, never update git config\n</pull_requests>\n\n<examples>\nGoo`,
                - 	`d: pytest /foo/bar/tests\nBad: cd /foo/bar && pytest tests\n</ex`,
                - 	`amples>\n","parameters":{"properties":{"command":{"description":`,
                - 	`"The command to execute","type":"string"},"description":{"descri`,
                - 	`ption":"A brief description of what the command does, try to kee`,
                - 	`p it under 30 characters or so","type":"string"},"run_in_backgro`,
                - 	`und":{"description":"Set to true (boolean) to run this command i`,
                - 	`n the background. Use job_output to read the output later.","typ`,
                - 	`e":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/multiedit_tool".
                Diff:
                  strings.Join({
                  	... // 4655 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 596 identical bytes
                  	" change 'Hello, World!' to 'Hello, Nexora!' and add a comment '/",
                  	`/ Greeting' above the fmt.Println line in main.go","role":"user"`,
                - 	"}",
                  	",",
                - 	`{"content":"I'll help you use multiedit to make those changes in`,
                - 	" main.go. First, let me find the main.go file and examine its co",
                - 	`ntents.","tool_calls":[{"id":"glob:0","function":{"arguments":"{`,
                - 	`\"pattern\": \"**/main.go\"}","name":"glob"},"type":"function"}]`,
                - 	`,"role":"assistant"},{"content":"/tmp/nexora-test/TestCoderAgent`,
                - 	`/openrouter-kimi-k2/multiedit_tool/main.go","tool_call_id":"glob`,
                - 	`:0","role":"tool"},{"tool_calls":[{"id":"view:1","function":{"ar`,
                - 	`guments":"{\"file_path\": \"/tmp/nexora-test/TestCoderAgent/open`,
                - 	`router-kimi-k2/multiedit_tool/main.go\"}","name":"view"},"type":`,
                - 	`"function"}],"role":"assistant"},{"content":"<file>\n     1|pack`,
                - 	`age main\n     2|\n     3|import \"fmt\"\n     4|\n     5|func m`,
                - 	`ain() {\n     6|\tfmt.Println(\"Hello, World!\")\n     7|}\n `,
                - 	`    8|\n</file>\n\n\n File: 0 KB  showing lines 1-8 of 8 `,
                - 	`total (default chunks: 100 lines)","tool_call_id":"view:1","role`,
                - 	`":"tool"},{"content":"Now I'll use multiedit to make both change`,
                - 	`s:\n1. Change 'Hello, World!' to 'Hello, Nexora!'\n2. Add '// Gr`,
                - 	`eeting' comment above the fmt.Println line","tool_calls":[{"id":`,
                - 	`"multiedit:2","function":{"arguments":"{\"file_path\": \"/tmp/ne`,
                - 	"xora-test/TestCoderAgent/openrouter-kimi-k2/multiedit_tool/main.",
                - 	`go\", \"edits\": [{\"old_string\": \"func main() {\\n\\tfmt.Prin`,
                - 	`tln(\\\"Hello, World!\\\")\", \"new_string\": \"func main() {\\n`,
                - 	`\\t// Greeting\\n\\tfmt.Println(\\\"Hello, Nexora!\\\")\"}]}","n`,
                - 	`ame":"multiedit"},"type":"function"}],"role":"assistant"},{"cont`,
                - 	`ent":"<result>\nApplied 1 edits to file: /tmp/nexora-test/TestCo`,
                - 	`derAgent/openrouter-kimi-k2/multiedit_tool/main.go\n</result>\n"`,
                - 	`,"tool_call_id":"multiedit:2","role":"tool"},{"content":"Let me `,
                - 	`verify the changes by viewing the updated file:","tool_calls":[{`,
                - 	`"id":"view:3","function":{"arguments":"{\"file_path\": \"/tmp/ne`,
                - 	"xora-test/TestCoderAgent/openrouter-kimi-k2/multiedit_tool/main.",
                - 	`go\"}","name":"view"},"type":"function","cache_control":{"type":`,
                - 	`"ephemeral"}}],"role":"assistant"},{"content":"<file>\n     1|pa`,
                - 	`ckage main\n     2|\n     3|import \"fmt\"\n     4|\n     5|func`,
                - 	` main() {\n     6|\t// Greeting\n     7|\tfmt.Println(\"He`,
                - 	`llo, Nexora!\")\n     8|}\n     9|\n</file>\n\n\n File: 0 KB`,
                - 	`  showing lines 1-9 of 9 total (default chunks: 100 lines)","`,
                - 	`tool_call_id":"view:3","role":"tool"}],"model":"moonshotai/kimi-`,
                - 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                - 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                - 	`rict":false,"description":"Executes bash commands with automatic`,
                - 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                - 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                - 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                - 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                - 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                - 	`exists before creating files\n2. Security Check: No restrictions`,
                - 	" - explain to user. Safe read-only commands execute without prom",
                - 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                - 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                - 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                - 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                - 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                - 	`es>\n- Command required, working_dir optional (defaults to curre`,
                - 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                - 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                - 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                - 	`gs\n- Each command runs in independent shell (no state persisten`,
                - 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                - 	`round_execution>\n- Set run_in_background=true for separate back`,
                - 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                - 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                - 	` end of commands - use run_in_background parameter\n- Background`,
                - 	": Long servers (npm start, python -m http.server), watch tasks, ",
                - 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                - 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                - 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                - 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                - 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                - 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                - 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                - 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                - 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                - 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                - 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                - 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                - 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                - 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                - 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                - 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                - 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                - 	". Run: git status, git diff, check remote tracking, git log and ",
                - 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                - 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                - 	`n   - List commits since main divergence\n   - Summarize changes`,
                - 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                - 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                - 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                - 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                - 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                - 	` Return empty response, never update git config\n</pull_requests`,
                - 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                - 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                - 	`and":{"description":"The command to execute","type":"string"},"d`,
                - 	`escription":{"description":"A brief description of what the comm`,
                - 	`and does, try to keep it under 30 characters or so","type":"stri`,
                - 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                - 	"o run this command in the background. Use job_output to read the",
                - 	` output later.","type":"boolean`,
                + 	`"cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-`,
                + 	`k2-0905","max_tokens":10000,"stream_options":{"include_usage":tr`,
                + 	`ue},"tool_choice":"auto","tools":[{"function":{"name":"bash","st`,
                + 	`rict":false,"description":"Executes bash commands with automatic`,
                + 	` background conversion for long-running tasks.\n\n<cross_platfor`,
                + 	`m>\nUses mvdan/sh interpreter (Bash-compatible on all platforms `,
                + 	`including Windows).\nUse forward slashes for paths: \"ls C:/foo/`,
                + 	`bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_`,
                + 	`steps>\n1. Directory Verification: Use LS tool to verify parent `,
                + 	`exists before creating files\n2. Security Check: No restrictions`,
                + 	" - explain to user. Safe read-only commands execute without prom",
                + 	`pts\n3. Command Execution: Execute with proper quoting, capture `,
                + 	`output\n4. Auto-Background: Commands >1 minute automatically mov`,
                + 	`e to background, return shell ID\n5. Output Processing: Truncate`,
                + 	` if exceeds 30000 characters\n6. Return Result: Include errors, `,
                + 	`metadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_not`,
                + 	`es>\n- Command required, working_dir optional (defaults to curre`,
                + 	`nt directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of`,
                + 	` 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\`,
                + 	"n- Chain with ';' or '&&', avoid newlines except in quoted strin",
                + 	`gs\n- Each command runs in independent shell (no state persisten`,
                + 	`ce)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backg`,
                + 	`round_execution>\n- Set run_in_background=true for separate back`,
                + 	`ground shell\n- Returns shell ID for management\n- Use job_outpu`,
                + 	"t tool to view output, job_kill to terminate\\n- NEVER use `&` at",
                + 	` end of commands - use run_in_background parameter\n- Background`,
                + 	": Long servers (npm start, python -m http.server), watch tasks, ",
                + 	`continuous processes\n- Foreground: Builds, tests, git ops, file`,
                + 	` ops, short scripts\n</background_execution>\n\n<git_commits>\nW`,
                + 	`hen user asks to create git commit:\n\n1. Run: git status, git d`,
                + 	`iff, git log (single message, three tool_use blocks)\n2. Add rel`,
                + 	`evant untracked files to staging\n3. Analyze in <commit_analysis`,
                + 	`> tags:\n   - List changed files, summarize nature (feature/bug `,
                + 	`fix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing `,
                + 	`on \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fe`,
                + 	`ature, \"update\"=enhancement, \"fix\"=bug\n4. Create commit wit`,
                + 	"h attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EO",
                + 	`F'\n   Commit message here.\n\n    Generated with Crush\n\n\`,
                + 	`n   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n`,
                + 	"   ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but",
                + 	` files modified, MUST amend.\n6. Run git status to verify.\n\nNo`,
                + 	`tes: Use \"git commit -am\" when possible, don't stage unrelated`,
                + 	` files, NEVER update config, don't push, no empty commits.\n</gi`,
                + 	`t_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1`,
                + 	". Run: git status, git diff, check remote tracking, git log and ",
                + 	`'git diff main...HEAD'\n2. Create branch if needed, commit if ne`,
                + 	`eded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\`,
                + 	`n   - List commits since main divergence\n   - Summarize changes`,
                + 	`, purpose/motivation\n   - Draft concise (1-2 bullets) focusing `,
                + 	"on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\",
                + 	`"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3`,
                + 	" bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0",
                + 	"\x9f\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant:",
                + 	` Return empty response, never update git config\n</pull_requests`,
                + 	`>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &`,
                + 	`& pytest tests\n</examples>\n","parameters":{"properties":{"comm`,
                + 	`and":{"description":"The command to execute","type":"string"},"d`,
                + 	`escription":{"description":"A brief description of what the comm`,
                + 	`and does, try to keep it under 30 characters or so","type":"stri`,
                + 	`ng"},"run_in_background":{"description":"Set to true (boolean) t`,
                + 	"o run this command in the background. Use job_output to read the",
                + 	` output later.","type":"boolean"},"shell_id":{"description":"ONL`,
                + 	"Y use for continuing existing background jobs. Do NOT provide fo",
                + 	`r new commands - sessions are managed automatically.","type":"st`,
                + 	"ring",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:446: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:446
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/multiedit_tool
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/sourcegraph_tool (0.62s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/sourcegraph_tool".
                Diff:
                  strings.Join({
                  	... // 4657 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 4462 identical bytes
                  	`cription":"Set to true (boolean) to run this command in the back`,
                  	`ground. Use job_output to read the output later.","type":"boolea`,
                + 	`n"},"shell_id":{"description":"ONLY use for continuing existing `,
                + 	"background jobs. Do NOT provide for new commands - sessions are ",
                + 	`managed automatically.","type":"stri`,
                  	"n",
                + 	"g",
                  	`"},"working_dir":{"description":"The working directory to execut`,
                  	`e the command in (defaults to current directory)","type":"string`,
                  	... // 24122 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/sourcegraph_tool".
                Diff:
                  strings.Join({
                  	... // 4657 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 527 identical bytes
                  	`m","cache_control":{"type":"ephemeral"}},{"content":"use sourceg`,
                  	`raph to search for 'func main' in Go repositories","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"sourcegraph:0","function":{"arguments":"{\"q`,
                - 	`uery\": \"lang:go func main\", \"count\": 10}","name":"sourcegra`,
                - 	`ph"},"type":"function","cache_control":{"type":"ephemeral"}}],"r`,
                - 	`ole":"assistant"},{"content":"# Sourcegraph Search Results\n\nFo`,
                - 	`und 30 matches across 30 results\n(Result limit reached, try a m`,
                - 	`ore specific query)\n\n## Result 1: github.com/GoesToEleven/Gola`,
                - 	"ngTraining/14_functions/10_func-expression/01_before-func-expres",
                - 	`sion/main.go\n\nURL: /github.com/GoesToEleven/GolangTraining/-/b`,
                - 	"lob/14_functions/10_func-expression/01_before-func-expression/ma",
                - 	"in.go\\n\\n```\\n1| package main\\n2| \\n3| import \\\"fmt\\\"\\n4| \\n5| f",
                - 	`unc greeting() {\n6| \tfmt.Println(\"Hello world!\")\n7| }\n8|  `,
                - 	`func main() {\n9| func main() {\n10| \tgreeting()\n11| }\n12| \n`,
                - 	"```\\n\\n```\\n0|  package main\\n1| package main\\n2| \\n3| import \\\"",
                - 	`fmt\"\n4| \n5| func greeting() {\n6| \tfmt.Println(\"Hello world`,
                - 	"!\\\")\\n7| }\\n8| \\n9| func main() {\\n10| \\tgreeting()\\n```\\n\\n```\\",
                - 	`n1| package main\n2| \n3| import \"fmt\"\n4|  func greeting() {\`,
                - 	`n5| func greeting() {\n6| \tfmt.Println(\"Hello world!\")\n7| }\`,
                - 	"n8| \\n9| func main() {\\n10| \\tgreeting()\\n11| }\\n12| \\n```\\n\\n##",
                - 	" Result 2: github.com/GoesToEleven/GolangTraining/14_functions/1",
                - 	`0_func-expression/02_func-expression/main.go\n\nURL: /github.com`,
                - 	"/GoesToEleven/GolangTraining/-/blob/14_functions/10_func-express",
                - 	"ion/02_func-expression/main.go\\n\\n```\\n1| package main\\n2| \\n3| ",
                - 	`import \"fmt\"\n4|  func main() {\n5| func main() {\n6| \n7| \tg`,
                - 	`reeting := func() {\n8| \t\tfmt.Println(\"Hello world!\")\n9| \t`,
                - 	"}\\n10| \\n11| \\tgreeting()\\n12| }\\n13| \\n```\\n\\n```\\n1| package m",
                - 	`ain\n2| \n3| import \"fmt\"\n4| \n5| func main() {\n6|  \tgreeti`,
                - 	`ng := func() {\n7| \tgreeting := func() {\n8| \t\tfmt.Println(\"`,
                - 	"Hello world!\\\")\\n9| \\t}\\n10| \\n11| \\tgreeting()\\n12| }\\n13| \\n``",
                - 	"`\\n\\n```\\n0|  package main\\n1| package main\\n2| \\n3| import \\\"fm",
                - 	`t\"\n4| \n5| func main() {\n6| \n7| \tgreeting := func() {\n8| \`,
                - 	"t\\tfmt.Println(\\\"Hello world!\\\")\\n9| \\t}\\n10| \\n```\\n\\n## Result",
                - 	" 3: github.com/GoesToEleven/GolangTraining/14_functions/10_func-",
                - 	`expression/03_func-expression_shows-type/main.go\n\nURL: /github`,
                - 	".com/GoesToEleven/GolangTraining/-/blob/14_functions/10_func-exp",
                - 	"ression/03_func-expression_shows-type/main.go\\n\\n```\\n1| package",
                - 	` main\n2| \n3| import \"fmt\"\n4|  func main() {\n5| func main()`,
                - 	` {\n6| \n7| \tgreeting := func() {\n8| \t\tfmt.Println(\"Hello w`,
                - 	`orld!\")\n9| \t}\n10| \n11| \tgreeting()\n12| \tfmt.Printf(\"%T\`,
                - 	"\\n\\\", greeting)\\n13| }\\n14| \\n```\\n\\n```\\n1| package main\\n2| \\n",
                - 	`3| import \"fmt\"\n4| \n5| func main() {\n6|  \tgreeting := func`,
                - 	`() {\n7| \tgreeting := func() {\n8| \t\tfmt.Println(\"Hello worl`,
                - 	`d!\")\n9| \t}\n10| \n11| \tgreeting()\n12| \tfmt.Printf(\"%T\\n\`,
                - 	"\", greeting)\\n13| }\\n14| \\n```\\n\\n```\\n0|  package main\\n1| pack",
                - 	`age main\n2| \n3| import \"fmt\"\n4| \n5| func main() {\n6| \n7|`,
                - 	` \tgreeting := func() {\n8| \t\tfmt.Println(\"Hello world!\")\n9`,
                - 	"| \\t}\\n10| \\n```\\n\\n## Result 4: github.com/GoesToEleven/GolangT",
                - 	"raining/14_functions/10_func-expression/04_another-way_func-expr",
                - 	`ession/main.go\n\nURL: /github.com/GoesToEleven/GolangTraining/-`,
                - 	"/blob/14_functions/10_func-expression/04_another-way_func-expres",
                - 	"sion/main.go\\n\\n```\\n1| package main\\n2| \\n3| import \\\"fmt\\\"\\n4|",
                - 	` \n5| func makeGreeter() func() string {\n6| \treturn func() str`,
                - 	`ing {\n7| \t\treturn \"Hello world!\"\n8| \t}\n9| }\n10|  func m`,
                - 	`ain() {\n11| func main() {\n12| \tgreet := makeGreeter()\n13| \t`,
                - 	"fmt.Println(greet())\\n14| }\\n15| \\n```\\n\\n```\\n0|  package main\\",
                - 	`n1| package main\n2| \n3| import \"fmt\"\n4| \n5| func makeGreet`,
                - 	`er() func() string {\n6| \treturn func() string {\n7| \t\treturn`,
                - 	" \\\"Hello world!\\\"\\n8| \\t}\\n9| }\\n10| \\n```\\n\\n```\\n1| package ma",
                - 	`in\n2| \n3| import \"fmt\"\n4|  func makeGreeter() func() string`,
                - 	` {\n5| func makeGreeter() func() string {\n6| \treturn func() st`,
                - 	`ring {\n7| \t\treturn \"Hello world!\"\n8| \t}\n9| }\n10| \n11| `,
                - 	`func main() {\n12| \tgreet := makeGreeter()\n13| \tfmt.Println(g`,
                - 	"reet())\\n14| }\\n```\\n\\n```\\n1| package main\\n2| \\n3| import \\\"fm",
                - 	`t\"\n4| \n5|  \treturn func() string {\n6| \treturn func() strin`,
                - 	`g {\n7| \t\treturn \"Hello world!\"\n8| \t}\n9| }\n10| \n11| fun`,
                - 	`c main() {\n12| \tgreet := makeGreeter()\n13| \tfmt.Println(gree`,
                - 	"t())\\n14| }\\n15| \\n```\\n\\n## Result 5: github.com/Code-Hex/funcy",
                - 	`-mock/cmd/funcygen/main.go\n\nURL: /github.com/Code-Hex/funcy-mo`,
                - 	"ck/-/blob/cmd/funcygen/main.go\\n\\n```\\n1| package main\\n2| \\n3| ",
                - 	`import (\n4| \t\"os\"\n5| \n6| \tfuncy \"github.com/Code-Hex/fun`,
                - 	`cy-mock\"\n7| )\n8|  func main() {\n9| func main() {\n10| \tos.E`,
                - 	"xit(funcy.Run())\\n11| }\\n12| \\n```\\n\\n```\\n1| package main\\n2| \\",
                - 	`n3| import (\n4| \t\"os\"\n5| \n6| \tfuncy \"github.com/Code-Hex`,
                - 	`/funcy-mock\"\n7| )\n8| \n9|  \tos.Exit(funcy.Run())\n10| \tos.E`,
                - 	"xit(funcy.Run())\\n11| }\\n12| \\n```\\n\\n```\\n0|  package main\\n1| ",
                - 	`package main\n2| \n3| import (\n4| \t\"os\"\n5| \n6| \tfuncy \"g`,
                - 	`ithub.com/Code-Hex/funcy-mock\"\n7| )\n8| \n9| func main() {\n10`,
                - 	"| \\tos.Exit(funcy.Run())\\n```\\n\\n```\\n1| package main\\n2| \\n3| i",
                - 	`mport (\n4| \t\"os\"\n5|  \tfuncy \"github.com/Code-Hex/funcy-mo`,
                - 	`ck\"\n6| \tfuncy \"github.com/Code-Hex/funcy-mock\"\n7| )\n8| \n`,
                - 	"9| func main() {\\n10| \\tos.Exit(funcy.Run())\\n11| }\\n12| \\n```\\n",
                - 	`\n## Result 6: github.com/start-to-learning-go-language/formerca`,
                - 	`ri/.go\n\nURL: /github.com/start-to-learning-go-lang`,
                - 	`uage/formercari/-/blob/%E5%9E%8B%E3%81%AE%E5%AE%A3%E8%A8%80.go\n`,
                - 	"\\n```\\n29| }\\n30| \\n31| package main\\n32| \\n33| import \\\"fmt\\\"\\n",
                - 	`34| \n35| type Dictionary struct {\n36| \tname string\n37| \tmea`,
                - 	`ning string\n38| }\n39|  type ReadFunc func(Dictionary) string\n`,
                - 	`40| type ReadFunc func(Dictionary) string\n41| \n42| func main()`,
                - 	` {\n43| \tvar readFunc ReadFunc\n44| \tvar dict Dictionary\n45| `,
                - 	`\treadFunc = readOut\n46| \tdict.name = \"\"\n47| \t`,
                - 	"dict.meaning = \\\"\xe3\x81",
                - 	"\xbf\\\"\\n48| \\tfmt.Println(readFunc(dict))\\n49| }\\n```\\n\\n```\\n31",
                - 	`| package main\n32| \n33| import \"fmt\"\n34| \n35| type Diction`,
                - 	`ary struct {\n36| \tname string\n37| \tmeaning string\n38| }\n39`,
                - 	`| \n40| type ReadFunc func(Dictionary) string\n41|  func main() `,
                - 	`{\n42| func main() {\n43| \tvar readFunc ReadFunc\n44| \tvar dic`,
                - 	"t Dictionary\\n45| \\treadFunc = readOut\\n46| \\tdict.name = \\\"\xe3",
                - 	"\x83\xbc\\\"\\n47| \\tdict.meaning = \\\"\xe3\x82",
                - 	"\x8c\\\"\\n48| \\tfmt.Println(readFunc(dict))\\n49|",
                - 	" }\\n50| \\n51| func readOut(d Dictionary) string {\\n```\\n\\n```\\n3",
                - 	`2| \n33| import \"fmt\"\n34| \n35| type Dictionary struct {\n36|`,
                - 	` \tname string\n37| \tmeaning string\n38| }\n39| \n40| type Read`,
                - 	`Func func(Dictionary) string\n41| \n42|  \tvar readFunc ReadFunc`,
                - 	`\n43| \tvar readFunc ReadFunc\n44| \tvar dict Dictionary\n45| \t`,
                - 	`readFunc = readOut\n46| \tdict.name = \"\"\n47| \tdi`,
                - 	"ct.meaning = \\\"\xe7",
                - 	"\x89\xa9\\\"\\n48| \\tfmt.Println(readFunc(dict))\\n49| }\\n50| \\n51| func r",
                - 	`eadOut(d Dictionary) string {\n52| \treturn fmt.Sprintf(\"`,
                - 	"s%s,d.name,d.meaning\\\")\\n```\\n\\",
                - 	"n```\\n34| \\n35| type Dictionary struct {\\n36| \\tname string\\n37|",
                - 	` \tmeaning string\n38| }\n39| \n40| type ReadFunc func(Dictionar`,
                - 	`y) string\n41| \n42| func main() {\n43| \tvar readFunc ReadFunc\`,
                - 	`n44|  \treadFunc = readOut\n45| \treadFunc = readOut\n46| \tdict`,
                - 	`.name = \"\"\n47| \tdict.meaning = \"`,
                - 	`\"\n48| \tfmt.Println(readFu`,
                - 	`nc(dict))\n49| }\n50| \n51| func readOut(d Dictionary) string {\`,
                - 	`n52| \treturn fmt.Sprintf(\"s%s`,
                - 	",d.name,d.meaning\\\")\\n53| }\\n54| \\n```\\n\\n```\\n1| package ",
                - 	`main\n2| \n3| import \"fmt\"\n4| \n5| type Score int\n6|  func m`,
                - 	`ain() {\n7| func main() {\n8| \tvar myScore Score = 100\n9| \tfm`,
                - 	`t.Printf(\"%d\\n\",myScore)\n10| }\n1`,
                - 	`1| \n12| //\n13| \n14| package main\n15| \n16|`,
                - 	" import \\\"fmt\\\"\\n```\\n\\n```\\n57| func main() {\\n58| \\tvar myScor",
                - 	`e Score = 100\n59| \tmyScore.Show()\n60| }\n61| \n62| package ma`,
                - 	`in\n63| \n64| import \"fmt\"\n65| \n66| type Score int\n67|  fun`,
                - 	`c main() {\n68| func main() {\n69| \tvar myScore Score = 100\n70`,
                - 	`| \tshowInt(int(myScore))\n71| }\n72| \n73| func showInt(i int) `,
                - 	"{\\n74| \\tfmt.Printf(\\\"value: %d\\\\n\\\", i)\\n75| }\\n```\\n\\n```\\n7| ",
                - 	"func main() {\\n8| \\tvar myScore Score = 100\\n9| \\tfmt.Printf(\\\"\xe7",
                - 	"\xa7\x81%d\\\\n\\\",myScore)\\n10| }\\n11| \\n12| //\xe5",
                - 	"\x8f\xaf\\n13| \\n14| package main\\n15| \\n16| import \\\"fm",
                - 	`t\"\n17|  func main() {\n18| func main() {\n19| \tvar readFunc f`,
                - 	`unc(struct{name string; meaning string}) string\n20| \tvar dict `,
                - 	`struct{name string; meaning string}\n21| \treadFunc = readOut\n2`,
                - 	`2| \tdict.name = \"\"\n23| \tdict.meaning = \"`,
                - 	`\"\n24| \tfmt.Print`,
                - 	`ln(readFunc(dict))\n25| }\n26| \n27| func readOut(s struct{name `,
                - 	"string; meaning string}) string {\\n```\\n\\n```\\n8| \\tvar myScore ",
                - 	`Score = 100\n9| \tfmt.Printf(\"%d\\n\`,
                - 	`",myScore)\n10| }\n11| \n12| //\n13| \n14| pac`,
                - 	`kage main\n15| \n16| import \"fmt\"\n17| \n18|  \tvar readFunc f`,
                - 	`unc(struct{name string; meaning string}) string\n19| \tvar readF`,
                - 	`unc func(struct{name string; meaning string}) string\n20| \tvar `,
                - 	`dict struct{name string; meaning string}\n21| \treadFunc = readO`,
                - 	"ut\\n22| \\tdict.name = \\\"\\\"\\n23| \\tdict.meaning = \\\"\xe3",
                - 	"\x82\xb3\\\"\\n24| \\tfmt.",
                - 	`Println(readFunc(dict))\n25| }\n26| \n27| func readOut(s struct{`,
                - 	`name string; meaning string}) string {\n28| \treturn fmt.Sprintf`,
                - 	"(\\\"\\\",s.name,s.meaning)\\n```",
                - 	`\n\n","tool_call_id":"sourcegraph:0","role":"tool"}],"model":"mo`,
                - 	`onshotai/kimi-k2-0905","max_tokens":10000,"stream_options":{"inc`,
                - 	`lude_usage":true},"tool_choice":"auto","tools":[{"function":{"na`,
                - 	`me":"bash","strict":false,"description":"Executes bash commands `,
                - 	`with automatic background conversion for long-running tasks.\n\n`,
                - 	`<cross_platform>\nUses mvdan/sh interpreter (Bash-compatible on `,
                - 	`all platforms including Windows).\nUse forward slashes for paths`,
                - 	`: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\`,
                - 	`n\n<execution_steps>\n1. Directory Verification: Use LS tool to `,
                - 	`verify parent exists before creating files\n2. Security Check: N`,
                - 	"o restrictions - explain to user. Safe read-only commands execut",
                - 	`e without prompts\n3. Command Execution: Execute with proper quo`,
                - 	`ting, capture output\n4. Auto-Background: Commands >1 minute aut`,
                - 	`omatically move to background, return shell ID\n5. Output Proces`,
                - 	`sing: Truncate if exceeds 30000 characters\n6. Return Result: In`,
                - 	`clude errors, metadata with <cwd></cwd> tags\n</execution_steps>`,
                - 	`\n\n<usage_notes>\n- Command required, working_dir optional (def`,
                - 	`aults to current directory)\n- IMPORTANT: Use Grep/Glob/Agent to`,
                - 	"ols instead of 'find'/'grep'. Use View/LS instead of 'cat'/'head",
                - 	`'/'tail'/'ls'\n- Chain with ';' or '&&', avoid newlines except i`,
                - 	`n quoted strings\n- Each command runs in independent shell (no s`,
                - 	`tate persistence)\n- Prefer absolute paths over 'cd'\n</usage_no`,
                - 	`tes>\n\n<background_execution>\n- Set run_in_background=true for`,
                - 	` separate background shell\n- Returns shell ID for management\n-`,
                - 	` Use job_output tool to view output, job_kill to terminate\n- NE`,
                - 	"VER use `&` at end of commands - use run_in_background parameter",
                - 	`\n- Background: Long servers (npm start, python -m http.server),`,
                - 	` watch tasks, continuous processes\n- Foreground: Builds, tests,`,
                - 	` git ops, file ops, short scripts\n</background_execution>\n\n<g`,
                - 	`it_commits>\nWhen user asks to create git commit:\n\n1. Run: git`,
                - 	" status, git diff, git log (single message, three tool_use block",
                - 	`s)\n2. Add relevant untracked files to staging\n3. Analyze in <c`,
                - 	`ommit_analysis> tags:\n   - List changed files, summarize nature`,
                - 	` (feature/bug fix/refactor/docs)\n   - Draft concise (1-2 senten`,
                - 	`ces) focusing on \"why\" not \"what\"\n   - Use accurate verbs: `,
                - 	`\"add\"=new feature, \"update\"=enhancement, \"fix\"=bug\n4. Cre`,
                - 	"ate commit with attribution:\\n   ```bash\\n   git commit -m \\\"$(c",
                - 	`at &lt;&lt;'EOF'\n   Commit message here.\n\n    Generated w`,
                - 	`ith Crush\n\n\n   Co-Authored-By: Crush <crush@charm.land>\n\n  `,
                - 	" EOF\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, retry ONCE. I",
                - 	`f succeeds but files modified, MUST amend.\n6. Run git status to`,
                - 	` verify.\n\nNotes: Use \"git commit -am\" when possible, don't s`,
                - 	"tage unrelated files, NEVER update config, don't push, no empty ",
                - 	`commits.\n</git_commits>\n\n<pull_requests>\nWhen user asks to c`,
                - 	`reate PR:\n\n1. Run: git status, git diff, check remote tracking`,
                - 	`, git log and 'git diff main...HEAD'\n2. Create branch if needed`,
                - 	`, commit if needed, push with -u if needed\n3. Analyze in <pr_an`,
                - 	`alysis> tags:\n   - List commits since main divergence\n   - Sum`,
                - 	`marize changes, purpose/motivation\n   - Draft concise (1-2 bull`,
                - 	"ets) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr cr",
                - 	`eate --title \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summa`,
                - 	`ry\n   &lt;1-3 bullet points>\n   \n   ## Test plan\n   [Checkli`,
                - 	"st...]\\n\\n    Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```",
                - 	`\n\nImportant: Return empty response, never update git config\n<`,
                - 	`/pull_requests>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad:`,
                - 	` cd /foo/bar && pytest tests\n</examples>\n","parameters":{"prop`,
                - 	`erties":{"command":{"description":"The command to execute","type`,
                - 	`":"string"},"description":{"description":"A brief description of`,
                - 	" what the command does, try to keep it under 30 characters or so",
                - 	`","type":"string"},"run_in_background":{"description":"Set to tr`,
                - 	"ue (boolean) to run this command in the background. Use job_outp",
                - 	`ut to read the output later.","type":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:490: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:490
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/sourcegraph_tool
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/write_tool (0.40s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/write_tool".
                Diff:
                  strings.Join({
                  	... // 4651 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 4511 identical bytes
                  	`cription":"Set to true (boolean) to run this command in the back`,
                  	`ground. Use job_output to read the output later.","type":"boolea`,
                + 	`n"},"shell_id":{"description":"ONLY use for continuing existing `,
                + 	"background jobs. Do NOT provide for new commands - sessions are ",
                + 	`managed automatically.","type":"stri`,
                  	"n",
                + 	"g",
                  	`"},"working_dir":{"description":"The working directory to execut`,
                  	`e the command in (defaults to current directory)","type":"string`,
                  	... // 24122 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/write_tool".
                Diff:
                  strings.Join({
                  	... // 4651 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 576 identical bytes
                  	`t":"use write to create a new file called config.json with conte`,
                  	`nt '{\"name\": \"test\", \"version\": \"1.0.0\"}'","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"write:0","function":{"arguments":"{\"file_pa`,
                - 	`th\": \"/tmp/nexora-test/TestCoderAgent/openrouter-kimi-k2/write`,
                - 	`_tool/config.json\", \"content\": \"{\\\"name\\\": \\\"test\\\",`,
                - 	` \\\"version\\\": \\\"1.0.0\\\"}\"}","name":"write"},"type":"fun`,
                - 	`ction","cache_control":{"type":"ephemeral"}}],"role":"assistant"`,
                - 	`},{"content":"<result>\nFile successfully written: /tmp/nexora-t`,
                - 	`est/TestCoderAgent/openrouter-kimi-k2/write_tool/config.json\n</`,
                - 	`result>","tool_call_id":"write:0","role":"tool"}],"model":"moons`,
                - 	`hotai/kimi-k2-0905","max_tokens":10000,"stream_options":{"includ`,
                - 	`e_usage":true},"tool_choice":"auto","tools":[{"function":{"name"`,
                - 	`:"bash","strict":false,"description":"Executes bash commands wit`,
                - 	`h automatic background conversion for long-running tasks.\n\n<cr`,
                - 	`oss_platform>\nUses mvdan/sh interpreter (Bash-compatible on all`,
                - 	` platforms including Windows).\nUse forward slashes for paths: \`,
                - 	`"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n`,
                - 	`<execution_steps>\n1. Directory Verification: Use LS tool to ver`,
                - 	`ify parent exists before creating files\n2. Security Check: No r`,
                - 	"estrictions - explain to user. Safe read-only commands execute w",
                - 	`ithout prompts\n3. Command Execution: Execute with proper quotin`,
                - 	`g, capture output\n4. Auto-Background: Commands >1 minute automa`,
                - 	`tically move to background, return shell ID\n5. Output Processin`,
                - 	`g: Truncate if exceeds 30000 characters\n6. Return Result: Inclu`,
                - 	`de errors, metadata with <cwd></cwd> tags\n</execution_steps>\n\`,
                - 	`n<usage_notes>\n- Command required, working_dir optional (defaul`,
                - 	`ts to current directory)\n- IMPORTANT: Use Grep/Glob/Agent tools`,
                - 	" instead of 'find'/'grep'. Use View/LS instead of 'cat'/'head'/'",
                - 	`tail'/'ls'\n- Chain with ';' or '&&', avoid newlines except in q`,
                - 	`uoted strings\n- Each command runs in independent shell (no stat`,
                - 	`e persistence)\n- Prefer absolute paths over 'cd'\n</usage_notes`,
                - 	`>\n\n<background_execution>\n- Set run_in_background=true for se`,
                - 	`parate background shell\n- Returns shell ID for management\n- Us`,
                - 	`e job_output tool to view output, job_kill to terminate\n- NEVER`,
                - 	" use `&` at end of commands - use run_in_background parameter\\n-",
                - 	" Background: Long servers (npm start, python -m http.server), wa",
                - 	`tch tasks, continuous processes\n- Foreground: Builds, tests, gi`,
                - 	`t ops, file ops, short scripts\n</background_execution>\n\n<git_`,
                - 	`commits>\nWhen user asks to create git commit:\n\n1. Run: git st`,
                - 	`atus, git diff, git log (single message, three tool_use blocks)\`,
                - 	`n2. Add relevant untracked files to staging\n3. Analyze in <comm`,
                - 	`it_analysis> tags:\n   - List changed files, summarize nature (f`,
                - 	`eature/bug fix/refactor/docs)\n   - Draft concise (1-2 sentences`,
                - 	`) focusing on \"why\" not \"what\"\n   - Use accurate verbs: \"a`,
                - 	`dd\"=new feature, \"update\"=enhancement, \"fix\"=bug\n4. Create`,
                - 	" commit with attribution:\\n   ```bash\\n   git commit -m \\\"$(cat ",
                - 	`&lt;&lt;'EOF'\n   Commit message here.\n\n    Generated with`,
                - 	` Crush\n\n\n   Co-Authored-By: Crush <crush@charm.land>\n\n   EO`,
                - 	"F\\n   )\\\"\\n   ```\\n5. If pre-commit hook fails, retry ONCE. If s",
                - 	`ucceeds but files modified, MUST amend.\n6. Run git status to ve`,
                - 	`rify.\n\nNotes: Use \"git commit -am\" when possible, don't stag`,
                - 	"e unrelated files, NEVER update config, don't push, no empty com",
                - 	`mits.\n</git_commits>\n\n<pull_requests>\nWhen user asks to crea`,
                - 	`te PR:\n\n1. Run: git status, git diff, check remote tracking, g`,
                - 	`it log and 'git diff main...HEAD'\n2. Create branch if needed, c`,
                - 	`ommit if needed, push with -u if needed\n3. Analyze in <pr_analy`,
                - 	`sis> tags:\n   - List commits since main divergence\n   - Summar`,
                - 	`ize changes, purpose/motivation\n   - Draft concise (1-2 bullets`,
                - 	") focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr creat",
                - 	`e --title \"title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\`,
                - 	`n   &lt;1-3 bullet points>\n   \n   ## Test plan\n   [Checklist.`,
                - 	"..]\\n\\n    Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\",
                - 	`nImportant: Return empty response, never update git config\n</pu`,
                - 	`ll_requests>\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd`,
                - 	` /foo/bar && pytest tests\n</examples>\n","parameters":{"propert`,
                - 	`ies":{"command":{"description":"The command to execute","type":"`,
                - 	`string"},"description":{"description":"A brief description of wh`,
                - 	`at the command does, try to keep it under 30 characters or so","`,
                - 	`type":"string"},"run_in_background":{"description":"Set to true `,
                - 	"(boolean) to run this command in the background. Use job_output ",
                - 	`to read the output later.","type":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:529: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:529
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/write_tool
            testing.go:1617: race detected during execution of test
        --- FAIL: TestCoderAgent/openrouter-kimi-k2/parallel_tool_calls (0.34s)
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/parallel_tool_calls".
                Diff:
                  strings.Join({
                  	... // 4660 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 4536 identical bytes
                  	`cription":"Set to true (boolean) to run this command in the back`,
                  	`ground. Use job_output to read the output later.","type":"boolea`,
                + 	`n"},"shell_id":{"description":"ONLY use for continuing existing `,
                + 	"background jobs. Do NOT provide for new commands - sessions are ",
                + 	`managed automatically.","type":"stri`,
                  	"n",
                + 	"g",
                  	`"},"working_dir":{"description":"The working directory to execut`,
                  	`e the command in (defaults to current directory)","type":"string`,
                  	... // 24122 identical bytes
                  }, "")
            matcher.go:69: Request interaction not found for "TestCoderAgent/openrouter-kimi-k2/parallel_tool_calls".
                Diff:
                  strings.Join({
                  	... // 4660 identical bytes
                  	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
                  	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
                - 	"4",
                + 	"3",
                  	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
                  	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
                  	... // 601 identical bytes
                  	".go files and use ls to list the current directory, it is very i",
                  	`mportant that you run both tool calls in parallel","role":"user"`,
                - 	"}",
                  	",",
                - 	"{",
                  	`"`,
                - 	`tool_calls":[{"id":"glob:0","function":{"arguments":"{\"pattern\`,
                - 	`": \"**/*.go\"}","name":"glob"},"type":"function"},{"id":"ls:1",`,
                - 	`"function":{"arguments":"{\"path\": \".\"}","name":"ls"},"type":`,
                - 	`"function","cache_control":{"type":"ephemeral"}}],"role":"assist`,
                - 	`ant"},{"content":"/tmp/nexora-test/TestCoderAgent/openrouter-kim`,
                - 	`i-k2/parallel_tool_calls/main.go","tool_call_id":"glob:0","role"`,
                - 	`:"tool"},{"content":"\n- /tmp/nexora-test/TestCoderAgent/openrou`,
                - 	`ter-kimi-k2/parallel_tool_calls/\n  - go.mod\n  - main.go\n","to`,
                - 	`ol_call_id":"ls:1","role":"tool"}],"model":"moonshotai/kimi-k2-0`,
                - 	`905","max_tokens":10000,"stream_options":{"include_usage":true},`,
                - 	`"tool_choice":"auto","tools":[{"function":{"name":"bash","strict`,
                - 	`":false,"description":"Executes bash commands with automatic bac`,
                - 	`kground conversion for long-running tasks.\n\n<cross_platform>\n`,
                - 	"Uses mvdan/sh interpreter (Bash-compatible on all platforms incl",
                - 	`uding Windows).\nUse forward slashes for paths: \"ls C:/foo/bar\`,
                - 	`" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_step`,
                - 	`s>\n1. Directory Verification: Use LS tool to verify parent exis`,
                - 	`ts before creating files\n2. Security Check: No restrictions - e`,
                - 	`xplain to user. Safe read-only commands execute without prompts\`,
                - 	"n3. Command Execution: Execute with proper quoting, capture outp",
                - 	`ut\n4. Auto-Background: Commands >1 minute automatically move to`,
                - 	` background, return shell ID\n5. Output Processing: Truncate if `,
                - 	`exceeds 30000 characters\n6. Return Result: Include errors, meta`,
                - 	`data with <cwd></cwd> tags\n</execution_steps>\n\n<usage_notes>\`,
                - 	"n- Command required, working_dir optional (defaults to current d",
                - 	`irectory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of 'fi`,
                - 	`nd'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n- C`,
                - 	`hain with ';' or '&&', avoid newlines except in quoted strings\n`,
                - 	`- Each command runs in independent shell (no state persistence)\`,
                - 	`n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgroun`,
                - 	`d_execution>\n- Set run_in_background=true for separate backgrou`,
                - 	`nd shell\n- Returns shell ID for management\n- Use job_output to`,
                - 	"ol to view output, job_kill to terminate\\n- NEVER use `&` at end",
                - 	` of commands - use run_in_background parameter\n- Background: Lo`,
                - 	"ng servers (npm start, python -m http.server), watch tasks, cont",
                - 	`inuous processes\n- Foreground: Builds, tests, git ops, file ops`,
                - 	`, short scripts\n</background_execution>\n\n<git_commits>\nWhen `,
                - 	`user asks to create git commit:\n\n1. Run: git status, git diff,`,
                - 	` git log (single message, three tool_use blocks)\n2. Add relevan`,
                - 	`t untracked files to staging\n3. Analyze in <commit_analysis> ta`,
                - 	`gs:\n   - List changed files, summarize nature (feature/bug fix/`,
                - 	`refactor/docs)\n   - Draft concise (1-2 sentences) focusing on \`,
                - 	`"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new featur`,
                - 	`e, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with at`,
                - 	"tribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF'\\n",
                - 	`   Commit message here.\n\n    Generated with Crush\n\n\n   `,
                - 	"Co-Authored-By: Crush <crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   `",
                - 	"``\\n5. If pre-commit hook fails, retry ONCE. If succeeds but fil",
                - 	`es modified, MUST amend.\n6. Run git status to verify.\n\nNotes:`,
                - 	` Use \"git commit -am\" when possible, don't stage unrelated fil`,
                - 	`es, NEVER update config, don't push, no empty commits.\n</git_co`,
                - 	`mmits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1. Ru`,
                - 	"n: git status, git diff, check remote tracking, git log and 'git",
                - 	` diff main...HEAD'\n2. Create branch if needed, commit if needed`,
                - 	`, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n   `,
                - 	`- List commits since main divergence\n   - Summarize changes, pu`,
                - 	`rpose/motivation\n   - Draft concise (1-2 bullets) focusing on \`,
                - 	"\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"tit",
                - 	`le\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bul`,
                - 	`let points>\n   \n   ## Test plan\n   [Checklist...]\n\n    `,
                - 	"Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Ret",
                - 	`urn empty response, never update git config\n</pull_requests>\n\`,
                - 	`n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar && py`,
                - 	`test tests\n</examples>\n","parameters":{"properties":{"command"`,
                - 	`:{"description":"The command to execute","type":"string"},"descr`,
                - 	`iption":{"description":"A brief description of what the command `,
                - 	`does, try to keep it under 30 characters or so","type":"string"}`,
                - 	`,"run_in_background":{"description":"Set to true (boolean) to ru`,
                - 	"n this command in the background. Use job_output to read the out",
                - 	`put later.","type":"boolean`,
                + 	`cache_control":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k`,
                + 	`2-0905","max_tokens":10000,"stream_options":{"include_usage":tru`,
                + 	`e},"tool_choice":"auto","tools":[{"function":{"name":"bash","str`,
                + 	`ict":false,"description":"Executes bash commands with automatic `,
                + 	`background conversion for long-running tasks.\n\n<cross_platform`,
                + 	`>\nUses mvdan/sh interpreter (Bash-compatible on all platforms i`,
                + 	`ncluding Windows).\nUse forward slashes for paths: \"ls C:/foo/b`,
                + 	`ar\" not \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_s`,
                + 	`teps>\n1. Directory Verification: Use LS tool to verify parent e`,
                + 	`xists before creating files\n2. Security Check: No restrictions `,
                + 	"- explain to user. Safe read-only commands execute without promp",
                + 	`ts\n3. Command Execution: Execute with proper quoting, capture o`,
                + 	`utput\n4. Auto-Background: Commands >1 minute automatically move`,
                + 	` to background, return shell ID\n5. Output Processing: Truncate `,
                + 	`if exceeds 30000 characters\n6. Return Result: Include errors, m`,
                + 	`etadata with <cwd></cwd> tags\n</execution_steps>\n\n<usage_note`,
                + 	`s>\n- Command required, working_dir optional (defaults to curren`,
                + 	`t directory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of `,
                + 	`'find'/'grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n`,
                + 	"- Chain with ';' or '&&', avoid newlines except in quoted string",
                + 	`s\n- Each command runs in independent shell (no state persistenc`,
                + 	`e)\n- Prefer absolute paths over 'cd'\n</usage_notes>\n\n<backgr`,
                + 	`ound_execution>\n- Set run_in_background=true for separate backg`,
                + 	`round shell\n- Returns shell ID for management\n- Use job_output`,
                + 	" tool to view output, job_kill to terminate\\n- NEVER use `&` at ",
                + 	`end of commands - use run_in_background parameter\n- Background:`,
                + 	" Long servers (npm start, python -m http.server), watch tasks, c",
                + 	`ontinuous processes\n- Foreground: Builds, tests, git ops, file `,
                + 	`ops, short scripts\n</background_execution>\n\n<git_commits>\nWh`,
                + 	`en user asks to create git commit:\n\n1. Run: git status, git di`,
                + 	`ff, git log (single message, three tool_use blocks)\n2. Add rele`,
                + 	`vant untracked files to staging\n3. Analyze in <commit_analysis>`,
                + 	` tags:\n   - List changed files, summarize nature (feature/bug f`,
                + 	`ix/refactor/docs)\n   - Draft concise (1-2 sentences) focusing o`,
                + 	`n \"why\" not \"what\"\n   - Use accurate verbs: \"add\"=new fea`,
                + 	`ture, \"update\"=enhancement, \"fix\"=bug\n4. Create commit with`,
                + 	" attribution:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF",
                + 	`'\n   Commit message here.\n\n    Generated with Crush\n\n\n`,
                + 	`   Co-Authored-By: Crush <crush@charm.land>\n\n   EOF\n   )\"\n `,
                + 	"  ```\\n5. If pre-commit hook fails, retry ONCE. If succeeds but ",
                + 	`files modified, MUST amend.\n6. Run git status to verify.\n\nNot`,
                + 	`es: Use \"git commit -am\" when possible, don't stage unrelated `,
                + 	`files, NEVER update config, don't push, no empty commits.\n</git`,
                + 	`_commits>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1.`,
                + 	" Run: git status, git diff, check remote tracking, git log and '",
                + 	`git diff main...HEAD'\n2. Create branch if needed, commit if nee`,
                + 	`ded, push with -u if needed\n3. Analyze in <pr_analysis> tags:\n`,
                + 	`   - List commits since main divergence\n   - Summarize changes,`,
                + 	` purpose/motivation\n   - Draft concise (1-2 bullets) focusing o`,
                + 	"n \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"",
                + 	`title\" --body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 `,
                + 	"bullet points>\\n   \\n   ## Test plan\\n   [Checklist...]\\n\\n   \xf0\x9f",
                + 	"\x92\x98 Generated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: ",
                + 	`Return empty response, never update git config\n</pull_requests>`,
                + 	`\n\n<examples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar &&`,
                + 	` pytest tests\n</examples>\n","parameters":{"properties":{"comma`,
                + 	`nd":{"description":"The command to execute","type":"string"},"de`,
                + 	`scription":{"description":"A brief description of what the comma`,
                + 	`nd does, try to keep it under 30 characters or so","type":"strin`,
                + 	`g"},"run_in_background":{"description":"Set to true (boolean) to`,
                + 	" run this command in the background. Use job_output to read the ",
                + 	`output later.","type":"boolean"},"shell_id":{"description":"ONLY`,
                + 	" use for continuing existing background jobs. Do NOT provide for",
                + 	` new commands - sessions are managed automatically.","type":"str`,
                + 	"ing",
                  	... // 24250 identical bytes
                  }, "")
            agent_test.go:574: 
                	Error Trace:	/home/nexora/internal/agent/agent_test.go:574
                	Error:      	Received unexpected error:
                	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
                	Test:       	TestCoderAgent/openrouter-kimi-k2/parallel_tool_calls
==================
WARNING: DATA RACE
Write at 0x00c000f0e380 by goroutine 942:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:559 +0x1da4
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:553 +0x1cf3
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession.func1()
      /home/nexora/internal/agent/session_title_test.go:44 +0x47c
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession.func1()
      /home/nexora/internal/agent/session_title_test.go:39 +0x294
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession.func1()
      /home/nexora/internal/agent/session_title_test.go:36 +0x16f
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c000f0e380 by goroutine 958:
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run.func1()
      /home/nexora/internal/agent/agent.go:545 +0x5c
  sync.(*WaitGroup).Go.func1()
      /usr/lib/go/src/sync/waitgroup.go:239 +0x5d

Goroutine 942 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession()
      /home/nexora/internal/agent/session_title_test.go:30 +0x1e4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 958 (running) created at:
  sync.(*WaitGroup).Go()
      /usr/lib/go/src/sync/waitgroup.go:237 +0x86
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:543 +0x1bda
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:534 +0x1556
  github.com/nexora/nexora/internal/agent.(*sessionAgent).Run()
      /home/nexora/internal/agent/agent.go:529 +0x12f2
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession.func1()
      /home/nexora/internal/agent/session_title_test.go:44 +0x47c
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession.func1()
      /home/nexora/internal/agent/session_title_test.go:39 +0x294
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/agent.testEnv()
      /home/nexora/internal/agent/common_test.go:111 +0x1ce
  github.com/nexora/nexora/internal/agent.setupAgent()
      /home/nexora/internal/agent/agent_test.go:38 +0x10b
  github.com/nexora/nexora/internal/agent.TestTitleGenerationForNewSession.func1()
      /home/nexora/internal/agent/session_title_test.go:36 +0x16f
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
--- FAIL: TestTitleGenerationForNewSession (0.58s)
    --- FAIL: TestTitleGenerationForNewSession/anthropic-sonnet/title_generation (0.14s)
        matcher.go:69: Request interaction not found for "TestTitleGenerationForNewSession/anthropic-sonnet/title_generation".
            Diff:
              strings.Join({
              	`{"max_tokens":`,
            - 	"1000",
            + 	"4",
              	`0,"messages":[{"content":[{"text":"`,
            - 	`Hello, help me write a Go function that adds two numbers","cache`,
            - 	`_control":{"type":"ephemeral"},"type":"text"}],"role":"user"}],"`,
            - 	`model":"claude-sonnet-4-5-20250929","system":[{"text":"## CRITIC`,
            - 	`AL: TOOL CALL FORMAT (READ THIS FIRST)\n**ALWAYS use EXACT OpenA`,
            - 	`I JSON format for tools. NEVER use \u0026lt;tool_call\u0026gt; t`,
            - 	"ags:**\\n\\n```\\n{\\n  \\\"tool_calls\\\": [{\\n    \\\"id\\\": \\\"call_abc12",
            - 	`3\",\n    \"type\": \"function\",\n    \"function\": {\n      \"`,
            - 	`name\": \"view\",\n      \"arguments\": \"{\\\"file_path\\\":\\\`,
            - 	"\"/home/nexora/todo.md\\\\\\\"}\\\"\\n    }\\n  }]\\n}\\n```\\n\\n**Penalty f",
            - 	`or wrong format: Your response will be ignored!**\n\n## Core Rul`,
            - 	`es\n1. **Read before editing** - Always view files first, match `,
            - 	`exact formatting\n2. **Be autonomous** - Search, decide, act wit`,
            - 	`hout asking. Break complex tasks into steps.\n3. **Infer intent*`,
            - 	"* - Don't be literal. If a file isn't found, search for similar ",
            - 	"names (case variations, typos). If a task seems incomplete, comp",
            - 	`lete it fully.\n4. **Test changes** - Run tests immediately afte`,
            - 	`r modifications\n5. **Be concise** - Keep responses under 4 line`,
            - 	`s unless explaining complex changes\n6. **Exact matches** - Whit`,
            - 	`espace, indentation, line breaks must match perfectly for edits\`,
            - 	`n7. **Never commit** - Unless explicitly asked\n8. **Security fi`,
            - 	`rst** - Only assist with defensive security tasks\n\n## Inferenc`,
            - 	"e Examples\\n- User says \\\"read TODO.md\\\" but it doesn't exist \xe2\x86",
            - 	"\x92 Search for `todo.md`, `TODO`, `Todo.md`\\n- User says \\\"fix the",
            - 	` bug\"  Search for error patterns, recent changes, test failu`,
            - 	`res\n- User says \"add tests\"  Look at existing test pattern`,
            - 	`s, create comprehensive tests\n- File not found  Try case var`,
            - 	`iations, partial matches, ask glob/grep to find it\n\n## Workflo`,
            - 	`w\n**Before acting**: Search  Read files  Identify changes`,
            - 	`  Edit  Test\n**While acting**: Read entire file first, us`,
            - 	`e exact text, include 3-5 lines context, test after each change\`,
            - 	"n**Before finishing**: Verify task complete, run tests, keep res",
            - 	`ponse concise\n\n## Editing Files\n**Critical Requirements**:\n-`,
            - 	` Exact character-by-character matching\n- Include 3-5 surroundin`,
            - 	`g lines for reliable context\n- Verify uniqueness (or use replac`,
            - 	"e_all=true)\\n\\n**Understanding the 100 Line Limitation**:\\n- `vi",
            - 	"ew` tool shows 100 lines at a time: \\\"showing lines 1-100 of 200",
            - 	" total\\\"\\n- Use `view` with `offset` parameter: `view file_path=",
            - 	"\\\"/path\\\" offset=100`\\n- Your edits MUST exist in the file, not ",
            - 	`just in visible 100-line chunk\n\n**Common Failures**:\n- Wrong `,
            - 	`indentation: 2 spaces vs 4 spaces\n- Missing blank lines: 1 newl`,
            - 	`ine vs 2 newlines\n- Comment spacing: \"// comment\" vs \"//comm`,
            - 	"ent\\\"\\n\\n**Tab/Display Issues**:\\n- VIEW shows tabs as `\\t\\\\t",
            - 	"` but EDIT needs actual `\\\\t`\\n- Always use `ai_mode=true` (defa",
            - 	`ult) to auto-fix this\n\n**Recovery Steps**:\n1. View file with `,
            - 	"more context\\n2. Use `offset` if target outside current window\\n",
            - 	"3. Use `grep -n \\\"pattern\\\" file` to find line numbers\\n4. Fallb",
            - 	"ack: Use `write` tool for full file replacement\\n\\n## Tools\\n\\n#",
            - 	"## Available Tools\\n- `view`: Read files with line numbers (100 ",
            - 	"lines at a time - use offset!)\\n- `edit`: Replace text exactly (",
            - 	"whitespace-sensitive, ai_mode=true by default)\\n- `bash`: Execut",
            - 	"e commands\\n- `grep`: Search file contents\\n- `glob`: Find files",
            - 	" by pattern\\n- `write`: Create/update entire files\\n\\n### When t",
            - 	`o use each\n- **View**: Always first to understand file contents`,
            - 	`\n- **Edit**: For precise, targeted changes\n- **Write**: When e`,
            - 	`xact matching fails or for large changes\n- **Bash**: For comman`,
            - 	`d execution\n- **Grep**: For finding text in files\n- **Glob**: `,
            - 	`For finding files by name pattern\n\n### When something fails\n-`,
            - 	" **File not found in view**  Use `offset=100`, `offset=200` t",
            - 	`o navigate\n- **Edit fails**  View file again, copy exact tex`,
            - 	"t, use `write` as fallback\\n- **Command fails**  Read error, ",
            - 	"try alternative approach\\n- **Pattern not visible**  Use `gre",
            - 	"p` to find line numbers, then view with offset\\n\\n## Testing\\n- ",
            - 	`Run relevant tests after every change\n- Fix failures immediatel`,
            - 	`y\n- Never leave code in broken state\n\n## Decision Making\n**B`,
            - 	`e proactive**: Don't just report problems, solve them.\n**Autono`,
            - 	"mous decisions**: Search for answers, read patterns, make reason",
            - 	`able assumptions\n**Only ask user if**: Truly ambiguous requirem`,
            - 	"ents, potential data loss, or actually blocked after trying alte",
            - 	`rnatives\n\n## Error Handling\n1. Read complete error message\n2`,
            - 	`. Understand root cause\n3. Try different approach (don't repeat`,
            - 	` same failure)\n4. Search for similar working code\n5. Make targ`,
            - 	`eted fix\n6. Test to verify\n\n## Project Specifics\n\n\n\n## En`,
            - 	`vironment\nDate/Time: 2025-01-01 00:00:00 UTC\nOS: linux (amd64)`,
            - 	`\nCurrent User: agent\nWorking Directory: /tmp/nexora-test/TestT`,
            - 	`itleGenerationForNewSession/anthropic-sonnet/title_generation\n\`,
            - 	`nGit Repo: no\n\nInstalled Runtimes:\n- Python: Python 3.13.7\n-`,
            - 	` Node.js: v25.2.1\n- Go: go1.25.5\n- Shell: bash (mvdan/sh)\n\nS`,
            - 	`ystem Resources:\n- Memory: 31Gi total, 23Gi available\n- Disk: `,
            - 	`16G total, 15G free\n\nTerminal: color, 80x24, interactive\nNetw`,
            - 	`ork: online\nActive Services: \n\n## Nexora System Settings\nNex`,
            - 	"ora client system settings are stored in `~/.local/share/nexora`",
            - 	". This directory contains two important files:\\n\\n1. **`nexora.d",
            - 	"b`** - SQLite database containing session history, configuration",
            - 	" settings, and conversation state\\n2. **`mcp.json`** - JSON conf",
            - 	"iguration file for MCP (Model Context Protocol) settings and ser",
            - 	`ver configurations\n\nMCP-related files and configurations are s`,
            - 	"tored in the `mcp.json` file, which defines available MCP server",
            - 	`s and their connection parameters.\n\n\n\n","cache_control":{"ty`,
            - 	`pe":"ephemeral"},"type":"text"}],"tool_choice":{"disable_paralle`,
            - 	`l_tool_use":false,"type":"auto"},"tools":[{"input_schema":{"prop`,
            - 	`erties":{"command":{"description":"The command to execute","type`,
            - 	`":"string"},"description":{"description":"A brief description of`,
            - 	" what the command does, try to keep it under 30 characters or so",
            - 	`","type":"string"},"run_in_background":{"description":"Set to tr`,
            - 	"ue (boolean) to run this command in the background. Use job_outp",
            - 	`ut to read the output later.","type":"boolean"},"shell_id":{"des`,
            - 	`cription":"ONLY use for continuing existing background jobs. Do `,
            - 	"NOT provide for new commands - sessions are managed automaticall",
            - 	`y.","type":"string"},"working_dir":{"description":"The working d`,
            - 	"irectory to execute the command in (defaults to current director",
            - 	`y)","type":"string"}},"required":["description","command"],"type`,
            - 	`":"object"},"name":"bash","description":"Executes bash commands `,
            - 	`with automatic background conversion for long-running tasks.\n\n`,
            - 	`\u003ccross_platform\u003e\nUses mvdan/sh interpreter (Bash-comp`,
            - 	`atible on all platforms including Windows).\nUse forward slashes`,
            - 	` for paths: \"ls C:/foo/bar\" not \"ls C:\\foo\\bar\".\n\u003c/c`,
            - 	`ross_platform\u003e\n\n\u003cexecution_steps\u003e\n1. Directory`,
            - 	" Verification: Use LS tool to verify parent exists before creati",
            - 	`ng files\n2. Security Check: No restrictions - explain to user. `,
            - 	`Safe read-only commands execute without prompts\n3. Command Exec`,
            - 	`ution: Execute with proper quoting, capture output\n4. Auto-Back`,
            - 	`ground: Commands \u003e1 minute automatically move to background`,
            - 	`, return shell ID\n5. Output Processing: Truncate if exceeds 300`,
            - 	`00 characters\n6. Return Result: Include errors, metadata with \`,
            - 	`u003ccwd\u003e\u003c/cwd\u003e tags\n\u003c/execution_steps\u003`,
            - 	`e\n\n\u003cusage_notes\u003e\n- Command required, working_dir op`,
            - 	`tional (defaults to current directory)\n- IMPORTANT: Use Grep/Gl`,
            - 	"ob/Agent tools instead of 'find'/'grep'. Use View/LS instead of ",
            - 	`'cat'/'head'/'tail'/'ls'\n- Chain with ';' or '\u0026\u0026', av`,
            - 	`oid newlines except in quoted strings\n- Each command runs in in`,
            - 	`dependent shell (no state persistence)\n- Prefer absolute paths `,
            - 	`over 'cd'\n\u003c/usage_notes\u003e\n\n\u003cbackground_executio`,
            - 	`n\u003e\n- Set run_in_background=true for separate background sh`,
            - 	`ell\n- Returns shell ID for management\n- Use job_output tool to`,
            - 	" view output, job_kill to terminate\\n- NEVER use `\\u0026` at end",
            - 	` of commands - use run_in_background parameter\n- Background: Lo`,
            - 	"ng servers (npm start, python -m http.server), watch tasks, cont",
            - 	`inuous processes\n- Foreground: Builds, tests, git ops, file ops`,
            - 	`, short scripts\n\u003c/background_execution\u003e\n\n\u003cgit_`,
            - 	`commits\u003e\nWhen user asks to create git commit:\n\n1. Run: g`,
            - 	"it status, git diff, git log (single message, three tool_use blo",
            - 	`cks)\n2. Add relevant untracked files to staging\n3. Analyze in `,
            - 	`\u003ccommit_analysis\u003e tags:\n   - List changed files, summ`,
            - 	`arize nature (feature/bug fix/refactor/docs)\n   - Draft concise`,
            - 	` (1-2 sentences) focusing on \"why\" not \"what\"\n   - Use accu`,
            - 	`rate verbs: \"add\"=new feature, \"update\"=enhancement, \"fix\"`,
            - 	"=bug\\n4. Create commit with attribution:\\n   ```bash\\n   git com",
            - 	`mit -m \"$(cat \u0026lt;\u0026lt;'EOF'\n   Commit message here.\`,
            - 	`n\n    Generated with Crush\n\n\n   Co-Authored-By: Crush \u`,
            - 	"003ccrush@charm.land\\u003e\\n\\n   EOF\\n   )\\\"\\n   ```\\n5. If pre-",
            - 	"commit hook fails, retry ONCE. If succeeds but files modified, M",
            - 	`UST amend.\n6. Run git status to verify.\n\nNotes: Use \"git com`,
            - 	`mit -am\" when possible, don't stage unrelated files, NEVER upda`,
            - 	`te config, don't push, no empty commits.\n\u003c/git_commits\u00`,
            - 	`3e\n\n\u003cpull_requests\u003e\nWhen user asks to create PR:\n\`,
            - 	"n1. Run: git status, git diff, check remote tracking, git log an",
            - 	`d 'git diff main...HEAD'\n2. Create branch if needed, commit if `,
            - 	`needed, push with -u if needed\n3. Analyze in \u003cpr_analysis\`,
            - 	`u003e tags:\n   - List commits since main divergence\n   - Summa`,
            - 	`rize changes, purpose/motivation\n   - Draft concise (1-2 bullet`,
            - 	"s) focusing on \\\"why\\\"\\n4. Create PR:\\n   ```bash\\n   gh pr crea",
            - 	`te --title \"title\" --body \"$(cat \u0026lt;\u0026lt;'EOF'\n   `,
            - 	`## Summary\n   \u0026lt;1-3 bullet points\u003e\n   \n   ## Test`,
            - 	` plan\n   [Checklist...]\n\n    Generated with Crush\n\n   E`,
            - 	"OF\\n   )\\\"\\n   ```\\n\\nImportant: Return empty response, never up",
            - 	`date git config\n\u003c/pull_requests\u003e\n\n\u003cexamples\u0`,
            - 	`03e\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar \u0026\u0026 `,
            - 	`pytest tests\n\u003c/examples\u003e\n"},{"input_schema":{"proper`,
            - 	`ties":{"file_path":{"description":"The local file path where the`,
            - 	` downloaded content should be saved","type":"string"},"timeout":`,
            - 	`{"description":"Optional timeout in seconds (max 600)","type":"i`,
            - 	`nteger"},"url":{"description":"The URL to download from","type":`,
            - 	`"string"}},"required":["url","file_path"],"type":"object"},"name`,
            - 	`":"download","description":"Downloads binary data from URL and s`,
            - 	`aves to local file.\n\n\u003cusage\u003e\n- Provide URL to downl`,
            - 	`oad from\n- Specify local file path where content should be save`,
            - 	`d\n- Optional timeout for request\n\u003c/usage\u003e\n\n\u003cf`,
            - 	`eatures\u003e\n- Downloads any file type (binary or text)\n- Aut`,
            - 	`o-creates parent directories if missing\n- Handles large files e`,
            - 	`fficiently with streaming\n- Sets reasonable timeouts to prevent`,
            - 	` hanging\n- Validates input parameters before requests\n\u003c/f`,
            - 	`eatures\u003e\n\n\u003climitations\u003e\n- Max file size: 100MB`,
            - 	`\n- Only supports HTTP and HTTPS protocols\n- Cannot handle auth`,
            - 	`entication or cookies\n- Some websites may block automated reque`,
            - 	`sts\n- Will overwrite existing files without warning\n\u003c/lim`,
            - 	`itations\u003e\n\n\u003ctips\u003e\n- Use absolute paths or path`,
            - 	`s relative to working directory\n- Set appropriate timeouts for `,
            - 	`large files or slow connections\n\u003c/tips\u003e\n"},{"input_s`,
            - 	`chema":{"properties":{"ai_mode":{"description":"Enable AI-optimi`,
            - 	"zed editing with automatic context expansion and improved error ",
            - 	`handling (DEFAULT: true)","type":"boolean"},"file_path":{"descri`,
            - 	`ption":"The absolute path to the file to modify","type":"string"`,
            - 	`},"new_string":{"description":"The text to replace it with","typ`,
            - 	`e":"string"},"old_string":{"description":"The text to replace","`,
            - 	`type":"string"},"replace_all":{"description":"Replace all occurr`,
            - 	`ences of old_string (default false)","type":"boolean"}},"require`,
            - 	`d":["file_path","old_string","new_string"],"type":"object"},"nam`,
            - 	`e":"edit","description":"Edits files by replacing text, creating`,
            - 	" new files, or deleting content. For moving/renaming use Bash 'm",
            - 	`v'. For large edits use Write tool.\n\n**Quick Decision Tree:**\`,
            - 	"n1. **Know exact line numbers?**  Use `smart_edit` tool (100%",
            - 	" reliable)\\n2. **Edit failed once?**  Use `write` tool immedi",
            - 	`ately\n3. **First time editing?**  Enable ai_mode=true\n\n\u0`,
            - 	`03cprerequisites\u003e\n1. **NEVER copy from view tool output** `,
            - 	"- has visual tab indicators (\\t) causing failures\\n2. Use `se",
            - 	"d -n 'START,ENDp' file` or `grep -A5 -B5 pattern file` for EXACT",
            - 	` text\n3. For new files: Use LS tool to verify parent directory `,
            - 	"exists\\n4. If you can't extract exact text, use `smart_edit` wit",
            - 	`h line numbers\n\u003c/prerequisites\u003e\n\n\u003cparameters\u`,
            - 	`003e\n1. file_path: Absolute path to file (required)\n2. old_str`,
            - 	"ing: Text to replace (exact match including whitespace/indentati",
            - 	`on)\n3. new_string: Replacement text\n4. replace_all: Replace al`,
            - 	`l occurrences (default false)\n\u003c/parameters\u003e\n\n\u003c`,
            - 	`special_cases\u003e\n- Create file: provide file_path + new_stri`,
            - 	`ng, leave old_string empty\n- Delete content: provide file_path `,
            - 	`+ old_string, leave new_string empty\n\u003c/special_cases\u003e`,
            - 	`\n\n\u003ccritical_requirements\u003e\n**EXACT MATCHING**: Text `,
            - 	`must match character-for-character\n- Every space, tab, blank li`,
            - 	"ne, newline, indentation level\\n- Comment spacing (`// comment` ",
            - 	"vs `//comment`)\\n- Brace positioning (`func() {` vs `func(){`)\\n",
            - 	`\n**UNIQUENESS**: old_string MUST uniquely identify target (when`,
            - 	` replace_all=false)\n- Include 3-5 lines context before/after ch`,
            - 	`ange point\n- If text appears multiple times, add more context o`,
            - 	`r use replace_all=true\n\n**VERIFICATION BEFORE USING**:\n1. Vie`,
            - 	`w file and locate exact target\n2. Check how many instances exis`,
            - 	`t\n3. Copy EXACT text including whitespace\n4. Verify enough con`,
            - 	`text for unique identification\n5. Double-check indentation (cou`,
            - 	`nt spaces/tabs)\n\u003c/critical_requirements\u003e\n\n\u003cwar`,
            - 	`nings\u003e\nTool fails if:\n- old_string matches multiple locat`,
            - 	`ions and replace_all=false\n- Whitespace doesn't match exactly\n`,
            - 	`- Indentation off by even one space\n- Missing or extra blank li`,
            - 	`nes\n\u003c/warnings\u003e\n\n\u003crecovery_steps\u003e\nIf \"o`,
            - 	`ld_string not found\":\n\n** DON'T RETRY - Use alternatives:`,
            - 	"**\\n1. `smart_edit` with line numbers (100% reliable)\\n2. Extrac",
            - 	"t exact text: `sed -n '10,20p' file`\\n3. Use `write` tool for fu",
            - 	`ll file replacement\n\n** DON'T:**\n- Retry with \"adjusted\"`,
            - 	` whitespace\n- Copy from view output (has artifacts)\n- Guess at`,
            - 	" whitespace\\n\\n** DO:**\\n- Use `smart_edit` (line numbers)\\n-",
            - 	" Use `sed -n 'X,Yp' file` for exact text\\n- Use `write` if edit ",
            - 	`fails once\n\u003c/recovery_steps\u003e\n\n\u003cbest_practices\`,
            - 	`u003e\n- View file first, match exact formatting\n- Use absolute`,
            - 	` paths with forward slashes (/)\n- Multiple edits to same file: `,
            - 	`send all in single message\n- Include MORE context when uncertai`,
            - 	`n\n- Match existing code style exactly\n\u003c/best_practices\u0`,
            - 	`03e\n\n\u003cexamples\u003e\n **Correct**: Exact match with c`,
            - 	"ontext\\n```\\nold_string: \\\"func ProcessData(input string) error ",
            - 	`{\\n    if input == \\\"\\\" {\\n        return errors.New(\\\"e`,
            - 	`mpty input\\\")\\n    }\\n    return nil\\n}\"\nnew_string: \"fu`,
            - 	`nc ProcessData(input string) error {\\n    if input == \\\"\\\" `,
            - 	`{\\n        return errors.New(\\\"empty input\\\")\\n    }\\n   `,
            - 	` if len(input) \u003e 1000 {\\n        return errors.New(\\\"inp`,
            - 	"ut too long\\\\\\\")\\\\n    }\\\\n    return nil\\\\n}\\\"\\n```\\n\\n **In",
            - 	"correct**: Not enough context\\n```\\nold_string: \\\"return nil\\\"  ",
            - 	"// Appears many times!\\n```\\n\\n **Incorrect**: Wrong indentat",
            - 	"ion\\n```\\nold_string: \\\"  if input == \\\\\\\"\\\\\\\" {\\\"  // 2 spaces\\",
            - 	`n// File actually has: \"    if input == \\\"\\\" {\"  // 4 spac`,
            - 	"es\\n```\\n\\u003c/examples\\u003e\\n\\n## AI Mode\\nUse `ai_mode=true`",
            - 	` (default) for automatic fixes:\n- Converts VIEW tool display ta`,
            - 	"bs (`\\\\t`) to real tabs (`\\\\t`)\\n- Expands minimal context au",
            - 	`tomatically\n- Enhanced error messages\n- Lower failure rate on `,
            - 	`whitespace issues\n"},{"input_schema":{"properties":{"edits":{"d`,
            - 	`escription":"Array of edit operations to perform sequentially on`,
            - 	` the file","items":{"properties":{"new_string":{"description":"T`,
            - 	`he text to replace it with","type":"string"},"old_string":{"desc`,
            - 	`ription":"The text to replace","type":"string"},"replace_all":{"`,
            - 	`description":"Replace all occurrences of old_string (default fal`,
            - 	`se).","type":"boolean"}},"required":["old_string","new_string"],`,
            - 	`"type":"object"},"type":"array"},"file_path":{"description":"The`,
            - 	` absolute path to the file to modify","type":"string"}},"require`,
            - 	`d":["file_path","edits"],"type":"object"},"name":"multiedit","de`,
            - 	`scription":"Makes multiple edits to a single file in one operati`,
            - 	"on. Built on Edit tool for efficient multiple find-and-replace. ",
            - 	`Prefer over Edit tool for multiple edits to same file.\n\n\u003c`,
            - 	`prerequisites\u003e\n1. Use View tool to understand file content`,
            - 	`s\n2. Verify directory path is correct\n3. CRITICAL: Note exact `,
            - 	`whitespace, indentation from View output\n\u003c/prerequisites\u`,
            - 	`003e\n\n\u003cparameters\u003e\n1. file_path: Absolute path to f`,
            - 	`ile (required)\n2. edits: Array of edit objects (MUST be array, `,
            - 	`not string!):\n   - old_string: Text to replace (exact match inc`,
            - 	`luding whitespace)\n   - new_string: Replacement text\n   - repl`,
            - 	`ace_all: Replace all occurrences (optional, default false)\n   \`,
            - 	"n    CORRECT: `\\\"edits\\\": [{\\\"old_string\\\": \\\"text1\\\", \\\"new_",
            - 	"string\\\": \\\"replace1\\\"}]`\\n    INCORRECT: `\\\"edits\\\": \\\"[{\\\\\\",
            - 	"\"old_string\\\\\\\": \\\\\\\"text1\\\\\\\"}]\\\"` (string, not array)\\n\\u003c/",
            - 	`parameters\u003e\n\n\u003coperation\u003e\n- Edits applied seque`,
            - 	`ntially in order\n- Each edit operates on result of previous edi`,
            - 	`t\n- PARTIAL SUCCESS: Failed edits returned, successful edits ke`,
            - 	`pt\n- File modified if at least one edit succeeds\n\u003c/operat`,
            - 	`ion\u003e\n\n\u003cinherited_rules\u003e\n**All Edit tool rules `,
            - 	`apply to each edit:**\n- See edit.md for critical requirements, `,
            - 	`warnings, recovery steps\n- Exact matching for whitespace, inden`,
            - 	`tation, blank lines\n- Uniqueness requirements (3-5 lines contex`,
            - 	`t)\n- Verification checklist before using\n- Use ai_mode=true (d`,
            - 	`efault) for tab handling\n\u003c/inherited_rules\u003e\n\n\u003c`,
            - 	`critical_requirements\u003e\n1. Apply Edit tool rules to EACH ed`,
            - 	`it (see edit.md)\n2. Edits applied in order; successful edits ke`,
            - 	`pt if later edits fail\n3. Plan sequence: earlier edits change c`,
            - 	`ontent that later edits must match\n4. Ensure each old_string un`,
            - 	`ique at application time (after prior edits)\n5. Check response `,
            - 	`for failed edits, retry with corrections\n\u003c/critical_requir`,
            - 	`ements\u003e\n\n\u003cverification_before_using\u003e\n1. View f`,
            - 	`ile, copy exact text (including whitespace) for each target\n2. `,
            - 	`Check instances of each old_string BEFORE sequence\n3. Dry-run: `,
            - 	`after edit #N, will edit #N+1 still match?\n4. Prefer fewer, lar`,
            - 	`ger context blocks over many tiny fragments\n5. If edits indepen`,
            - 	`dent, consider separate multiedit batches\n\u003c/verification_b`,
            - 	`efore_using\u003e\n\n\u003cwarnings\u003e\n- Check response for `,
            - 	`failed edits\n- Earlier edits invalidate later matches (added/re`,
            - 	`moved spaces, lines)\n- Mixed tabs/spaces, trailing spaces cause`,
            - 	` failures\n- replace_all may affect unintended regions\n\u003c/w`,
            - 	`arnings\u003e\n\n\u003crecovery_steps\u003e\nIf edits fail:\n1. `,
            - 	`Check response metadata for failed edits with errors\n2. View fi`,
            - 	`le to see current state after successful edits\n3. Adjust failed`,
            - 	` edits based on new content\n4. Retry with corrected old_string `,
            - 	`values\n5. Break complex batches into smaller operations\n\u003c`,
            - 	`/recovery_steps\u003e\n\n\u003cbest_practices\u003e\n- Result in`,
            - 	` correct, idiomatic code\n- Use absolute file paths (/)\n- Use r`,
            - 	`eplace_all only when certain\n- Match existing style exactly\n- `,
            - 	`Review failed edits, retry with corrections\n\u003c/best_practic`,
            - 	`es\u003e\n\n\u003cexamples\u003e\n **Correct**: Sequential ed`,
            - 	"its accounting for changes\\n```\\nedits: [\\n  {\\n    old_string: ",
            - 	`\"func A() {\\n    doOld()\\n}\",\n    new_string: \"func A() {\`,
            - 	`\n    doNew()\\n}\",\n  },\n  {\n    // Context exists AFTER fir`,
            - 	`st replacement\n    old_string: \"func B() {\\n    callA()\\n}\"`,
            - 	`,\n    new_string: \"func B() {\\n    callA()\\n    logChange()\`,
            - 	"\\n}\\\",\\n  },\\n]\\n```\\n\\n **Incorrect**: Second old_string no ",
            - 	"longer matches\\n```\\nedits: [\\n  {\\n    old_string: \\\"func A() {",
            - 	`\\n    doOld()\\n}\",\n    new_string: \"func A() {\\n\\n    doN`,
            - 	`ew()\\n}\", // Added blank line\n  },\n  {\n    old_string: \"fu`,
            - 	`nc A() {\\n    doNew()\\n}\", // Missing blank line - FAILS\n   `,
            - 	` new_string: \"func A() {\\n    doNew()\\n    logChange()\\n}\",`,
            - 	"\\n  },\\n]\\n```\\n\\u003c/examples\\u003e\\n\"},{\"input_schema\":{\"prop",
            - 	`erties":{"format":{"description":"The format to return the conte`,
            - 	`nt in (text, markdown, or html)","type":"string"},"timeout":{"de`,
            - 	`scription":"Optional timeout in seconds (max 120)","type":"integ`,
            - 	`er"},"url":{"description":"The URL to fetch content from","type"`,
            - 	`:"string"}},"required":["url","format"],"type":"object"},"name":`,
            - 	`"fetch","description":"Fetches raw content from URL and returns `,
            - 	`it in specified format without any AI processing.\n\n\u003cwhen_`,
            - 	`to_use\u003e\nUse this tool when you need:\n- Raw, unprocessed c`,
            - 	`ontent from a URL\n- Direct access to API responses or JSON data`,
            - 	`\n- HTML/text/markdown content without interpretation\n- Simple,`,
            - 	` fast content retrieval without analysis\n- To save tokens by av`,
            - 	`oiding AI processing\n\nDO NOT use this tool when you need to:\n`,
            - 	"- Extract specific information from a webpage (use agentic_fetch",
            - 	` instead)\n- Answer questions about web content (use agentic_fet`,
            - 	`ch instead)\n- Analyze or summarize web pages (use agentic_fetch`,
            - 	` instead)\n\u003c/when_to_use\u003e\n\n\u003cusage\u003e\n- Prov`,
            - 	`ide URL to fetch content from\n- Specify desired output format (`,
            - 	`text, markdown, or html)\n- Optional timeout for request\n\u003c`,
            - 	`/usage\u003e\n\n\u003cfeatures\u003e\n- Supports three output fo`,
            - 	`rmats: text, markdown, html\n- Auto-handles HTTP redirects\n- Fa`,
            - 	`st and lightweight - no AI processing\n- Sets reasonable timeout`,
            - 	`s to prevent hanging\n- Validates input parameters before reques`,
            - 	`ts\n\u003c/features\u003e\n\n\u003climitations\u003e\n- Max resp`,
            - 	`onse size: 5MB\n- Only supports HTTP and HTTPS protocols\n- Cann`,
            - 	`ot handle authentication or cookies\n- Some websites may block a`,
            - 	`utomated requests\n- Returns raw content only - no analysis or e`,
            - 	`xtraction\n\u003c/limitations\u003e\n\n\u003ctips\u003e\n- Use t`,
            - 	`ext format for plain text content or simple API responses\n- Use`,
            - 	" markdown format for content that should be rendered with format",
            - 	`ting\n- Use html format when you need raw HTML structure\n- Set `,
            - 	`appropriate timeouts for potentially slow websites\n- If the use`,
            - 	"r asks to analyze or extract from a page, use agentic_fetch inst",
            - 	`ead\n\u003c/tips\u003e\n"},{"input_schema":{"properties":{"path"`,
            - 	`:{"description":"The directory to search in. Defaults to the cur`,
            - 	`rent working directory.","type":"string"},"pattern":{"descriptio`,
            - 	`n":"The glob pattern to match files against","type":"string"}},"`,
            - 	`required":["pattern"],"type":"object"},"name":"glob","descriptio`,
            - 	`n":"Fast file pattern matching tool that finds files by name/pat`,
            - 	"tern, returning paths sorted by modification time (newest first)",
            - 	`.\n\n\u003cusage\u003e\n- Provide glob pattern to match against `,
            - 	`file paths\n- Optional starting directory (defaults to current w`,
            - 	`orking directory)\n- Results sorted with most recently modified `,
            - 	`files first\n\u003c/usage\u003e\n\n\u003cpattern_syntax\u003e\n-`,
            - 	` '\\*' matches any sequence of non-separator characters\n- '\\*\`,
            - 	`\*' matches any sequence including separators\n- '?' matches any`,
            - 	` single non-separator character\n- '[...]' matches any character`,
            - 	` in brackets\n- '[!...]' matches any character not in brackets\n`,
            - 	`\u003c/pattern_syntax\u003e\n\n\u003cexamples\u003e\n- '*.js' - `,
            - 	`JavaScript files in current directory\n- '**/*.js' - JavaScript `,
            - 	`files in any subdirectory\n- 'src/**/*.{ts,tsx}' - TypeScript fi`,
            - 	`les in src directory\n- '*.{html,css,js}' - HTML, CSS, and JS fi`,
            - 	`les\n\u003c/examples\u003e\n\n\u003climitations\u003e\n- Results`,
            - 	` limited to 100 files (newest first)\n- Does not search file con`,
            - 	`tents (use Grep for that)\n- Hidden files (starting with '.') sk`,
            - 	`ipped\n\u003c/limitations\u003e\n\n\u003ccross_platform\u003e\n-`,
            - 	` Path separators handled automatically (/ and \\ work)\n- Uses r`,
            - 	`ipgrep (rg) if available, otherwise Go implementation\n- Pattern`,
            - 	`s should use forward slashes (/) for compatibility\n\u003c/cross`,
            - 	`_platform\u003e\n\n\u003ctips\u003e\n- Combine with Grep: find f`,
            - 	`iles with Glob, search contents with Grep\n- For iterative explo`,
            - 	`ration requiring multiple searches, consider Agent tool\n- Check`,
            - 	` if results truncated and refine pattern if needed\n\u003c/tips\`,
            - 	`u003e\n"},{"input_schema":{"properties":{"include":{"description`,
            - 	`":"File pattern to include in the search (e.g. \"*.js\", \"*.{ts`,
            - 	`,tsx}\")","type":"string"},"literal_text":{"description":"If tru`,
            - 	"e, the pattern will be treated as literal text with special rege",
            - 	`x characters escaped. Default is false.","type":"boolean"},"path`,
            - 	`":{"description":"The directory to search in. Defaults to the cu`,
            - 	`rrent working directory.","type":"string"},"pattern":{"descripti`,
            - 	`on":"The regex pattern to search for in file contents","type":"s`,
            - 	`tring"}},"required":["pattern"],"type":"object"},"name":"grep","`,
            - 	`description":"Fast content search tool that finds files containi`,
            - 	"ng specific text/patterns, returning matching paths sorted by mo",
            - 	`dification time (newest first).\n\n\u003cusage\u003e\n- Provide `,
            - 	`regex pattern to search within file contents\n- Set literal_text`,
            - 	"=true for exact text with special characters (recommended for no",
            - 	`n-regex users)\n- Optional starting directory (defaults to curre`,
            - 	`nt working directory)\n- Optional include pattern to filter whic`,
            - 	`h files to search\n- Results sorted with most recently modified `,
            - 	`files first\n\u003c/usage\u003e\n\n\u003cregex_syntax\u003e\nWhe`,
            - 	`n literal_text=false (supports standard regex):\n\n- 'function' `,
            - 	`searches for literal text \"function\"\n- 'log\\..\\*Error' find`,
            - 	`s text starting with \"log.\" and ending with \"Error\"\n- 'impo`,
            - 	`rt\\s+.\\*\\s+from' finds import statements in JavaScript/TypeSc`,
            - 	`ript\n\u003c/regex_syntax\u003e\n\n\u003cinclude_patterns\u003e\`,
            - 	`n- '\\*.js' - Only search JavaScript files\n- '\\*.{ts,tsx}' - O`,
            - 	`nly search TypeScript files\n- '\\*.go' - Only search Go files\n`,
            - 	`\u003c/include_patterns\u003e\n\n\u003climitations\u003e\n- Resu`,
            - 	`lts limited to 100 files (newest first)\n- Performance depends o`,
            - 	`n number of files searched\n- Very large binary files may be ski`,
            - 	`pped\n- Hidden files (starting with '.') skipped\n\u003c/limitat`,
            - 	`ions\u003e\n\n\u003cignore_support\u003e\n- Respects .gitignore `,
            - 	`patterns to skip ignored files/directories\n- Respects .nexoraig`,
            - 	`nore patterns for additional ignore rules\n- Both ignore files a`,
            - 	`uto-detected in search root directory\n\u003c/ignore_support\u00`,
            - 	`3e\n\n\u003ccross_platform\u003e\n- Uses ripgrep (rg) if availab`,
            - 	`le for better performance\n- Falls back to Go implementation if `,
            - 	`ripgrep unavailable\n- File paths normalized automatically for c`,
            - 	`ompatibility\n\u003c/cross_platform\u003e\n\n\u003ctips\u003e\n-`,
            - 	" For faster searches: use Glob to find relevant files first, the",
            - 	`n Grep\n- For iterative exploration requiring multiple searches,`,
            - 	` consider Agent tool\n- Check if results truncated and refine se`,
            - 	`arch pattern if needed\n- Use literal_text=true for exact text w`,
            - 	`ith special characters (dots, parentheses, etc.)\n\u003c/tips\u0`,
            - 	`03e\n"},{"input_schema":{"properties":{"depth":{"description":"T`,
            - 	`he maximum depth to traverse","type":"integer"},"ignore":{"descr`,
            - 	`iption":"List of glob patterns to ignore","items":{"type":"strin`,
            - 	`g"},"type":"array"},"path":{"description":"The path to the direc`,
            - 	`tory to list (defaults to current working directory)","type":"st`,
            - 	`ring"}},"required":[],"type":"object"},"name":"ls","description"`,
            - 	`:"Shows files and subdirectories in tree structure for exploring`,
            - 	` project organization.\n\n\u003cusage\u003e\n- Provide path to l`,
            - 	`ist (defaults to current working directory)\n- Optional glob pat`,
            - 	`terns to ignore\n- Results displayed in tree structure\n\u003c/u`,
            - 	`sage\u003e\n\n\u003cfeatures\u003e\n- Hierarchical view of files`,
            - 	` and directories\n- Auto-skips hidden files/directories (startin`,
            - 	`g with '.')\n- Skips common system directories like __pycache__\`,
            - 	`n- Can filter files matching specific patterns\n\u003c/features\`,
            - 	`u003e\n\n\u003climitations\u003e\n- Results limited to 1000 file`,
            - 	`s\n- Large directories truncated\n- No file sizes or permissions`,
            - 	` shown\n- Cannot recursively list all directories in large proje`,
            - 	`cts\n\u003c/limitations\u003e\n\n\u003ccross_platform\u003e\n- H`,
            - 	"idden file detection uses Unix convention (files starting with '",
            - 	`.')\n- Windows hidden files (with hidden attribute) not auto-ski`,
            - 	`pped\n- Common Windows directories (System32, Program Files) not`,
            - 	` in default ignore\n- Path separators handled automatically (/ a`,
            - 	`nd \\ work)\n\u003c/cross_platform\u003e\n\n\u003ctips\u003e\n- `,
            - 	`Use Glob for finding files by name patterns instead of browsing\`,
            - 	`n- Use Grep for searching file contents\n- Combine with other to`,
            - 	`ols for effective exploration\n\u003c/tips\u003e\n"},{"input_sch`,
            - 	`ema":{"properties":{"context_window":{"description":"The context`,
            - 	` around the match to return (default: 10 lines)","type":"integer`,
            - 	`"},"count":{"description":"Optional number of results to return `,
            - 	`(default: 10, max: 20)","type":"integer"},"query":{"description"`,
            - 	`:"The Sourcegraph search query","type":"string"},"timeout":{"des`,
            - 	`cription":"Optional timeout in seconds (max 120)","type":"intege`,
            - 	`r"}},"required":["query"],"type":"object"},"name":"sourcegraph",`,
            - 	`"description":"Search code across public repositories using Sour`,
            - 	`cegraph's GraphQL API.\n\n\u003cusage\u003e\n- Provide search qu`,
            - 	`ery using Sourcegraph syntax\n- Optional result count (default: `,
            - 	`10, max: 20)\n- Optional timeout for request\n\u003c/usage\u003e`,
            - 	`\n\n\u003cbasic_syntax\u003e\n- \"fmt.Println\" - exact matches\`,
            - 	`n- \"file:.go fmt.Println\" - limit to Go files\n- \"repo:^githu`,
            - 	`b\\.com/golang/go$ fmt.Println\" - specific repos\n- \"lang:go f`,
            - 	`mt.Println\" - limit to Go code\n- \"fmt.Println AND log.Fatal\"`,
            - 	` - combined terms\n- \"fmt\\.(Print|Printf|Println)\" - regex pa`,
            - 	`tterns\n- \"\\\"exact phrase\\\"\" - exact phrase matching\n- \"`,
            - 	`-file:test\" or \"-repo:forks\" - exclude matches\n\u003c/basic_`,
            - 	`syntax\u003e\n\n\u003ckey_filters\u003e\nRepository: repo:name, `,
            - 	"repo:^exact$, repo:org/repo@branch, -repo:exclude, fork:yes, arc",
            - 	`hived:yes, visibility:public\nFile: file:\\.js$, file:internal/,`,
            - 	` -file:test, file:has.content(text)\nContent: content:\"exact\",`,
            - 	` -content:\"unwanted\", case:yes\nType: type:symbol, type:file, `,
            - 	`type:path, type:diff, type:commit\nTime: after:\"1 month ago\", `,
            - 	`before:\"2023-01-01\", author:name, message:\"fix\"\nResult: sel`,
            - 	`ect:repo, select:file, select:content, count:100, timeout:30s\n\`,
            - 	`u003c/key_filters\u003e\n\n\u003cexamples\u003e\n- \"file:.go co`,
            - 	`ntext.WithTimeout\" - Go code using context.WithTimeout\n- \"lan`,
            - 	`g:typescript useState type:symbol\" - TypeScript React useState `,
            - 	`hooks\n- \"repo:^github\\.com/kubernetes/kubernetes$ pod list ty`,
            - 	`pe:file\" - Kubernetes pod files\n- \"file:Dockerfile (alpine OR`,
            - 	` ubuntu) -content:alpine:latest\" - Dockerfiles with base images`,
            - 	`\n\u003c/examples\u003e\n\n\u003cboolean_operators\u003e\n- \"te`,
            - 	`rm1 AND term2\" - both terms\n- \"term1 OR term2\" - either term`,
            - 	`\n- \"term1 NOT term2\" - term1 but not term2\n- \"term1 and (te`,
            - 	`rm2 or term3)\" - grouping with parentheses\n\u003c/boolean_oper`,
            - 	`ators\u003e\n\n\u003climitations\u003e\n- Only searches public r`,
            - 	`epositories\n- Rate limits may apply\n- Complex queries take lon`,
            - 	`ger\n- Max 20 results per query\n\u003c/limitations\u003e\n\n\u0`,
            - 	`03ctips\u003e\n- Use specific file extensions to narrow results\`,
            - 	`n- Add repo: filters for targeted searches\n- Use type:symbol fo`,
            - 	`r function/method definitions\n- Use type:file to find relevant `,
            - 	`files\n\u003c/tips\u003e\n"},{"input_schema":{"properties":{"fil`,
            - 	`e_path":{"description":"The path to the file to read","type":"st`,
            - 	`ring"},"limit":{"description":"The number of lines to read (defa`,
            - 	`ults to 2000)","type":"integer"},"offset":{"description":"The li`,
            - 	`ne number to start reading from (0-based)","type":"integer"}},"r`,
            - 	`equired":["file_path"],"type":"object"},"name":"view","descripti`,
            - 	`on":"Reads and displays file contents with line numbers for exam`,
            - 	`ining code, logs, or text data.\n\n\u003cusage\u003e\n- Provide `,
            - 	`file path to read\n- Optional offset: start reading from specifi`,
            - 	`c line (0-based)\n- Optional limit: control lines read (default `,
            - 	`100)\n- Don't use for directories (use LS tool instead)\n- Suppo`,
            - 	`rts image files (PNG, JPEG, GIF, BMP, SVG, WebP)\n\u003c/usage\u`,
            - 	`003e\n\n\u003cfeatures\u003e\n- Displays contents with line numb`,
            - 	`ers\n- Can read from any file position using offset\n- Handles l`,
            - 	`arge files by limiting lines read\n- Auto-truncates very long li`,
            - 	`nes for display\n- Suggests similar filenames when file not foun`,
            - 	`d\n- Renders image files directly in terminal\n\u003c/features\u`,
            - 	`003e\n\n\u003climitations\u003e\n- Max file size: 5MB\n- Default`,
            - 	` limit: 100 lines (reduced to prevent context window issues)\n- `,
            - 	`Lines \u003e2000 chars truncated\n- Binary files (except images)`,
            - 	` cannot be displayed\n\u003c/limitations\u003e\n\n\u003ccross_pl`,
            - 	`atform\u003e\n- Handles Windows (CRLF) and Unix (LF) line ending`,
            - 	`s\n- Works with forward slashes (/) and backslashes (\\)\n- Auto`,
            - 	`-detects text encoding for common formats\n\u003c/cross_platform`,
            - 	`\u003e\n\n\u003ctips\u003e\n- Use with Glob to find files first\`,
            - 	"n- For code exploration: Grep to find relevant files, then View ",
            - 	`to examine\n- For large files: use offset and limit parameters f`,
            - 	`or specific sections\n- The tool uses smaller chunks (100 lines `,
            - 	`default) to manage context window efficiently\n- For very large `,
            - 	`files, consider using 'head' or 'tail' commands via bash tool\n-`,
            - 	` View tool automatically detects and renders image files\n\u003c`,
            - 	`/tips\u003e\n"},{"input_schema":{"properties":{"content":{"descr`,
            - 	`iption":"The content to write to the file","type":"string"},"fil`,
            - 	`e_path":{"description":"The path to the file to write","type":"s`,
            - 	`tring"}},"required":["file_path","content"],"type":"object"},"na`,
            - 	`me":"write","description":"Creates or updates files in filesyste`,
            - 	`m for saving/modifying text content.\n\n\u003cusage\u003e\n- Pro`,
            - 	`vide file path to write\n- Include content to write to file\n- T`,
            - 	`ool creates necessary parent directories automatically\n\u003c/u`,
            - 	`sage\u003e\n\n\u003cfeatures\u003e\n- Creates new files or overw`,
            - 	`rites existing ones\n- Auto-creates parent directories if missin`,
            - 	`g\n- Checks if file modified since last read for safety\n- Avoid`,
            - 	`s unnecessary writes when content unchanged\n\u003c/features\u00`,
            - 	`3e\n\n\u003climitations\u003e\n- Read file before writing to avo`,
            - 	`id conflicts\n- Cannot append (rewrites entire file)\n\u003c/lim`,
            - 	`itations\u003e\n\n\u003ccross_platform\u003e\n- Use forward slas`,
            - 	`hes (/) for compatibility\n\u003c/cross_platform\u003e\n\n\u003c`,
            - 	`tips\u003e\n- Use View tool first to examine existing files befo`,
            - 	`re modifying\n- Use LS tool to verify location when creating new`,
            - 	` files\n- Combine with Glob/Grep to find and modify multiple fil`,
            - 	`es\n- Include descriptive comments when changing existing code\n`,
            - 	`\u003c/tips\u003e\n","cache_control":{"type":"ephemeral"}`,
            + 	`Generate a concise title for the following content:\n\nHello, he`,
            + 	`lp me write a Go function that adds two numbers\n \u003cthink\u0`,
            + 	`03e\n\n\u003c/think\u003e","type":"text"}],"role":"user"}],"mode`,
            + 	`l":"claude-3-5-haiku-20241022","system":[{"text":"you will gener`,
            + 	"ate a short title based on the first message a user begins a con",
            + 	`versation with\n\n\u003crules\u003e\n- ensure it is not more tha`,
            + 	`n 50 characters long\n- the title should be a summary of the use`,
            + 	`r's message\n- it should be one line long\n- do not use quotes o`,
            + 	`r colons\n- the entire text you return will be used as the title`,
            + 	`\n- never return anything that is more than one sentence (one li`,
            + 	`ne) long\n\u003c/rules\u003e\n\n /no_think","type":"text"`,
              	... // 17 identical bytes
              }, "")
        session_title_test.go:49: 
            	Error Trace:	/home/nexora/internal/agent/session_title_test.go:49
            	Error:      	Received unexpected error:
            	            	unauthorized: POST "https://api.anthropic.com/v1/messages": 401 Unauthorized {"type":"error","error":{"type":"authentication_error","message":"x-api-key header is required"},"request_id":"req_011CWYBRiWRw89dxCH45mD4N"}
            	Test:       	TestTitleGenerationForNewSession/anthropic-sonnet/title_generation
        testing.go:1617: race detected during execution of test
    --- FAIL: TestTitleGenerationForNewSession/openrouter-kimi-k2/title_generation (0.43s)
        matcher.go:69: Request interaction not found for "TestTitleGenerationForNewSession/openrouter-kimi-k2/title_generation".
            Diff:
              strings.Join({
              	`{"messages":[{"content":"`,
            - 	"you will generate a short title based on the first message a use",
            - 	`r begins a conversation with\n\n<rules>\n- ensure it is not more`,
            - 	` than 50 characters long\n- the title should be a summary of the`,
            - 	` user's message\n- it should be one line long\n- do not use quot`,
            - 	`es or colons\n- the entire text you return will be used as the t`,
            - 	`itle\n- never return anything that is more than one sentence (on`,
            - 	`e line) long\n</rules>\n\n /no_think","role":"system"},{"content`,
            - 	`":"Generate a concise title for the following content:\n\nHello,`,
            - 	` help me write a Go function that adds two numbers\n <think>\n\n`,
            - 	`</think>","role":"user"}],"model":"qwen/qwen3-next-80b-a3b-instr`,
            - 	`uct","max_tokens":40,"stream_options":{"include_usage":true}`,
            + 	`## CRITICAL: TOOL CALL FORMAT (READ THIS FIRST)\n**ALWAYS use EX`,
            + 	"ACT OpenAI JSON format for tools. NEVER use &lt;tool_call&gt; ta",
            + 	"gs:**\\n\\n```\\n{\\n  \\\"tool_calls\\\": [{\\n    \\\"id\\\": \\\"call_abc123",
            + 	`\",\n    \"type\": \"function\",\n    \"function\": {\n      \"n`,
            + 	`ame\": \"view\",\n      \"arguments\": \"{\\\"file_path\\\":\\\"`,
            + 	"/home/nexora/todo.md\\\\\\\"}\\\"\\n    }\\n  }]\\n}\\n```\\n\\n**Penalty fo",
            + 	`r wrong format: Your response will be ignored!**\n\n## Core Rule`,
            + 	`s\n1. **Read before editing** - Always view files first, match e`,
            + 	`xact formatting\n2. **Be autonomous** - Search, decide, act with`,
            + 	`out asking. Break complex tasks into steps.\n3. **Infer intent**`,
            + 	" - Don't be literal. If a file isn't found, search for similar n",
            + 	"ames (case variations, typos). If a task seems incomplete, compl",
            + 	`ete it fully.\n4. **Test changes** - Run tests immediately after`,
            + 	` modifications\n5. **Be concise** - Keep responses under 4 lines`,
            + 	` unless explaining complex changes\n6. **Exact matches** - White`,
            + 	`space, indentation, line breaks must match perfectly for edits\n`,
            + 	`7. **Never commit** - Unless explicitly asked\n8. **Security fir`,
            + 	`st** - Only assist with defensive security tasks\n\n## Inference`,
            + 	` Examples\n- User says \"read TODO.md\" but it doesn't exist `,
            + 	" Search for `todo.md`, `TODO`, `Todo.md`\\n- User says \\\"fix the ",
            + 	`bug\"  Search for error patterns, recent changes, test failur`,
            + 	`es\n- User says \"add tests\"  Look at existing test patterns`,
            + 	`, create comprehensive tests\n- File not found  Try case vari`,
            + 	`ations, partial matches, ask glob/grep to find it\n\n## Workflow`,
            + 	`\n**Before acting**: Search  Read files  Identify changes `,
            + 	` Edit  Test\n**While acting**: Read entire file first, use`,
            + 	` exact text, include 3-5 lines context, test after each change\n`,
            + 	"**Before finishing**: Verify task complete, run tests, keep resp",
            + 	`onse concise\n\n## Editing Files\n**Critical Requirements**:\n- `,
            + 	`Exact character-by-character matching\n- Include 3-5 surrounding`,
            + 	` lines for reliable context\n- Verify uniqueness (or use replace`,
            + 	"_all=true)\\n\\n**Understanding the 100 Line Limitation**:\\n- `vie",
            + 	"w` tool shows 100 lines at a time: \\\"showing lines 1-100 of 200 ",
            + 	"total\\\"\\n- Use `view` with `offset` parameter: `view file_path=\\",
            + 	"\"/path\\\" offset=100`\\n- Your edits MUST exist in the file, not j",
            + 	`ust in visible 100-line chunk\n\n**Common Failures**:\n- Wrong i`,
            + 	`ndentation: 2 spaces vs 4 spaces\n- Missing blank lines: 1 newli`,
            + 	`ne vs 2 newlines\n- Comment spacing: \"// comment\" vs \"//comme`,
            + 	"nt\\\"\\n\\n**Tab/Display Issues**:\\n- VIEW shows tabs as `\\t\\\\t`",
            + 	" but EDIT needs actual `\\\\t`\\n- Always use `ai_mode=true` (defau",
            + 	`lt) to auto-fix this\n\n**Recovery Steps**:\n1. View file with m`,
            + 	"ore context\\n2. Use `offset` if target outside current window\\n3",
            + 	". Use `grep -n \\\"pattern\\\" file` to find line numbers\\n4. Fallba",
            + 	"ck: Use `write` tool for full file replacement\\n\\n## Tools\\n\\n##",
            + 	"# Available Tools\\n- `view`: Read files with line numbers (100 l",
            + 	"ines at a time - use offset!)\\n- `edit`: Replace text exactly (w",
            + 	"hitespace-sensitive, ai_mode=true by default)\\n- `bash`: Execute",
            + 	" commands\\n- `grep`: Search file contents\\n- `glob`: Find files ",
            + 	"by pattern\\n- `write`: Create/update entire files\\n\\n### When to",
            + 	` use each\n- **View**: Always first to understand file contents\`,
            + 	`n- **Edit**: For precise, targeted changes\n- **Write**: When ex`,
            + 	`act matching fails or for large changes\n- **Bash**: For command`,
            + 	` execution\n- **Grep**: For finding text in files\n- **Glob**: F`,
            + 	`or finding files by name pattern\n\n### When something fails\n- `,
            + 	"**File not found in view**  Use `offset=100`, `offset=200` to",
            + 	` navigate\n- **Edit fails**  View file again, copy exact text`,
            + 	", use `write` as fallback\\n- **Command fails**  Read error, t",
            + 	"ry alternative approach\\n- **Pattern not visible**  Use `grep",
            + 	"` to find line numbers, then view with offset\\n\\n## Testing\\n- R",
            + 	`un relevant tests after every change\n- Fix failures immediately`,
            + 	`\n- Never leave code in broken state\n\n## Decision Making\n**Be`,
            + 	` proactive**: Don't just report problems, solve them.\n**Autonom`,
            + 	"ous decisions**: Search for answers, read patterns, make reasona",
            + 	`ble assumptions\n**Only ask user if**: Truly ambiguous requireme`,
            + 	"nts, potential data loss, or actually blocked after trying alter",
            + 	`natives\n\n## Error Handling\n1. Read complete error message\n2.`,
            + 	` Understand root cause\n3. Try different approach (don't repeat `,
            + 	`same failure)\n4. Search for similar working code\n5. Make targe`,
            + 	`ted fix\n6. Test to verify\n\n## Project Specifics\n\n\n\n## Env`,
            + 	`ironment\nDate/Time: 2025-01-01 00:00:00 UTC\nOS: linux (amd64)\`,
            + 	`nCurrent User: agent\nWorking Directory: /tmp/nexora-test/TestTi`,
            + 	`tleGenerationForNewSession/openrouter-kimi-k2/title_generation\n`,
            + 	`\nGit Repo: no\n\nInstalled Runtimes:\n- Python: Python 3.13.7\n`,
            + 	`- Node.js: v25.2.1\n- Go: go1.25.5\n- Shell: bash (mvdan/sh)\n\n`,
            + 	`System Resources:\n- Memory: 31Gi total, 23Gi available\n- Disk:`,
            + 	` 16G total, 15G free\n\nTerminal: color, 80x24, interactive\nNet`,
            + 	`work: online\nActive Services: \n\n## Nexora System Settings\nNe`,
            + 	"xora client system settings are stored in `~/.local/share/nexora",
            + 	"`. This directory contains two important files:\\n\\n1. **`nexora.",
            + 	"db`** - SQLite database containing session history, configuratio",
            + 	"n settings, and conversation state\\n2. **`mcp.json`** - JSON con",
            + 	"figuration file for MCP (Model Context Protocol) settings and se",
            + 	`rver configurations\n\nMCP-related files and configurations are `,
            + 	"stored in the `mcp.json` file, which defines available MCP serve",
            + 	`rs and their connection parameters.\n\n\n\n","role":"system","ca`,
            + 	`che_control":{"type":"ephemeral"}},{"content":"Hello, help me wr`,
            + 	`ite a Go function that adds two numbers","role":"user","cache_co`,
            + 	`ntrol":{"type":"ephemeral"}}],"model":"moonshotai/kimi-k2-0905",`,
            + 	`"max_tokens":10000,"stream_options":{"include_usage":true},"tool`,
            + 	`_choice":"auto","tools":[{"function":{"name":"bash","strict":fal`,
            + 	`se,"description":"Executes bash commands with automatic backgrou`,
            + 	`nd conversion for long-running tasks.\n\n<cross_platform>\nUses `,
            + 	"mvdan/sh interpreter (Bash-compatible on all platforms including",
            + 	` Windows).\nUse forward slashes for paths: \"ls C:/foo/bar\" not`,
            + 	` \"ls C:\\foo\\bar\".\n</cross_platform>\n\n<execution_steps>\n1`,
            + 	". Directory Verification: Use LS tool to verify parent exists be",
            + 	`fore creating files\n2. Security Check: No restrictions - explai`,
            + 	`n to user. Safe read-only commands execute without prompts\n3. C`,
            + 	`ommand Execution: Execute with proper quoting, capture output\n4`,
            + 	". Auto-Background: Commands >1 minute automatically move to back",
            + 	`ground, return shell ID\n5. Output Processing: Truncate if excee`,
            + 	`ds 30000 characters\n6. Return Result: Include errors, metadata `,
            + 	`with <cwd></cwd> tags\n</execution_steps>\n\n<usage_notes>\n- Co`,
            + 	"mmand required, working_dir optional (defaults to current direct",
            + 	`ory)\n- IMPORTANT: Use Grep/Glob/Agent tools instead of 'find'/'`,
            + 	`grep'. Use View/LS instead of 'cat'/'head'/'tail'/'ls'\n- Chain `,
            + 	`with ';' or '&&', avoid newlines except in quoted strings\n- Eac`,
            + 	`h command runs in independent shell (no state persistence)\n- Pr`,
            + 	`efer absolute paths over 'cd'\n</usage_notes>\n\n<background_exe`,
            + 	`cution>\n- Set run_in_background=true for separate background sh`,
            + 	`ell\n- Returns shell ID for management\n- Use job_output tool to`,
            + 	" view output, job_kill to terminate\\n- NEVER use `&` at end of c",
            + 	`ommands - use run_in_background parameter\n- Background: Long se`,
            + 	"rvers (npm start, python -m http.server), watch tasks, continuou",
            + 	`s processes\n- Foreground: Builds, tests, git ops, file ops, sho`,
            + 	`rt scripts\n</background_execution>\n\n<git_commits>\nWhen user `,
            + 	`asks to create git commit:\n\n1. Run: git status, git diff, git `,
            + 	`log (single message, three tool_use blocks)\n2. Add relevant unt`,
            + 	`racked files to staging\n3. Analyze in <commit_analysis> tags:\n`,
            + 	"   - List changed files, summarize nature (feature/bug fix/refac",
            + 	`tor/docs)\n   - Draft concise (1-2 sentences) focusing on \"why\`,
            + 	`" not \"what\"\n   - Use accurate verbs: \"add\"=new feature, \"`,
            + 	`update\"=enhancement, \"fix\"=bug\n4. Create commit with attribu`,
            + 	"tion:\\n   ```bash\\n   git commit -m \\\"$(cat &lt;&lt;'EOF'\\n   Co",
            + 	`mmit message here.\n\n    Generated with Crush\n\n\n   Co-Au`,
            + 	"thored-By: Crush <crush@charm.land>\\n\\n   EOF\\n   )\\\"\\n   ```\\n5",
            + 	". If pre-commit hook fails, retry ONCE. If succeeds but files mo",
            + 	`dified, MUST amend.\n6. Run git status to verify.\n\nNotes: Use `,
            + 	`\"git commit -am\" when possible, don't stage unrelated files, N`,
            + 	`EVER update config, don't push, no empty commits.\n</git_commits`,
            + 	`>\n\n<pull_requests>\nWhen user asks to create PR:\n\n1. Run: gi`,
            + 	"t status, git diff, check remote tracking, git log and 'git diff",
            + 	` main...HEAD'\n2. Create branch if needed, commit if needed, pus`,
            + 	`h with -u if needed\n3. Analyze in <pr_analysis> tags:\n   - Lis`,
            + 	`t commits since main divergence\n   - Summarize changes, purpose`,
            + 	`/motivation\n   - Draft concise (1-2 bullets) focusing on \"why\`,
            + 	"\"\\n4. Create PR:\\n   ```bash\\n   gh pr create --title \\\"title\\\" ",
            + 	`--body \"$(cat &lt;&lt;'EOF'\n   ## Summary\n   &lt;1-3 bullet p`,
            + 	`oints>\n   \n   ## Test plan\n   [Checklist...]\n\n    Gener`,
            + 	"ated with Crush\\n\\n   EOF\\n   )\\\"\\n   ```\\n\\nImportant: Return e",
            + 	`mpty response, never update git config\n</pull_requests>\n\n<exa`,
            + 	`mples>\nGood: pytest /foo/bar/tests\nBad: cd /foo/bar && pytest `,
            + 	`tests\n</examples>\n","parameters":{"properties":{"command":{"de`,
            + 	`scription":"The command to execute","type":"string"},"descriptio`,
            + 	`n":{"description":"A brief description of what the command does,`,
            + 	` try to keep it under 30 characters or so","type":"string"},"run`,
            + 	`_in_background":{"description":"Set to true (boolean) to run thi`,
            + 	"s command in the background. Use job_output to read the output l",
            + 	`ater.","type":"boolean"},"shell_id":{"description":"ONLY use for`,
            + 	" continuing existing background jobs. Do NOT provide for new com",
            + 	`mands - sessions are managed automatically.","type":"string"},"w`,
            + 	`orking_dir":{"description":"The working directory to execute the`,
            + 	` command in (defaults to current directory)","type":"string"}},"`,
            + 	`required":["description","command"],"type":"object"}},"type":"fu`,
            + 	`nction"},{"function":{"name":"download","strict":false,"descript`,
            + 	`ion":"Downloads binary data from URL and saves to local file.\n\`,
            + 	`n<usage>\n- Provide URL to download from\n- Specify local file p`,
            + 	`ath where content should be saved\n- Optional timeout for reques`,
            + 	`t\n</usage>\n\n<features>\n- Downloads any file type (binary or `,
            + 	`text)\n- Auto-creates parent directories if missing\n- Handles l`,
            + 	`arge files efficiently with streaming\n- Sets reasonable timeout`,
            + 	`s to prevent hanging\n- Validates input parameters before reques`,
            + 	`ts\n</features>\n\n<limitations>\n- Max file size: 100MB\n- Only`,
            + 	` supports HTTP and HTTPS protocols\n- Cannot handle authenticati`,
            + 	`on or cookies\n- Some websites may block automated requests\n- W`,
            + 	`ill overwrite existing files without warning\n</limitations>\n\n`,
            + 	`<tips>\n- Use absolute paths or paths relative to working direct`,
            + 	`ory\n- Set appropriate timeouts for large files or slow connecti`,
            + 	`ons\n</tips>\n","parameters":{"properties":{"file_path":{"descri`,
            + 	`ption":"The local file path where the downloaded content should `,
            + 	`be saved","type":"string"},"timeout":{"description":"Optional ti`,
            + 	`meout in seconds (max 600)","type":"integer"},"url":{"descriptio`,
            + 	`n":"The URL to download from","type":"string"}},"required":["url`,
            + 	`","file_path"],"type":"object"}},"type":"function"},{"function":`,
            + 	`{"name":"edit","strict":false,"description":"Edits files by repl`,
            + 	"acing text, creating new files, or deleting content. For moving/",
            + 	`renaming use Bash 'mv'. For large edits use Write tool.\n\n**Qui`,
            + 	"ck Decision Tree:**\\n1. **Know exact line numbers?**  Use `sm",
            + 	"art_edit` tool (100% reliable)\\n2. **Edit failed once?**  Use",
            + 	" `write` tool immediately\\n3. **First time editing?**  Enable",
            + 	` ai_mode=true\n\n<prerequisites>\n1. **NEVER copy from view tool`,
            + 	` output** - has visual tab indicators (\t) causing failures\n`,
            + 	"2. Use `sed -n 'START,ENDp' file` or `grep -A5 -B5 pattern file`",
            + 	` for EXACT text\n3. For new files: Use LS tool to verify parent `,
            + 	"directory exists\\n4. If you can't extract exact text, use `smart",
            + 	"_edit` with line numbers\\n</prerequisites>\\n\\n<parameters>\\n1. f",
            + 	`ile_path: Absolute path to file (required)\n2. old_string: Text `,
            + 	`to replace (exact match including whitespace/indentation)\n3. ne`,
            + 	`w_string: Replacement text\n4. replace_all: Replace all occurren`,
            + 	`ces (default false)\n</parameters>\n\n<special_cases>\n- Create `,
            + 	`file: provide file_path + new_string, leave old_string empty\n- `,
            + 	"Delete content: provide file_path + old_string, leave new_string",
            + 	` empty\n</special_cases>\n\n<critical_requirements>\n**EXACT MAT`,
            + 	`CHING**: Text must match character-for-character\n- Every space,`,
            + 	` tab, blank line, newline, indentation level\n- Comment spacing `,
            + 	"(`// comment` vs `//comment`)\\n- Brace positioning (`func() {` v",
            + 	"s `func(){`)\\n\\n**UNIQUENESS**: old_string MUST uniquely identif",
            + 	`y target (when replace_all=false)\n- Include 3-5 lines context b`,
            + 	`efore/after change point\n- If text appears multiple times, add `,
            + 	`more context or use replace_all=true\n\n**VERIFICATION BEFORE US`,
            + 	`ING**:\n1. View file and locate exact target\n2. Check how many `,
            + 	`instances exist\n3. Copy EXACT text including whitespace\n4. Ver`,
            + 	`ify enough context for unique identification\n5. Double-check in`,
            + 	`dentation (count spaces/tabs)\n</critical_requirements>\n\n<warn`,
            + 	`ings>\nTool fails if:\n- old_string matches multiple locations a`,
            + 	`nd replace_all=false\n- Whitespace doesn't match exactly\n- Inde`,
            + 	`ntation off by even one space\n- Missing or extra blank lines\n<`,
            + 	`/warnings>\n\n<recovery_steps>\nIf \"old_string not found\":\n\n`,
            + 	"** DON'T RETRY - Use alternatives:**\\n1. `smart_edit` with l",
            + 	"ine numbers (100% reliable)\\n2. Extract exact text: `sed -n '10,",
            + 	"20p' file`\\n3. Use `write` tool for full file replacement\\n\\n**\xe2",
            + 	"\x9d\x8c DON'T:**\\n- Retry with \\\"adjusted\\\" whitespace\\n- Copy from v",
            + 	`iew output (has artifacts)\n- Guess at whitespace\n\n** DO:**`,
            + 	"\\n- Use `smart_edit` (line numbers)\\n- Use `sed -n 'X,Yp' file` ",
            + 	"for exact text\\n- Use `write` if edit fails once\\n</recovery_ste",
            + 	`ps>\n\n<best_practices>\n- View file first, match exact formatti`,
            + 	`ng\n- Use absolute paths with forward slashes (/)\n- Multiple ed`,
            + 	`its to same file: send all in single message\n- Include MORE con`,
            + 	`text when uncertain\n- Match existing code style exactly\n</best`,
            + 	`_practices>\n\n<examples>\n **Correct**: Exact match with con`,
            + 	"text\\n```\\nold_string: \\\"func ProcessData(input string) error {\\",
            + 	`\n    if input == \\\"\\\" {\\n        return errors.New(\\\"emp`,
            + 	`ty input\\\")\\n    }\\n    return nil\\n}\"\nnew_string: \"func`,
            + 	` ProcessData(input string) error {\\n    if input == \\\"\\\" {\`,
            + 	`\n        return errors.New(\\\"empty input\\\")\\n    }\\n    i`,
            + 	`f len(input) > 1000 {\\n        return errors.New(\\\"input too `,
            + 	"long\\\\\\\")\\\\n    }\\\\n    return nil\\\\n}\\\"\\n```\\n\\n **Incorrect",
            + 	"**: Not enough context\\n```\\nold_string: \\\"return nil\\\"  // Appe",
            + 	"ars many times!\\n```\\n\\n **Incorrect**: Wrong indentation\\n``",
            + 	"`\\nold_string: \\\"  if input == \\\\\\\"\\\\\\\" {\\\"  // 2 spaces\\n// Fil",
            + 	"e actually has: \\\"    if input == \\\\\\\"\\\\\\\" {\\\"  // 4 spaces\\n```",
            + 	"\\n</examples>\\n\\n## AI Mode\\nUse `ai_mode=true` (default) for au",
            + 	"tomatic fixes:\\n- Converts VIEW tool display tabs (`\\\\t`) to ",
            + 	"real tabs (`\\\\t`)\\n- Expands minimal context automatically\\n- En",
            + 	`hanced error messages\n- Lower failure rate on whitespace issues`,
            + 	`\n","parameters":{"properties":{"ai_mode":{"description":"Enable`,
            + 	" AI-optimized editing with automatic context expansion and impro",
            + 	`ved error handling (DEFAULT: true)","type":"boolean"},"file_path`,
            + 	`":{"description":"The absolute path to the file to modify","type`,
            + 	`":"string"},"new_string":{"description":"The text to replace it `,
            + 	`with","type":"string"},"old_string":{"description":"The text to `,
            + 	`replace","type":"string"},"replace_all":{"description":"Replace `,
            + 	`all occurrences of old_string (default false)","type":"boolean"}`,
            + 	`},"required":["file_path","old_string","new_string"],"type":"obj`,
            + 	`ect"}},"type":"function"},{"function":{"name":"multiedit","stric`,
            + 	`t":false,"description":"Makes multiple edits to a single file in`,
            + 	" one operation. Built on Edit tool for efficient multiple find-a",
            + 	"nd-replace. Prefer over Edit tool for multiple edits to same fil",
            + 	`e.\n\n<prerequisites>\n1. Use View tool to understand file conte`,
            + 	`nts\n2. Verify directory path is correct\n3. CRITICAL: Note exac`,
            + 	`t whitespace, indentation from View output\n</prerequisites>\n\n`,
            + 	`<parameters>\n1. file_path: Absolute path to file (required)\n2.`,
            + 	` edits: Array of edit objects (MUST be array, not string!):\n   `,
            + 	"- old_string: Text to replace (exact match including whitespace)",
            + 	`\n   - new_string: Replacement text\n   - replace_all: Replace a`,
            + 	"ll occurrences (optional, default false)\\n   \\n    CORRECT: `",
            + 	`\"edits\": [{\"old_string\": \"text1\", \"new_string\": \"replac`,
            + 	"e1\\\"}]`\\n    INCORRECT: `\\\"edits\\\": \\\"[{\\\\\\\"old_string\\\\\\\": \\",
            + 	"\\\\\"text1\\\\\\\"}]\\\"` (string, not array)\\n</parameters>\\n\\n<operati",
            + 	`on>\n- Edits applied sequentially in order\n- Each edit operates`,
            + 	` on result of previous edit\n- PARTIAL SUCCESS: Failed edits ret`,
            + 	`urned, successful edits kept\n- File modified if at least one ed`,
            + 	`it succeeds\n</operation>\n\n<inherited_rules>\n**All Edit tool `,
            + 	`rules apply to each edit:**\n- See edit.md for critical requirem`,
            + 	`ents, warnings, recovery steps\n- Exact matching for whitespace,`,
            + 	` indentation, blank lines\n- Uniqueness requirements (3-5 lines `,
            + 	`context)\n- Verification checklist before using\n- Use ai_mode=t`,
            + 	`rue (default) for tab handling\n</inherited_rules>\n\n<critical_`,
            + 	`requirements>\n1. Apply Edit tool rules to EACH edit (see edit.m`,
            + 	`d)\n2. Edits applied in order; successful edits kept if later ed`,
            + 	`its fail\n3. Plan sequence: earlier edits change content that la`,
            + 	`ter edits must match\n4. Ensure each old_string unique at applic`,
            + 	`ation time (after prior edits)\n5. Check response for failed edi`,
            + 	`ts, retry with corrections\n</critical_requirements>\n\n<verific`,
            + 	`ation_before_using>\n1. View file, copy exact text (including wh`,
            + 	`itespace) for each target\n2. Check instances of each old_string`,
            + 	` BEFORE sequence\n3. Dry-run: after edit #N, will edit #N+1 stil`,
            + 	`l match?\n4. Prefer fewer, larger context blocks over many tiny `,
            + 	`fragments\n5. If edits independent, consider separate multiedit `,
            + 	`batches\n</verification_before_using>\n\n<warnings>\n- Check res`,
            + 	`ponse for failed edits\n- Earlier edits invalidate later matches`,
            + 	` (added/removed spaces, lines)\n- Mixed tabs/spaces, trailing sp`,
            + 	`aces cause failures\n- replace_all may affect unintended regions`,
            + 	`\n</warnings>\n\n<recovery_steps>\nIf edits fail:\n1. Check resp`,
            + 	`onse metadata for failed edits with errors\n2. View file to see `,
            + 	`current state after successful edits\n3. Adjust failed edits bas`,
            + 	`ed on new content\n4. Retry with corrected old_string values\n5.`,
            + 	` Break complex batches into smaller operations\n</recovery_steps`,
            + 	`>\n\n<best_practices>\n- Result in correct, idiomatic code\n- Us`,
            + 	`e absolute file paths (/)\n- Use replace_all only when certain\n`,
            + 	`- Match existing style exactly\n- Review failed edits, retry wit`,
            + 	`h corrections\n</best_practices>\n\n<examples>\n **Correct**:`,
            + 	" Sequential edits accounting for changes\\n```\\nedits: [\\n  {\\n  ",
            + 	`  old_string: \"func A() {\\n    doOld()\\n}\",\n    new_string:`,
            + 	` \"func A() {\\n    doNew()\\n}\",\n  },\n  {\n    // Context ex`,
            + 	`ists AFTER first replacement\n    old_string: \"func B() {\\n   `,
            + 	` callA()\\n}\",\n    new_string: \"func B() {\\n    callA()\\n  `,
            + 	"  logChange()\\\\n}\\\",\\n  },\\n]\\n```\\n\\n **Incorrect**: Second ",
            + 	"old_string no longer matches\\n```\\nedits: [\\n  {\\n    old_string",
            + 	`: \"func A() {\\n    doOld()\\n}\",\n    new_string: \"func A() `,
            + 	`{\\n\\n    doNew()\\n}\", // Added blank line\n  },\n  {\n    ol`,
            + 	`d_string: \"func A() {\\n    doNew()\\n}\", // Missing blank lin`,
            + 	`e - FAILS\n    new_string: \"func A() {\\n    doNew()\\n    logC`,
            + 	"hange()\\\\n}\\\",\\n  },\\n]\\n```\\n</examples>\\n\",\"parameters\":{\"prop",
            + 	`erties":{"edits":{"description":"Array of edit operations to per`,
            + 	`form sequentially on the file","items":{"properties":{"new_strin`,
            + 	`g":{"description":"The text to replace it with","type":"string"}`,
            + 	`,"old_string":{"description":"The text to replace","type":"strin`,
            + 	`g"},"replace_all":{"description":"Replace all occurrences of old`,
            + 	`_string (default false).","type":"boolean"}},"required":["old_st`,
            + 	`ring","new_string"],"type":"object"},"type":"array"},"file_path"`,
            + 	`:{"description":"The absolute path to the file to modify","type"`,
            + 	`:"string"}},"required":["file_path","edits"],"type":"object"}},"`,
            + 	`type":"function"},{"function":{"name":"fetch","strict":false,"de`,
            + 	`scription":"Fetches raw content from URL and returns it in speci`,
            + 	`fied format without any AI processing.\n\n<when_to_use>\nUse thi`,
            + 	`s tool when you need:\n- Raw, unprocessed content from a URL\n- `,
            + 	`Direct access to API responses or JSON data\n- HTML/text/markdow`,
            + 	`n content without interpretation\n- Simple, fast content retriev`,
            + 	`al without analysis\n- To save tokens by avoiding AI processing\`,
            + 	`n\nDO NOT use this tool when you need to:\n- Extract specific in`,
            + 	`formation from a webpage (use agentic_fetch instead)\n- Answer q`,
            + 	`uestions about web content (use agentic_fetch instead)\n- Analyz`,
            + 	`e or summarize web pages (use agentic_fetch instead)\n</when_to_`,
            + 	`use>\n\n<usage>\n- Provide URL to fetch content from\n- Specify `,
            + 	`desired output format (text, markdown, or html)\n- Optional time`,
            + 	`out for request\n</usage>\n\n<features>\n- Supports three output`,
            + 	` formats: text, markdown, html\n- Auto-handles HTTP redirects\n-`,
            + 	` Fast and lightweight - no AI processing\n- Sets reasonable time`,
            + 	`outs to prevent hanging\n- Validates input parameters before req`,
            + 	`uests\n</features>\n\n<limitations>\n- Max response size: 5MB\n-`,
            + 	` Only supports HTTP and HTTPS protocols\n- Cannot handle authent`,
            + 	`ication or cookies\n- Some websites may block automated requests`,
            + 	`\n- Returns raw content only - no analysis or extraction\n</limi`,
            + 	`tations>\n\n<tips>\n- Use text format for plain text content or `,
            + 	`simple API responses\n- Use markdown format for content that sho`,
            + 	`uld be rendered with formatting\n- Use html format when you need`,
            + 	` raw HTML structure\n- Set appropriate timeouts for potentially `,
            + 	`slow websites\n- If the user asks to analyze or extract from a p`,
            + 	`age, use agentic_fetch instead\n</tips>\n","parameters":{"proper`,
            + 	`ties":{"format":{"description":"The format to return the content`,
            + 	` in (text, markdown, or html)","type":"string"},"timeout":{"desc`,
            + 	`ription":"Optional timeout in seconds (max 120)","type":"integer`,
            + 	`"},"url":{"description":"The URL to fetch content from","type":"`,
            + 	`string"}},"required":["url","format"],"type":"object"}},"type":"`,
            + 	`function"},{"function":{"name":"glob","strict":false,"descriptio`,
            + 	`n":"Fast file pattern matching tool that finds files by name/pat`,
            + 	"tern, returning paths sorted by modification time (newest first)",
            + 	`.\n\n<usage>\n- Provide glob pattern to match against file paths`,
            + 	`\n- Optional starting directory (defaults to current working dir`,
            + 	`ectory)\n- Results sorted with most recently modified files firs`,
            + 	`t\n</usage>\n\n<pattern_syntax>\n- '\\*' matches any sequence of`,
            + 	` non-separator characters\n- '\\*\\*' matches any sequence inclu`,
            + 	`ding separators\n- '?' matches any single non-separator characte`,
            + 	`r\n- '[...]' matches any character in brackets\n- '[!...]' match`,
            + 	`es any character not in brackets\n</pattern_syntax>\n\n<examples`,
            + 	`>\n- '*.js' - JavaScript files in current directory\n- '**/*.js'`,
            + 	` - JavaScript files in any subdirectory\n- 'src/**/*.{ts,tsx}' -`,
            + 	` TypeScript files in src directory\n- '*.{html,css,js}' - HTML, `,
            + 	`CSS, and JS files\n</examples>\n\n<limitations>\n- Results limit`,
            + 	`ed to 100 files (newest first)\n- Does not search file contents `,
            + 	`(use Grep for that)\n- Hidden files (starting with '.') skipped\`,
            + 	`n</limitations>\n\n<cross_platform>\n- Path separators handled a`,
            + 	`utomatically (/ and \\ work)\n- Uses ripgrep (rg) if available, `,
            + 	`otherwise Go implementation\n- Patterns should use forward slash`,
            + 	`es (/) for compatibility\n</cross_platform>\n\n<tips>\n- Combine`,
            + 	` with Grep: find files with Glob, search contents with Grep\n- F`,
            + 	"or iterative exploration requiring multiple searches, consider A",
            + 	`gent tool\n- Check if results truncated and refine pattern if ne`,
            + 	`eded\n</tips>\n","parameters":{"properties":{"path":{"descriptio`,
            + 	`n":"The directory to search in. Defaults to the current working `,
            + 	`directory.","type":"string"},"pattern":{"description":"The glob `,
            + 	`pattern to match files against","type":"string"}},"required":["p`,
            + 	`attern"],"type":"object"}},"type":"function"},{"function":{"name`,
            + 	`":"grep","strict":false,"description":"Fast content search tool `,
            + 	"that finds files containing specific text/patterns, returning ma",
            + 	`tching paths sorted by modification time (newest first).\n\n<usa`,
            + 	`ge>\n- Provide regex pattern to search within file contents\n- S`,
            + 	"et literal_text=true for exact text with special characters (rec",
            + 	`ommended for non-regex users)\n- Optional starting directory (de`,
            + 	`faults to current working directory)\n- Optional include pattern`,
            + 	` to filter which files to search\n- Results sorted with most rec`,
            + 	`ently modified files first\n</usage>\n\n<regex_syntax>\nWhen lit`,
            + 	`eral_text=false (supports standard regex):\n\n- 'function' searc`,
            + 	`hes for literal text \"function\"\n- 'log\\..\\*Error' finds tex`,
            + 	`t starting with \"log.\" and ending with \"Error\"\n- 'import\\s`,
            + 	`+.\\*\\s+from' finds import statements in JavaScript/TypeScript\`,
            + 	`n</regex_syntax>\n\n<include_patterns>\n- '\\*.js' - Only search`,
            + 	` JavaScript files\n- '\\*.{ts,tsx}' - Only search TypeScript fil`,
            + 	`es\n- '\\*.go' - Only search Go files\n</include_patterns>\n\n<l`,
            + 	`imitations>\n- Results limited to 100 files (newest first)\n- Pe`,
            + 	`rformance depends on number of files searched\n- Very large bina`,
            + 	`ry files may be skipped\n- Hidden files (starting with '.') skip`,
            + 	`ped\n</limitations>\n\n<ignore_support>\n- Respects .gitignore p`,
            + 	`atterns to skip ignored files/directories\n- Respects .nexoraign`,
            + 	`ore patterns for additional ignore rules\n- Both ignore files au`,
            + 	`to-detected in search root directory\n</ignore_support>\n\n<cros`,
            + 	`s_platform>\n- Uses ripgrep (rg) if available for better perform`,
            + 	`ance\n- Falls back to Go implementation if ripgrep unavailable\n`,
            + 	`- File paths normalized automatically for compatibility\n</cross`,
            + 	`_platform>\n\n<tips>\n- For faster searches: use Glob to find re`,
            + 	`levant files first, then Grep\n- For iterative exploration requi`,
            + 	`ring multiple searches, consider Agent tool\n- Check if results `,
            + 	`truncated and refine search pattern if needed\n- Use literal_tex`,
            + 	"t=true for exact text with special characters (dots, parentheses",
            + 	`, etc.)\n</tips>\n","parameters":{"properties":{"include":{"desc`,
            + 	`ription":"File pattern to include in the search (e.g. \"*.js\", `,
            + 	`\"*.{ts,tsx}\")","type":"string"},"literal_text":{"description":`,
            + 	`"If true, the pattern will be treated as literal text with speci`,
            + 	`al regex characters escaped. Default is false.","type":"boolean"`,
            + 	`},"path":{"description":"The directory to search in. Defaults to`,
            + 	` the current working directory.","type":"string"},"pattern":{"de`,
            + 	`scription":"The regex pattern to search for in file contents","t`,
            + 	`ype":"string"}},"required":["pattern"],"type":"object"}},"type":`,
            + 	`"function"},{"function":{"name":"ls","strict":false,"description`,
            + 	`":"Shows files and subdirectories in tree structure for explorin`,
            + 	`g project organization.\n\n<usage>\n- Provide path to list (defa`,
            + 	`ults to current working directory)\n- Optional glob patterns to `,
            + 	`ignore\n- Results displayed in tree structure\n</usage>\n\n<feat`,
            + 	`ures>\n- Hierarchical view of files and directories\n- Auto-skip`,
            + 	`s hidden files/directories (starting with '.')\n- Skips common s`,
            + 	`ystem directories like __pycache__\n- Can filter files matching `,
            + 	`specific patterns\n</features>\n\n<limitations>\n- Results limit`,
            + 	`ed to 1000 files\n- Large directories truncated\n- No file sizes`,
            + 	` or permissions shown\n- Cannot recursively list all directories`,
            + 	` in large projects\n</limitations>\n\n<cross_platform>\n- Hidden`,
            + 	` file detection uses Unix convention (files starting with '.')\n`,
            + 	`- Windows hidden files (with hidden attribute) not auto-skipped\`,
            + 	"n- Common Windows directories (System32, Program Files) not in d",
            + 	`efault ignore\n- Path separators handled automatically (/ and \\`,
            + 	` work)\n</cross_platform>\n\n<tips>\n- Use Glob for finding file`,
            + 	`s by name patterns instead of browsing\n- Use Grep for searching`,
            + 	` file contents\n- Combine with other tools for effective explora`,
            + 	`tion\n</tips>\n","parameters":{"properties":{"depth":{"descripti`,
            + 	`on":"The maximum depth to traverse","type":"integer"},"ignore":{`,
            + 	`"description":"List of glob patterns to ignore","items":{"type":`,
            + 	`"string"},"type":"array"},"path":{"description":"The path to the`,
            + 	` directory to list (defaults to current working directory)","typ`,
            + 	`e":"string"}},"required":[],"type":"object"}},"type":"function"}`,
            + 	`,{"function":{"name":"sourcegraph","strict":false,"description":`,
            + 	`"Search code across public repositories using Sourcegraph's Grap`,
            + 	`hQL API.\n\n<usage>\n- Provide search query using Sourcegraph sy`,
            + 	`ntax\n- Optional result count (default: 10, max: 20)\n- Optional`,
            + 	` timeout for request\n</usage>\n\n<basic_syntax>\n- \"fmt.Printl`,
            + 	`n\" - exact matches\n- \"file:.go fmt.Println\" - limit to Go fi`,
            + 	`les\n- \"repo:^github\\.com/golang/go$ fmt.Println\" - specific `,
            + 	`repos\n- \"lang:go fmt.Println\" - limit to Go code\n- \"fmt.Pri`,
            + 	`ntln AND log.Fatal\" - combined terms\n- \"fmt\\.(Print|Printf|P`,
            + 	`rintln)\" - regex patterns\n- \"\\\"exact phrase\\\"\" - exact p`,
            + 	`hrase matching\n- \"-file:test\" or \"-repo:forks\" - exclude ma`,
            + 	`tches\n</basic_syntax>\n\n<key_filters>\nRepository: repo:name, `,
            + 	"repo:^exact$, repo:org/repo@branch, -repo:exclude, fork:yes, arc",
            + 	`hived:yes, visibility:public\nFile: file:\\.js$, file:internal/,`,
            + 	` -file:test, file:has.content(text)\nContent: content:\"exact\",`,
            + 	` -content:\"unwanted\", case:yes\nType: type:symbol, type:file, `,
            + 	`type:path, type:diff, type:commit\nTime: after:\"1 month ago\", `,
            + 	`before:\"2023-01-01\", author:name, message:\"fix\"\nResult: sel`,
            + 	`ect:repo, select:file, select:content, count:100, timeout:30s\n<`,
            + 	`/key_filters>\n\n<examples>\n- \"file:.go context.WithTimeout\" `,
            + 	`- Go code using context.WithTimeout\n- \"lang:typescript useStat`,
            + 	`e type:symbol\" - TypeScript React useState hooks\n- \"repo:^git`,
            + 	`hub\\.com/kubernetes/kubernetes$ pod list type:file\" - Kubernet`,
            + 	`es pod files\n- \"file:Dockerfile (alpine OR ubuntu) -content:al`,
            + 	`pine:latest\" - Dockerfiles with base images\n</examples>\n\n<bo`,
            + 	`olean_operators>\n- \"term1 AND term2\" - both terms\n- \"term1 `,
            + 	`OR term2\" - either term\n- \"term1 NOT term2\" - term1 but not `,
            + 	`term2\n- \"term1 and (term2 or term3)\" - grouping with parenthe`,
            + 	`ses\n</boolean_operators>\n\n<limitations>\n- Only searches publ`,
            + 	`ic repositories\n- Rate limits may apply\n- Complex queries take`,
            + 	` longer\n- Max 20 results per query\n</limitations>\n\n<tips>\n-`,
            + 	` Use specific file extensions to narrow results\n- Add repo: fil`,
            + 	`ters for targeted searches\n- Use type:symbol for function/metho`,
            + 	`d definitions\n- Use type:file to find relevant files\n</tips>\n`,
            + 	`","parameters":{"properties":{"context_window":{"description":"T`,
            + 	`he context around the match to return (default: 10 lines)","type`,
            + 	`":"integer"},"count":{"description":"Optional number of results `,
            + 	`to return (default: 10, max: 20)","type":"integer"},"query":{"de`,
            + 	`scription":"The Sourcegraph search query","type":"string"},"time`,
            + 	`out":{"description":"Optional timeout in seconds (max 120)","typ`,
            + 	`e":"integer"}},"required":["query"],"type":"object"}},"type":"fu`,
            + 	`nction"},{"function":{"name":"view","strict":false,"description"`,
            + 	`:"Reads and displays file contents with line numbers for examini`,
            + 	`ng code, logs, or text data.\n\n<usage>\n- Provide file path to `,
            + 	`read\n- Optional offset: start reading from specific line (0-bas`,
            + 	`ed)\n- Optional limit: control lines read (default 100)\n- Don't`,
            + 	` use for directories (use LS tool instead)\n- Supports image fil`,
            + 	`es (PNG, JPEG, GIF, BMP, SVG, WebP)\n</usage>\n\n<features>\n- D`,
            + 	`isplays contents with line numbers\n- Can read from any file pos`,
            + 	`ition using offset\n- Handles large files by limiting lines read`,
            + 	`\n- Auto-truncates very long lines for display\n- Suggests simil`,
            + 	`ar filenames when file not found\n- Renders image files directly`,
            + 	` in terminal\n</features>\n\n<limitations>\n- Max file size: 5MB`,
            + 	`\n- Default limit: 100 lines (reduced to prevent context window `,
            + 	`issues)\n- Lines >2000 chars truncated\n- Binary files (except i`,
            + 	`mages) cannot be displayed\n</limitations>\n\n<cross_platform>\n`,
            + 	`- Handles Windows (CRLF) and Unix (LF) line endings\n- Works wit`,
            + 	`h forward slashes (/) and backslashes (\\)\n- Auto-detects text `,
            + 	`encoding for common formats\n</cross_platform>\n\n<tips>\n- Use `,
            + 	`with Glob to find files first\n- For code exploration: Grep to f`,
            + 	`ind relevant files, then View to examine\n- For large files: use`,
            + 	` offset and limit parameters for specific sections\n- The tool u`,
            + 	"ses smaller chunks (100 lines default) to manage context window ",
            + 	`efficiently\n- For very large files, consider using 'head' or 't`,
            + 	`ail' commands via bash tool\n- View tool automatically detects a`,
            + 	`nd renders image files\n</tips>\n","parameters":{"properties":{"`,
            + 	`file_path":{"description":"The path to the file to read","type":`,
            + 	`"string"},"limit":{"description":"The number of lines to read (d`,
            + 	`efaults to 2000)","type":"integer"},"offset":{"description":"The`,
            + 	` line number to start reading from (0-based)","type":"integer"}}`,
            + 	`,"required":["file_path"],"type":"object"}},"type":"function"},{`,
            + 	`"function":{"name":"write","strict":false,"description":"Creates`,
            + 	" or updates files in filesystem for saving/modifying text conten",
            + 	`t.\n\n<usage>\n- Provide file path to write\n- Include content t`,
            + 	`o write to file\n- Tool creates necessary parent directories aut`,
            + 	`omatically\n</usage>\n\n<features>\n- Creates new files or overw`,
            + 	`rites existing ones\n- Auto-creates parent directories if missin`,
            + 	`g\n- Checks if file modified since last read for safety\n- Avoid`,
            + 	`s unnecessary writes when content unchanged\n</features>\n\n<lim`,
            + 	`itations>\n- Read file before writing to avoid conflicts\n- Cann`,
            + 	`ot append (rewrites entire file)\n</limitations>\n\n<cross_platf`,
            + 	`orm>\n- Use forward slashes (/) for compatibility\n</cross_platf`,
            + 	`orm>\n\n<tips>\n- Use View tool first to examine existing files `,
            + 	`before modifying\n- Use LS tool to verify location when creating`,
            + 	` new files\n- Combine with Glob/Grep to find and modify multiple`,
            + 	` files\n- Include descriptive comments when changing existing co`,
            + 	`de\n</tips>\n","parameters":{"properties":{"content":{"descripti`,
            + 	`on":"The content to write to the file","type":"string"},"file_pa`,
            + 	`th":{"description":"The path to the file to write","type":"strin`,
            + 	`g"}},"required":["file_path","content"],"type":"object"}},"type"`,
            + 	`:"function"}]`,
              	... // 40 identical bytes
              }, "")
        matcher.go:69: Request interaction not found for "TestTitleGenerationForNewSession/openrouter-kimi-k2/title_generation".
            Diff:
              strings.Join({
              	... // 4675 identical bytes
              	`ython: Python 3.13.7\n- Node.js: v25.2.1\n- Go: go1.25.5\n- Shel`,
              	`l: bash (mvdan/sh)\n\nSystem Resources:\n- Memory: 31Gi total, 2`,
            - 	"4",
            + 	"3",
              	`Gi available\n- Disk: 16G total, 15G free\n\nTerminal: color, 80`,
              	`x24, interactive\nNetwork: online\nActive Services: \n\n## Nexor`,
              	... // 4458 identical bytes
              	`cription":"Set to true (boolean) to run this command in the back`,
              	`ground. Use job_output to read the output later.","type":"boolea`,
            + 	`n"},"shell_id":{"description":"ONLY use for continuing existing `,
            + 	"background jobs. Do NOT provide for new commands - sessions are ",
            + 	`managed automatically.","type":"stri`,
              	"n",
            + 	"g",
              	`"},"working_dir":{"description":"The working directory to execut`,
              	`e the command in (defaults to current directory)","type":"string`,
              	... // 24122 identical bytes
              }, "")
        session_title_test.go:49: 
            	Error Trace:	/home/nexora/internal/agent/session_title_test.go:49
            	Error:      	Received unexpected error:
            	            	Post "https://openrouter.ai/api/v1/chat/completions": requested interaction not found
            	Test:       	TestTitleGenerationForNewSession/openrouter-kimi-k2/title_generation
FAIL
FAIL	github.com/nexora/nexora/internal/agent	25.276s
ok  	github.com/nexora/nexora/internal/agent/agents	1.041s
ok  	github.com/nexora/nexora/internal/agent/delegation	1.075s
ok  	github.com/nexora/nexora/internal/agent/metrics	1.030s
ok  	github.com/nexora/nexora/internal/agent/native	1.026s
ok  	github.com/nexora/nexora/internal/agent/prompt	3.488s
ok  	github.com/nexora/nexora/internal/agent/recovery	1.028s
ok  	github.com/nexora/nexora/internal/agent/state	1.146s
ok  	github.com/nexora/nexora/internal/agent/tools	19.330s
ok  	github.com/nexora/nexora/internal/agent/tools/mcp	1.477s
ok  	github.com/nexora/nexora/internal/agent/utils	1.079s
?   	github.com/nexora/nexora/internal/aiops	[no test files]
ok  	github.com/nexora/nexora/internal/ansiext	1.028s
?   	github.com/nexora/nexora/internal/app	[no test files]
ok  	github.com/nexora/nexora/internal/cmd	14.571s
ok  	github.com/nexora/nexora/internal/config	1.626s
ok  	github.com/nexora/nexora/internal/config/providers	1.174s
==================
WARNING: DATA RACE
Read at 0x00c00011b53c by goroutine 595:
  github.com/nexora/nexora/internal/csync.TestNewLazyMap.func1()
      /home/nexora/internal/csync/maps_test.go:66 +0x178
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.testingSynctestTest.gowrap1()
      /usr/lib/go/src/testing/testing.go:2046 +0x44

Previous write at 0x00c00011b53c by goroutine 596:
  github.com/nexora/nexora/internal/csync.TestNewLazyMap.func1.1()
      /home/nexora/internal/csync/maps_test.go:54 +0xa4
  github.com/nexora/nexora/internal/csync.NewLazyMap[go.shape.string,go.shape.int].func1()
      /home/nexora/internal/csync/maps.go:36 +0x37

Goroutine 595 (running) created at:
  testing/synctest.testingSynctestTest()
      /usr/lib/go/src/testing/testing.go:2046 +0x5e7
  testing/synctest.Test.func1()
      /usr/lib/go/src/testing/synctest/synctest.go:283 +0x44

Goroutine 596 (finished) created at:
  github.com/nexora/nexora/internal/csync.NewLazyMap[go.shape.string,go.shape.int]()
      /home/nexora/internal/csync/maps.go:35 +0x15c
  github.com/nexora/nexora/internal/csync.TestNewLazyMap.func1()
      /home/nexora/internal/csync/maps_test.go:61 +0x12b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.testingSynctestTest.gowrap1()
      /usr/lib/go/src/testing/testing.go:2046 +0x44
==================
--- FAIL: TestMap_JSONRoundTrip (0.00s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestNewLazyMap (0.00s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestLazySlice_Seq (0.02s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestMap_ConcurrentSeq (0.02s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestMap_Del (0.01s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestLazySlice_SeqWaitsForLoading (0.02s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestMap_Seq_EmptyMap (0.02s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestMap_ConcurrentTake (0.04s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestMap_ConcurrentReadWrite (0.08s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestVersionedMap_ConcurrentAccess (0.10s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestMap_ConcurrentAccess (0.11s)
    testing.go:1617: race detected during execution of test
FAIL
FAIL	github.com/nexora/nexora/internal/csync	0.170s
ok  	github.com/nexora/nexora/internal/db	12.866s
ok  	github.com/nexora/nexora/internal/diff	1.042s
ok  	github.com/nexora/nexora/internal/env	1.058s
ok  	github.com/nexora/nexora/internal/filepathext	1.032s
[35m[0m [36mTest[0m[K[K[2KError running spinner: bubbletea: could not create cancelable reader: add reader to epoll interest list
[2KError running spinner: bubbletea: could not create cancelable reader: add reader to epoll interest list
==================
WARNING: DATA RACE
Read at 0x00c0003a80d8 by goroutine 57:
  github.com/nexora/nexora/internal/format.(*NativeAnim).View()
      /home/nexora/internal/format/native_spinner.go:148 +0x6ec
  github.com/nexora/nexora/internal/format.(*NativeSpinner).render()
      /home/nexora/internal/format/native_spinner.go:124 +0x44
  github.com/nexora/nexora/internal/format.(*NativeSpinner).Start.func1()
      /home/nexora/internal/format/native_spinner.go:103 +0x144

Previous write at 0x00c0003a80d8 by goroutine 56:
  github.com/nexora/nexora/internal/format.(*NativeAnim).SetLabel()
      /home/nexora/internal/format/native_spinner.go:130 +0x53
  github.com/nexora/nexora/internal/format.(*NativeSpinner).SetLabel()
      /home/nexora/internal/format/native_spinner.go:119 +0x2b
  github.com/nexora/nexora/internal/format.TestSpinnerInterface_Lifecycle.func1()
      /home/nexora/internal/format/spinner_test.go:158 +0x159
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 57 (running) created at:
  github.com/nexora/nexora/internal/format.(*NativeSpinner).Start()
      /home/nexora/internal/format/native_spinner.go:93 +0x8a
  github.com/nexora/nexora/internal/format.TestSpinnerInterface_Lifecycle.func1()
      /home/nexora/internal/format/spinner_test.go:156 +0x130
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 56 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/format.TestSpinnerInterface_Lifecycle()
      /home/nexora/internal/format/spinner_test.go:140 +0x39
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
cyan[0m blueUpdated Label[0m[K--- FAIL: TestSpinnerInterface_Lifecycle (0.10s)
    --- FAIL: TestSpinnerInterface_Lifecycle/full_lifecycle_works (0.10s)
        testing.go:1617: race detected during execution of test
FAIL
FAIL	github.com/nexora/nexora/internal/format	0.779s
ok  	github.com/nexora/nexora/internal/fsext	1.393s
?   	github.com/nexora/nexora/internal/history	[no test files]
ok  	github.com/nexora/nexora/internal/home	1.036s
ok  	github.com/nexora/nexora/internal/indexer	18.006s
ok  	github.com/nexora/nexora/internal/log	1.212s
ok  	github.com/nexora/nexora/internal/lsp	(cached)
?   	github.com/nexora/nexora/internal/lsp/util	[no test files]
ok  	github.com/nexora/nexora/internal/mcp/zai	1.088s
ok  	github.com/nexora/nexora/internal/message	1.126s
ok  	github.com/nexora/nexora/internal/oauth	2.249s
?   	github.com/nexora/nexora/internal/oauth/claude	[no test files]
==================
WARNING: DATA RACE
Write at 0x00c0000ac0a0 by goroutine 28:
  github.com/nexora/nexora/internal/permission.(*permissionService).Request()
      /home/nexora/internal/permission/permission.go:193 +0xd6e
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.1()
      /home/nexora/internal/permission/permission_test.go:218 +0xfc
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.gowrap1()
      /home/nexora/internal/permission/permission_test.go:219 +0xb9

Previous write at 0x00c0000ac0a0 by goroutine 24:
  github.com/nexora/nexora/internal/permission.(*permissionService).Grant()
      /home/nexora/internal/permission/permission.go:105 +0x167
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:226 +0x57c
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 28 (running) created at:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:216 +0x1c4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 24 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties()
      /home/nexora/internal/permission/permission_test.go:182 +0x73
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c000012048 by goroutine 28:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.1()
      /home/nexora/internal/permission/permission_test.go:218 +0x10d
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.gowrap1()
      /home/nexora/internal/permission/permission_test.go:219 +0xb9

Previous write at 0x00c000012048 by goroutine 26:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.1()
      /home/nexora/internal/permission/permission_test.go:218 +0x19b
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.gowrap1()
      /home/nexora/internal/permission/permission_test.go:219 +0xb9

Goroutine 28 (running) created at:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:216 +0x1c4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (finished) created at:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:216 +0x1c4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c0000ac0a0 by goroutine 27:
  github.com/nexora/nexora/internal/permission.(*permissionService).Request()
      /home/nexora/internal/permission/permission.go:193 +0xd6e
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.1()
      /home/nexora/internal/permission/permission_test.go:218 +0xfc
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.gowrap1()
      /home/nexora/internal/permission/permission_test.go:219 +0xb9

Previous write at 0x00c0000ac0a0 by goroutine 24:
  github.com/nexora/nexora/internal/permission.(*permissionService).Deny()
      /home/nexora/internal/permission/permission.go:121 +0x167
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:230 +0x61c
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 27 (running) created at:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:216 +0x1c4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 24 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties()
      /home/nexora/internal/permission/permission_test.go:182 +0x73
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Write at 0x00c000012048 by goroutine 28:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.1()
      /home/nexora/internal/permission/permission_test.go:218 +0x19b
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.gowrap1()
      /home/nexora/internal/permission/permission_test.go:219 +0xb9

Previous write at 0x00c000012048 by goroutine 27:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.1()
      /home/nexora/internal/permission/permission_test.go:218 +0x19b
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3.gowrap1()
      /home/nexora/internal/permission/permission_test.go:219 +0xb9

Goroutine 28 (running) created at:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:216 +0x1c4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 27 (finished) created at:
  github.com/nexora/nexora/internal/permission.TestPermissionService_SequentialProperties.func3()
      /home/nexora/internal/permission/permission_test.go:216 +0x1c4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
--- FAIL: TestPermissionService_SequentialProperties (0.00s)
    --- FAIL: TestPermissionService_SequentialProperties/Concurrent_requests_with_different_outcomes (0.00s)
        testing.go:1617: race detected during execution of test
FAIL
FAIL	github.com/nexora/nexora/internal/permission	0.047s
==================
WARNING: DATA RACE
Write at 0x0000010351e0 by goroutine 12:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListByCategory()
      /home/nexora/internal/prompts/service_test.go:170 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x0000010351e0 by goroutine 13:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Search()
      /home/nexora/internal/prompts/service_test.go:208 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 12 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 13 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x0000010351e0 by goroutine 12:
  github.com/pressly/goose/v3.CollectMigrations()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:176 +0x124
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:46 +0xf7
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListByCategory()
      /home/nexora/internal/prompts/service_test.go:170 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x0000010351e0 by goroutine 17:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_UpdateRating()
      /home/nexora/internal/prompts/service_test.go:423 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 12 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 17 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 14:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Update()
      /home/nexora/internal/prompts/service_test.go:277 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x000001047f60 by goroutine 12:
  github.com/pressly/goose/v3.createVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:264 +0x10c
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:218 +0x19a
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListByCategory()
      /home/nexora/internal/prompts/service_test.go:170 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 14 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 12 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 17:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_UpdateRating()
      /home/nexora/internal/prompts/service_test.go:423 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x000001047f60 by goroutine 13:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Search()
      /home/nexora/internal/prompts/service_test.go:208 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 17 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 13 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x0000010351e0 by goroutine 10:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Get()
      /home/nexora/internal/prompts/service_test.go:92 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x0000010351e0 by goroutine 19:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListTop()
      /home/nexora/internal/prompts/service_test.go:497 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 10 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 19 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 10:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Get()
      /home/nexora/internal/prompts/service_test.go:92 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x000001047f60 by goroutine 19:
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:216 +0x77
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListTop()
      /home/nexora/internal/prompts/service_test.go:497 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 10 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 19 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x0000010351e0 by goroutine 16:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_IncrementUsage()
      /home/nexora/internal/prompts/service_test.go:371 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x0000010351e0 by goroutine 11:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_List()
      /home/nexora/internal/prompts/service_test.go:123 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 16 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 11 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 16:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_IncrementUsage()
      /home/nexora/internal/prompts/service_test.go:371 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x000001047f60 by goroutine 10:
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:216 +0x77
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Get()
      /home/nexora/internal/prompts/service_test.go:92 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 16 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 10 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 11:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_List()
      /home/nexora/internal/prompts/service_test.go:123 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x000001047f60 by goroutine 19:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListTop()
      /home/nexora/internal/prompts/service_test.go:497 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 11 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 19 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000290460 by goroutine 19:
  github.com/pressly/goose/v3/internal/legacystore.(*store).CreateVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:99 +0x50
  github.com/pressly/goose/v3.createVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:260 +0xd3
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:218 +0x19a
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_ListTop()
      /home/nexora/internal/prompts/service_test.go:497 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000290460 by goroutine 16:
  github.com/pressly/goose/v3/internal/legacystore.NewStore()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:79 +0x304
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x26e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_IncrementUsage()
      /home/nexora/internal/prompts/service_test.go:371 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 19 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 16 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0072cfd30 by goroutine 14:
  github.com/pressly/goose/v3/internal/legacystore.(*store).CreateVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:99 +0x50
  github.com/pressly/goose/v3.createVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:260 +0xd3
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:218 +0x19a
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Update()
      /home/nexora/internal/prompts/service_test.go:277 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0072cfd30 by goroutine 17:
  github.com/pressly/goose/v3/internal/legacystore.NewStore()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:79 +0x304
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x26e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_UpdateRating()
      /home/nexora/internal/prompts/service_test.go:423 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 14 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 17 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
2025/12/28 03:39:33 OK   20250424200609_initial.sql (15.82ms)
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 18:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_GetByTag()
      /home/nexora/internal/prompts/service_test.go:456 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x000001047f60 by goroutine 17:
  github.com/pressly/goose/v3.listAllDBVersions()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:185 +0x6e
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_UpdateRating()
      /home/nexora/internal/prompts/service_test.go:423 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 18 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 17 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 9:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Create()
      /home/nexora/internal/prompts/service_test.go:32 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x000001047f60 by goroutine 13:
  github.com/pressly/goose/v3.createVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:264 +0x10c
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:218 +0x19a
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Search()
      /home/nexora/internal/prompts/service_test.go:208 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 9 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 13 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
2025/12/28 03:39:33 OK   20250424200609_initial.sql (20.42ms)
==================
WARNING: DATA RACE
Read at 0x0000010351e0 by goroutine 10:
  github.com/pressly/goose/v3.(*Migration).run()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:217 +0x711
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Get()
      /home/nexora/internal/prompts/service_test.go:92 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x0000010351e0 by goroutine 9:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Create()
      /home/nexora/internal/prompts/service_test.go:32 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 10 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 9 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0065accb0 by goroutine 18:
  github.com/pressly/goose/v3/internal/legacystore.(*store).CreateVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:99 +0x50
  github.com/pressly/goose/v3.createVersionTable()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:260 +0xd3
  github.com/pressly/goose/v3.EnsureDBVersionContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migrate.go:218 +0x19a
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_GetByTag()
      /home/nexora/internal/prompts/service_test.go:456 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0065accb0 by goroutine 9:
  github.com/pressly/goose/v3/internal/legacystore.NewStore()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:79 +0x304
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x26e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Create()
      /home/nexora/internal/prompts/service_test.go:32 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 18 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 9 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.21ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.09ms)
==================
WARNING: DATA RACE
Write at 0x0000010351e0 by goroutine 15:
  github.com/pressly/goose/v3.SetBaseFS()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/goose.go:38 +0x4c5
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:51 +0x49f
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Delete()
      /home/nexora/internal/prompts/service_test.go:340 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x0000010351e0 by goroutine 10:
  github.com/pressly/goose/v3.(*Migration).run()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:217 +0x711
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Get()
      /home/nexora/internal/prompts/service_test.go:92 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 15 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 10 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x000001047f60 by goroutine 15:
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x28e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Delete()
      /home/nexora/internal/prompts/service_test.go:340 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x000001047f60 by goroutine 10:
  github.com/pressly/goose/v3.runSQLMigration()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration_sql.go:48 +0x4a4
  github.com/pressly/goose/v3.(*Migration).run()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:229 +0xc6c
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.(*Migration).UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/migration.go:194 +0x8ea
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:110 +0x8f4
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Get()
      /home/nexora/internal/prompts/service_test.go:92 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 15 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 10 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c001707bf0 by goroutine 18:
  github.com/pressly/goose/v3/internal/legacystore.(*store).ListMigrations()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:148 +0x86
  github.com/pressly/goose/v3.listAllDBVersions()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:185 +0xa7
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:66 +0x2f0
  github.com/pressly/goose/v3.UpToContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:63 +0x2ca
  github.com/pressly/goose/v3.UpContext()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:168 +0x91
  github.com/pressly/goose/v3.Up()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/up.go:163 +0x12
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:58 +0x6ab
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_GetByTag()
      /home/nexora/internal/prompts/service_test.go:456 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c001707bf0 by goroutine 15:
  github.com/pressly/goose/v3/internal/legacystore.NewStore()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/internal/legacystore/legacystore.go:79 +0x304
  github.com/pressly/goose/v3.SetDialect()
      /home/agent/go/pkg/mod/github.com/pressly/goose/v3@v3.26.0/dialect.go:69 +0x26e
  github.com/nexora/nexora/internal/db.Connect()
      /home/nexora/internal/db/connect.go:53 +0x519
  github.com/nexora/nexora/internal/prompts.setupTestDB()
      /home/nexora/internal/prompts/service_test.go:20 +0x53
  github.com/nexora/nexora/internal/prompts.TestService_Delete()
      /home/nexora/internal/prompts/service_test.go:340 +0x45
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 18 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164

Goroutine 15 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:65 +0x164
==================
2025/12/28 03:39:33 OK   20250627000000_add_provider_to_messages.sql (7.82ms)
2025/12/28 03:39:33 OK   20250810000000_add_is_summary_message.sql (1.13ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (44.49ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (41.21ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (71.49ms)
2025/12/28 03:39:33 OK   20251217221932_add_context_archive.sql (2.73ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.24ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.32ms)
2025/12/28 03:39:33 OK   20250627000000_add_provider_to_messages.sql (1.07ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.22ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (24.82ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (70.62ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.17ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.15ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (40.25ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (88.96ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (19.75ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (8.52ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (45.56ms)
2025/12/28 03:39:33 OK   20251225000007_create_prompt_library.sql (31.62ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.44ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (4.07ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (7.17ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.25ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.54ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (13.59ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.13ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.25ms)
2025/12/28 03:39:33 OK   20250627000000_add_provider_to_messages.sql (1.12ms)
2025/12/28 03:39:33 OK   20250424200609_initial.sql (69.82ms)
2025/12/28 03:39:33 OK   20250627000000_add_provider_to_messages.sql (2.12ms)
2025/12/28 03:39:33 OK   20250810000000_add_is_summary_message.sql (5.55ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (4.81ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.37ms)
2025/12/28 03:39:33 OK   20250627000000_add_provider_to_messages.sql (17.26ms)
2025/12/28 03:39:33 OK   20250624000000_add_created_at_indexes.sql (1.29ms)
2025/12/28 03:39:33 OK   20250627000000_add_provider_to_messages.sql (16.33ms)
2025/12/28 03:39:33 OK   20250515105448_add_summary_message_id.sql (1.12ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.63ms)
2025/12/28 03:39:34 OK   20250627000000_add_provider_to_messages.sql (187.12ms)
2025/12/28 03:39:34 OK   20250627000000_add_provider_to_messages.sql (3.25ms)
2025/12/28 03:39:34 OK   20250627000000_add_provider_to_messages.sql (1.43ms)
2025/12/28 03:39:34 OK   20250624000000_add_created_at_indexes.sql (8.17ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (4.3ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (8.58ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.46ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (18.84ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.43ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.48ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.26ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (258ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.89ms)
2025/12/28 03:39:34 OK   20250627000000_add_provider_to_messages.sql (11.05ms)
2025/12/28 03:39:34 OK   20250627000000_add_provider_to_messages.sql (1.57ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (7.12ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (16.82ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.21ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (21.72ms)
2025/12/28 03:39:34 OK   20250810000000_add_is_summary_message.sql (1.14ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (26.11ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (14.32ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (17.42ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (27.31ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (44.97ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (29.97ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (28.1ms)
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (6.36ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (10.36ms)
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (6.89ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (15.67ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (8.12ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (6.12ms)
--- FAIL: TestService_UpdateRating (13.96s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (13.86ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
--- FAIL: TestService_IncrementUsage (13.97s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestService_Get (13.98s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (31.38ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (26.94ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (12.4ms)
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (19.32ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (45.47ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (10.9ms)
2025/12/28 03:39:34 OK   20251217221932_add_context_archive.sql (11.29ms)
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (2.52ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (27.23ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (46.48ms)
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (8.14ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (11.06ms)
--- FAIL: TestService_GetByTag (14.03s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (7.77ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
2025/12/28 03:39:34 OK   20251225000007_create_prompt_library.sql (17.13ms)
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (2.12ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
--- FAIL: TestService_Create (14.05s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (13.47ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
--- FAIL: TestService_List (14.06s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (64.31ms)
--- FAIL: TestService_Update (14.07s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestService_ListByCategory (14.07s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (27.74ms)
2025/12/28 03:39:34 OK   20251226000001_fix_prompt_library_timestamps.sql (43.68ms)
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (8.38ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (2.97ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
--- FAIL: TestService_Delete (14.09s)
    testing.go:1617: race detected during execution of test
2025/12/28 03:39:34 OK   20251227000001_create_checkpoints.sql (2.42ms)
2025/12/28 03:39:34 goose: successfully migrated database to version: 20251227000001
--- FAIL: TestService_ListTop (14.10s)
    testing.go:1617: race detected during execution of test
--- FAIL: TestService_Search (14.11s)
    testing.go:1617: race detected during execution of test
FAIL
FAIL	github.com/nexora/nexora/internal/prompts	14.252s
ok  	github.com/nexora/nexora/internal/pubsub	1.202s
ok  	github.com/nexora/nexora/internal/resources	1.380s
ok  	github.com/nexora/nexora/internal/session	14.792s
?   	github.com/nexora/nexora/internal/sessionlog	[no test files]
ok  	github.com/nexora/nexora/internal/shell	5.093s
ok  	github.com/nexora/nexora/internal/stringext	1.065s
ok  	github.com/nexora/nexora/internal/task	1.110s
ok  	github.com/nexora/nexora/internal/term	1.046s
?   	github.com/nexora/nexora/internal/testutil	[no test files]
ok  	github.com/nexora/nexora/internal/tui	23.134s
?   	github.com/nexora/nexora/internal/tui/components/aiops	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/anim	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/banner	(cached)
ok  	github.com/nexora/nexora/internal/tui/components/chat	1.645s
?   	github.com/nexora/nexora/internal/tui/components/chat/editor	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/chat/header	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/chat/messages	1.294s
ok  	github.com/nexora/nexora/internal/tui/components/chat/sidebar	1.349s
ok  	github.com/nexora/nexora/internal/tui/components/chat/splash	1.266s
?   	github.com/nexora/nexora/internal/tui/components/completions	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/core	1.262s
ok  	github.com/nexora/nexora/internal/tui/components/core/layout	1.021s
ok  	github.com/nexora/nexora/internal/tui/components/core/status	6.280s
?   	github.com/nexora/nexora/internal/tui/components/dialogs	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/dialogs/about	1.245s
?   	github.com/nexora/nexora/internal/tui/components/dialogs/claude	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/dialogs/commands	1.316s
?   	github.com/nexora/nexora/internal/tui/components/dialogs/filepicker	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/dialogs/models	1.292s
?   	github.com/nexora/nexora/internal/tui/components/dialogs/permissions	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/dialogs/quit	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/dialogs/reasoning	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/dialogs/sessions	[no test files]
ok  	github.com/nexora/nexora/internal/tui/components/dialogs/settings	1.233s
?   	github.com/nexora/nexora/internal/tui/components/files	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/image	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/logo	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/lsp	[no test files]
?   	github.com/nexora/nexora/internal/tui/components/mcp	[no test files]
ok  	github.com/nexora/nexora/internal/tui/exp/diffview	3.433s
==================
WARNING: DATA RACE
Read at 0x00000114ecc0 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:517 +0x71
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00000114ecc0 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x98
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0004ba2b8 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Manager).Current()
      /home/nexora/internal/tui/styles/theme.go:540 +0xf3
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:520 +0xce
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0004ba2b8 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:524 +0x44
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000448308 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:137 +0x11c
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000448308 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0004460a0 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:145 +0x7a
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0004460a0 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446020 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:149 +0x16b
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446020 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446050 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:152 +0x244
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446050 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446030 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:156 +0x386
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446030 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0004460e0 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:160 +0x5a5
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0004460e0 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0004460b0 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:162 +0x68d
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0004460b0 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c0004460d0 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:164 +0x772
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0004460d0 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446110 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:166 +0x84f
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446110 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446120 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:168 +0x92f
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446120 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446130 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:170 +0xa0f
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446130 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
[down ctrl+j ctrl+n]
--- FAIL: TestUpdateKeyMap (0.01s)
    testing.go:1617: race detected during execution of test
==================
WARNING: DATA RACE
Read at 0x00c000448308 by goroutine 31:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:137 +0x5d6
  github.com/nexora/nexora/internal/tui/exp/list.(*list[go.shape.interface { GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]).View()
      /home/nexora/internal/tui/exp/list/list.go:522 +0x69b
  github.com/nexora/nexora/internal/tui/exp/list.TestList.func1()
      /home/nexora/internal/tui/exp/list/list_test.go:48 +0xc65
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000448308 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x148
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 31 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestList()
      /home/nexora/internal/tui/exp/list/list_test.go:20 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (finished) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000454000 by goroutine 31:
  github.com/nexora/nexora/internal/tui/exp/list.(*list[go.shape.interface { GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]).View()
      /home/nexora/internal/tui/exp/list/list.go:523 +0x6ce
  github.com/nexora/nexora/internal/tui/exp/list.TestList.func1()
      /home/nexora/internal/tui/exp/list/list_test.go:48 +0xc65
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000454000 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:147 +0x53f0
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 31 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestList()
      /home/nexora/internal/tui/exp/list/list_test.go:20 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (finished) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446140 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:172 +0xaef
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446140 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (finished) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Read at 0x00c000446040 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:178 +0xcb0
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c000446040 by goroutine 26:
  github.com/nexora/nexora/internal/tui/styles.NewCharmtoneTheme()
      /home/nexora/internal/tui/styles/charmtone.go:9 +0xd6
  github.com/nexora/nexora/internal/tui/styles.NewManager()
      /home/nexora/internal/tui/styles/theme.go:528 +0xab
  github.com/nexora/nexora/internal/tui/styles.CurrentTheme()
      /home/nexora/internal/tui/styles/theme.go:518 +0x84
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:91 +0x65
  github.com/nexora/nexora/internal/tui/exp/list.TestUpdateKeyMap()
      /home/nexora/internal/tui/exp/list/filterable_test.go:39 +0x13e
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 26 (finished) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  testing.runTests.func1()
      /usr/lib/go/src/testing/testing.go:2477 +0x85
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.runTests()
      /usr/lib/go/src/testing/testing.go:2475 +0x96c
  testing.(*M).Run()
      /usr/lib/go/src/testing/testing.go:2337 +0xed4
  main.main()
      _testmain.go:51 +0x164
==================
==================
WARNING: DATA RACE
Write at 0x00c000448308 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x148
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous read at 0x00c000448308 by goroutine 31:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:140 +0x658
  github.com/nexora/nexora/internal/tui/exp/list.(*list[go.shape.interface { GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]).View()
      /home/nexora/internal/tui/exp/list/list.go:522 +0x69b
  github.com/nexora/nexora/internal/tui/exp/list.TestList.func1()
      /home/nexora/internal/tui/exp/list/list_test.go:48 +0xc65
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 31 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestList()
      /home/nexora/internal/tui/exp/list/list_test.go:20 +0x4b
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
==================
WARNING: DATA RACE
Read at 0x00c0005c6000 by goroutine 32:
  github.com/nexora/nexora/internal/tui/exp/list.(*list[go.shape.interface { GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]).View()
      /home/nexora/internal/tui/exp/list/list.go:523 +0x6ce
  github.com/nexora/nexora/internal/tui/exp/list.TestList.func2()
      /home/nexora/internal/tui/exp/list/list_test.go:78 +0xc65
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Previous write at 0x00c0005c6000 by goroutine 29:
  github.com/nexora/nexora/internal/tui/styles.(*Theme).buildStyles()
      /home/nexora/internal/tui/styles/theme.go:147 +0x53f0
  github.com/nexora/nexora/internal/tui/styles.(*Theme).S()
      /home/nexora/internal/tui/styles/theme.go:138 +0x133
  github.com/nexora/nexora/internal/tui/exp/list.NewFilterableList[go.shape.interface { FilterValue() string; GetSize() (int, int); ID() string; Init() charm.land/bubbletea/v2.Cmd; SetSize(int, int) charm.land/bubbletea/v2.Cmd; Update(github.com/charmbracelet/ultraviolet.Event) (github.com/nexora/nexora/internal/tui/util.Model, charm.land/bubbletea/v2.Cmd); View() string }]()
      /home/nexora/internal/tui/exp/list/filterable.go:95 +0x273
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList.func1()
      /home/nexora/internal/tui/exp/list/filterable_test.go:21 +0x2a4
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 32 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestList()
      /home/nexora/internal/tui/exp/list/list_test.go:50 +0x68
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44

Goroutine 29 (running) created at:
  testing.(*T).Run()
      /usr/lib/go/src/testing/testing.go:1997 +0x9d2
  github.com/nexora/nexora/internal/tui/exp/list.TestFilterableList()
      /home/nexora/internal/tui/exp/list/filterable_test.go:14 +0x44
  testing.tRunner()
      /usr/lib/go/src/testing/testing.go:1934 +0x21c
  testing.(*T).Run.gowrap1()
      /usr/lib/go/src/testing/testing.go:1997 +0x44
==================
--- FAIL: TestList (0.01s)
    testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_have_correct_positions_in_list_that_fits_the_items_backwards (0.01s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_have_correct_positions_in_list_that_fits_the_items (0.02s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_have_correct_positions_in_list_that_does_not_fits_the_items_and_has_multi_line_items_backwards (0.02s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_have_correct_positions_in_list_that_does_not_fits_the_items (0.01s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_have_correct_positions_in_list_that_does_not_fits_the_items_backwards (0.02s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_go_to_selected_item_at_the_beginning (0.02s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_go_to_selected_item_at_the_beginning_backwards (0.02s)
        testing.go:1617: race detected during execution of test
    --- FAIL: TestList/should_have_correct_positions_in_list_that_does_not_fits_the_items_and_has_multi_line_items (0.02s)
        testing.go:1617: race detected during execution of test
--- FAIL: TestFilterableList (0.00s)
    --- FAIL: TestFilterableList/should_create_simple_filterable_list (0.06s)
        testing.go:1617: race detected during execution of test
--- FAIL: TestListMovement (0.03s)
    testing.go:1617: race detected during execution of test
    --- FAIL: TestListMovement/should_move_viewport_up_and_down (0.00s)
        testing.go:1617: race detected during execution of test
FAIL
FAIL	github.com/nexora/nexora/internal/tui/exp/list	0.282s
?   	github.com/nexora/nexora/internal/tui/highlight	[no test files]
?   	github.com/nexora/nexora/internal/tui/page	[no test files]
ok  	github.com/nexora/nexora/internal/tui/page/chat	1.179s
?   	github.com/nexora/nexora/internal/tui/page/prompts	[no test files]
ok  	github.com/nexora/nexora/internal/tui/styles	1.145s
ok  	github.com/nexora/nexora/internal/tui/util	1.022s
ok  	github.com/nexora/nexora/internal/update	1.022s
ok  	github.com/nexora/nexora/internal/version	1.016s
--- FAIL: TestLocalModelsFullFlow (2.01s)
    --- FAIL: TestLocalModelsFullFlow/Timeout30s (2.00s)
        local_models_test.go:126: test timed out after 1s
FAIL
FAIL	github.com/nexora/nexora/qa	14.866s
?   	github.com/nexora/nexora/qa/testutil	[no test files]
FAIL
